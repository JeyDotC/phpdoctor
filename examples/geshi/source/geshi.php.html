<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">

<html lang="en">
<head>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<meta name="generator" content="PHPDoctor 2RC4 (http://peej.github.com/phpdoctor/)">
<meta name="when" content="Sun, 25 Apr 2010 10:25:53 +0100">

<link rel="stylesheet" type="text/css" href="../stylesheet.css">
<link rel="start" href="../overview-summary.html">

<title>geshi.php (GeSHi)</title>

</head>
<body id="file" onload="parent.document.title=document.title;">

<div class="header">
<h1>GeSHi</h1>
<ul>
<li><a href="../overview-summary.html">Overview</a></li>
<li>Package</li><li>Class</li><li>Tree</li><li><a href="../overview-files.html">Files</a></li>
<li><a href="../deprecated-list.html">Deprecated</a></li>
<li><a href="../index-all.html">Index</a></li>
</ul>
</div>

<div class="small_links">
<a href="../index.html" target="_top">Frames</a>
<a href="../source/geshi.php.html" target="_top">No frames</a>
</div>
<hr>

<h1>geshi.php</h1>
<div class="comment" id="overview_description"><p>GeSHi - Generic Syntax Highlighter</p><p>The GeSHi class for Generic Syntax Highlighting. Please refer to the
documentation at http://qbnz.com/highlighter/documentation.php for more
information about how to use this class.</p><p>For changes, release notes, TODOs etc, see the relevant files in the docs/
directory.</p><p>This file is part of GeSHi.</p><p>GeSHi is free software; you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation; either version 2 of the License, or
(at your option) any later version.</p><p>GeSHi is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.</p><p>You should have received a copy of the GNU General Public License
along with GeSHi; if not, write to the Free Software
Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA</p></div>

<hr>

<a name="line1"></a><pre class="php" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">&lt;?php</span>
<a name="line2"></a><span style="color: #009933; font-style: italic;">/**
<a name="line3"></a> * GeSHi - Generic Syntax Highlighter
<a name="line4"></a> *
<a name="line5"></a> * The GeSHi class for Generic Syntax Highlighting. Please refer to the
<a name="line6"></a> * documentation at http://qbnz.com/highlighter/documentation.php for more
<a name="line7"></a> * information about how to use this class.
<a name="line8"></a> *
<a name="line9"></a> * For changes, release notes, TODOs etc, see the relevant files in the docs/
<a name="line10"></a> * directory.
<a name="line11"></a> *
<a name="line12"></a> *   This file is part of GeSHi.
<a name="line13"></a> *
<a name="line14"></a> *  GeSHi is free software; you can redistribute it and/or modify
<a name="line15"></a> *  it under the terms of the GNU General Public License as published by
<a name="line16"></a> *  the Free Software Foundation; either version 2 of the License, or
<a name="line17"></a> *  (at your option) any later version.
<a name="line18"></a> *
<a name="line19"></a> *  GeSHi is distributed in the hope that it will be useful,
<a name="line20"></a> *  but WITHOUT ANY WARRANTY; without even the implied warranty of
<a name="line21"></a> *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
<a name="line22"></a> *  GNU General Public License for more details.
<a name="line23"></a> *
<a name="line24"></a> *  You should have received a copy of the GNU General Public License
<a name="line25"></a> *  along with GeSHi; if not, write to the Free Software
<a name="line26"></a> *  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
<a name="line27"></a> *
<a name="line28"></a> * @package    geshi
<a name="line29"></a> * @subpackage core
<a name="line30"></a> * @author     Nigel McNie &lt;nigel@geshi.org&gt;, Benny Baumann &lt;BenBE@omorphia.de&gt;
<a name="line31"></a> * @copyright  (C) 2004 - 2007 Nigel McNie, (C) 2007 - 2008 Benny Baumann
<a name="line32"></a> * @license    http://gnu.org/copyleft/gpl.html GNU GPL
<a name="line33"></a> *
<a name="line34"></a> */</span>
<a name="line35"></a>&nbsp;
<a name="line36"></a><span style="color: #666666; font-style: italic;">//</span>
<a name="line37"></a><span style="color: #666666; font-style: italic;">// GeSHi Constants</span>
<a name="line38"></a><span style="color: #666666; font-style: italic;">// You should use these constant names in your programs instead of</span>
<a name="line39"></a><span style="color: #666666; font-style: italic;">// their values - you never know when a value may change in a future</span>
<a name="line40"></a><span style="color: #666666; font-style: italic;">// version</span>
<a name="line41"></a><span style="color: #666666; font-style: italic;">//</span>
<a name="line42"></a>&nbsp;
<a name="line43"></a><span style="color: #009933; font-style: italic;">/** The version of this GeSHi file */</span>
<a name="line44"></a><a href="http://www.php.net/define"><span style="color: #990000;">define</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'GESHI_VERSION'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'1.0.8.3'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line45"></a>&nbsp;
<a name="line46"></a><span style="color: #666666; font-style: italic;">// Define the root directory for the GeSHi code tree</span>
<a name="line47"></a><span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><a href="http://www.php.net/defined"><span style="color: #990000;">defined</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'GESHI_ROOT'</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line48"></a>    <span style="color: #009933; font-style: italic;">/** The root directory for GeSHi */</span>
<a name="line49"></a>    <a href="http://www.php.net/define"><span style="color: #990000;">define</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'GESHI_ROOT'</span><span style="color: #339933;">,</span> <a href="http://www.php.net/dirname"><span style="color: #990000;">dirname</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900; font-weight: bold;">__FILE__</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">.</span> <span style="color: #009900; font-weight: bold;">DIRECTORY_SEPARATOR</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line50"></a><span style="color: #009900;">&#125;</span>
<a name="line51"></a><span style="color: #009933; font-style: italic;">/** The language file directory for GeSHi
<a name="line52"></a>    @access private */</span>
<a name="line53"></a><a href="http://www.php.net/define"><span style="color: #990000;">define</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'GESHI_LANG_ROOT'</span><span style="color: #339933;">,</span> GESHI_ROOT <span style="color: #339933;">.</span> <span style="color: #0000ff;">'geshi'</span> <span style="color: #339933;">.</span> <span style="color: #009900; font-weight: bold;">DIRECTORY_SEPARATOR</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line54"></a>&nbsp;
<a name="line55"></a><span style="color: #666666; font-style: italic;">// Define if GeSHi should be paranoid about security</span>
<a name="line56"></a><span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><a href="http://www.php.net/defined"><span style="color: #990000;">defined</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'GESHI_SECURITY_PARANOID'</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line57"></a>    <span style="color: #009933; font-style: italic;">/** Tells GeSHi to be paranoid about security settings */</span>
<a name="line58"></a>    <a href="http://www.php.net/define"><span style="color: #990000;">define</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'GESHI_SECURITY_PARANOID'</span><span style="color: #339933;">,</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line59"></a><span style="color: #009900;">&#125;</span>
<a name="line60"></a>&nbsp;
<a name="line61"></a><span style="color: #666666; font-style: italic;">// Line numbers - use with enable_line_numbers()</span>
<a name="line62"></a><span style="color: #009933; font-style: italic;">/** Use no line numbers when building the result */</span>
<a name="line63"></a><a href="http://www.php.net/define"><span style="color: #990000;">define</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'GESHI_NO_LINE_NUMBERS'</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line64"></a><span style="color: #009933; font-style: italic;">/** Use normal line numbers when building the result */</span>
<a name="line65"></a><a href="http://www.php.net/define"><span style="color: #990000;">define</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'GESHI_NORMAL_LINE_NUMBERS'</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line66"></a><span style="color: #009933; font-style: italic;">/** Use fancy line numbers when building the result */</span>
<a name="line67"></a><a href="http://www.php.net/define"><span style="color: #990000;">define</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'GESHI_FANCY_LINE_NUMBERS'</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">2</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line68"></a>&nbsp;
<a name="line69"></a><span style="color: #666666; font-style: italic;">// Container HTML type</span>
<a name="line70"></a><span style="color: #009933; font-style: italic;">/** Use nothing to surround the source */</span>
<a name="line71"></a><a href="http://www.php.net/define"><span style="color: #990000;">define</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'GESHI_HEADER_NONE'</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line72"></a><span style="color: #009933; font-style: italic;">/** Use a &quot;div&quot; to surround the source */</span>
<a name="line73"></a><a href="http://www.php.net/define"><span style="color: #990000;">define</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'GESHI_HEADER_DIV'</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line74"></a><span style="color: #009933; font-style: italic;">/** Use a &quot;pre&quot; to surround the source */</span>
<a name="line75"></a><a href="http://www.php.net/define"><span style="color: #990000;">define</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'GESHI_HEADER_PRE'</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">2</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line76"></a><span style="color: #009933; font-style: italic;">/** Use a pre to wrap lines when line numbers are enabled or to wrap the whole code. */</span>
<a name="line77"></a><a href="http://www.php.net/define"><span style="color: #990000;">define</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'GESHI_HEADER_PRE_VALID'</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">3</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line78"></a><span style="color: #009933; font-style: italic;">/**
<a name="line79"></a> * Use a &quot;table&quot; to surround the source:
<a name="line80"></a> *
<a name="line81"></a> *  &lt;table&gt;
<a name="line82"></a> *    &lt;thead&gt;&lt;tr&gt;&lt;td colspan=&quot;2&quot;&gt;$header&lt;/td&gt;&lt;/tr&gt;&lt;/thead&gt;
<a name="line83"></a> *    &lt;tbody&gt;&lt;tr&gt;&lt;td&gt;&lt;pre&gt;$linenumbers&lt;/pre&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;$code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;
<a name="line84"></a> *    &lt;tfooter&gt;&lt;tr&gt;&lt;td colspan=&quot;2&quot;&gt;$footer&lt;/td&gt;&lt;/tr&gt;&lt;/tfoot&gt;
<a name="line85"></a> *  &lt;/table&gt;
<a name="line86"></a> *
<a name="line87"></a> * this is essentially only a workaround for Firefox, see sf#1651996 or take a look at
<a name="line88"></a> * https://bugzilla.mozilla.org/show_bug.cgi?id=365805
<a name="line89"></a> * @note when linenumbers are disabled this is essentially the same as GESHI_HEADER_PRE
<a name="line90"></a> */</span>
<a name="line91"></a><a href="http://www.php.net/define"><span style="color: #990000;">define</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'GESHI_HEADER_PRE_TABLE'</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">4</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line92"></a>&nbsp;
<a name="line93"></a><span style="color: #666666; font-style: italic;">// Capatalisation constants</span>
<a name="line94"></a><span style="color: #009933; font-style: italic;">/** Lowercase keywords found */</span>
<a name="line95"></a><a href="http://www.php.net/define"><span style="color: #990000;">define</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'GESHI_CAPS_NO_CHANGE'</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line96"></a><span style="color: #009933; font-style: italic;">/** Uppercase keywords found */</span>
<a name="line97"></a><a href="http://www.php.net/define"><span style="color: #990000;">define</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'GESHI_CAPS_UPPER'</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line98"></a><span style="color: #009933; font-style: italic;">/** Leave keywords found as the case that they are */</span>
<a name="line99"></a><a href="http://www.php.net/define"><span style="color: #990000;">define</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'GESHI_CAPS_LOWER'</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">2</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line100"></a>&nbsp;
<a name="line101"></a><span style="color: #666666; font-style: italic;">// Link style constants</span>
<a name="line102"></a><span style="color: #009933; font-style: italic;">/** Links in the source in the :link state */</span>
<a name="line103"></a><a href="http://www.php.net/define"><span style="color: #990000;">define</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'GESHI_LINK'</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line104"></a><span style="color: #009933; font-style: italic;">/** Links in the source in the :hover state */</span>
<a name="line105"></a><a href="http://www.php.net/define"><span style="color: #990000;">define</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'GESHI_HOVER'</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line106"></a><span style="color: #009933; font-style: italic;">/** Links in the source in the :active state */</span>
<a name="line107"></a><a href="http://www.php.net/define"><span style="color: #990000;">define</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'GESHI_ACTIVE'</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">2</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line108"></a><span style="color: #009933; font-style: italic;">/** Links in the source in the :visited state */</span>
<a name="line109"></a><a href="http://www.php.net/define"><span style="color: #990000;">define</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'GESHI_VISITED'</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">3</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line110"></a>&nbsp;
<a name="line111"></a><span style="color: #666666; font-style: italic;">// Important string starter/finisher</span>
<a name="line112"></a><span style="color: #666666; font-style: italic;">// Note that if you change these, they should be as-is: i.e., don't</span>
<a name="line113"></a><span style="color: #666666; font-style: italic;">// write them as if they had been run through htmlentities()</span>
<a name="line114"></a><span style="color: #009933; font-style: italic;">/** The starter for important parts of the source */</span>
<a name="line115"></a><a href="http://www.php.net/define"><span style="color: #990000;">define</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'GESHI_START_IMPORTANT'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'&lt;BEGIN GeSHi&gt;'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line116"></a><span style="color: #009933; font-style: italic;">/** The ender for important parts of the source */</span>
<a name="line117"></a><a href="http://www.php.net/define"><span style="color: #990000;">define</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'GESHI_END_IMPORTANT'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'&lt;END GeSHi&gt;'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line118"></a>&nbsp;
<a name="line119"></a><span style="color: #009933; font-style: italic;">/**#@+
<a name="line120"></a> *  @access private
<a name="line121"></a> */</span>
<a name="line122"></a><span style="color: #666666; font-style: italic;">// When strict mode applies for a language</span>
<a name="line123"></a><span style="color: #009933; font-style: italic;">/** Strict mode never applies (this is the most common) */</span>
<a name="line124"></a><a href="http://www.php.net/define"><span style="color: #990000;">define</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'GESHI_NEVER'</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line125"></a><span style="color: #009933; font-style: italic;">/** Strict mode *might* apply, and can be enabled or
<a name="line126"></a>    disabled by {@link GeSHi-&gt;enable_strict_mode()} */</span>
<a name="line127"></a><a href="http://www.php.net/define"><span style="color: #990000;">define</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'GESHI_MAYBE'</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line128"></a><span style="color: #009933; font-style: italic;">/** Strict mode always applies */</span>
<a name="line129"></a><a href="http://www.php.net/define"><span style="color: #990000;">define</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'GESHI_ALWAYS'</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">2</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line130"></a>&nbsp;
<a name="line131"></a><span style="color: #666666; font-style: italic;">// Advanced regexp handling constants, used in language files</span>
<a name="line132"></a><span style="color: #009933; font-style: italic;">/** The key of the regex array defining what to search for */</span>
<a name="line133"></a><a href="http://www.php.net/define"><span style="color: #990000;">define</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'GESHI_SEARCH'</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line134"></a><span style="color: #009933; font-style: italic;">/** The key of the regex array defining what bracket group in a
<a name="line135"></a>    matched search to use as a replacement */</span>
<a name="line136"></a><a href="http://www.php.net/define"><span style="color: #990000;">define</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'GESHI_REPLACE'</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line137"></a><span style="color: #009933; font-style: italic;">/** The key of the regex array defining any modifiers to the regular expression */</span>
<a name="line138"></a><a href="http://www.php.net/define"><span style="color: #990000;">define</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'GESHI_MODIFIERS'</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">2</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line139"></a><span style="color: #009933; font-style: italic;">/** The key of the regex array defining what bracket group in a
<a name="line140"></a>    matched search to put before the replacement */</span>
<a name="line141"></a><a href="http://www.php.net/define"><span style="color: #990000;">define</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'GESHI_BEFORE'</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">3</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line142"></a><span style="color: #009933; font-style: italic;">/** The key of the regex array defining what bracket group in a
<a name="line143"></a>    matched search to put after the replacement */</span>
<a name="line144"></a><a href="http://www.php.net/define"><span style="color: #990000;">define</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'GESHI_AFTER'</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">4</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line145"></a><span style="color: #009933; font-style: italic;">/** The key of the regex array defining a custom keyword to use
<a name="line146"></a>    for this regexp's html tag class */</span>
<a name="line147"></a><a href="http://www.php.net/define"><span style="color: #990000;">define</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'GESHI_CLASS'</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">5</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line148"></a>&nbsp;
<a name="line149"></a><span style="color: #009933; font-style: italic;">/** Used in language files to mark comments */</span>
<a name="line150"></a><a href="http://www.php.net/define"><span style="color: #990000;">define</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'GESHI_COMMENTS'</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line151"></a>&nbsp;
<a name="line152"></a><span style="color: #009933; font-style: italic;">/** Used to work around missing PHP features **/</span>
<a name="line153"></a><a href="http://www.php.net/define"><span style="color: #990000;">define</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'GESHI_PHP_PRE_433'</span><span style="color: #339933;">,</span> <span style="color: #339933;">!</span><span style="color: #009900;">&#40;</span><a href="http://www.php.net/version_compare"><span style="color: #990000;">version_compare</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900; font-weight: bold;">PHP_VERSION</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'4.3.3'</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">===</span> <span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line154"></a>&nbsp;
<a name="line155"></a><span style="color: #009933; font-style: italic;">/** make sure we can call stripos **/</span>
<a name="line156"></a><span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><a href="http://www.php.net/function_exists"><span style="color: #990000;">function_exists</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'stripos'</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line157"></a>    <span style="color: #666666; font-style: italic;">// the offset param of preg_match is not supported below PHP 4.3.3</span>
<a name="line158"></a>    <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span>GESHI_PHP_PRE_433<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line159"></a>        <span style="color: #009933; font-style: italic;">/**
<a name="line160"></a>         * @ignore
<a name="line161"></a>         */</span>
<a name="line162"></a>        <span style="color: #000000; font-weight: bold;">function</span> <a href="http://www.php.net/stripos"><span style="color: #990000;">stripos</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$haystack</span><span style="color: #339933;">,</span> <span style="color: #000088;">$needle</span><span style="color: #339933;">,</span> <span style="color: #000088;">$offset</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">null</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line163"></a>            <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><a href="http://www.php.net/is_null"><span style="color: #990000;">is_null</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$offset</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line164"></a>                <span style="color: #000088;">$haystack</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/substr"><span style="color: #990000;">substr</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$haystack</span><span style="color: #339933;">,</span> <span style="color: #000088;">$offset</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line165"></a>            <span style="color: #009900;">&#125;</span>
<a name="line166"></a>            <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><a href="http://www.php.net/preg_match"><span style="color: #990000;">preg_match</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'/'</span><span style="color: #339933;">.</span> <a href="http://www.php.net/preg_quote"><span style="color: #990000;">preg_quote</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$needle</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'/'</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">'/'</span><span style="color: #339933;">,</span> <span style="color: #000088;">$haystack</span><span style="color: #339933;">,</span> <span style="color: #000088;">$match</span><span style="color: #339933;">,</span> PREG_OFFSET_CAPTURE<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line167"></a>                <span style="color: #b1b100;">return</span> <span style="color: #000088;">$match</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
<a name="line168"></a>            <span style="color: #009900;">&#125;</span>
<a name="line169"></a>            <span style="color: #b1b100;">return</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #339933;">;</span>
<a name="line170"></a>        <span style="color: #009900;">&#125;</span>
<a name="line171"></a>    <span style="color: #009900;">&#125;</span>
<a name="line172"></a>    <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line173"></a>        <span style="color: #009933; font-style: italic;">/**
<a name="line174"></a>         * @ignore
<a name="line175"></a>         */</span>
<a name="line176"></a>        <span style="color: #000000; font-weight: bold;">function</span> <a href="http://www.php.net/stripos"><span style="color: #990000;">stripos</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$haystack</span><span style="color: #339933;">,</span> <span style="color: #000088;">$needle</span><span style="color: #339933;">,</span> <span style="color: #000088;">$offset</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">null</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line177"></a>            <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><a href="http://www.php.net/preg_match"><span style="color: #990000;">preg_match</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'/'</span><span style="color: #339933;">.</span> <a href="http://www.php.net/preg_quote"><span style="color: #990000;">preg_quote</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$needle</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'/'</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">'/'</span><span style="color: #339933;">,</span> <span style="color: #000088;">$haystack</span><span style="color: #339933;">,</span> <span style="color: #000088;">$match</span><span style="color: #339933;">,</span> PREG_OFFSET_CAPTURE<span style="color: #339933;">,</span> <span style="color: #000088;">$offset</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line178"></a>                <span style="color: #b1b100;">return</span> <span style="color: #000088;">$match</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
<a name="line179"></a>            <span style="color: #009900;">&#125;</span>
<a name="line180"></a>            <span style="color: #b1b100;">return</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #339933;">;</span>
<a name="line181"></a>        <span style="color: #009900;">&#125;</span>
<a name="line182"></a>    <span style="color: #009900;">&#125;</span>
<a name="line183"></a><span style="color: #009900;">&#125;</span>
<a name="line184"></a>&nbsp;
<a name="line185"></a><span style="color: #009933; font-style: italic;">/** some old PHP / PCRE subpatterns only support up to xxx subpatterns in
<a name="line186"></a>    regular expressions. Set this to false if your PCRE lib is up to date
<a name="line187"></a>    @see GeSHi-&gt;optimize_regexp_list()
<a name="line188"></a>    **/</span>
<a name="line189"></a><a href="http://www.php.net/define"><span style="color: #990000;">define</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'GESHI_MAX_PCRE_SUBPATTERNS'</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">500</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line190"></a><span style="color: #009933; font-style: italic;">/** it's also important not to generate too long regular expressions
<a name="line191"></a>    be generous here... but keep in mind, that when reaching this limit we
<a name="line192"></a>    still have to close open patterns. 12k should do just fine on a 16k limit.
<a name="line193"></a>    @see GeSHi-&gt;optimize_regexp_list()
<a name="line194"></a>    **/</span>
<a name="line195"></a><a href="http://www.php.net/define"><span style="color: #990000;">define</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'GESHI_MAX_PCRE_LENGTH'</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">12288</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line196"></a>&nbsp;
<a name="line197"></a><span style="color: #666666; font-style: italic;">//Number format specification</span>
<a name="line198"></a><span style="color: #009933; font-style: italic;">/** Basic number format for integers */</span>
<a name="line199"></a><a href="http://www.php.net/define"><span style="color: #990000;">define</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'GESHI_NUMBER_INT_BASIC'</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>        <span style="color: #666666; font-style: italic;">//Default integers \d+</span>
<a name="line200"></a><span style="color: #009933; font-style: italic;">/** Enhanced number format for integers like seen in C */</span>
<a name="line201"></a><a href="http://www.php.net/define"><span style="color: #990000;">define</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'GESHI_NUMBER_INT_CSTYLE'</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">2</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>       <span style="color: #666666; font-style: italic;">//Default C-Style \d+[lL]?</span>
<a name="line202"></a><span style="color: #009933; font-style: italic;">/** Number format to highlight binary numbers with a suffix &quot;b&quot; */</span>
<a name="line203"></a><a href="http://www.php.net/define"><span style="color: #990000;">define</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'GESHI_NUMBER_BIN_SUFFIX'</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">16</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>           <span style="color: #666666; font-style: italic;">//[01]+[bB]</span>
<a name="line204"></a><span style="color: #009933; font-style: italic;">/** Number format to highlight binary numbers with a prefix % */</span>
<a name="line205"></a><a href="http://www.php.net/define"><span style="color: #990000;">define</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'GESHI_NUMBER_BIN_PREFIX_PERCENT'</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">32</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>   <span style="color: #666666; font-style: italic;">//%[01]+</span>
<a name="line206"></a><span style="color: #009933; font-style: italic;">/** Number format to highlight binary numbers with a prefix 0b (C) */</span>
<a name="line207"></a><a href="http://www.php.net/define"><span style="color: #990000;">define</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'GESHI_NUMBER_BIN_PREFIX_0B'</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">64</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>        <span style="color: #666666; font-style: italic;">//0b[01]+</span>
<a name="line208"></a><span style="color: #009933; font-style: italic;">/** Number format to highlight octal numbers with a leading zero */</span>
<a name="line209"></a><a href="http://www.php.net/define"><span style="color: #990000;">define</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'GESHI_NUMBER_OCT_PREFIX'</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">256</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>           <span style="color: #666666; font-style: italic;">//0[0-7]+</span>
<a name="line210"></a><span style="color: #009933; font-style: italic;">/** Number format to highlight octal numbers with a suffix of o */</span>
<a name="line211"></a><a href="http://www.php.net/define"><span style="color: #990000;">define</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'GESHI_NUMBER_OCT_SUFFIX'</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">512</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>           <span style="color: #666666; font-style: italic;">//[0-7]+[oO]</span>
<a name="line212"></a><span style="color: #009933; font-style: italic;">/** Number format to highlight hex numbers with a prefix 0x */</span>
<a name="line213"></a><a href="http://www.php.net/define"><span style="color: #990000;">define</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'GESHI_NUMBER_HEX_PREFIX'</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">4096</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>           <span style="color: #666666; font-style: italic;">//0x[0-9a-fA-F]+</span>
<a name="line214"></a><span style="color: #009933; font-style: italic;">/** Number format to highlight hex numbers with a suffix of h */</span>
<a name="line215"></a><a href="http://www.php.net/define"><span style="color: #990000;">define</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'GESHI_NUMBER_HEX_SUFFIX'</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">8192</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>           <span style="color: #666666; font-style: italic;">//[0-9][0-9a-fA-F]*h</span>
<a name="line216"></a><span style="color: #009933; font-style: italic;">/** Number format to highlight floating-point numbers without support for scientific notation */</span>
<a name="line217"></a><a href="http://www.php.net/define"><span style="color: #990000;">define</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'GESHI_NUMBER_FLT_NONSCI'</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">65536</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>          <span style="color: #666666; font-style: italic;">//\d+\.\d+</span>
<a name="line218"></a><span style="color: #009933; font-style: italic;">/** Number format to highlight floating-point numbers without support for scientific notation */</span>
<a name="line219"></a><a href="http://www.php.net/define"><span style="color: #990000;">define</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'GESHI_NUMBER_FLT_NONSCI_F'</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">131072</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>       <span style="color: #666666; font-style: italic;">//\d+(\.\d+)?f</span>
<a name="line220"></a><span style="color: #009933; font-style: italic;">/** Number format to highlight floating-point numbers with support for scientific notation (E) and optional leading zero */</span>
<a name="line221"></a><a href="http://www.php.net/define"><span style="color: #990000;">define</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'GESHI_NUMBER_FLT_SCI_SHORT'</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">262144</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>      <span style="color: #666666; font-style: italic;">//\.\d+e\d+</span>
<a name="line222"></a><span style="color: #009933; font-style: italic;">/** Number format to highlight floating-point numbers with support for scientific notation (E) and required leading digit */</span>
<a name="line223"></a><a href="http://www.php.net/define"><span style="color: #990000;">define</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'GESHI_NUMBER_FLT_SCI_ZERO'</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">524288</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>       <span style="color: #666666; font-style: italic;">//\d+(\.\d+)?e\d+</span>
<a name="line224"></a><span style="color: #666666; font-style: italic;">//Custom formats are passed by RX array</span>
<a name="line225"></a>&nbsp;
<a name="line226"></a><span style="color: #666666; font-style: italic;">// Error detection - use these to analyse faults</span>
<a name="line227"></a><span style="color: #009933; font-style: italic;">/** No sourcecode to highlight was specified
<a name="line228"></a> * @deprecated
<a name="line229"></a> */</span>
<a name="line230"></a><a href="http://www.php.net/define"><span style="color: #990000;">define</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'GESHI_ERROR_NO_INPUT'</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line231"></a><span style="color: #009933; font-style: italic;">/** The language specified does not exist */</span>
<a name="line232"></a><a href="http://www.php.net/define"><span style="color: #990000;">define</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'GESHI_ERROR_NO_SUCH_LANG'</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">2</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line233"></a><span style="color: #009933; font-style: italic;">/** GeSHi could not open a file for reading (generally a language file) */</span>
<a name="line234"></a><a href="http://www.php.net/define"><span style="color: #990000;">define</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'GESHI_ERROR_FILE_NOT_READABLE'</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">3</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line235"></a><span style="color: #009933; font-style: italic;">/** The header type passed to {@link GeSHi-&gt;set_header_type()} was invalid */</span>
<a name="line236"></a><a href="http://www.php.net/define"><span style="color: #990000;">define</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'GESHI_ERROR_INVALID_HEADER_TYPE'</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">4</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line237"></a><span style="color: #009933; font-style: italic;">/** The line number type passed to {@link GeSHi-&gt;enable_line_numbers()} was invalid */</span>
<a name="line238"></a><a href="http://www.php.net/define"><span style="color: #990000;">define</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'GESHI_ERROR_INVALID_LINE_NUMBER_TYPE'</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">5</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line239"></a><span style="color: #009933; font-style: italic;">/**#@-*/</span>
<a name="line240"></a>&nbsp;
<a name="line241"></a>&nbsp;
<a name="line242"></a><span style="color: #009933; font-style: italic;">/**
<a name="line243"></a> * The GeSHi Class.
<a name="line244"></a> *
<a name="line245"></a> * Please refer to the documentation for GeSHi 1.0.X that is available
<a name="line246"></a> * at http://qbnz.com/highlighter/documentation.php for more information
<a name="line247"></a> * about how to use this class.
<a name="line248"></a> *
<a name="line249"></a> * @package   geshi
<a name="line250"></a> * @author    Nigel McNie &lt;nigel@geshi.org&gt;, Benny Baumann &lt;BenBE@omorphia.de&gt;
<a name="line251"></a> * @copyright (C) 2004 - 2007 Nigel McNie, (C) 2007 - 2008 Benny Baumann
<a name="line252"></a> */</span>
<a name="line253"></a><span style="color: #000000; font-weight: bold;">class</span> GeSHi <span style="color: #009900;">&#123;</span>
<a name="line254"></a>    <span style="color: #009933; font-style: italic;">/**#@+
<a name="line255"></a>     * @access private
<a name="line256"></a>     */</span>
<a name="line257"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line258"></a>     * The source code to highlight
<a name="line259"></a>     * @var string
<a name="line260"></a>     */</span>
<a name="line261"></a>    <span style="color: #000000; font-weight: bold;">var</span> <span style="color: #000088;">$source</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">''</span><span style="color: #339933;">;</span>
<a name="line262"></a>&nbsp;
<a name="line263"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line264"></a>     * The language to use when highlighting
<a name="line265"></a>     * @var string
<a name="line266"></a>     */</span>
<a name="line267"></a>    <span style="color: #000000; font-weight: bold;">var</span> <span style="color: #000088;">$language</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">''</span><span style="color: #339933;">;</span>
<a name="line268"></a>&nbsp;
<a name="line269"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line270"></a>     * The data for the language used
<a name="line271"></a>     * @var array
<a name="line272"></a>     */</span>
<a name="line273"></a>    <span style="color: #000000; font-weight: bold;">var</span> <span style="color: #000088;">$language_data</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line274"></a>&nbsp;
<a name="line275"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line276"></a>     * The path to the language files
<a name="line277"></a>     * @var string
<a name="line278"></a>     */</span>
<a name="line279"></a>    <span style="color: #000000; font-weight: bold;">var</span> <span style="color: #000088;">$language_path</span> <span style="color: #339933;">=</span> GESHI_LANG_ROOT<span style="color: #339933;">;</span>
<a name="line280"></a>&nbsp;
<a name="line281"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line282"></a>     * The error message associated with an error
<a name="line283"></a>     * @var string
<a name="line284"></a>     * @todo check err reporting works
<a name="line285"></a>     */</span>
<a name="line286"></a>    <span style="color: #000000; font-weight: bold;">var</span> <span style="color: #000088;">$error</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #339933;">;</span>
<a name="line287"></a>&nbsp;
<a name="line288"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line289"></a>     * Possible error messages
<a name="line290"></a>     * @var array
<a name="line291"></a>     */</span>
<a name="line292"></a>    <span style="color: #000000; font-weight: bold;">var</span> <span style="color: #000088;">$error_messages</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span>
<a name="line293"></a>        GESHI_ERROR_NO_SUCH_LANG <span style="color: #339933;">=&gt;</span> <span style="color: #0000ff;">'GeSHi could not find the language {LANGUAGE} (using path {PATH})'</span><span style="color: #339933;">,</span>
<a name="line294"></a>        GESHI_ERROR_FILE_NOT_READABLE <span style="color: #339933;">=&gt;</span> <span style="color: #0000ff;">'The file specified for load_from_file was not readable'</span><span style="color: #339933;">,</span>
<a name="line295"></a>        GESHI_ERROR_INVALID_HEADER_TYPE <span style="color: #339933;">=&gt;</span> <span style="color: #0000ff;">'The header type specified is invalid'</span><span style="color: #339933;">,</span>
<a name="line296"></a>        GESHI_ERROR_INVALID_LINE_NUMBER_TYPE <span style="color: #339933;">=&gt;</span> <span style="color: #0000ff;">'The line number type specified is invalid'</span>
<a name="line297"></a>    <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line298"></a>&nbsp;
<a name="line299"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line300"></a>     * Whether highlighting is strict or not
<a name="line301"></a>     * @var boolean
<a name="line302"></a>     */</span>
<a name="line303"></a>    <span style="color: #000000; font-weight: bold;">var</span> <span style="color: #000088;">$strict_mode</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #339933;">;</span>
<a name="line304"></a>&nbsp;
<a name="line305"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line306"></a>     * Whether to use CSS classes in output
<a name="line307"></a>     * @var boolean
<a name="line308"></a>     */</span>
<a name="line309"></a>    <span style="color: #000000; font-weight: bold;">var</span> <span style="color: #000088;">$use_classes</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #339933;">;</span>
<a name="line310"></a>&nbsp;
<a name="line311"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line312"></a>     * The type of header to use. Can be one of the following
<a name="line313"></a>     * values:
<a name="line314"></a>     *
<a name="line315"></a>     * - GESHI_HEADER_PRE: Source is outputted in a &quot;pre&quot; HTML element.
<a name="line316"></a>     * - GESHI_HEADER_DIV: Source is outputted in a &quot;div&quot; HTML element.
<a name="line317"></a>     * - GESHI_HEADER_NONE: No header is outputted.
<a name="line318"></a>     *
<a name="line319"></a>     * @var int
<a name="line320"></a>     */</span>
<a name="line321"></a>    <span style="color: #000000; font-weight: bold;">var</span> <span style="color: #000088;">$header_type</span> <span style="color: #339933;">=</span> GESHI_HEADER_PRE<span style="color: #339933;">;</span>
<a name="line322"></a>&nbsp;
<a name="line323"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line324"></a>     * Array of permissions for which lexics should be highlighted
<a name="line325"></a>     * @var array
<a name="line326"></a>     */</span>
<a name="line327"></a>    <span style="color: #000000; font-weight: bold;">var</span> <span style="color: #000088;">$lexic_permissions</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span>
<a name="line328"></a>        <span style="color: #0000ff;">'KEYWORDS'</span> <span style="color: #339933;">=&gt;</span>    <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span>
<a name="line329"></a>        <span style="color: #0000ff;">'COMMENTS'</span> <span style="color: #339933;">=&gt;</span>    <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'MULTI'</span> <span style="color: #339933;">=&gt;</span> <span style="color: #009900; font-weight: bold;">true</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span>
<a name="line330"></a>        <span style="color: #0000ff;">'REGEXPS'</span> <span style="color: #339933;">=&gt;</span>     <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span>
<a name="line331"></a>        <span style="color: #0000ff;">'ESCAPE_CHAR'</span> <span style="color: #339933;">=&gt;</span> <span style="color: #009900; font-weight: bold;">true</span><span style="color: #339933;">,</span>
<a name="line332"></a>        <span style="color: #0000ff;">'BRACKETS'</span> <span style="color: #339933;">=&gt;</span>    <span style="color: #009900; font-weight: bold;">true</span><span style="color: #339933;">,</span>
<a name="line333"></a>        <span style="color: #0000ff;">'SYMBOLS'</span> <span style="color: #339933;">=&gt;</span>     <span style="color: #009900; font-weight: bold;">false</span><span style="color: #339933;">,</span>
<a name="line334"></a>        <span style="color: #0000ff;">'STRINGS'</span> <span style="color: #339933;">=&gt;</span>     <span style="color: #009900; font-weight: bold;">true</span><span style="color: #339933;">,</span>
<a name="line335"></a>        <span style="color: #0000ff;">'NUMBERS'</span> <span style="color: #339933;">=&gt;</span>     <span style="color: #009900; font-weight: bold;">true</span><span style="color: #339933;">,</span>
<a name="line336"></a>        <span style="color: #0000ff;">'METHODS'</span> <span style="color: #339933;">=&gt;</span>     <span style="color: #009900; font-weight: bold;">true</span><span style="color: #339933;">,</span>
<a name="line337"></a>        <span style="color: #0000ff;">'SCRIPT'</span> <span style="color: #339933;">=&gt;</span>      <span style="color: #009900; font-weight: bold;">true</span>
<a name="line338"></a>    <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line339"></a>&nbsp;
<a name="line340"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line341"></a>     * The time it took to parse the code
<a name="line342"></a>     * @var double
<a name="line343"></a>     */</span>
<a name="line344"></a>    <span style="color: #000000; font-weight: bold;">var</span> <span style="color: #000088;">$time</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span>
<a name="line345"></a>&nbsp;
<a name="line346"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line347"></a>     * The content of the header block
<a name="line348"></a>     * @var string
<a name="line349"></a>     */</span>
<a name="line350"></a>    <span style="color: #000000; font-weight: bold;">var</span> <span style="color: #000088;">$header_content</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">''</span><span style="color: #339933;">;</span>
<a name="line351"></a>&nbsp;
<a name="line352"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line353"></a>     * The content of the footer block
<a name="line354"></a>     * @var string
<a name="line355"></a>     */</span>
<a name="line356"></a>    <span style="color: #000000; font-weight: bold;">var</span> <span style="color: #000088;">$footer_content</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">''</span><span style="color: #339933;">;</span>
<a name="line357"></a>&nbsp;
<a name="line358"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line359"></a>     * The style of the header block
<a name="line360"></a>     * @var string
<a name="line361"></a>     */</span>
<a name="line362"></a>    <span style="color: #000000; font-weight: bold;">var</span> <span style="color: #000088;">$header_content_style</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">''</span><span style="color: #339933;">;</span>
<a name="line363"></a>&nbsp;
<a name="line364"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line365"></a>     * The style of the footer block
<a name="line366"></a>     * @var string
<a name="line367"></a>     */</span>
<a name="line368"></a>    <span style="color: #000000; font-weight: bold;">var</span> <span style="color: #000088;">$footer_content_style</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">''</span><span style="color: #339933;">;</span>
<a name="line369"></a>&nbsp;
<a name="line370"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line371"></a>     * Tells if a block around the highlighted source should be forced
<a name="line372"></a>     * if not using line numbering
<a name="line373"></a>     * @var boolean
<a name="line374"></a>     */</span>
<a name="line375"></a>    <span style="color: #000000; font-weight: bold;">var</span> <span style="color: #000088;">$force_code_block</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #339933;">;</span>
<a name="line376"></a>&nbsp;
<a name="line377"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line378"></a>     * The styles for hyperlinks in the code
<a name="line379"></a>     * @var array
<a name="line380"></a>     */</span>
<a name="line381"></a>    <span style="color: #000000; font-weight: bold;">var</span> <span style="color: #000088;">$link_styles</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line382"></a>&nbsp;
<a name="line383"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line384"></a>     * Whether important blocks should be recognised or not
<a name="line385"></a>     * @var boolean
<a name="line386"></a>     * @deprecated
<a name="line387"></a>     * @todo REMOVE THIS FUNCTIONALITY!
<a name="line388"></a>     */</span>
<a name="line389"></a>    <span style="color: #000000; font-weight: bold;">var</span> <span style="color: #000088;">$enable_important_blocks</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #339933;">;</span>
<a name="line390"></a>&nbsp;
<a name="line391"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line392"></a>     * Styles for important parts of the code
<a name="line393"></a>     * @var string
<a name="line394"></a>     * @deprecated
<a name="line395"></a>     * @todo As above - rethink the whole idea of important blocks as it is buggy and
<a name="line396"></a>     * will be hard to implement in 1.2
<a name="line397"></a>     */</span>
<a name="line398"></a>    <span style="color: #000000; font-weight: bold;">var</span> <span style="color: #000088;">$important_styles</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">'font-weight: bold; color: red;'</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">// Styles for important parts of the code</span>
<a name="line399"></a>&nbsp;
<a name="line400"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line401"></a>     * Whether CSS IDs should be added to the code
<a name="line402"></a>     * @var boolean
<a name="line403"></a>     */</span>
<a name="line404"></a>    <span style="color: #000000; font-weight: bold;">var</span> <span style="color: #000088;">$add_ids</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #339933;">;</span>
<a name="line405"></a>&nbsp;
<a name="line406"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line407"></a>     * Lines that should be highlighted extra
<a name="line408"></a>     * @var array
<a name="line409"></a>     */</span>
<a name="line410"></a>    <span style="color: #000000; font-weight: bold;">var</span> <span style="color: #000088;">$highlight_extra_lines</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line411"></a>&nbsp;
<a name="line412"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line413"></a>     * Styles of lines that should be highlighted extra
<a name="line414"></a>     * @var array
<a name="line415"></a>     */</span>
<a name="line416"></a>    <span style="color: #000000; font-weight: bold;">var</span> <span style="color: #000088;">$highlight_extra_lines_styles</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line417"></a>&nbsp;
<a name="line418"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line419"></a>     * Styles of extra-highlighted lines
<a name="line420"></a>     * @var string
<a name="line421"></a>     */</span>
<a name="line422"></a>    <span style="color: #000000; font-weight: bold;">var</span> <span style="color: #000088;">$highlight_extra_lines_style</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">'background-color: #ffc;'</span><span style="color: #339933;">;</span>
<a name="line423"></a>&nbsp;
<a name="line424"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line425"></a>     * The line ending
<a name="line426"></a>     * If null, nl2br() will be used on the result string.
<a name="line427"></a>     * Otherwise, all instances of \n will be replaced with $line_ending
<a name="line428"></a>     * @var string
<a name="line429"></a>     */</span>
<a name="line430"></a>    <span style="color: #000000; font-weight: bold;">var</span> <span style="color: #000088;">$line_ending</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">null</span><span style="color: #339933;">;</span>
<a name="line431"></a>&nbsp;
<a name="line432"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line433"></a>     * Number at which line numbers should start at
<a name="line434"></a>     * @var int
<a name="line435"></a>     */</span>
<a name="line436"></a>    <span style="color: #000000; font-weight: bold;">var</span> <span style="color: #000088;">$line_numbers_start</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">1</span><span style="color: #339933;">;</span>
<a name="line437"></a>&nbsp;
<a name="line438"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line439"></a>     * The overall style for this code block
<a name="line440"></a>     * @var string
<a name="line441"></a>     */</span>
<a name="line442"></a>    <span style="color: #000000; font-weight: bold;">var</span> <span style="color: #000088;">$overall_style</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">'font-family:monospace;'</span><span style="color: #339933;">;</span>
<a name="line443"></a>&nbsp;
<a name="line444"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line445"></a>     *  The style for the actual code
<a name="line446"></a>     * @var string
<a name="line447"></a>     */</span>
<a name="line448"></a>    <span style="color: #000000; font-weight: bold;">var</span> <span style="color: #000088;">$code_style</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">'font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;'</span><span style="color: #339933;">;</span>
<a name="line449"></a>&nbsp;
<a name="line450"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line451"></a>     * The overall class for this code block
<a name="line452"></a>     * @var string
<a name="line453"></a>     */</span>
<a name="line454"></a>    <span style="color: #000000; font-weight: bold;">var</span> <span style="color: #000088;">$overall_class</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">''</span><span style="color: #339933;">;</span>
<a name="line455"></a>&nbsp;
<a name="line456"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line457"></a>     * The overall ID for this code block
<a name="line458"></a>     * @var string
<a name="line459"></a>     */</span>
<a name="line460"></a>    <span style="color: #000000; font-weight: bold;">var</span> <span style="color: #000088;">$overall_id</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">''</span><span style="color: #339933;">;</span>
<a name="line461"></a>&nbsp;
<a name="line462"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line463"></a>     * Line number styles
<a name="line464"></a>     * @var string
<a name="line465"></a>     */</span>
<a name="line466"></a>    <span style="color: #000000; font-weight: bold;">var</span> <span style="color: #000088;">$line_style1</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">'font-weight: normal; vertical-align:top;'</span><span style="color: #339933;">;</span>
<a name="line467"></a>&nbsp;
<a name="line468"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line469"></a>     * Line number styles for fancy lines
<a name="line470"></a>     * @var string
<a name="line471"></a>     */</span>
<a name="line472"></a>    <span style="color: #000000; font-weight: bold;">var</span> <span style="color: #000088;">$line_style2</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">'font-weight: bold; vertical-align:top;'</span><span style="color: #339933;">;</span>
<a name="line473"></a>&nbsp;
<a name="line474"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line475"></a>     * Style for line numbers when GESHI_HEADER_PRE_TABLE is chosen
<a name="line476"></a>     * @var string
<a name="line477"></a>     */</span>
<a name="line478"></a>    <span style="color: #000000; font-weight: bold;">var</span> <span style="color: #000088;">$table_linenumber_style</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">'width:1px;text-align:right;margin:0;padding:0 2px;vertical-align:top;'</span><span style="color: #339933;">;</span>
<a name="line479"></a>&nbsp;
<a name="line480"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line481"></a>     * Flag for how line numbers are displayed
<a name="line482"></a>     * @var boolean
<a name="line483"></a>     */</span>
<a name="line484"></a>    <span style="color: #000000; font-weight: bold;">var</span> <span style="color: #000088;">$line_numbers</span> <span style="color: #339933;">=</span> GESHI_NO_LINE_NUMBERS<span style="color: #339933;">;</span>
<a name="line485"></a>&nbsp;
<a name="line486"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line487"></a>     * Flag to decide if multi line spans are allowed. Set it to false to make sure
<a name="line488"></a>     * each tag is closed before and reopened after each linefeed.
<a name="line489"></a>     * @var boolean
<a name="line490"></a>     */</span>
<a name="line491"></a>    <span style="color: #000000; font-weight: bold;">var</span> <span style="color: #000088;">$allow_multiline_span</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">true</span><span style="color: #339933;">;</span>
<a name="line492"></a>&nbsp;
<a name="line493"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line494"></a>     * The &quot;nth&quot; value for fancy line highlighting
<a name="line495"></a>     * @var int
<a name="line496"></a>     */</span>
<a name="line497"></a>    <span style="color: #000000; font-weight: bold;">var</span> <span style="color: #000088;">$line_nth_row</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span>
<a name="line498"></a>&nbsp;
<a name="line499"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line500"></a>     * The size of tab stops
<a name="line501"></a>     * @var int
<a name="line502"></a>     */</span>
<a name="line503"></a>    <span style="color: #000000; font-weight: bold;">var</span> <span style="color: #000088;">$tab_width</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">8</span><span style="color: #339933;">;</span>
<a name="line504"></a>&nbsp;
<a name="line505"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line506"></a>     * Should we use language-defined tab stop widths?
<a name="line507"></a>     * @var int
<a name="line508"></a>     */</span>
<a name="line509"></a>    <span style="color: #000000; font-weight: bold;">var</span> <span style="color: #000088;">$use_language_tab_width</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #339933;">;</span>
<a name="line510"></a>&nbsp;
<a name="line511"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line512"></a>     * Default target for keyword links
<a name="line513"></a>     * @var string
<a name="line514"></a>     */</span>
<a name="line515"></a>    <span style="color: #000000; font-weight: bold;">var</span> <span style="color: #000088;">$link_target</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">''</span><span style="color: #339933;">;</span>
<a name="line516"></a>&nbsp;
<a name="line517"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line518"></a>     * The encoding to use for entity encoding
<a name="line519"></a>     * NOTE: Used with Escape Char Sequences to fix UTF-8 handling (cf. SF#2037598)
<a name="line520"></a>     * @var string
<a name="line521"></a>     */</span>
<a name="line522"></a>    <span style="color: #000000; font-weight: bold;">var</span> <span style="color: #000088;">$encoding</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">'utf-8'</span><span style="color: #339933;">;</span>
<a name="line523"></a>&nbsp;
<a name="line524"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line525"></a>     * Should keywords be linked?
<a name="line526"></a>     * @var boolean
<a name="line527"></a>     */</span>
<a name="line528"></a>    <span style="color: #000000; font-weight: bold;">var</span> <span style="color: #000088;">$keyword_links</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">true</span><span style="color: #339933;">;</span>
<a name="line529"></a>&nbsp;
<a name="line530"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line531"></a>     * Currently loaded language file
<a name="line532"></a>     * @var string
<a name="line533"></a>     * @since 1.0.7.22
<a name="line534"></a>     */</span>
<a name="line535"></a>    <span style="color: #000000; font-weight: bold;">var</span> <span style="color: #000088;">$loaded_language</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">''</span><span style="color: #339933;">;</span>
<a name="line536"></a>&nbsp;
<a name="line537"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line538"></a>     * Wether the caches needed for parsing are built or not
<a name="line539"></a>     *
<a name="line540"></a>     * @var bool
<a name="line541"></a>     * @since 1.0.8
<a name="line542"></a>     */</span>
<a name="line543"></a>    <span style="color: #000000; font-weight: bold;">var</span> <span style="color: #000088;">$parse_cache_built</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #339933;">;</span>
<a name="line544"></a>&nbsp;
<a name="line545"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line546"></a>     * Work around for Suhosin Patch with disabled /e modifier
<a name="line547"></a>     *
<a name="line548"></a>     * Note from suhosins author in config file:
<a name="line549"></a>     * &lt;blockquote&gt;
<a name="line550"></a>     *   The /e modifier inside &lt;code&gt;preg_replace()&lt;/code&gt; allows code execution.
<a name="line551"></a>     *   Often it is the cause for remote code execution exploits. It is wise to
<a name="line552"></a>     *   deactivate this feature and test where in the application it is used.
<a name="line553"></a>     *   The developer using the /e modifier should be made aware that he should
<a name="line554"></a>     *   use &lt;code&gt;preg_replace_callback()&lt;/code&gt; instead
<a name="line555"></a>     * &lt;/blockquote&gt;
<a name="line556"></a>     *
<a name="line557"></a>     * @var array
<a name="line558"></a>     * @since 1.0.8
<a name="line559"></a>     */</span>
<a name="line560"></a>    <span style="color: #000000; font-weight: bold;">var</span> <span style="color: #000088;">$_kw_replace_group</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span>
<a name="line561"></a>    <span style="color: #000000; font-weight: bold;">var</span> <span style="color: #000088;">$_rx_key</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span>
<a name="line562"></a>&nbsp;
<a name="line563"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line564"></a>     * some &quot;callback parameters&quot; for handle_multiline_regexps
<a name="line565"></a>     *
<a name="line566"></a>     * @since 1.0.8
<a name="line567"></a>     * @access private
<a name="line568"></a>     * @var string
<a name="line569"></a>     */</span>
<a name="line570"></a>    <span style="color: #000000; font-weight: bold;">var</span> <span style="color: #000088;">$_hmr_before</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">''</span><span style="color: #339933;">;</span>
<a name="line571"></a>    <span style="color: #000000; font-weight: bold;">var</span> <span style="color: #000088;">$_hmr_replace</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">''</span><span style="color: #339933;">;</span>
<a name="line572"></a>    <span style="color: #000000; font-weight: bold;">var</span> <span style="color: #000088;">$_hmr_after</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">''</span><span style="color: #339933;">;</span>
<a name="line573"></a>    <span style="color: #000000; font-weight: bold;">var</span> <span style="color: #000088;">$_hmr_key</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span>
<a name="line574"></a>&nbsp;
<a name="line575"></a>    <span style="color: #009933; font-style: italic;">/**#@-*/</span>
<a name="line576"></a>&nbsp;
<a name="line577"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line578"></a>     * Creates a new GeSHi object, with source and language
<a name="line579"></a>     *
<a name="line580"></a>     * @param string The source code to highlight
<a name="line581"></a>     * @param string The language to highlight the source with
<a name="line582"></a>     * @param string The path to the language file directory. &lt;b&gt;This
<a name="line583"></a>     *               is deprecated!&lt;/b&gt; I've backported the auto path
<a name="line584"></a>     *               detection from the 1.1.X dev branch, so now it
<a name="line585"></a>     *               should be automatically set correctly. If you have
<a name="line586"></a>     *               renamed the language directory however, you will
<a name="line587"></a>     *               still need to set the path using this parameter or
<a name="line588"></a>     *               {@link GeSHi-&gt;set_language_path()}
<a name="line589"></a>     * @since 1.0.0
<a name="line590"></a>     */</span>
<a name="line591"></a>    <span style="color: #000000; font-weight: bold;">function</span> GeSHi<span style="color: #009900;">&#40;</span><span style="color: #000088;">$source</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">''</span><span style="color: #339933;">,</span> <span style="color: #000088;">$language</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">''</span><span style="color: #339933;">,</span> <span style="color: #000088;">$path</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">''</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line592"></a>        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><a href="http://www.php.net/empty"><span style="color: #990000;">empty</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$source</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line593"></a>            <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">set_source</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$source</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line594"></a>        <span style="color: #009900;">&#125;</span>
<a name="line595"></a>        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><a href="http://www.php.net/empty"><span style="color: #990000;">empty</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$language</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line596"></a>            <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">set_language</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$language</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line597"></a>        <span style="color: #009900;">&#125;</span>
<a name="line598"></a>        <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">set_language_path</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$path</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line599"></a>    <span style="color: #009900;">&#125;</span>
<a name="line600"></a>&nbsp;
<a name="line601"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line602"></a>     * Returns an error message associated with the last GeSHi operation,
<a name="line603"></a>     * or false if no error has occured
<a name="line604"></a>     *
<a name="line605"></a>     * @return string|false An error message if there has been an error, else false
<a name="line606"></a>     * @since  1.0.0
<a name="line607"></a>     */</span>
<a name="line608"></a>    <span style="color: #000000; font-weight: bold;">function</span> error<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line609"></a>        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">error</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line610"></a>            <span style="color: #666666; font-style: italic;">//Put some template variables for debugging here ...</span>
<a name="line611"></a>            <span style="color: #000088;">$debug_tpl_vars</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span>
<a name="line612"></a>                <span style="color: #0000ff;">'{LANGUAGE}'</span> <span style="color: #339933;">=&gt;</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language</span><span style="color: #339933;">,</span>
<a name="line613"></a>                <span style="color: #0000ff;">'{PATH}'</span> <span style="color: #339933;">=&gt;</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_path</span>
<a name="line614"></a>            <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line615"></a>            <span style="color: #000088;">$msg</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/str_replace"><span style="color: #990000;">str_replace</span></a><span style="color: #009900;">&#40;</span>
<a name="line616"></a>                <a href="http://www.php.net/array_keys"><span style="color: #990000;">array_keys</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$debug_tpl_vars</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span>
<a name="line617"></a>                <a href="http://www.php.net/array_values"><span style="color: #990000;">array_values</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$debug_tpl_vars</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span>
<a name="line618"></a>                <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">error_messages</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">error</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line619"></a>&nbsp;
<a name="line620"></a>            <span style="color: #b1b100;">return</span> <span style="color: #0000ff;">&quot;&lt;br /&gt;&lt;strong&gt;GeSHi Error:&lt;/strong&gt; <span style="color: #006699; font-weight: bold;">$msg</span> (code <span style="color: #006699; font-weight: bold;">{$this-&gt;error}</span>)&lt;br /&gt;&quot;</span><span style="color: #339933;">;</span>
<a name="line621"></a>        <span style="color: #009900;">&#125;</span>
<a name="line622"></a>        <span style="color: #b1b100;">return</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #339933;">;</span>
<a name="line623"></a>    <span style="color: #009900;">&#125;</span>
<a name="line624"></a>&nbsp;
<a name="line625"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line626"></a>     * Gets a human-readable language name (thanks to Simon Patterson
<a name="line627"></a>     * for the idea :))
<a name="line628"></a>     *
<a name="line629"></a>     * @return string The name for the current language
<a name="line630"></a>     * @since  1.0.2
<a name="line631"></a>     */</span>
<a name="line632"></a>    <span style="color: #000000; font-weight: bold;">function</span> get_language_name<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line633"></a>        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span>GESHI_ERROR_NO_SUCH_LANG <span style="color: #339933;">==</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">error</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line634"></a>            <span style="color: #b1b100;">return</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'LANG_NAME'</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">' (Unknown Language)'</span><span style="color: #339933;">;</span>
<a name="line635"></a>        <span style="color: #009900;">&#125;</span>
<a name="line636"></a>        <span style="color: #b1b100;">return</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'LANG_NAME'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
<a name="line637"></a>    <span style="color: #009900;">&#125;</span>
<a name="line638"></a>&nbsp;
<a name="line639"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line640"></a>     * Sets the source code for this object
<a name="line641"></a>     *
<a name="line642"></a>     * @param string The source code to highlight
<a name="line643"></a>     * @since 1.0.0
<a name="line644"></a>     */</span>
<a name="line645"></a>    <span style="color: #000000; font-weight: bold;">function</span> set_source<span style="color: #009900;">&#40;</span><span style="color: #000088;">$source</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line646"></a>        <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">source</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$source</span><span style="color: #339933;">;</span>
<a name="line647"></a>        <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">highlight_extra_lines</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line648"></a>    <span style="color: #009900;">&#125;</span>
<a name="line649"></a>&nbsp;
<a name="line650"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line651"></a>     * Sets the language for this object
<a name="line652"></a>     *
<a name="line653"></a>     * @note since 1.0.8 this function won't reset language-settings by default anymore!
<a name="line654"></a>     *       if you need this set $force_reset = true
<a name="line655"></a>     *
<a name="line656"></a>     * @param string The name of the language to use
<a name="line657"></a>     * @since 1.0.0
<a name="line658"></a>     */</span>
<a name="line659"></a>    <span style="color: #000000; font-weight: bold;">function</span> set_language<span style="color: #009900;">&#40;</span><span style="color: #000088;">$language</span><span style="color: #339933;">,</span> <span style="color: #000088;">$force_reset</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line660"></a>        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$force_reset</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line661"></a>            <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">loaded_language</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #339933;">;</span>
<a name="line662"></a>        <span style="color: #009900;">&#125;</span>
<a name="line663"></a>&nbsp;
<a name="line664"></a>        <span style="color: #666666; font-style: italic;">//Clean up the language name to prevent malicious code injection</span>
<a name="line665"></a>        <span style="color: #000088;">$language</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/preg_replace"><span style="color: #990000;">preg_replace</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'#[^a-zA-Z0-9\-_]#'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">''</span><span style="color: #339933;">,</span> <span style="color: #000088;">$language</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line666"></a>&nbsp;
<a name="line667"></a>        <span style="color: #000088;">$language</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/strtolower"><span style="color: #990000;">strtolower</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$language</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line668"></a>&nbsp;
<a name="line669"></a>        <span style="color: #666666; font-style: italic;">//Retreive the full filename</span>
<a name="line670"></a>        <span style="color: #000088;">$file_name</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_path</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$language</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">'.php'</span><span style="color: #339933;">;</span>
<a name="line671"></a>        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$file_name</span> <span style="color: #339933;">==</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">loaded_language</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line672"></a>            <span style="color: #666666; font-style: italic;">// this language is already loaded!</span>
<a name="line673"></a>            <span style="color: #b1b100;">return</span><span style="color: #339933;">;</span>
<a name="line674"></a>        <span style="color: #009900;">&#125;</span>
<a name="line675"></a>&nbsp;
<a name="line676"></a>        <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$language</span><span style="color: #339933;">;</span>
<a name="line677"></a>&nbsp;
<a name="line678"></a>        <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">error</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #339933;">;</span>
<a name="line679"></a>        <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">strict_mode</span> <span style="color: #339933;">=</span> GESHI_NEVER<span style="color: #339933;">;</span>
<a name="line680"></a>&nbsp;
<a name="line681"></a>        <span style="color: #666666; font-style: italic;">//Check if we can read the desired file</span>
<a name="line682"></a>        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><a href="http://www.php.net/is_readable"><span style="color: #990000;">is_readable</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$file_name</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line683"></a>            <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">error</span> <span style="color: #339933;">=</span> GESHI_ERROR_NO_SUCH_LANG<span style="color: #339933;">;</span>
<a name="line684"></a>            <span style="color: #b1b100;">return</span><span style="color: #339933;">;</span>
<a name="line685"></a>        <span style="color: #009900;">&#125;</span>
<a name="line686"></a>&nbsp;
<a name="line687"></a>        <span style="color: #666666; font-style: italic;">// Load the language for parsing</span>
<a name="line688"></a>        <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">load_language</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$file_name</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line689"></a>    <span style="color: #009900;">&#125;</span>
<a name="line690"></a>&nbsp;
<a name="line691"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line692"></a>     * Sets the path to the directory containing the language files. Note
<a name="line693"></a>     * that this path is relative to the directory of the script that included
<a name="line694"></a>     * geshi.php, NOT geshi.php itself.
<a name="line695"></a>     *
<a name="line696"></a>     * @param string The path to the language directory
<a name="line697"></a>     * @since 1.0.0
<a name="line698"></a>     * @deprecated The path to the language files should now be automatically
<a name="line699"></a>     *             detected, so this method should no longer be needed. The
<a name="line700"></a>     *             1.1.X branch handles manual setting of the path differently
<a name="line701"></a>     *             so this method will disappear in 1.2.0.
<a name="line702"></a>     */</span>
<a name="line703"></a>    <span style="color: #000000; font-weight: bold;">function</span> set_language_path<span style="color: #009900;">&#40;</span><span style="color: #000088;">$path</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line704"></a>        <span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><a href="http://www.php.net/strpos"><span style="color: #990000;">strpos</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$path</span><span style="color: #339933;">,</span><span style="color: #0000ff;">':'</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line705"></a>            <span style="color: #666666; font-style: italic;">//Security Fix to prevent external directories using fopen wrappers.</span>
<a name="line706"></a>            <span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #009900; font-weight: bold;">DIRECTORY_SEPARATOR</span> <span style="color: #339933;">==</span> <span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\\</span>&quot;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line707"></a>                <span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><a href="http://www.php.net/preg_match"><span style="color: #990000;">preg_match</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'#^[a-zA-Z]:#'</span><span style="color: #339933;">,</span> <span style="color: #000088;">$path</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">||</span> <span style="color: #009900; font-weight: bold;">false</span> <span style="color: #339933;">!==</span> <a href="http://www.php.net/strpos"><span style="color: #990000;">strpos</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$path</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">':'</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">2</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line708"></a>                    <span style="color: #b1b100;">return</span><span style="color: #339933;">;</span>
<a name="line709"></a>                <span style="color: #009900;">&#125;</span>
<a name="line710"></a>            <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line711"></a>                <span style="color: #b1b100;">return</span><span style="color: #339933;">;</span>
<a name="line712"></a>            <span style="color: #009900;">&#125;</span>
<a name="line713"></a>        <span style="color: #009900;">&#125;</span>
<a name="line714"></a>        <span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><a href="http://www.php.net/preg_match"><span style="color: #990000;">preg_match</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'#[^/a-zA-Z0-9_\.\-\\\s:]#'</span><span style="color: #339933;">,</span> <span style="color: #000088;">$path</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line715"></a>            <span style="color: #666666; font-style: italic;">//Security Fix to prevent external directories using fopen wrappers.</span>
<a name="line716"></a>            <span style="color: #b1b100;">return</span><span style="color: #339933;">;</span>
<a name="line717"></a>        <span style="color: #009900;">&#125;</span>
<a name="line718"></a>        <span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span>GESHI_SECURITY_PARANOID <span style="color: #339933;">&amp;&amp;</span> <span style="color: #009900; font-weight: bold;">false</span> <span style="color: #339933;">!==</span> <a href="http://www.php.net/strpos"><span style="color: #990000;">strpos</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$path</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'/.'</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line719"></a>            <span style="color: #666666; font-style: italic;">//Security Fix to prevent external directories using fopen wrappers.</span>
<a name="line720"></a>            <span style="color: #b1b100;">return</span><span style="color: #339933;">;</span>
<a name="line721"></a>        <span style="color: #009900;">&#125;</span>
<a name="line722"></a>        <span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span>GESHI_SECURITY_PARANOID <span style="color: #339933;">&amp;&amp;</span> <span style="color: #009900; font-weight: bold;">false</span> <span style="color: #339933;">!==</span> <a href="http://www.php.net/strpos"><span style="color: #990000;">strpos</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$path</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'..'</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line723"></a>            <span style="color: #666666; font-style: italic;">//Security Fix to prevent external directories using fopen wrappers.</span>
<a name="line724"></a>            <span style="color: #b1b100;">return</span><span style="color: #339933;">;</span>
<a name="line725"></a>        <span style="color: #009900;">&#125;</span>
<a name="line726"></a>        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$path</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line727"></a>            <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_path</span> <span style="color: #339933;">=</span> <span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'/'</span> <span style="color: #339933;">==</span> <span style="color: #000088;">$path</span><span style="color: #009900;">&#91;</span><a href="http://www.php.net/strlen"><span style="color: #990000;">strlen</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$path</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">-</span> <span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span> ? <span style="color: #000088;">$path</span> <span style="color: #339933;">:</span> <span style="color: #000088;">$path</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">'/'</span><span style="color: #339933;">;</span>
<a name="line728"></a>            <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">set_language</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">// otherwise set_language_path has no effect</span>
<a name="line729"></a>        <span style="color: #009900;">&#125;</span>
<a name="line730"></a>    <span style="color: #009900;">&#125;</span>
<a name="line731"></a>&nbsp;
<a name="line732"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line733"></a>     * Sets the type of header to be used.
<a name="line734"></a>     *
<a name="line735"></a>     * If GESHI_HEADER_DIV is used, the code is surrounded in a &quot;div&quot;.This
<a name="line736"></a>     * means more source code but more control over tab width and line-wrapping.
<a name="line737"></a>     * GESHI_HEADER_PRE means that a &quot;pre&quot; is used - less source, but less
<a name="line738"></a>     * control. Default is GESHI_HEADER_PRE.
<a name="line739"></a>     *
<a name="line740"></a>     * From 1.0.7.2, you can use GESHI_HEADER_NONE to specify that no header code
<a name="line741"></a>     * should be outputted.
<a name="line742"></a>     *
<a name="line743"></a>     * @param int The type of header to be used
<a name="line744"></a>     * @since 1.0.0
<a name="line745"></a>     */</span>
<a name="line746"></a>    <span style="color: #000000; font-weight: bold;">function</span> set_header_type<span style="color: #009900;">&#40;</span><span style="color: #000088;">$type</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line747"></a>        <span style="color: #666666; font-style: italic;">//Check if we got a valid header type</span>
<a name="line748"></a>        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><a href="http://www.php.net/in_array"><span style="color: #990000;">in_array</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$type</span><span style="color: #339933;">,</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span>GESHI_HEADER_NONE<span style="color: #339933;">,</span> GESHI_HEADER_DIV<span style="color: #339933;">,</span>
<a name="line749"></a>            GESHI_HEADER_PRE<span style="color: #339933;">,</span> GESHI_HEADER_PRE_VALID<span style="color: #339933;">,</span> GESHI_HEADER_PRE_TABLE<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line750"></a>            <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">error</span> <span style="color: #339933;">=</span> GESHI_ERROR_INVALID_HEADER_TYPE<span style="color: #339933;">;</span>
<a name="line751"></a>            <span style="color: #b1b100;">return</span><span style="color: #339933;">;</span>
<a name="line752"></a>        <span style="color: #009900;">&#125;</span>
<a name="line753"></a>&nbsp;
<a name="line754"></a>        <span style="color: #666666; font-style: italic;">//Set that new header type</span>
<a name="line755"></a>        <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">header_type</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$type</span><span style="color: #339933;">;</span>
<a name="line756"></a>    <span style="color: #009900;">&#125;</span>
<a name="line757"></a>&nbsp;
<a name="line758"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line759"></a>     * Sets the styles for the code that will be outputted
<a name="line760"></a>     * when this object is parsed. The style should be a
<a name="line761"></a>     * string of valid stylesheet declarations
<a name="line762"></a>     *
<a name="line763"></a>     * @param string  The overall style for the outputted code block
<a name="line764"></a>     * @param boolean Whether to merge the styles with the current styles or not
<a name="line765"></a>     * @since 1.0.0
<a name="line766"></a>     */</span>
<a name="line767"></a>    <span style="color: #000000; font-weight: bold;">function</span> set_overall_style<span style="color: #009900;">&#40;</span><span style="color: #000088;">$style</span><span style="color: #339933;">,</span> <span style="color: #000088;">$preserve_defaults</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line768"></a>        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><span style="color: #000088;">$preserve_defaults</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line769"></a>            <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">overall_style</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$style</span><span style="color: #339933;">;</span>
<a name="line770"></a>        <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line771"></a>            <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">overall_style</span> <span style="color: #339933;">.=</span> <span style="color: #000088;">$style</span><span style="color: #339933;">;</span>
<a name="line772"></a>        <span style="color: #009900;">&#125;</span>
<a name="line773"></a>    <span style="color: #009900;">&#125;</span>
<a name="line774"></a>&nbsp;
<a name="line775"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line776"></a>     * Sets the overall classname for this block of code. This
<a name="line777"></a>     * class can then be used in a stylesheet to style this object's
<a name="line778"></a>     * output
<a name="line779"></a>     *
<a name="line780"></a>     * @param string The class name to use for this block of code
<a name="line781"></a>     * @since 1.0.0
<a name="line782"></a>     */</span>
<a name="line783"></a>    <span style="color: #000000; font-weight: bold;">function</span> set_overall_class<span style="color: #009900;">&#40;</span><span style="color: #000088;">$class</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line784"></a>        <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">overall_class</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$class</span><span style="color: #339933;">;</span>
<a name="line785"></a>    <span style="color: #009900;">&#125;</span>
<a name="line786"></a>&nbsp;
<a name="line787"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line788"></a>     * Sets the overall id for this block of code. This id can then
<a name="line789"></a>     * be used in a stylesheet to style this object's output
<a name="line790"></a>     *
<a name="line791"></a>     * @param string The ID to use for this block of code
<a name="line792"></a>     * @since 1.0.0
<a name="line793"></a>     */</span>
<a name="line794"></a>    <span style="color: #000000; font-weight: bold;">function</span> set_overall_id<span style="color: #009900;">&#40;</span><span style="color: #000088;">$id</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line795"></a>        <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">overall_id</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$id</span><span style="color: #339933;">;</span>
<a name="line796"></a>    <span style="color: #009900;">&#125;</span>
<a name="line797"></a>&nbsp;
<a name="line798"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line799"></a>     * Sets whether CSS classes should be used to highlight the source. Default
<a name="line800"></a>     * is off, calling this method with no arguments will turn it on
<a name="line801"></a>     *
<a name="line802"></a>     * @param boolean Whether to turn classes on or not
<a name="line803"></a>     * @since 1.0.0
<a name="line804"></a>     */</span>
<a name="line805"></a>    <span style="color: #000000; font-weight: bold;">function</span> enable_classes<span style="color: #009900;">&#40;</span><span style="color: #000088;">$flag</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">true</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line806"></a>        <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">use_classes</span> <span style="color: #339933;">=</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$flag</span><span style="color: #009900;">&#41;</span> ? <span style="color: #009900; font-weight: bold;">true</span> <span style="color: #339933;">:</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #339933;">;</span>
<a name="line807"></a>    <span style="color: #009900;">&#125;</span>
<a name="line808"></a>&nbsp;
<a name="line809"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line810"></a>     * Sets the style for the actual code. This should be a string
<a name="line811"></a>     * containing valid stylesheet declarations. If $preserve_defaults is
<a name="line812"></a>     * true, then styles are merged with the default styles, with the
<a name="line813"></a>     * user defined styles having priority
<a name="line814"></a>     *
<a name="line815"></a>     * Note: Use this method to override any style changes you made to
<a name="line816"></a>     * the line numbers if you are using line numbers, else the line of
<a name="line817"></a>     * code will have the same style as the line number! Consult the
<a name="line818"></a>     * GeSHi documentation for more information about this.
<a name="line819"></a>     *
<a name="line820"></a>     * @param string  The style to use for actual code
<a name="line821"></a>     * @param boolean Whether to merge the current styles with the new styles
<a name="line822"></a>     * @since 1.0.2
<a name="line823"></a>     */</span>
<a name="line824"></a>    <span style="color: #000000; font-weight: bold;">function</span> set_code_style<span style="color: #009900;">&#40;</span><span style="color: #000088;">$style</span><span style="color: #339933;">,</span> <span style="color: #000088;">$preserve_defaults</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line825"></a>        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><span style="color: #000088;">$preserve_defaults</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line826"></a>            <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">code_style</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$style</span><span style="color: #339933;">;</span>
<a name="line827"></a>        <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line828"></a>            <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">code_style</span> <span style="color: #339933;">.=</span> <span style="color: #000088;">$style</span><span style="color: #339933;">;</span>
<a name="line829"></a>        <span style="color: #009900;">&#125;</span>
<a name="line830"></a>    <span style="color: #009900;">&#125;</span>
<a name="line831"></a>&nbsp;
<a name="line832"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line833"></a>     * Sets the styles for the line numbers.
<a name="line834"></a>     *
<a name="line835"></a>     * @param string The style for the line numbers that are &quot;normal&quot;
<a name="line836"></a>     * @param string|boolean If a string, this is the style of the line
<a name="line837"></a>     *        numbers that are &quot;fancy&quot;, otherwise if boolean then this
<a name="line838"></a>     *        defines whether the normal styles should be merged with the
<a name="line839"></a>     *        new normal styles or not
<a name="line840"></a>     * @param boolean If set, is the flag for whether to merge the &quot;fancy&quot;
<a name="line841"></a>     *        styles with the current styles or not
<a name="line842"></a>     * @since 1.0.2
<a name="line843"></a>     */</span>
<a name="line844"></a>    <span style="color: #000000; font-weight: bold;">function</span> set_line_style<span style="color: #009900;">&#40;</span><span style="color: #000088;">$style1</span><span style="color: #339933;">,</span> <span style="color: #000088;">$style2</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">''</span><span style="color: #339933;">,</span> <span style="color: #000088;">$preserve_defaults</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line845"></a>        <span style="color: #666666; font-style: italic;">//Check if we got 2 or three parameters</span>
<a name="line846"></a>        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><a href="http://www.php.net/is_bool"><span style="color: #990000;">is_bool</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$style2</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line847"></a>            <span style="color: #000088;">$preserve_defaults</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$style2</span><span style="color: #339933;">;</span>
<a name="line848"></a>            <span style="color: #000088;">$style2</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">''</span><span style="color: #339933;">;</span>
<a name="line849"></a>        <span style="color: #009900;">&#125;</span>
<a name="line850"></a>&nbsp;
<a name="line851"></a>        <span style="color: #666666; font-style: italic;">//Actually set the new styles</span>
<a name="line852"></a>        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><span style="color: #000088;">$preserve_defaults</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line853"></a>            <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">line_style1</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$style1</span><span style="color: #339933;">;</span>
<a name="line854"></a>            <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">line_style2</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$style2</span><span style="color: #339933;">;</span>
<a name="line855"></a>        <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line856"></a>            <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">line_style1</span> <span style="color: #339933;">.=</span> <span style="color: #000088;">$style1</span><span style="color: #339933;">;</span>
<a name="line857"></a>            <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">line_style2</span> <span style="color: #339933;">.=</span> <span style="color: #000088;">$style2</span><span style="color: #339933;">;</span>
<a name="line858"></a>        <span style="color: #009900;">&#125;</span>
<a name="line859"></a>    <span style="color: #009900;">&#125;</span>
<a name="line860"></a>&nbsp;
<a name="line861"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line862"></a>     * Sets whether line numbers should be displayed.
<a name="line863"></a>     *
<a name="line864"></a>     * Valid values for the first parameter are:
<a name="line865"></a>     *
<a name="line866"></a>     *  - GESHI_NO_LINE_NUMBERS: Line numbers will not be displayed
<a name="line867"></a>     *  - GESHI_NORMAL_LINE_NUMBERS: Line numbers will be displayed
<a name="line868"></a>     *  - GESHI_FANCY_LINE_NUMBERS: Fancy line numbers will be displayed
<a name="line869"></a>     *
<a name="line870"></a>     * For fancy line numbers, the second parameter is used to signal which lines
<a name="line871"></a>     * are to be fancy. For example, if the value of this parameter is 5 then every
<a name="line872"></a>     * 5th line will be fancy.
<a name="line873"></a>     *
<a name="line874"></a>     * @param int How line numbers should be displayed
<a name="line875"></a>     * @param int Defines which lines are fancy
<a name="line876"></a>     * @since 1.0.0
<a name="line877"></a>     */</span>
<a name="line878"></a>    <span style="color: #000000; font-weight: bold;">function</span> enable_line_numbers<span style="color: #009900;">&#40;</span><span style="color: #000088;">$flag</span><span style="color: #339933;">,</span> <span style="color: #000088;">$nth_row</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">5</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line879"></a>        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span>GESHI_NO_LINE_NUMBERS <span style="color: #339933;">!=</span> <span style="color: #000088;">$flag</span> <span style="color: #339933;">&amp;&amp;</span> GESHI_NORMAL_LINE_NUMBERS <span style="color: #339933;">!=</span> <span style="color: #000088;">$flag</span>
<a name="line880"></a>            <span style="color: #339933;">&amp;&amp;</span> GESHI_FANCY_LINE_NUMBERS <span style="color: #339933;">!=</span> <span style="color: #000088;">$flag</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line881"></a>            <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">error</span> <span style="color: #339933;">=</span> GESHI_ERROR_INVALID_LINE_NUMBER_TYPE<span style="color: #339933;">;</span>
<a name="line882"></a>        <span style="color: #009900;">&#125;</span>
<a name="line883"></a>        <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">line_numbers</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$flag</span><span style="color: #339933;">;</span>
<a name="line884"></a>        <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">line_nth_row</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$nth_row</span><span style="color: #339933;">;</span>
<a name="line885"></a>    <span style="color: #009900;">&#125;</span>
<a name="line886"></a>&nbsp;
<a name="line887"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line888"></a>     * Sets wether spans and other HTML markup generated by GeSHi can
<a name="line889"></a>     * span over multiple lines or not. Defaults to true to reduce overhead.
<a name="line890"></a>     * Set it to false if you want to manipulate the output or manually display
<a name="line891"></a>     * the code in an ordered list.
<a name="line892"></a>     *
<a name="line893"></a>     * @param boolean Wether multiline spans are allowed or not
<a name="line894"></a>     * @since 1.0.7.22
<a name="line895"></a>     */</span>
<a name="line896"></a>    <span style="color: #000000; font-weight: bold;">function</span> enable_multiline_span<span style="color: #009900;">&#40;</span><span style="color: #000088;">$flag</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line897"></a>        <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">allow_multiline_span</span> <span style="color: #339933;">=</span> <span style="color: #009900;">&#40;</span>bool<span style="color: #009900;">&#41;</span> <span style="color: #000088;">$flag</span><span style="color: #339933;">;</span>
<a name="line898"></a>    <span style="color: #009900;">&#125;</span>
<a name="line899"></a>&nbsp;
<a name="line900"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line901"></a>     * Get current setting for multiline spans, see GeSHi-&gt;enable_multiline_span().
<a name="line902"></a>     *
<a name="line903"></a>     * @see enable_multiline_span
<a name="line904"></a>     * @return bool
<a name="line905"></a>     */</span>
<a name="line906"></a>    <span style="color: #000000; font-weight: bold;">function</span> get_multiline_span<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line907"></a>        <span style="color: #b1b100;">return</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">allow_multiline_span</span><span style="color: #339933;">;</span>
<a name="line908"></a>    <span style="color: #009900;">&#125;</span>
<a name="line909"></a>&nbsp;
<a name="line910"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line911"></a>     * Sets the style for a keyword group. If $preserve_defaults is
<a name="line912"></a>     * true, then styles are merged with the default styles, with the
<a name="line913"></a>     * user defined styles having priority
<a name="line914"></a>     *
<a name="line915"></a>     * @param int     The key of the keyword group to change the styles of
<a name="line916"></a>     * @param string  The style to make the keywords
<a name="line917"></a>     * @param boolean Whether to merge the new styles with the old or just
<a name="line918"></a>     *                to overwrite them
<a name="line919"></a>     * @since 1.0.0
<a name="line920"></a>     */</span>
<a name="line921"></a>    <span style="color: #000000; font-weight: bold;">function</span> set_keyword_group_style<span style="color: #009900;">&#40;</span><span style="color: #000088;">$key</span><span style="color: #339933;">,</span> <span style="color: #000088;">$style</span><span style="color: #339933;">,</span> <span style="color: #000088;">$preserve_defaults</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line922"></a>        <span style="color: #666666; font-style: italic;">//Set the style for this keyword group</span>
<a name="line923"></a>        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><span style="color: #000088;">$preserve_defaults</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line924"></a>            <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'STYLES'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'KEYWORDS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$key</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$style</span><span style="color: #339933;">;</span>
<a name="line925"></a>        <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line926"></a>            <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'STYLES'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'KEYWORDS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$key</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">.=</span> <span style="color: #000088;">$style</span><span style="color: #339933;">;</span>
<a name="line927"></a>        <span style="color: #009900;">&#125;</span>
<a name="line928"></a>&nbsp;
<a name="line929"></a>        <span style="color: #666666; font-style: italic;">//Update the lexic permissions</span>
<a name="line930"></a>        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><a href="http://www.php.net/isset"><span style="color: #990000;">isset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">lexic_permissions</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'KEYWORDS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$key</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line931"></a>            <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">lexic_permissions</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'KEYWORDS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$key</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">true</span><span style="color: #339933;">;</span>
<a name="line932"></a>        <span style="color: #009900;">&#125;</span>
<a name="line933"></a>    <span style="color: #009900;">&#125;</span>
<a name="line934"></a>&nbsp;
<a name="line935"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line936"></a>     * Turns highlighting on/off for a keyword group
<a name="line937"></a>     *
<a name="line938"></a>     * @param int     The key of the keyword group to turn on or off
<a name="line939"></a>     * @param boolean Whether to turn highlighting for that group on or off
<a name="line940"></a>     * @since 1.0.0
<a name="line941"></a>     */</span>
<a name="line942"></a>    <span style="color: #000000; font-weight: bold;">function</span> set_keyword_group_highlighting<span style="color: #009900;">&#40;</span><span style="color: #000088;">$key</span><span style="color: #339933;">,</span> <span style="color: #000088;">$flag</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">true</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line943"></a>        <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">lexic_permissions</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'KEYWORDS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$key</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$flag</span><span style="color: #009900;">&#41;</span> ? <span style="color: #009900; font-weight: bold;">true</span> <span style="color: #339933;">:</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #339933;">;</span>
<a name="line944"></a>    <span style="color: #009900;">&#125;</span>
<a name="line945"></a>&nbsp;
<a name="line946"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line947"></a>     * Sets the styles for comment groups.  If $preserve_defaults is
<a name="line948"></a>     * true, then styles are merged with the default styles, with the
<a name="line949"></a>     * user defined styles having priority
<a name="line950"></a>     *
<a name="line951"></a>     * @param int     The key of the comment group to change the styles of
<a name="line952"></a>     * @param string  The style to make the comments
<a name="line953"></a>     * @param boolean Whether to merge the new styles with the old or just
<a name="line954"></a>     *                to overwrite them
<a name="line955"></a>     * @since 1.0.0
<a name="line956"></a>     */</span>
<a name="line957"></a>    <span style="color: #000000; font-weight: bold;">function</span> set_comments_style<span style="color: #009900;">&#40;</span><span style="color: #000088;">$key</span><span style="color: #339933;">,</span> <span style="color: #000088;">$style</span><span style="color: #339933;">,</span> <span style="color: #000088;">$preserve_defaults</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line958"></a>        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><span style="color: #000088;">$preserve_defaults</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line959"></a>            <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'STYLES'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'COMMENTS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$key</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$style</span><span style="color: #339933;">;</span>
<a name="line960"></a>        <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line961"></a>            <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'STYLES'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'COMMENTS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$key</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">.=</span> <span style="color: #000088;">$style</span><span style="color: #339933;">;</span>
<a name="line962"></a>        <span style="color: #009900;">&#125;</span>
<a name="line963"></a>    <span style="color: #009900;">&#125;</span>
<a name="line964"></a>&nbsp;
<a name="line965"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line966"></a>     * Turns highlighting on/off for comment groups
<a name="line967"></a>     *
<a name="line968"></a>     * @param int     The key of the comment group to turn on or off
<a name="line969"></a>     * @param boolean Whether to turn highlighting for that group on or off
<a name="line970"></a>     * @since 1.0.0
<a name="line971"></a>     */</span>
<a name="line972"></a>    <span style="color: #000000; font-weight: bold;">function</span> set_comments_highlighting<span style="color: #009900;">&#40;</span><span style="color: #000088;">$key</span><span style="color: #339933;">,</span> <span style="color: #000088;">$flag</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">true</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line973"></a>        <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">lexic_permissions</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'COMMENTS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$key</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$flag</span><span style="color: #009900;">&#41;</span> ? <span style="color: #009900; font-weight: bold;">true</span> <span style="color: #339933;">:</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #339933;">;</span>
<a name="line974"></a>    <span style="color: #009900;">&#125;</span>
<a name="line975"></a>&nbsp;
<a name="line976"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line977"></a>     * Sets the styles for escaped characters. If $preserve_defaults is
<a name="line978"></a>     * true, then styles are merged with the default styles, with the
<a name="line979"></a>     * user defined styles having priority
<a name="line980"></a>     *
<a name="line981"></a>     * @param string  The style to make the escape characters
<a name="line982"></a>     * @param boolean Whether to merge the new styles with the old or just
<a name="line983"></a>     *                to overwrite them
<a name="line984"></a>     * @since 1.0.0
<a name="line985"></a>     */</span>
<a name="line986"></a>    <span style="color: #000000; font-weight: bold;">function</span> set_escape_characters_style<span style="color: #009900;">&#40;</span><span style="color: #000088;">$style</span><span style="color: #339933;">,</span> <span style="color: #000088;">$preserve_defaults</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #339933;">,</span> <span style="color: #000088;">$group</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line987"></a>        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><span style="color: #000088;">$preserve_defaults</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line988"></a>            <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'STYLES'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'ESCAPE_CHAR'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$group</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$style</span><span style="color: #339933;">;</span>
<a name="line989"></a>        <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line990"></a>            <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'STYLES'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'ESCAPE_CHAR'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$group</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">.=</span> <span style="color: #000088;">$style</span><span style="color: #339933;">;</span>
<a name="line991"></a>        <span style="color: #009900;">&#125;</span>
<a name="line992"></a>    <span style="color: #009900;">&#125;</span>
<a name="line993"></a>&nbsp;
<a name="line994"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line995"></a>     * Turns highlighting on/off for escaped characters
<a name="line996"></a>     *
<a name="line997"></a>     * @param boolean Whether to turn highlighting for escape characters on or off
<a name="line998"></a>     * @since 1.0.0
<a name="line999"></a>     */</span>
<a name="line1000"></a>    <span style="color: #000000; font-weight: bold;">function</span> set_escape_characters_highlighting<span style="color: #009900;">&#40;</span><span style="color: #000088;">$flag</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">true</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1001"></a>        <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">lexic_permissions</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'ESCAPE_CHAR'</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$flag</span><span style="color: #009900;">&#41;</span> ? <span style="color: #009900; font-weight: bold;">true</span> <span style="color: #339933;">:</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #339933;">;</span>
<a name="line1002"></a>    <span style="color: #009900;">&#125;</span>
<a name="line1003"></a>&nbsp;
<a name="line1004"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line1005"></a>     * Sets the styles for brackets. If $preserve_defaults is
<a name="line1006"></a>     * true, then styles are merged with the default styles, with the
<a name="line1007"></a>     * user defined styles having priority
<a name="line1008"></a>     *
<a name="line1009"></a>     * This method is DEPRECATED: use set_symbols_style instead.
<a name="line1010"></a>     * This method will be removed in 1.2.X
<a name="line1011"></a>     *
<a name="line1012"></a>     * @param string  The style to make the brackets
<a name="line1013"></a>     * @param boolean Whether to merge the new styles with the old or just
<a name="line1014"></a>     *                to overwrite them
<a name="line1015"></a>     * @since 1.0.0
<a name="line1016"></a>     * @deprecated In favour of set_symbols_style
<a name="line1017"></a>     */</span>
<a name="line1018"></a>    <span style="color: #000000; font-weight: bold;">function</span> set_brackets_style<span style="color: #009900;">&#40;</span><span style="color: #000088;">$style</span><span style="color: #339933;">,</span> <span style="color: #000088;">$preserve_defaults</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1019"></a>        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><span style="color: #000088;">$preserve_defaults</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1020"></a>            <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'STYLES'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'BRACKETS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$style</span><span style="color: #339933;">;</span>
<a name="line1021"></a>        <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line1022"></a>            <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'STYLES'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'BRACKETS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">.=</span> <span style="color: #000088;">$style</span><span style="color: #339933;">;</span>
<a name="line1023"></a>        <span style="color: #009900;">&#125;</span>
<a name="line1024"></a>    <span style="color: #009900;">&#125;</span>
<a name="line1025"></a>&nbsp;
<a name="line1026"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line1027"></a>     * Turns highlighting on/off for brackets
<a name="line1028"></a>     *
<a name="line1029"></a>     * This method is DEPRECATED: use set_symbols_highlighting instead.
<a name="line1030"></a>     * This method will be remove in 1.2.X
<a name="line1031"></a>     *
<a name="line1032"></a>     * @param boolean Whether to turn highlighting for brackets on or off
<a name="line1033"></a>     * @since 1.0.0
<a name="line1034"></a>     * @deprecated In favour of set_symbols_highlighting
<a name="line1035"></a>     */</span>
<a name="line1036"></a>    <span style="color: #000000; font-weight: bold;">function</span> set_brackets_highlighting<span style="color: #009900;">&#40;</span><span style="color: #000088;">$flag</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1037"></a>        <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">lexic_permissions</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'BRACKETS'</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$flag</span><span style="color: #009900;">&#41;</span> ? <span style="color: #009900; font-weight: bold;">true</span> <span style="color: #339933;">:</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #339933;">;</span>
<a name="line1038"></a>    <span style="color: #009900;">&#125;</span>
<a name="line1039"></a>&nbsp;
<a name="line1040"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line1041"></a>     * Sets the styles for symbols. If $preserve_defaults is
<a name="line1042"></a>     * true, then styles are merged with the default styles, with the
<a name="line1043"></a>     * user defined styles having priority
<a name="line1044"></a>     *
<a name="line1045"></a>     * @param string  The style to make the symbols
<a name="line1046"></a>     * @param boolean Whether to merge the new styles with the old or just
<a name="line1047"></a>     *                to overwrite them
<a name="line1048"></a>     * @param int     Tells the group of symbols for which style should be set.
<a name="line1049"></a>     * @since 1.0.1
<a name="line1050"></a>     */</span>
<a name="line1051"></a>    <span style="color: #000000; font-weight: bold;">function</span> set_symbols_style<span style="color: #009900;">&#40;</span><span style="color: #000088;">$style</span><span style="color: #339933;">,</span> <span style="color: #000088;">$preserve_defaults</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #339933;">,</span> <span style="color: #000088;">$group</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1052"></a>        <span style="color: #666666; font-style: italic;">// Update the style of symbols</span>
<a name="line1053"></a>        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><span style="color: #000088;">$preserve_defaults</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1054"></a>            <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'STYLES'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'SYMBOLS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$group</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$style</span><span style="color: #339933;">;</span>
<a name="line1055"></a>        <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line1056"></a>            <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'STYLES'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'SYMBOLS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$group</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">.=</span> <span style="color: #000088;">$style</span><span style="color: #339933;">;</span>
<a name="line1057"></a>        <span style="color: #009900;">&#125;</span>
<a name="line1058"></a>&nbsp;
<a name="line1059"></a>        <span style="color: #666666; font-style: italic;">// For backward compatibility</span>
<a name="line1060"></a>        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">0</span> <span style="color: #339933;">==</span> <span style="color: #000088;">$group</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1061"></a>            <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">set_brackets_style</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$style</span><span style="color: #339933;">,</span> <span style="color: #000088;">$preserve_defaults</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line1062"></a>        <span style="color: #009900;">&#125;</span>
<a name="line1063"></a>    <span style="color: #009900;">&#125;</span>
<a name="line1064"></a>&nbsp;
<a name="line1065"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line1066"></a>     * Turns highlighting on/off for symbols
<a name="line1067"></a>     *
<a name="line1068"></a>     * @param boolean Whether to turn highlighting for symbols on or off
<a name="line1069"></a>     * @since 1.0.0
<a name="line1070"></a>     */</span>
<a name="line1071"></a>    <span style="color: #000000; font-weight: bold;">function</span> set_symbols_highlighting<span style="color: #009900;">&#40;</span><span style="color: #000088;">$flag</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1072"></a>        <span style="color: #666666; font-style: italic;">// Update lexic permissions for this symbol group</span>
<a name="line1073"></a>        <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">lexic_permissions</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'SYMBOLS'</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$flag</span><span style="color: #009900;">&#41;</span> ? <span style="color: #009900; font-weight: bold;">true</span> <span style="color: #339933;">:</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #339933;">;</span>
<a name="line1074"></a>&nbsp;
<a name="line1075"></a>        <span style="color: #666666; font-style: italic;">// For backward compatibility</span>
<a name="line1076"></a>        <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">set_brackets_highlighting</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$flag</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line1077"></a>    <span style="color: #009900;">&#125;</span>
<a name="line1078"></a>&nbsp;
<a name="line1079"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line1080"></a>     * Sets the styles for strings. If $preserve_defaults is
<a name="line1081"></a>     * true, then styles are merged with the default styles, with the
<a name="line1082"></a>     * user defined styles having priority
<a name="line1083"></a>     *
<a name="line1084"></a>     * @param string  The style to make the escape characters
<a name="line1085"></a>     * @param boolean Whether to merge the new styles with the old or just
<a name="line1086"></a>     *                to overwrite them
<a name="line1087"></a>     * @since 1.0.0
<a name="line1088"></a>     */</span>
<a name="line1089"></a>    <span style="color: #000000; font-weight: bold;">function</span> set_strings_style<span style="color: #009900;">&#40;</span><span style="color: #000088;">$style</span><span style="color: #339933;">,</span> <span style="color: #000088;">$preserve_defaults</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1090"></a>        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><span style="color: #000088;">$preserve_defaults</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1091"></a>            <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'STYLES'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'STRINGS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$style</span><span style="color: #339933;">;</span>
<a name="line1092"></a>        <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line1093"></a>            <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'STYLES'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'STRINGS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">.=</span> <span style="color: #000088;">$style</span><span style="color: #339933;">;</span>
<a name="line1094"></a>        <span style="color: #009900;">&#125;</span>
<a name="line1095"></a>    <span style="color: #009900;">&#125;</span>
<a name="line1096"></a>&nbsp;
<a name="line1097"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line1098"></a>     * Turns highlighting on/off for strings
<a name="line1099"></a>     *
<a name="line1100"></a>     * @param boolean Whether to turn highlighting for strings on or off
<a name="line1101"></a>     * @since 1.0.0
<a name="line1102"></a>     */</span>
<a name="line1103"></a>    <span style="color: #000000; font-weight: bold;">function</span> set_strings_highlighting<span style="color: #009900;">&#40;</span><span style="color: #000088;">$flag</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1104"></a>        <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">lexic_permissions</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'STRINGS'</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$flag</span><span style="color: #009900;">&#41;</span> ? <span style="color: #009900; font-weight: bold;">true</span> <span style="color: #339933;">:</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #339933;">;</span>
<a name="line1105"></a>    <span style="color: #009900;">&#125;</span>
<a name="line1106"></a>&nbsp;
<a name="line1107"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line1108"></a>     * Sets the styles for numbers. If $preserve_defaults is
<a name="line1109"></a>     * true, then styles are merged with the default styles, with the
<a name="line1110"></a>     * user defined styles having priority
<a name="line1111"></a>     *
<a name="line1112"></a>     * @param string  The style to make the numbers
<a name="line1113"></a>     * @param boolean Whether to merge the new styles with the old or just
<a name="line1114"></a>     *                to overwrite them
<a name="line1115"></a>     * @since 1.0.0
<a name="line1116"></a>     */</span>
<a name="line1117"></a>    <span style="color: #000000; font-weight: bold;">function</span> set_numbers_style<span style="color: #009900;">&#40;</span><span style="color: #000088;">$style</span><span style="color: #339933;">,</span> <span style="color: #000088;">$preserve_defaults</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1118"></a>        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><span style="color: #000088;">$preserve_defaults</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1119"></a>            <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'STYLES'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'NUMBERS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$style</span><span style="color: #339933;">;</span>
<a name="line1120"></a>        <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line1121"></a>            <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'STYLES'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'NUMBERS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">.=</span> <span style="color: #000088;">$style</span><span style="color: #339933;">;</span>
<a name="line1122"></a>        <span style="color: #009900;">&#125;</span>
<a name="line1123"></a>    <span style="color: #009900;">&#125;</span>
<a name="line1124"></a>&nbsp;
<a name="line1125"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line1126"></a>     * Turns highlighting on/off for numbers
<a name="line1127"></a>     *
<a name="line1128"></a>     * @param boolean Whether to turn highlighting for numbers on or off
<a name="line1129"></a>     * @since 1.0.0
<a name="line1130"></a>     */</span>
<a name="line1131"></a>    <span style="color: #000000; font-weight: bold;">function</span> set_numbers_highlighting<span style="color: #009900;">&#40;</span><span style="color: #000088;">$flag</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1132"></a>        <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">lexic_permissions</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'NUMBERS'</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$flag</span><span style="color: #009900;">&#41;</span> ? <span style="color: #009900; font-weight: bold;">true</span> <span style="color: #339933;">:</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #339933;">;</span>
<a name="line1133"></a>    <span style="color: #009900;">&#125;</span>
<a name="line1134"></a>&nbsp;
<a name="line1135"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line1136"></a>     * Sets the styles for methods. $key is a number that references the
<a name="line1137"></a>     * appropriate &quot;object splitter&quot; - see the language file for the language
<a name="line1138"></a>     * you are highlighting to get this number. If $preserve_defaults is
<a name="line1139"></a>     * true, then styles are merged with the default styles, with the
<a name="line1140"></a>     * user defined styles having priority
<a name="line1141"></a>     *
<a name="line1142"></a>     * @param int     The key of the object splitter to change the styles of
<a name="line1143"></a>     * @param string  The style to make the methods
<a name="line1144"></a>     * @param boolean Whether to merge the new styles with the old or just
<a name="line1145"></a>     *                to overwrite them
<a name="line1146"></a>     * @since 1.0.0
<a name="line1147"></a>     */</span>
<a name="line1148"></a>    <span style="color: #000000; font-weight: bold;">function</span> set_methods_style<span style="color: #009900;">&#40;</span><span style="color: #000088;">$key</span><span style="color: #339933;">,</span> <span style="color: #000088;">$style</span><span style="color: #339933;">,</span> <span style="color: #000088;">$preserve_defaults</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1149"></a>        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><span style="color: #000088;">$preserve_defaults</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1150"></a>            <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'STYLES'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'METHODS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$key</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$style</span><span style="color: #339933;">;</span>
<a name="line1151"></a>        <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line1152"></a>            <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'STYLES'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'METHODS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$key</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">.=</span> <span style="color: #000088;">$style</span><span style="color: #339933;">;</span>
<a name="line1153"></a>        <span style="color: #009900;">&#125;</span>
<a name="line1154"></a>    <span style="color: #009900;">&#125;</span>
<a name="line1155"></a>&nbsp;
<a name="line1156"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line1157"></a>     * Turns highlighting on/off for methods
<a name="line1158"></a>     *
<a name="line1159"></a>     * @param boolean Whether to turn highlighting for methods on or off
<a name="line1160"></a>     * @since 1.0.0
<a name="line1161"></a>     */</span>
<a name="line1162"></a>    <span style="color: #000000; font-weight: bold;">function</span> set_methods_highlighting<span style="color: #009900;">&#40;</span><span style="color: #000088;">$flag</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1163"></a>        <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">lexic_permissions</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'METHODS'</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$flag</span><span style="color: #009900;">&#41;</span> ? <span style="color: #009900; font-weight: bold;">true</span> <span style="color: #339933;">:</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #339933;">;</span>
<a name="line1164"></a>    <span style="color: #009900;">&#125;</span>
<a name="line1165"></a>&nbsp;
<a name="line1166"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line1167"></a>     * Sets the styles for regexps. If $preserve_defaults is
<a name="line1168"></a>     * true, then styles are merged with the default styles, with the
<a name="line1169"></a>     * user defined styles having priority
<a name="line1170"></a>     *
<a name="line1171"></a>     * @param string  The style to make the regular expression matches
<a name="line1172"></a>     * @param boolean Whether to merge the new styles with the old or just
<a name="line1173"></a>     *                to overwrite them
<a name="line1174"></a>     * @since 1.0.0
<a name="line1175"></a>     */</span>
<a name="line1176"></a>    <span style="color: #000000; font-weight: bold;">function</span> set_regexps_style<span style="color: #009900;">&#40;</span><span style="color: #000088;">$key</span><span style="color: #339933;">,</span> <span style="color: #000088;">$style</span><span style="color: #339933;">,</span> <span style="color: #000088;">$preserve_defaults</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1177"></a>        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><span style="color: #000088;">$preserve_defaults</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1178"></a>            <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'STYLES'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'REGEXPS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$key</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$style</span><span style="color: #339933;">;</span>
<a name="line1179"></a>        <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line1180"></a>            <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'STYLES'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'REGEXPS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$key</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">.=</span> <span style="color: #000088;">$style</span><span style="color: #339933;">;</span>
<a name="line1181"></a>        <span style="color: #009900;">&#125;</span>
<a name="line1182"></a>    <span style="color: #009900;">&#125;</span>
<a name="line1183"></a>&nbsp;
<a name="line1184"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line1185"></a>     * Turns highlighting on/off for regexps
<a name="line1186"></a>     *
<a name="line1187"></a>     * @param int     The key of the regular expression group to turn on or off
<a name="line1188"></a>     * @param boolean Whether to turn highlighting for the regular expression group on or off
<a name="line1189"></a>     * @since 1.0.0
<a name="line1190"></a>     */</span>
<a name="line1191"></a>    <span style="color: #000000; font-weight: bold;">function</span> set_regexps_highlighting<span style="color: #009900;">&#40;</span><span style="color: #000088;">$key</span><span style="color: #339933;">,</span> <span style="color: #000088;">$flag</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1192"></a>        <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">lexic_permissions</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'REGEXPS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$key</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$flag</span><span style="color: #009900;">&#41;</span> ? <span style="color: #009900; font-weight: bold;">true</span> <span style="color: #339933;">:</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #339933;">;</span>
<a name="line1193"></a>    <span style="color: #009900;">&#125;</span>
<a name="line1194"></a>&nbsp;
<a name="line1195"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line1196"></a>     * Sets whether a set of keywords are checked for in a case sensitive manner
<a name="line1197"></a>     *
<a name="line1198"></a>     * @param int The key of the keyword group to change the case sensitivity of
<a name="line1199"></a>     * @param boolean Whether to check in a case sensitive manner or not
<a name="line1200"></a>     * @since 1.0.0
<a name="line1201"></a>     */</span>
<a name="line1202"></a>    <span style="color: #000000; font-weight: bold;">function</span> set_case_sensitivity<span style="color: #009900;">&#40;</span><span style="color: #000088;">$key</span><span style="color: #339933;">,</span> <span style="color: #000088;">$case</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1203"></a>        <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'CASE_SENSITIVE'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$key</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$case</span><span style="color: #009900;">&#41;</span> ? <span style="color: #009900; font-weight: bold;">true</span> <span style="color: #339933;">:</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #339933;">;</span>
<a name="line1204"></a>    <span style="color: #009900;">&#125;</span>
<a name="line1205"></a>&nbsp;
<a name="line1206"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line1207"></a>     * Sets the case that keywords should use when found. Use the constants:
<a name="line1208"></a>     *
<a name="line1209"></a>     *  - GESHI_CAPS_NO_CHANGE: leave keywords as-is
<a name="line1210"></a>     *  - GESHI_CAPS_UPPER: convert all keywords to uppercase where found
<a name="line1211"></a>     *  - GESHI_CAPS_LOWER: convert all keywords to lowercase where found
<a name="line1212"></a>     *
<a name="line1213"></a>     * @param int A constant specifying what to do with matched keywords
<a name="line1214"></a>     * @since 1.0.1
<a name="line1215"></a>     */</span>
<a name="line1216"></a>    <span style="color: #000000; font-weight: bold;">function</span> set_case_keywords<span style="color: #009900;">&#40;</span><span style="color: #000088;">$case</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1217"></a>        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><a href="http://www.php.net/in_array"><span style="color: #990000;">in_array</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$case</span><span style="color: #339933;">,</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span>
<a name="line1218"></a>            GESHI_CAPS_NO_CHANGE<span style="color: #339933;">,</span> GESHI_CAPS_UPPER<span style="color: #339933;">,</span> GESHI_CAPS_LOWER<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1219"></a>            <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'CASE_KEYWORDS'</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$case</span><span style="color: #339933;">;</span>
<a name="line1220"></a>        <span style="color: #009900;">&#125;</span>
<a name="line1221"></a>    <span style="color: #009900;">&#125;</span>
<a name="line1222"></a>&nbsp;
<a name="line1223"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line1224"></a>     * Sets how many spaces a tab is substituted for
<a name="line1225"></a>     *
<a name="line1226"></a>     * Widths below zero are ignored
<a name="line1227"></a>     *
<a name="line1228"></a>     * @param int The tab width
<a name="line1229"></a>     * @since 1.0.0
<a name="line1230"></a>     */</span>
<a name="line1231"></a>    <span style="color: #000000; font-weight: bold;">function</span> set_tab_width<span style="color: #009900;">&#40;</span><span style="color: #000088;">$width</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1232"></a>        <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">tab_width</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/intval"><span style="color: #990000;">intval</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$width</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line1233"></a>&nbsp;
<a name="line1234"></a>        <span style="color: #666666; font-style: italic;">//Check if it fit's the constraints:</span>
<a name="line1235"></a>        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">tab_width</span> <span style="color: #339933;">&lt;</span> <span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1236"></a>            <span style="color: #666666; font-style: italic;">//Return it to the default</span>
<a name="line1237"></a>            <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">tab_width</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">8</span><span style="color: #339933;">;</span>
<a name="line1238"></a>        <span style="color: #009900;">&#125;</span>
<a name="line1239"></a>    <span style="color: #009900;">&#125;</span>
<a name="line1240"></a>&nbsp;
<a name="line1241"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line1242"></a>     * Sets whether or not to use tab-stop width specifed by language
<a name="line1243"></a>     *
<a name="line1244"></a>     * @param boolean Whether to use language-specific tab-stop widths
<a name="line1245"></a>     * @since 1.0.7.20
<a name="line1246"></a>     */</span>
<a name="line1247"></a>    <span style="color: #000000; font-weight: bold;">function</span> set_use_language_tab_width<span style="color: #009900;">&#40;</span><span style="color: #000088;">$use</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1248"></a>        <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">use_language_tab_width</span> <span style="color: #339933;">=</span> <span style="color: #009900;">&#40;</span>bool<span style="color: #009900;">&#41;</span> <span style="color: #000088;">$use</span><span style="color: #339933;">;</span>
<a name="line1249"></a>    <span style="color: #009900;">&#125;</span>
<a name="line1250"></a>&nbsp;
<a name="line1251"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line1252"></a>     * Returns the tab width to use, based on the current language and user
<a name="line1253"></a>     * preference
<a name="line1254"></a>     *
<a name="line1255"></a>     * @return int Tab width
<a name="line1256"></a>     * @since 1.0.7.20
<a name="line1257"></a>     */</span>
<a name="line1258"></a>    <span style="color: #000000; font-weight: bold;">function</span> get_real_tab_width<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1259"></a>        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">use_language_tab_width</span> <span style="color: #339933;">||</span>
<a name="line1260"></a>            <span style="color: #339933;">!</span><a href="http://www.php.net/isset"><span style="color: #990000;">isset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'TAB_WIDTH'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1261"></a>            <span style="color: #b1b100;">return</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">tab_width</span><span style="color: #339933;">;</span>
<a name="line1262"></a>        <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line1263"></a>            <span style="color: #b1b100;">return</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'TAB_WIDTH'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
<a name="line1264"></a>        <span style="color: #009900;">&#125;</span>
<a name="line1265"></a>    <span style="color: #009900;">&#125;</span>
<a name="line1266"></a>&nbsp;
<a name="line1267"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line1268"></a>     * Enables/disables strict highlighting. Default is off, calling this
<a name="line1269"></a>     * method without parameters will turn it on. See documentation
<a name="line1270"></a>     * for more details on strict mode and where to use it.
<a name="line1271"></a>     *
<a name="line1272"></a>     * @param boolean Whether to enable strict mode or not
<a name="line1273"></a>     * @since 1.0.0
<a name="line1274"></a>     */</span>
<a name="line1275"></a>    <span style="color: #000000; font-weight: bold;">function</span> enable_strict_mode<span style="color: #009900;">&#40;</span><span style="color: #000088;">$mode</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">true</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1276"></a>        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span>GESHI_MAYBE <span style="color: #339933;">==</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'STRICT_MODE_APPLIES'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1277"></a>            <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">strict_mode</span> <span style="color: #339933;">=</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$mode</span><span style="color: #009900;">&#41;</span> ? GESHI_ALWAYS <span style="color: #339933;">:</span> GESHI_NEVER<span style="color: #339933;">;</span>
<a name="line1278"></a>        <span style="color: #009900;">&#125;</span>
<a name="line1279"></a>    <span style="color: #009900;">&#125;</span>
<a name="line1280"></a>&nbsp;
<a name="line1281"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line1282"></a>     * Disables all highlighting
<a name="line1283"></a>     *
<a name="line1284"></a>     * @since 1.0.0
<a name="line1285"></a>     * @todo  Rewrite with array traversal
<a name="line1286"></a>     * @deprecated In favour of enable_highlighting
<a name="line1287"></a>     */</span>
<a name="line1288"></a>    <span style="color: #000000; font-weight: bold;">function</span> disable_highlighting<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1289"></a>        <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">enable_highlighting</span><span style="color: #009900;">&#40;</span><span style="color: #009900; font-weight: bold;">false</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line1290"></a>    <span style="color: #009900;">&#125;</span>
<a name="line1291"></a>&nbsp;
<a name="line1292"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line1293"></a>     * Enables all highlighting
<a name="line1294"></a>     *
<a name="line1295"></a>     * The optional flag parameter was added in version 1.0.7.21 and can be used
<a name="line1296"></a>     * to enable (true) or disable (false) all highlighting.
<a name="line1297"></a>     *
<a name="line1298"></a>     * @since 1.0.0
<a name="line1299"></a>     * @param boolean A flag specifying whether to enable or disable all highlighting
<a name="line1300"></a>     * @todo  Rewrite with array traversal
<a name="line1301"></a>     */</span>
<a name="line1302"></a>    <span style="color: #000000; font-weight: bold;">function</span> enable_highlighting<span style="color: #009900;">&#40;</span><span style="color: #000088;">$flag</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">true</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1303"></a>        <span style="color: #000088;">$flag</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$flag</span> ? <span style="color: #009900; font-weight: bold;">true</span> <span style="color: #339933;">:</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #339933;">;</span>
<a name="line1304"></a>        <span style="color: #b1b100;">foreach</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">lexic_permissions</span> <span style="color: #b1b100;">as</span> <span style="color: #000088;">$key</span> <span style="color: #339933;">=&gt;</span> <span style="color: #000088;">$value</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1305"></a>            <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><a href="http://www.php.net/is_array"><span style="color: #990000;">is_array</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$value</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1306"></a>                <span style="color: #b1b100;">foreach</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$value</span> <span style="color: #b1b100;">as</span> <span style="color: #000088;">$k</span> <span style="color: #339933;">=&gt;</span> <span style="color: #000088;">$v</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1307"></a>                    <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">lexic_permissions</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$key</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$k</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$flag</span><span style="color: #339933;">;</span>
<a name="line1308"></a>                <span style="color: #009900;">&#125;</span>
<a name="line1309"></a>            <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line1310"></a>                <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">lexic_permissions</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$key</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$flag</span><span style="color: #339933;">;</span>
<a name="line1311"></a>            <span style="color: #009900;">&#125;</span>
<a name="line1312"></a>        <span style="color: #009900;">&#125;</span>
<a name="line1313"></a>&nbsp;
<a name="line1314"></a>        <span style="color: #666666; font-style: italic;">// Context blocks</span>
<a name="line1315"></a>        <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">enable_important_blocks</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$flag</span><span style="color: #339933;">;</span>
<a name="line1316"></a>    <span style="color: #009900;">&#125;</span>
<a name="line1317"></a>&nbsp;
<a name="line1318"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line1319"></a>     * Given a file extension, this method returns either a valid geshi language
<a name="line1320"></a>     * name, or the empty string if it couldn't be found
<a name="line1321"></a>     *
<a name="line1322"></a>     * @param string The extension to get a language name for
<a name="line1323"></a>     * @param array  A lookup array to use instead of the default one
<a name="line1324"></a>     * @since 1.0.5
<a name="line1325"></a>     * @todo Re-think about how this method works (maybe make it private and/or make it
<a name="line1326"></a>     *       a extension-&gt;lang lookup?)
<a name="line1327"></a>     * @todo static?
<a name="line1328"></a>     */</span>
<a name="line1329"></a>    <span style="color: #000000; font-weight: bold;">function</span> get_language_name_from_extension<span style="color: #009900;">&#40;</span> <span style="color: #000088;">$extension</span><span style="color: #339933;">,</span> <span style="color: #000088;">$lookup</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1330"></a>        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span> <span style="color: #339933;">!</span><a href="http://www.php.net/is_array"><span style="color: #990000;">is_array</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$lookup</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">||</span> <a href="http://www.php.net/empty"><span style="color: #990000;">empty</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$lookup</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1331"></a>            <span style="color: #000088;">$lookup</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span>
<a name="line1332"></a>                <span style="color: #0000ff;">'actionscript'</span> <span style="color: #339933;">=&gt;</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'as'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span>
<a name="line1333"></a>                <span style="color: #0000ff;">'ada'</span> <span style="color: #339933;">=&gt;</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'a'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'ada'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'adb'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'ads'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span>
<a name="line1334"></a>                <span style="color: #0000ff;">'apache'</span> <span style="color: #339933;">=&gt;</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'conf'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span>
<a name="line1335"></a>                <span style="color: #0000ff;">'asm'</span> <span style="color: #339933;">=&gt;</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'ash'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'asm'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'inc'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span>
<a name="line1336"></a>                <span style="color: #0000ff;">'asp'</span> <span style="color: #339933;">=&gt;</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'asp'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span>
<a name="line1337"></a>                <span style="color: #0000ff;">'bash'</span> <span style="color: #339933;">=&gt;</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'sh'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span>
<a name="line1338"></a>                <span style="color: #0000ff;">'bf'</span> <span style="color: #339933;">=&gt;</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'bf'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span>
<a name="line1339"></a>                <span style="color: #0000ff;">'c'</span> <span style="color: #339933;">=&gt;</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'c'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'h'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span>
<a name="line1340"></a>                <span style="color: #0000ff;">'c_mac'</span> <span style="color: #339933;">=&gt;</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'c'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'h'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span>
<a name="line1341"></a>                <span style="color: #0000ff;">'caddcl'</span> <span style="color: #339933;">=&gt;</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span>
<a name="line1342"></a>                <span style="color: #0000ff;">'cadlisp'</span> <span style="color: #339933;">=&gt;</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span>
<a name="line1343"></a>                <span style="color: #0000ff;">'cdfg'</span> <span style="color: #339933;">=&gt;</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'cdfg'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span>
<a name="line1344"></a>                <span style="color: #0000ff;">'cobol'</span> <span style="color: #339933;">=&gt;</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'cbl'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span>
<a name="line1345"></a>                <span style="color: #0000ff;">'cpp'</span> <span style="color: #339933;">=&gt;</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'cpp'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'hpp'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'C'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'H'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'CPP'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'HPP'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span>
<a name="line1346"></a>                <span style="color: #0000ff;">'csharp'</span> <span style="color: #339933;">=&gt;</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'cs'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span>
<a name="line1347"></a>                <span style="color: #0000ff;">'css'</span> <span style="color: #339933;">=&gt;</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'css'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span>
<a name="line1348"></a>                <span style="color: #0000ff;">'d'</span> <span style="color: #339933;">=&gt;</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'d'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span>
<a name="line1349"></a>                <span style="color: #0000ff;">'delphi'</span> <span style="color: #339933;">=&gt;</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'dpk'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'dpr'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'pp'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'pas'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span>
<a name="line1350"></a>                <span style="color: #0000ff;">'diff'</span> <span style="color: #339933;">=&gt;</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'diff'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'patch'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span>
<a name="line1351"></a>                <span style="color: #0000ff;">'dos'</span> <span style="color: #339933;">=&gt;</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'bat'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'cmd'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span>
<a name="line1352"></a>                <span style="color: #0000ff;">'gettext'</span> <span style="color: #339933;">=&gt;</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'po'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'pot'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span>
<a name="line1353"></a>                <span style="color: #0000ff;">'gml'</span> <span style="color: #339933;">=&gt;</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'gml'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span>
<a name="line1354"></a>                <span style="color: #0000ff;">'gnuplot'</span> <span style="color: #339933;">=&gt;</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'plt'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span>
<a name="line1355"></a>                <span style="color: #0000ff;">'groovy'</span> <span style="color: #339933;">=&gt;</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'groovy'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span>
<a name="line1356"></a>                <span style="color: #0000ff;">'haskell'</span> <span style="color: #339933;">=&gt;</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'hs'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span>
<a name="line1357"></a>                <span style="color: #0000ff;">'html4strict'</span> <span style="color: #339933;">=&gt;</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'html'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'htm'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span>
<a name="line1358"></a>                <span style="color: #0000ff;">'ini'</span> <span style="color: #339933;">=&gt;</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'ini'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'desktop'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span>
<a name="line1359"></a>                <span style="color: #0000ff;">'java'</span> <span style="color: #339933;">=&gt;</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'java'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span>
<a name="line1360"></a>                <span style="color: #0000ff;">'javascript'</span> <span style="color: #339933;">=&gt;</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'js'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span>
<a name="line1361"></a>                <span style="color: #0000ff;">'klonec'</span> <span style="color: #339933;">=&gt;</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'kl1'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span>
<a name="line1362"></a>                <span style="color: #0000ff;">'klonecpp'</span> <span style="color: #339933;">=&gt;</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'klx'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span>
<a name="line1363"></a>                <span style="color: #0000ff;">'latex'</span> <span style="color: #339933;">=&gt;</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'tex'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span>
<a name="line1364"></a>                <span style="color: #0000ff;">'lisp'</span> <span style="color: #339933;">=&gt;</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'lisp'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span>
<a name="line1365"></a>                <span style="color: #0000ff;">'lua'</span> <span style="color: #339933;">=&gt;</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'lua'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span>
<a name="line1366"></a>                <span style="color: #0000ff;">'matlab'</span> <span style="color: #339933;">=&gt;</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'m'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span>
<a name="line1367"></a>                <span style="color: #0000ff;">'mpasm'</span> <span style="color: #339933;">=&gt;</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span>
<a name="line1368"></a>                <span style="color: #0000ff;">'mysql'</span> <span style="color: #339933;">=&gt;</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'sql'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span>
<a name="line1369"></a>                <span style="color: #0000ff;">'nsis'</span> <span style="color: #339933;">=&gt;</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span>
<a name="line1370"></a>                <span style="color: #0000ff;">'objc'</span> <span style="color: #339933;">=&gt;</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span>
<a name="line1371"></a>                <span style="color: #0000ff;">'oobas'</span> <span style="color: #339933;">=&gt;</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span>
<a name="line1372"></a>                <span style="color: #0000ff;">'oracle8'</span> <span style="color: #339933;">=&gt;</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span>
<a name="line1373"></a>                <span style="color: #0000ff;">'oracle10'</span> <span style="color: #339933;">=&gt;</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span>
<a name="line1374"></a>                <span style="color: #0000ff;">'pascal'</span> <span style="color: #339933;">=&gt;</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'pas'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span>
<a name="line1375"></a>                <span style="color: #0000ff;">'perl'</span> <span style="color: #339933;">=&gt;</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'pl'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'pm'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span>
<a name="line1376"></a>                <span style="color: #0000ff;">'php'</span> <span style="color: #339933;">=&gt;</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'php'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'php5'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'phtml'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'phps'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span>
<a name="line1377"></a>                <span style="color: #0000ff;">'povray'</span> <span style="color: #339933;">=&gt;</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'pov'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span>
<a name="line1378"></a>                <span style="color: #0000ff;">'providex'</span> <span style="color: #339933;">=&gt;</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'pvc'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'pvx'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span>
<a name="line1379"></a>                <span style="color: #0000ff;">'prolog'</span> <span style="color: #339933;">=&gt;</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'pl'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span>
<a name="line1380"></a>                <span style="color: #0000ff;">'python'</span> <span style="color: #339933;">=&gt;</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'py'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span>
<a name="line1381"></a>                <span style="color: #0000ff;">'qbasic'</span> <span style="color: #339933;">=&gt;</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'bi'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span>
<a name="line1382"></a>                <span style="color: #0000ff;">'reg'</span> <span style="color: #339933;">=&gt;</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'reg'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span>
<a name="line1383"></a>                <span style="color: #0000ff;">'ruby'</span> <span style="color: #339933;">=&gt;</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'rb'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span>
<a name="line1384"></a>                <span style="color: #0000ff;">'sas'</span> <span style="color: #339933;">=&gt;</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'sas'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span>
<a name="line1385"></a>                <span style="color: #0000ff;">'scala'</span> <span style="color: #339933;">=&gt;</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'scala'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span>
<a name="line1386"></a>                <span style="color: #0000ff;">'scheme'</span> <span style="color: #339933;">=&gt;</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'scm'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span>
<a name="line1387"></a>                <span style="color: #0000ff;">'scilab'</span> <span style="color: #339933;">=&gt;</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'sci'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span>
<a name="line1388"></a>                <span style="color: #0000ff;">'smalltalk'</span> <span style="color: #339933;">=&gt;</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'st'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span>
<a name="line1389"></a>                <span style="color: #0000ff;">'smarty'</span> <span style="color: #339933;">=&gt;</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span>
<a name="line1390"></a>                <span style="color: #0000ff;">'tcl'</span> <span style="color: #339933;">=&gt;</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'tcl'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span>
<a name="line1391"></a>                <span style="color: #0000ff;">'vb'</span> <span style="color: #339933;">=&gt;</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'bas'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span>
<a name="line1392"></a>                <span style="color: #0000ff;">'vbnet'</span> <span style="color: #339933;">=&gt;</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span>
<a name="line1393"></a>                <span style="color: #0000ff;">'visualfoxpro'</span> <span style="color: #339933;">=&gt;</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span>
<a name="line1394"></a>                <span style="color: #0000ff;">'whitespace'</span> <span style="color: #339933;">=&gt;</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'ws'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span>
<a name="line1395"></a>                <span style="color: #0000ff;">'xml'</span> <span style="color: #339933;">=&gt;</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'xml'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'svg'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span>
<a name="line1396"></a>                <span style="color: #0000ff;">'z80'</span> <span style="color: #339933;">=&gt;</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'z80'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'asm'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'inc'</span><span style="color: #009900;">&#41;</span>
<a name="line1397"></a>            <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line1398"></a>        <span style="color: #009900;">&#125;</span>
<a name="line1399"></a>&nbsp;
<a name="line1400"></a>        <span style="color: #b1b100;">foreach</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$lookup</span> <span style="color: #b1b100;">as</span> <span style="color: #000088;">$lang</span> <span style="color: #339933;">=&gt;</span> <span style="color: #000088;">$extensions</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1401"></a>            <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><a href="http://www.php.net/in_array"><span style="color: #990000;">in_array</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$extension</span><span style="color: #339933;">,</span> <span style="color: #000088;">$extensions</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1402"></a>                <span style="color: #b1b100;">return</span> <span style="color: #000088;">$lang</span><span style="color: #339933;">;</span>
<a name="line1403"></a>            <span style="color: #009900;">&#125;</span>
<a name="line1404"></a>        <span style="color: #009900;">&#125;</span>
<a name="line1405"></a>        <span style="color: #b1b100;">return</span> <span style="color: #0000ff;">''</span><span style="color: #339933;">;</span>
<a name="line1406"></a>    <span style="color: #009900;">&#125;</span>
<a name="line1407"></a>&nbsp;
<a name="line1408"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line1409"></a>     * Given a file name, this method loads its contents in, and attempts
<a name="line1410"></a>     * to set the language automatically. An optional lookup table can be
<a name="line1411"></a>     * passed for looking up the language name. If not specified a default
<a name="line1412"></a>     * table is used
<a name="line1413"></a>     *
<a name="line1414"></a>     * The language table is in the form
<a name="line1415"></a>     * &lt;pre&gt;array(
<a name="line1416"></a>     *   'lang_name' =&gt; array('extension', 'extension', ...),
<a name="line1417"></a>     *   'lang_name' ...
<a name="line1418"></a>     * );&lt;/pre&gt;
<a name="line1419"></a>     *
<a name="line1420"></a>     * @param string The filename to load the source from
<a name="line1421"></a>     * @param array  A lookup array to use instead of the default one
<a name="line1422"></a>     * @todo Complete rethink of this and above method
<a name="line1423"></a>     * @since 1.0.5
<a name="line1424"></a>     */</span>
<a name="line1425"></a>    <span style="color: #000000; font-weight: bold;">function</span> load_from_file<span style="color: #009900;">&#40;</span><span style="color: #000088;">$file_name</span><span style="color: #339933;">,</span> <span style="color: #000088;">$lookup</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1426"></a>        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><a href="http://www.php.net/is_readable"><span style="color: #990000;">is_readable</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$file_name</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1427"></a>            <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">set_source</span><span style="color: #009900;">&#40;</span><a href="http://www.php.net/file_get_contents"><span style="color: #990000;">file_get_contents</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$file_name</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line1428"></a>            <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">set_language</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">get_language_name_from_extension</span><span style="color: #009900;">&#40;</span><a href="http://www.php.net/substr"><span style="color: #990000;">substr</span></a><span style="color: #009900;">&#40;</span><a href="http://www.php.net/strrchr"><span style="color: #990000;">strrchr</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$file_name</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'.'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <span style="color: #000088;">$lookup</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line1429"></a>        <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line1430"></a>            <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">error</span> <span style="color: #339933;">=</span> GESHI_ERROR_FILE_NOT_READABLE<span style="color: #339933;">;</span>
<a name="line1431"></a>        <span style="color: #009900;">&#125;</span>
<a name="line1432"></a>    <span style="color: #009900;">&#125;</span>
<a name="line1433"></a>&nbsp;
<a name="line1434"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line1435"></a>     * Adds a keyword to a keyword group for highlighting
<a name="line1436"></a>     *
<a name="line1437"></a>     * @param int    The key of the keyword group to add the keyword to
<a name="line1438"></a>     * @param string The word to add to the keyword group
<a name="line1439"></a>     * @since 1.0.0
<a name="line1440"></a>     */</span>
<a name="line1441"></a>    <span style="color: #000000; font-weight: bold;">function</span> add_keyword<span style="color: #009900;">&#40;</span><span style="color: #000088;">$key</span><span style="color: #339933;">,</span> <span style="color: #000088;">$word</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1442"></a>        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><a href="http://www.php.net/in_array"><span style="color: #990000;">in_array</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$word</span><span style="color: #339933;">,</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'KEYWORDS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$key</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1443"></a>            <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'KEYWORDS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$key</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$word</span><span style="color: #339933;">;</span>
<a name="line1444"></a>&nbsp;
<a name="line1445"></a>            <span style="color: #666666; font-style: italic;">//NEW in 1.0.8 don't recompile the whole optimized regexp, simply append it</span>
<a name="line1446"></a>            <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">parse_cache_built</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1447"></a>                <span style="color: #000088;">$subkey</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/count"><span style="color: #990000;">count</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'CACHED_KEYWORD_LISTS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$key</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">-</span> <span style="color: #cc66cc;">1</span><span style="color: #339933;">;</span>
<a name="line1448"></a>                <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'CACHED_KEYWORD_LISTS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$key</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$subkey</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">.=</span> <span style="color: #0000ff;">'|'</span> <span style="color: #339933;">.</span> <a href="http://www.php.net/preg_quote"><span style="color: #990000;">preg_quote</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$word</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'/'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line1449"></a>            <span style="color: #009900;">&#125;</span>
<a name="line1450"></a>        <span style="color: #009900;">&#125;</span>
<a name="line1451"></a>    <span style="color: #009900;">&#125;</span>
<a name="line1452"></a>&nbsp;
<a name="line1453"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line1454"></a>     * Removes a keyword from a keyword group
<a name="line1455"></a>     *
<a name="line1456"></a>     * @param int    The key of the keyword group to remove the keyword from
<a name="line1457"></a>     * @param string The word to remove from the keyword group
<a name="line1458"></a>     * @param bool   Wether to automatically recompile the optimized regexp list or not.
<a name="line1459"></a>     *               Note: if you set this to false and @see GeSHi-&gt;parse_code() was already called once,
<a name="line1460"></a>     *               for the current language, you have to manually call @see GeSHi-&gt;optimize_keyword_group()
<a name="line1461"></a>     *               or the removed keyword will stay in cache and still be highlighted! On the other hand
<a name="line1462"></a>     *               it might be too expensive to recompile the regexp list for every removal if you want to
<a name="line1463"></a>     *               remove a lot of keywords.
<a name="line1464"></a>     * @since 1.0.0
<a name="line1465"></a>     */</span>
<a name="line1466"></a>    <span style="color: #000000; font-weight: bold;">function</span> remove_keyword<span style="color: #009900;">&#40;</span><span style="color: #000088;">$key</span><span style="color: #339933;">,</span> <span style="color: #000088;">$word</span><span style="color: #339933;">,</span> <span style="color: #000088;">$recompile</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">true</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1467"></a>        <span style="color: #000088;">$key_to_remove</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/array_search"><span style="color: #990000;">array_search</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$word</span><span style="color: #339933;">,</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'KEYWORDS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$key</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line1468"></a>        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$key_to_remove</span> <span style="color: #339933;">!==</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1469"></a>            <a href="http://www.php.net/unset"><span style="color: #990000;">unset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'KEYWORDS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$key</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$key_to_remove</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line1470"></a>&nbsp;
<a name="line1471"></a>            <span style="color: #666666; font-style: italic;">//NEW in 1.0.8, optionally recompile keyword group</span>
<a name="line1472"></a>            <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$recompile</span> <span style="color: #339933;">&amp;&amp;</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">parse_cache_built</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1473"></a>                <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">optimize_keyword_group</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$key</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line1474"></a>            <span style="color: #009900;">&#125;</span>
<a name="line1475"></a>        <span style="color: #009900;">&#125;</span>
<a name="line1476"></a>    <span style="color: #009900;">&#125;</span>
<a name="line1477"></a>&nbsp;
<a name="line1478"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line1479"></a>     * Creates a new keyword group
<a name="line1480"></a>     *
<a name="line1481"></a>     * @param int    The key of the keyword group to create
<a name="line1482"></a>     * @param string The styles for the keyword group
<a name="line1483"></a>     * @param boolean Whether the keyword group is case sensitive ornot
<a name="line1484"></a>     * @param array  The words to use for the keyword group
<a name="line1485"></a>     * @since 1.0.0
<a name="line1486"></a>     */</span>
<a name="line1487"></a>    <span style="color: #000000; font-weight: bold;">function</span> add_keyword_group<span style="color: #009900;">&#40;</span><span style="color: #000088;">$key</span><span style="color: #339933;">,</span> <span style="color: #000088;">$styles</span><span style="color: #339933;">,</span> <span style="color: #000088;">$case_sensitive</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">true</span><span style="color: #339933;">,</span> <span style="color: #000088;">$words</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1488"></a>        <span style="color: #000088;">$words</span> <span style="color: #339933;">=</span> <span style="color: #009900;">&#40;</span><a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#41;</span> <span style="color: #000088;">$words</span><span style="color: #339933;">;</span>
<a name="line1489"></a>        <span style="color: #b1b100;">if</span>  <span style="color: #009900;">&#40;</span><a href="http://www.php.net/empty"><span style="color: #990000;">empty</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$words</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1490"></a>            <span style="color: #666666; font-style: italic;">// empty word lists mess up highlighting</span>
<a name="line1491"></a>            <span style="color: #b1b100;">return</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #339933;">;</span>
<a name="line1492"></a>        <span style="color: #009900;">&#125;</span>
<a name="line1493"></a>&nbsp;
<a name="line1494"></a>        <span style="color: #666666; font-style: italic;">//Add the new keyword group internally</span>
<a name="line1495"></a>        <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'KEYWORDS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$key</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$words</span><span style="color: #339933;">;</span>
<a name="line1496"></a>        <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">lexic_permissions</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'KEYWORDS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$key</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">true</span><span style="color: #339933;">;</span>
<a name="line1497"></a>        <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'CASE_SENSITIVE'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$key</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$case_sensitive</span><span style="color: #339933;">;</span>
<a name="line1498"></a>        <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'STYLES'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'KEYWORDS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$key</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$styles</span><span style="color: #339933;">;</span>
<a name="line1499"></a>&nbsp;
<a name="line1500"></a>        <span style="color: #666666; font-style: italic;">//NEW in 1.0.8, cache keyword regexp</span>
<a name="line1501"></a>        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">parse_cache_built</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1502"></a>            <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">optimize_keyword_group</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$key</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line1503"></a>        <span style="color: #009900;">&#125;</span>
<a name="line1504"></a>    <span style="color: #009900;">&#125;</span>
<a name="line1505"></a>&nbsp;
<a name="line1506"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line1507"></a>     * Removes a keyword group
<a name="line1508"></a>     *
<a name="line1509"></a>     * @param int    The key of the keyword group to remove
<a name="line1510"></a>     * @since 1.0.0
<a name="line1511"></a>     */</span>
<a name="line1512"></a>    <span style="color: #000000; font-weight: bold;">function</span> remove_keyword_group <span style="color: #009900;">&#40;</span><span style="color: #000088;">$key</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1513"></a>        <span style="color: #666666; font-style: italic;">//Remove the keyword group internally</span>
<a name="line1514"></a>        <a href="http://www.php.net/unset"><span style="color: #990000;">unset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'KEYWORDS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$key</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line1515"></a>        <a href="http://www.php.net/unset"><span style="color: #990000;">unset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">lexic_permissions</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'KEYWORDS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$key</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line1516"></a>        <a href="http://www.php.net/unset"><span style="color: #990000;">unset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'CASE_SENSITIVE'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$key</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line1517"></a>        <a href="http://www.php.net/unset"><span style="color: #990000;">unset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'STYLES'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'KEYWORDS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$key</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line1518"></a>&nbsp;
<a name="line1519"></a>        <span style="color: #666666; font-style: italic;">//NEW in 1.0.8</span>
<a name="line1520"></a>        <a href="http://www.php.net/unset"><span style="color: #990000;">unset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'CACHED_KEYWORD_LISTS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$key</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line1521"></a>    <span style="color: #009900;">&#125;</span>
<a name="line1522"></a>&nbsp;
<a name="line1523"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line1524"></a>     * compile optimized regexp list for keyword group
<a name="line1525"></a>     *
<a name="line1526"></a>     * @param int   The key of the keyword group to compile &amp; optimize
<a name="line1527"></a>     * @since 1.0.8
<a name="line1528"></a>     */</span>
<a name="line1529"></a>    <span style="color: #000000; font-weight: bold;">function</span> optimize_keyword_group<span style="color: #009900;">&#40;</span><span style="color: #000088;">$key</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1530"></a>        <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'CACHED_KEYWORD_LISTS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$key</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span>
<a name="line1531"></a>            <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">optimize_regexp_list</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'KEYWORDS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$key</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line1532"></a>        <span style="color: #000088;">$space_as_whitespace</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #339933;">;</span>
<a name="line1533"></a>        <span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><a href="http://www.php.net/isset"><span style="color: #990000;">isset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'PARSER_CONTROL'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1534"></a>            <span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><a href="http://www.php.net/isset"><span style="color: #990000;">isset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'PARSER_CONTROL'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'KEYWORDS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1535"></a>                <span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><a href="http://www.php.net/isset"><span style="color: #990000;">isset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'PARSER_CONTROL'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'KEYWORDS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'SPACE_AS_WHITESPACE'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1536"></a>                    <span style="color: #000088;">$space_as_whitespace</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'PARSER_CONTROL'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'KEYWORDS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'SPACE_AS_WHITESPACE'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
<a name="line1537"></a>                <span style="color: #009900;">&#125;</span>
<a name="line1538"></a>                <span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><a href="http://www.php.net/isset"><span style="color: #990000;">isset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'PARSER_CONTROL'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'KEYWORDS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$key</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'SPACE_AS_WHITESPACE'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1539"></a>                    <span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><a href="http://www.php.net/isset"><span style="color: #990000;">isset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'PARSER_CONTROL'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'KEYWORDS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$key</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'SPACE_AS_WHITESPACE'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1540"></a>                        <span style="color: #000088;">$space_as_whitespace</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'PARSER_CONTROL'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'KEYWORDS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$key</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'SPACE_AS_WHITESPACE'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
<a name="line1541"></a>                    <span style="color: #009900;">&#125;</span>
<a name="line1542"></a>                <span style="color: #009900;">&#125;</span>
<a name="line1543"></a>            <span style="color: #009900;">&#125;</span>
<a name="line1544"></a>        <span style="color: #009900;">&#125;</span>
<a name="line1545"></a>        <span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$space_as_whitespace</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1546"></a>            <span style="color: #b1b100;">foreach</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'CACHED_KEYWORD_LISTS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$key</span><span style="color: #009900;">&#93;</span> <span style="color: #b1b100;">as</span> <span style="color: #000088;">$rxk</span> <span style="color: #339933;">=&gt;</span> <span style="color: #000088;">$rxv</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1547"></a>                <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'CACHED_KEYWORD_LISTS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$key</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$rxk</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span>
<a name="line1548"></a>                    <a href="http://www.php.net/str_replace"><span style="color: #990000;">str_replace</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot; &quot;</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\\</span>s+&quot;</span><span style="color: #339933;">,</span> <span style="color: #000088;">$rxv</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line1549"></a>            <span style="color: #009900;">&#125;</span>
<a name="line1550"></a>        <span style="color: #009900;">&#125;</span>
<a name="line1551"></a>    <span style="color: #009900;">&#125;</span>
<a name="line1552"></a>&nbsp;
<a name="line1553"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line1554"></a>     * Sets the content of the header block
<a name="line1555"></a>     *
<a name="line1556"></a>     * @param string The content of the header block
<a name="line1557"></a>     * @since 1.0.2
<a name="line1558"></a>     */</span>
<a name="line1559"></a>    <span style="color: #000000; font-weight: bold;">function</span> set_header_content<span style="color: #009900;">&#40;</span><span style="color: #000088;">$content</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1560"></a>        <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">header_content</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$content</span><span style="color: #339933;">;</span>
<a name="line1561"></a>    <span style="color: #009900;">&#125;</span>
<a name="line1562"></a>&nbsp;
<a name="line1563"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line1564"></a>     * Sets the content of the footer block
<a name="line1565"></a>     *
<a name="line1566"></a>     * @param string The content of the footer block
<a name="line1567"></a>     * @since 1.0.2
<a name="line1568"></a>     */</span>
<a name="line1569"></a>    <span style="color: #000000; font-weight: bold;">function</span> set_footer_content<span style="color: #009900;">&#40;</span><span style="color: #000088;">$content</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1570"></a>        <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">footer_content</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$content</span><span style="color: #339933;">;</span>
<a name="line1571"></a>    <span style="color: #009900;">&#125;</span>
<a name="line1572"></a>&nbsp;
<a name="line1573"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line1574"></a>     * Sets the style for the header content
<a name="line1575"></a>     *
<a name="line1576"></a>     * @param string The style for the header content
<a name="line1577"></a>     * @since 1.0.2
<a name="line1578"></a>     */</span>
<a name="line1579"></a>    <span style="color: #000000; font-weight: bold;">function</span> set_header_content_style<span style="color: #009900;">&#40;</span><span style="color: #000088;">$style</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1580"></a>        <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">header_content_style</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$style</span><span style="color: #339933;">;</span>
<a name="line1581"></a>    <span style="color: #009900;">&#125;</span>
<a name="line1582"></a>&nbsp;
<a name="line1583"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line1584"></a>     * Sets the style for the footer content
<a name="line1585"></a>     *
<a name="line1586"></a>     * @param string The style for the footer content
<a name="line1587"></a>     * @since 1.0.2
<a name="line1588"></a>     */</span>
<a name="line1589"></a>    <span style="color: #000000; font-weight: bold;">function</span> set_footer_content_style<span style="color: #009900;">&#40;</span><span style="color: #000088;">$style</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1590"></a>        <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">footer_content_style</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$style</span><span style="color: #339933;">;</span>
<a name="line1591"></a>    <span style="color: #009900;">&#125;</span>
<a name="line1592"></a>&nbsp;
<a name="line1593"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line1594"></a>     * Sets whether to force a surrounding block around
<a name="line1595"></a>     * the highlighted code or not
<a name="line1596"></a>     *
<a name="line1597"></a>     * @param boolean Tells whether to enable or disable this feature
<a name="line1598"></a>     * @since 1.0.7.20
<a name="line1599"></a>     */</span>
<a name="line1600"></a>    <span style="color: #000000; font-weight: bold;">function</span> enable_inner_code_block<span style="color: #009900;">&#40;</span><span style="color: #000088;">$flag</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1601"></a>        <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">force_code_block</span> <span style="color: #339933;">=</span> <span style="color: #009900;">&#40;</span>bool<span style="color: #009900;">&#41;</span><span style="color: #000088;">$flag</span><span style="color: #339933;">;</span>
<a name="line1602"></a>    <span style="color: #009900;">&#125;</span>
<a name="line1603"></a>&nbsp;
<a name="line1604"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line1605"></a>     * Sets the base URL to be used for keywords
<a name="line1606"></a>     *
<a name="line1607"></a>     * @param int The key of the keyword group to set the URL for
<a name="line1608"></a>     * @param string The URL to set for the group. If {FNAME} is in
<a name="line1609"></a>     *               the url somewhere, it is replaced by the keyword
<a name="line1610"></a>     *               that the URL is being made for
<a name="line1611"></a>     * @since 1.0.2
<a name="line1612"></a>     */</span>
<a name="line1613"></a>    <span style="color: #000000; font-weight: bold;">function</span> set_url_for_keyword_group<span style="color: #009900;">&#40;</span><span style="color: #000088;">$group</span><span style="color: #339933;">,</span> <span style="color: #000088;">$url</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1614"></a>        <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'URLS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$group</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$url</span><span style="color: #339933;">;</span>
<a name="line1615"></a>    <span style="color: #009900;">&#125;</span>
<a name="line1616"></a>&nbsp;
<a name="line1617"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line1618"></a>     * Sets styles for links in code
<a name="line1619"></a>     *
<a name="line1620"></a>     * @param int A constant that specifies what state the style is being
<a name="line1621"></a>     *            set for - e.g. :hover or :visited
<a name="line1622"></a>     * @param string The styles to use for that state
<a name="line1623"></a>     * @since 1.0.2
<a name="line1624"></a>     */</span>
<a name="line1625"></a>    <span style="color: #000000; font-weight: bold;">function</span> set_link_styles<span style="color: #009900;">&#40;</span><span style="color: #000088;">$type</span><span style="color: #339933;">,</span> <span style="color: #000088;">$styles</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1626"></a>        <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">link_styles</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$type</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$styles</span><span style="color: #339933;">;</span>
<a name="line1627"></a>    <span style="color: #009900;">&#125;</span>
<a name="line1628"></a>&nbsp;
<a name="line1629"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line1630"></a>     * Sets the target for links in code
<a name="line1631"></a>     *
<a name="line1632"></a>     * @param string The target for links in the code, e.g. _blank
<a name="line1633"></a>     * @since 1.0.3
<a name="line1634"></a>     */</span>
<a name="line1635"></a>    <span style="color: #000000; font-weight: bold;">function</span> set_link_target<span style="color: #009900;">&#40;</span><span style="color: #000088;">$target</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1636"></a>        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><span style="color: #000088;">$target</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1637"></a>            <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">link_target</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">''</span><span style="color: #339933;">;</span>
<a name="line1638"></a>        <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line1639"></a>            <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">link_target</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">' target=&quot;'</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$target</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">'&quot;'</span><span style="color: #339933;">;</span>
<a name="line1640"></a>        <span style="color: #009900;">&#125;</span>
<a name="line1641"></a>    <span style="color: #009900;">&#125;</span>
<a name="line1642"></a>&nbsp;
<a name="line1643"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line1644"></a>     * Sets styles for important parts of the code
<a name="line1645"></a>     *
<a name="line1646"></a>     * @param string The styles to use on important parts of the code
<a name="line1647"></a>     * @since 1.0.2
<a name="line1648"></a>     */</span>
<a name="line1649"></a>    <span style="color: #000000; font-weight: bold;">function</span> set_important_styles<span style="color: #009900;">&#40;</span><span style="color: #000088;">$styles</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1650"></a>        <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">important_styles</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$styles</span><span style="color: #339933;">;</span>
<a name="line1651"></a>    <span style="color: #009900;">&#125;</span>
<a name="line1652"></a>&nbsp;
<a name="line1653"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line1654"></a>     * Sets whether context-important blocks are highlighted
<a name="line1655"></a>     *
<a name="line1656"></a>     * @param boolean Tells whether to enable or disable highlighting of important blocks
<a name="line1657"></a>     * @todo REMOVE THIS SHIZ FROM GESHI!
<a name="line1658"></a>     * @deprecated
<a name="line1659"></a>     * @since 1.0.2
<a name="line1660"></a>     */</span>
<a name="line1661"></a>    <span style="color: #000000; font-weight: bold;">function</span> enable_important_blocks<span style="color: #009900;">&#40;</span><span style="color: #000088;">$flag</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1662"></a>        <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">enable_important_blocks</span> <span style="color: #339933;">=</span> <span style="color: #009900;">&#40;</span> <span style="color: #000088;">$flag</span> <span style="color: #009900;">&#41;</span> ? <span style="color: #009900; font-weight: bold;">true</span> <span style="color: #339933;">:</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #339933;">;</span>
<a name="line1663"></a>    <span style="color: #009900;">&#125;</span>
<a name="line1664"></a>&nbsp;
<a name="line1665"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line1666"></a>     * Whether CSS IDs should be added to each line
<a name="line1667"></a>     *
<a name="line1668"></a>     * @param boolean If true, IDs will be added to each line.
<a name="line1669"></a>     * @since 1.0.2
<a name="line1670"></a>     */</span>
<a name="line1671"></a>    <span style="color: #000000; font-weight: bold;">function</span> enable_ids<span style="color: #009900;">&#40;</span><span style="color: #000088;">$flag</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">true</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1672"></a>        <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">add_ids</span> <span style="color: #339933;">=</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$flag</span><span style="color: #009900;">&#41;</span> ? <span style="color: #009900; font-weight: bold;">true</span> <span style="color: #339933;">:</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #339933;">;</span>
<a name="line1673"></a>    <span style="color: #009900;">&#125;</span>
<a name="line1674"></a>&nbsp;
<a name="line1675"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line1676"></a>     * Specifies which lines to highlight extra
<a name="line1677"></a>     *
<a name="line1678"></a>     * The extra style parameter was added in 1.0.7.21.
<a name="line1679"></a>     *
<a name="line1680"></a>     * @param mixed An array of line numbers to highlight, or just a line
<a name="line1681"></a>     *              number on its own.
<a name="line1682"></a>     * @param string A string specifying the style to use for this line.
<a name="line1683"></a>     *              If null is specified, the default style is used.
<a name="line1684"></a>     *              If false is specified, the line will be removed from
<a name="line1685"></a>     *              special highlighting
<a name="line1686"></a>     * @since 1.0.2
<a name="line1687"></a>     * @todo  Some data replication here that could be cut down on
<a name="line1688"></a>     */</span>
<a name="line1689"></a>    <span style="color: #000000; font-weight: bold;">function</span> highlight_lines_extra<span style="color: #009900;">&#40;</span><span style="color: #000088;">$lines</span><span style="color: #339933;">,</span> <span style="color: #000088;">$style</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">null</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1690"></a>        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><a href="http://www.php.net/is_array"><span style="color: #990000;">is_array</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$lines</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1691"></a>            <span style="color: #666666; font-style: italic;">//Split up the job using single lines at a time</span>
<a name="line1692"></a>            <span style="color: #b1b100;">foreach</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$lines</span> <span style="color: #b1b100;">as</span> <span style="color: #000088;">$line</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1693"></a>                <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">highlight_lines_extra</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$line</span><span style="color: #339933;">,</span> <span style="color: #000088;">$style</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line1694"></a>            <span style="color: #009900;">&#125;</span>
<a name="line1695"></a>        <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line1696"></a>            <span style="color: #666666; font-style: italic;">//Mark the line as being highlighted specially</span>
<a name="line1697"></a>            <span style="color: #000088;">$lines</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/intval"><span style="color: #990000;">intval</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$lines</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line1698"></a>            <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">highlight_extra_lines</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$lines</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$lines</span><span style="color: #339933;">;</span>
<a name="line1699"></a>&nbsp;
<a name="line1700"></a>            <span style="color: #666666; font-style: italic;">//Decide on which style to use</span>
<a name="line1701"></a>            <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$style</span> <span style="color: #339933;">===</span> <span style="color: #009900; font-weight: bold;">null</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span> <span style="color: #666666; font-style: italic;">//Check if we should use default style</span>
<a name="line1702"></a>                <a href="http://www.php.net/unset"><span style="color: #990000;">unset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">highlight_extra_lines_styles</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$lines</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line1703"></a>            <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$style</span> <span style="color: #339933;">===</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span> <span style="color: #666666; font-style: italic;">//Check if to remove this line</span>
<a name="line1704"></a>                <a href="http://www.php.net/unset"><span style="color: #990000;">unset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">highlight_extra_lines</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$lines</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line1705"></a>                <a href="http://www.php.net/unset"><span style="color: #990000;">unset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">highlight_extra_lines_styles</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$lines</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line1706"></a>            <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line1707"></a>                <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">highlight_extra_lines_styles</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$lines</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$style</span><span style="color: #339933;">;</span>
<a name="line1708"></a>            <span style="color: #009900;">&#125;</span>
<a name="line1709"></a>        <span style="color: #009900;">&#125;</span>
<a name="line1710"></a>    <span style="color: #009900;">&#125;</span>
<a name="line1711"></a>&nbsp;
<a name="line1712"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line1713"></a>     * Sets the style for extra-highlighted lines
<a name="line1714"></a>     *
<a name="line1715"></a>     * @param string The style for extra-highlighted lines
<a name="line1716"></a>     * @since 1.0.2
<a name="line1717"></a>     */</span>
<a name="line1718"></a>    <span style="color: #000000; font-weight: bold;">function</span> set_highlight_lines_extra_style<span style="color: #009900;">&#40;</span><span style="color: #000088;">$styles</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1719"></a>        <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">highlight_extra_lines_style</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$styles</span><span style="color: #339933;">;</span>
<a name="line1720"></a>    <span style="color: #009900;">&#125;</span>
<a name="line1721"></a>&nbsp;
<a name="line1722"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line1723"></a>     * Sets the line-ending
<a name="line1724"></a>     *
<a name="line1725"></a>     * @param string The new line-ending
<a name="line1726"></a>     * @since 1.0.2
<a name="line1727"></a>     */</span>
<a name="line1728"></a>    <span style="color: #000000; font-weight: bold;">function</span> set_line_ending<span style="color: #009900;">&#40;</span><span style="color: #000088;">$line_ending</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1729"></a>        <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">line_ending</span> <span style="color: #339933;">=</span> <span style="color: #009900;">&#40;</span>string<span style="color: #009900;">&#41;</span><span style="color: #000088;">$line_ending</span><span style="color: #339933;">;</span>
<a name="line1730"></a>    <span style="color: #009900;">&#125;</span>
<a name="line1731"></a>&nbsp;
<a name="line1732"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line1733"></a>     * Sets what number line numbers should start at. Should
<a name="line1734"></a>     * be a positive integer, and will be converted to one.
<a name="line1735"></a>     *
<a name="line1736"></a>     * &lt;b&gt;Warning:&lt;/b&gt; Using this method will add the &quot;start&quot;
<a name="line1737"></a>     * attribute to the &amp;lt;ol&amp;gt; that is used for line numbering.
<a name="line1738"></a>     * This is &lt;b&gt;not&lt;/b&gt; valid XHTML strict, so if that's what you
<a name="line1739"></a>     * care about then don't use this method. Firefox is getting
<a name="line1740"></a>     * support for the CSS method of doing this in 1.1 and Opera
<a name="line1741"></a>     * has support for the CSS method, but (of course) IE doesn't
<a name="line1742"></a>     * so it's not worth doing it the CSS way yet.
<a name="line1743"></a>     *
<a name="line1744"></a>     * @param int The number to start line numbers at
<a name="line1745"></a>     * @since 1.0.2
<a name="line1746"></a>     */</span>
<a name="line1747"></a>    <span style="color: #000000; font-weight: bold;">function</span> start_line_numbers_at<span style="color: #009900;">&#40;</span><span style="color: #000088;">$number</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1748"></a>        <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">line_numbers_start</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/abs"><span style="color: #990000;">abs</span></a><span style="color: #009900;">&#40;</span><a href="http://www.php.net/intval"><span style="color: #990000;">intval</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$number</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line1749"></a>    <span style="color: #009900;">&#125;</span>
<a name="line1750"></a>&nbsp;
<a name="line1751"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line1752"></a>     * Sets the encoding used for htmlspecialchars(), for international
<a name="line1753"></a>     * support.
<a name="line1754"></a>     *
<a name="line1755"></a>     * NOTE: This is not needed for now because htmlspecialchars() is not
<a name="line1756"></a>     * being used (it has a security hole in PHP4 that has not been patched).
<a name="line1757"></a>     * Maybe in a future version it may make a return for speed reasons, but
<a name="line1758"></a>     * I doubt it.
<a name="line1759"></a>     *
<a name="line1760"></a>     * @param string The encoding to use for the source
<a name="line1761"></a>     * @since 1.0.3
<a name="line1762"></a>     */</span>
<a name="line1763"></a>    <span style="color: #000000; font-weight: bold;">function</span> set_encoding<span style="color: #009900;">&#40;</span><span style="color: #000088;">$encoding</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1764"></a>        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$encoding</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1765"></a>          <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">encoding</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/strtolower"><span style="color: #990000;">strtolower</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$encoding</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line1766"></a>        <span style="color: #009900;">&#125;</span>
<a name="line1767"></a>    <span style="color: #009900;">&#125;</span>
<a name="line1768"></a>&nbsp;
<a name="line1769"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line1770"></a>     * Turns linking of keywords on or off.
<a name="line1771"></a>     *
<a name="line1772"></a>     * @param boolean If true, links will be added to keywords
<a name="line1773"></a>     * @since 1.0.2
<a name="line1774"></a>     */</span>
<a name="line1775"></a>    <span style="color: #000000; font-weight: bold;">function</span> enable_keyword_links<span style="color: #009900;">&#40;</span><span style="color: #000088;">$enable</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">true</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1776"></a>        <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">keyword_links</span> <span style="color: #339933;">=</span> <span style="color: #009900;">&#40;</span>bool<span style="color: #009900;">&#41;</span> <span style="color: #000088;">$enable</span><span style="color: #339933;">;</span>
<a name="line1777"></a>    <span style="color: #009900;">&#125;</span>
<a name="line1778"></a>&nbsp;
<a name="line1779"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line1780"></a>     * Setup caches needed for styling. This is automatically called in
<a name="line1781"></a>     * parse_code() and get_stylesheet() when appropriate. This function helps
<a name="line1782"></a>     * stylesheet generators as they rely on some style information being
<a name="line1783"></a>     * preprocessed
<a name="line1784"></a>     *
<a name="line1785"></a>     * @since 1.0.8
<a name="line1786"></a>     * @access private
<a name="line1787"></a>     */</span>
<a name="line1788"></a>    <span style="color: #000000; font-weight: bold;">function</span> build_style_cache<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1789"></a>        <span style="color: #666666; font-style: italic;">//Build the style cache needed to highlight numbers appropriate</span>
<a name="line1790"></a>        <span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">lexic_permissions</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'NUMBERS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1791"></a>            <span style="color: #666666; font-style: italic;">//First check what way highlighting information for numbers are given</span>
<a name="line1792"></a>            <span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><a href="http://www.php.net/isset"><span style="color: #990000;">isset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'NUMBERS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1793"></a>                <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'NUMBERS'</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span>
<a name="line1794"></a>            <span style="color: #009900;">&#125;</span>
<a name="line1795"></a>&nbsp;
<a name="line1796"></a>            <span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><a href="http://www.php.net/is_array"><span style="color: #990000;">is_array</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'NUMBERS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1797"></a>                <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'NUMBERS_CACHE'</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'NUMBERS'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
<a name="line1798"></a>            <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line1799"></a>                <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'NUMBERS_CACHE'</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line1800"></a>                <span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'NUMBERS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1801"></a>                    <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'NUMBERS'</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span>
<a name="line1802"></a>                        GESHI_NUMBER_INT_BASIC <span style="color: #339933;">|</span>
<a name="line1803"></a>                        GESHI_NUMBER_FLT_NONSCI<span style="color: #339933;">;</span>
<a name="line1804"></a>                <span style="color: #009900;">&#125;</span>
<a name="line1805"></a>&nbsp;
<a name="line1806"></a>                <span style="color: #b1b100;">for</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$i</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span> <span style="color: #000088;">$j</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'NUMBERS'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span> <span style="color: #000088;">$j</span> <span style="color: #339933;">&gt;</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span> <span style="color: #339933;">++</span><span style="color: #000088;">$i</span><span style="color: #339933;">,</span> <span style="color: #000088;">$j</span><span style="color: #339933;">&gt;&gt;=</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1807"></a>                    <span style="color: #666666; font-style: italic;">//Rearrange style indices if required ...</span>
<a name="line1808"></a>                    <span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><a href="http://www.php.net/isset"><span style="color: #990000;">isset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'STYLES'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'NUMBERS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">&lt;&lt;</span><span style="color: #000088;">$i</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1809"></a>                        <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'STYLES'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'NUMBERS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$i</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span>
<a name="line1810"></a>                            <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'STYLES'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'NUMBERS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">&lt;&lt;</span><span style="color: #000088;">$i</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
<a name="line1811"></a>                        <a href="http://www.php.net/unset"><span style="color: #990000;">unset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'STYLES'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'NUMBERS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">&lt;&lt;</span><span style="color: #000088;">$i</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line1812"></a>                    <span style="color: #009900;">&#125;</span>
<a name="line1813"></a>&nbsp;
<a name="line1814"></a>                    <span style="color: #666666; font-style: italic;">//Check if this bit is set for highlighting</span>
<a name="line1815"></a>                    <span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$j</span><span style="color: #339933;">&amp;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1816"></a>                        <span style="color: #666666; font-style: italic;">//So this bit is set ...</span>
<a name="line1817"></a>                        <span style="color: #666666; font-style: italic;">//Check if it belongs to group 0 or the actual stylegroup</span>
<a name="line1818"></a>                        <span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><a href="http://www.php.net/isset"><span style="color: #990000;">isset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'STYLES'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'NUMBERS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$i</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1819"></a>                            <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'NUMBERS_CACHE'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$i</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">1</span> <span style="color: #339933;">&lt;&lt;</span> <span style="color: #000088;">$i</span><span style="color: #339933;">;</span>
<a name="line1820"></a>                        <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line1821"></a>                            <span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><a href="http://www.php.net/isset"><span style="color: #990000;">isset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'NUMBERS_CACHE'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1822"></a>                                <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'NUMBERS_CACHE'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span>
<a name="line1823"></a>                            <span style="color: #009900;">&#125;</span>
<a name="line1824"></a>                            <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'NUMBERS_CACHE'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">|=</span> <span style="color: #cc66cc;">1</span> <span style="color: #339933;">&lt;&lt;</span> <span style="color: #000088;">$i</span><span style="color: #339933;">;</span>
<a name="line1825"></a>                        <span style="color: #009900;">&#125;</span>
<a name="line1826"></a>                    <span style="color: #009900;">&#125;</span>
<a name="line1827"></a>                <span style="color: #009900;">&#125;</span>
<a name="line1828"></a>            <span style="color: #009900;">&#125;</span>
<a name="line1829"></a>        <span style="color: #009900;">&#125;</span>
<a name="line1830"></a>    <span style="color: #009900;">&#125;</span>
<a name="line1831"></a>&nbsp;
<a name="line1832"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line1833"></a>     * Setup caches needed for parsing. This is automatically called in parse_code() when appropriate.
<a name="line1834"></a>     * This function makes stylesheet generators much faster as they do not need these caches.
<a name="line1835"></a>     *
<a name="line1836"></a>     * @since 1.0.8
<a name="line1837"></a>     * @access private
<a name="line1838"></a>     */</span>
<a name="line1839"></a>    <span style="color: #000000; font-weight: bold;">function</span> build_parse_cache<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1840"></a>        <span style="color: #666666; font-style: italic;">// cache symbol regexp</span>
<a name="line1841"></a>        <span style="color: #666666; font-style: italic;">//As this is a costy operation, we avoid doing it for multiple groups ...</span>
<a name="line1842"></a>        <span style="color: #666666; font-style: italic;">//Instead we perform it for all symbols at once.</span>
<a name="line1843"></a>        <span style="color: #666666; font-style: italic;">//</span>
<a name="line1844"></a>        <span style="color: #666666; font-style: italic;">//For this to work, we need to reorganize the data arrays.</span>
<a name="line1845"></a>        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">lexic_permissions</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'SYMBOLS'</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">&amp;&amp;</span> <span style="color: #339933;">!</span><a href="http://www.php.net/empty"><span style="color: #990000;">empty</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'SYMBOLS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1846"></a>            <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'MULTIPLE_SYMBOL_GROUPS'</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/count"><span style="color: #990000;">count</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'STYLES'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'SYMBOLS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">&gt;</span> <span style="color: #cc66cc;">1</span><span style="color: #339933;">;</span>
<a name="line1847"></a>&nbsp;
<a name="line1848"></a>            <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'SYMBOL_DATA'</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line1849"></a>            <span style="color: #000088;">$symbol_preg_multi</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">// multi char symbols</span>
<a name="line1850"></a>            <span style="color: #000088;">$symbol_preg_single</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">// single char symbols</span>
<a name="line1851"></a>            <span style="color: #b1b100;">foreach</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'SYMBOLS'</span><span style="color: #009900;">&#93;</span> <span style="color: #b1b100;">as</span> <span style="color: #000088;">$key</span> <span style="color: #339933;">=&gt;</span> <span style="color: #000088;">$symbols</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1852"></a>                <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><a href="http://www.php.net/is_array"><span style="color: #990000;">is_array</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$symbols</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1853"></a>                    <span style="color: #b1b100;">foreach</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$symbols</span> <span style="color: #b1b100;">as</span> <span style="color: #000088;">$sym</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1854"></a>                        <span style="color: #000088;">$sym</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">hsc</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$sym</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line1855"></a>                        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><a href="http://www.php.net/isset"><span style="color: #990000;">isset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'SYMBOL_DATA'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$sym</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1856"></a>                            <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'SYMBOL_DATA'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$sym</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$key</span><span style="color: #339933;">;</span>
<a name="line1857"></a>                            <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><a href="http://www.php.net/isset"><span style="color: #990000;">isset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$sym</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span> <span style="color: #666666; font-style: italic;">// multiple chars</span>
<a name="line1858"></a>                                <span style="color: #000088;">$symbol_preg_multi</span><span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/preg_quote"><span style="color: #990000;">preg_quote</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$sym</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'/'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line1859"></a>                            <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span> <span style="color: #666666; font-style: italic;">// single char</span>
<a name="line1860"></a>                                <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$sym</span> <span style="color: #339933;">==</span> <span style="color: #0000ff;">'-'</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1861"></a>                                    <span style="color: #666666; font-style: italic;">// don't trigger range out of order error</span>
<a name="line1862"></a>                                    <span style="color: #000088;">$symbol_preg_single</span><span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">'\-'</span><span style="color: #339933;">;</span>
<a name="line1863"></a>                                <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line1864"></a>                                    <span style="color: #000088;">$symbol_preg_single</span><span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/preg_quote"><span style="color: #990000;">preg_quote</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$sym</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'/'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line1865"></a>                                <span style="color: #009900;">&#125;</span>
<a name="line1866"></a>                            <span style="color: #009900;">&#125;</span>
<a name="line1867"></a>                        <span style="color: #009900;">&#125;</span>
<a name="line1868"></a>                    <span style="color: #009900;">&#125;</span>
<a name="line1869"></a>                <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line1870"></a>                    <span style="color: #000088;">$symbols</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">hsc</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$symbols</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line1871"></a>                    <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><a href="http://www.php.net/isset"><span style="color: #990000;">isset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'SYMBOL_DATA'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$symbols</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1872"></a>                        <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'SYMBOL_DATA'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$symbols</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span>
<a name="line1873"></a>                        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><a href="http://www.php.net/isset"><span style="color: #990000;">isset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$symbols</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span> <span style="color: #666666; font-style: italic;">// multiple chars</span>
<a name="line1874"></a>                            <span style="color: #000088;">$symbol_preg_multi</span><span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/preg_quote"><span style="color: #990000;">preg_quote</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$symbols</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'/'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line1875"></a>                        <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$symbols</span> <span style="color: #339933;">==</span> <span style="color: #0000ff;">'-'</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1876"></a>                            <span style="color: #666666; font-style: italic;">// don't trigger range out of order error</span>
<a name="line1877"></a>                            <span style="color: #000088;">$symbol_preg_single</span><span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">'\-'</span><span style="color: #339933;">;</span>
<a name="line1878"></a>                        <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span> <span style="color: #666666; font-style: italic;">// single char</span>
<a name="line1879"></a>                            <span style="color: #000088;">$symbol_preg_single</span><span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/preg_quote"><span style="color: #990000;">preg_quote</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$symbols</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'/'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line1880"></a>                        <span style="color: #009900;">&#125;</span>
<a name="line1881"></a>                    <span style="color: #009900;">&#125;</span>
<a name="line1882"></a>                <span style="color: #009900;">&#125;</span>
<a name="line1883"></a>            <span style="color: #009900;">&#125;</span>
<a name="line1884"></a>&nbsp;
<a name="line1885"></a>            <span style="color: #666666; font-style: italic;">//Now we have an array with each possible symbol as the key and the style as the actual data.</span>
<a name="line1886"></a>            <span style="color: #666666; font-style: italic;">//This way we can set the correct style just the moment we highlight ...</span>
<a name="line1887"></a>            <span style="color: #666666; font-style: italic;">//</span>
<a name="line1888"></a>            <span style="color: #666666; font-style: italic;">//Now we need to rewrite our array to get a search string that</span>
<a name="line1889"></a>            <span style="color: #000088;">$symbol_preg</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line1890"></a>            <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><a href="http://www.php.net/empty"><span style="color: #990000;">empty</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$symbol_preg_multi</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1891"></a>                <a href="http://www.php.net/rsort"><span style="color: #990000;">rsort</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$symbol_preg_multi</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line1892"></a>                <span style="color: #000088;">$symbol_preg</span><span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/implode"><span style="color: #990000;">implode</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'|'</span><span style="color: #339933;">,</span> <span style="color: #000088;">$symbol_preg_multi</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line1893"></a>            <span style="color: #009900;">&#125;</span>
<a name="line1894"></a>            <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><a href="http://www.php.net/empty"><span style="color: #990000;">empty</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$symbol_preg_single</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1895"></a>                <a href="http://www.php.net/rsort"><span style="color: #990000;">rsort</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$symbol_preg_single</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line1896"></a>                <span style="color: #000088;">$symbol_preg</span><span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">'['</span> <span style="color: #339933;">.</span> <a href="http://www.php.net/implode"><span style="color: #990000;">implode</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">''</span><span style="color: #339933;">,</span> <span style="color: #000088;">$symbol_preg_single</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">']'</span><span style="color: #339933;">;</span>
<a name="line1897"></a>            <span style="color: #009900;">&#125;</span>
<a name="line1898"></a>            <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'SYMBOL_SEARCH'</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/implode"><span style="color: #990000;">implode</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;|&quot;</span><span style="color: #339933;">,</span> <span style="color: #000088;">$symbol_preg</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line1899"></a>        <span style="color: #009900;">&#125;</span>
<a name="line1900"></a>&nbsp;
<a name="line1901"></a>        <span style="color: #666666; font-style: italic;">// cache optimized regexp for keyword matching</span>
<a name="line1902"></a>        <span style="color: #666666; font-style: italic;">// remove old cache</span>
<a name="line1903"></a>        <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'CACHED_KEYWORD_LISTS'</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line1904"></a>        <span style="color: #b1b100;">foreach</span> <span style="color: #009900;">&#40;</span><a href="http://www.php.net/array_keys"><span style="color: #990000;">array_keys</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'KEYWORDS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span> <span style="color: #b1b100;">as</span> <span style="color: #000088;">$key</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1905"></a>            <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><a href="http://www.php.net/isset"><span style="color: #990000;">isset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">lexic_permissions</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'KEYWORDS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$key</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">||</span>
<a name="line1906"></a>                    <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">lexic_permissions</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'KEYWORDS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$key</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1907"></a>                <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">optimize_keyword_group</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$key</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line1908"></a>            <span style="color: #009900;">&#125;</span>
<a name="line1909"></a>        <span style="color: #009900;">&#125;</span>
<a name="line1910"></a>&nbsp;
<a name="line1911"></a>        <span style="color: #666666; font-style: italic;">// brackets</span>
<a name="line1912"></a>        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">lexic_permissions</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'BRACKETS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1913"></a>            <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'CACHE_BRACKET_MATCH'</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'['</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">']'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'('</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">')'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'{'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'}'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line1914"></a>            <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">use_classes</span> <span style="color: #339933;">&amp;&amp;</span> <a href="http://www.php.net/isset"><span style="color: #990000;">isset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'STYLES'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'BRACKETS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1915"></a>                <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'CACHE_BRACKET_REPLACE'</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span>
<a name="line1916"></a>                    <span style="color: #0000ff;">'&lt;| style=&quot;'</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'STYLES'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'BRACKETS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">'&quot;&gt;&amp;#91;|&gt;'</span><span style="color: #339933;">,</span>
<a name="line1917"></a>                    <span style="color: #0000ff;">'&lt;| style=&quot;'</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'STYLES'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'BRACKETS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">'&quot;&gt;&amp;#93;|&gt;'</span><span style="color: #339933;">,</span>
<a name="line1918"></a>                    <span style="color: #0000ff;">'&lt;| style=&quot;'</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'STYLES'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'BRACKETS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">'&quot;&gt;&amp;#40;|&gt;'</span><span style="color: #339933;">,</span>
<a name="line1919"></a>                    <span style="color: #0000ff;">'&lt;| style=&quot;'</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'STYLES'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'BRACKETS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">'&quot;&gt;&amp;#41;|&gt;'</span><span style="color: #339933;">,</span>
<a name="line1920"></a>                    <span style="color: #0000ff;">'&lt;| style=&quot;'</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'STYLES'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'BRACKETS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">'&quot;&gt;&amp;#123;|&gt;'</span><span style="color: #339933;">,</span>
<a name="line1921"></a>                    <span style="color: #0000ff;">'&lt;| style=&quot;'</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'STYLES'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'BRACKETS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">'&quot;&gt;&amp;#125;|&gt;'</span><span style="color: #339933;">,</span>
<a name="line1922"></a>                <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line1923"></a>            <span style="color: #009900;">&#125;</span>
<a name="line1924"></a>            <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line1925"></a>                <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'CACHE_BRACKET_REPLACE'</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span>
<a name="line1926"></a>                    <span style="color: #0000ff;">'&lt;| class=&quot;br0&quot;&gt;&amp;#91;|&gt;'</span><span style="color: #339933;">,</span>
<a name="line1927"></a>                    <span style="color: #0000ff;">'&lt;| class=&quot;br0&quot;&gt;&amp;#93;|&gt;'</span><span style="color: #339933;">,</span>
<a name="line1928"></a>                    <span style="color: #0000ff;">'&lt;| class=&quot;br0&quot;&gt;&amp;#40;|&gt;'</span><span style="color: #339933;">,</span>
<a name="line1929"></a>                    <span style="color: #0000ff;">'&lt;| class=&quot;br0&quot;&gt;&amp;#41;|&gt;'</span><span style="color: #339933;">,</span>
<a name="line1930"></a>                    <span style="color: #0000ff;">'&lt;| class=&quot;br0&quot;&gt;&amp;#123;|&gt;'</span><span style="color: #339933;">,</span>
<a name="line1931"></a>                    <span style="color: #0000ff;">'&lt;| class=&quot;br0&quot;&gt;&amp;#125;|&gt;'</span><span style="color: #339933;">,</span>
<a name="line1932"></a>                <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line1933"></a>            <span style="color: #009900;">&#125;</span>
<a name="line1934"></a>        <span style="color: #009900;">&#125;</span>
<a name="line1935"></a>&nbsp;
<a name="line1936"></a>        <span style="color: #666666; font-style: italic;">//Build the parse cache needed to highlight numbers appropriate</span>
<a name="line1937"></a>        <span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">lexic_permissions</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'NUMBERS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1938"></a>            <span style="color: #666666; font-style: italic;">//Check if the style rearrangements have been processed ...</span>
<a name="line1939"></a>            <span style="color: #666666; font-style: italic;">//This also does some preprocessing to check which style groups are useable ...</span>
<a name="line1940"></a>            <span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><a href="http://www.php.net/isset"><span style="color: #990000;">isset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'NUMBERS_CACHE'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1941"></a>                <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">build_style_cache</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line1942"></a>            <span style="color: #009900;">&#125;</span>
<a name="line1943"></a>&nbsp;
<a name="line1944"></a>            <span style="color: #666666; font-style: italic;">//Number format specification</span>
<a name="line1945"></a>            <span style="color: #666666; font-style: italic;">//All this formats are matched case-insensitively!</span>
<a name="line1946"></a>            static <span style="color: #000088;">$numbers_format</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span>
<a name="line1947"></a>                GESHI_NUMBER_INT_BASIC <span style="color: #339933;">=&gt;</span>
<a name="line1948"></a>                    <span style="color: #0000ff;">'(?&lt;![0-9a-z_\.%])(?&lt;![\d\.]e[+\-])([1-9]\d*?|0)(?![0-9a-z\.])'</span><span style="color: #339933;">,</span>
<a name="line1949"></a>                GESHI_NUMBER_INT_CSTYLE <span style="color: #339933;">=&gt;</span>
<a name="line1950"></a>                    <span style="color: #0000ff;">'(?&lt;![0-9a-z_\.%])(?&lt;![\d\.]e[+\-])([1-9]\d*?|0)l(?![0-9a-z\.])'</span><span style="color: #339933;">,</span>
<a name="line1951"></a>                GESHI_NUMBER_BIN_SUFFIX <span style="color: #339933;">=&gt;</span>
<a name="line1952"></a>                    <span style="color: #0000ff;">'(?&lt;![0-9a-z_\.])(?&lt;![\d\.]e[+\-])[01]+?b(?![0-9a-z\.])'</span><span style="color: #339933;">,</span>
<a name="line1953"></a>                GESHI_NUMBER_BIN_PREFIX_PERCENT <span style="color: #339933;">=&gt;</span>
<a name="line1954"></a>                    <span style="color: #0000ff;">'(?&lt;![0-9a-z_\.%])(?&lt;![\d\.]e[+\-])%[01]+?(?![0-9a-z\.])'</span><span style="color: #339933;">,</span>
<a name="line1955"></a>                GESHI_NUMBER_BIN_PREFIX_0B <span style="color: #339933;">=&gt;</span>
<a name="line1956"></a>                    <span style="color: #0000ff;">'(?&lt;![0-9a-z_\.%])(?&lt;![\d\.]e[+\-])0b[01]+?(?![0-9a-z\.])'</span><span style="color: #339933;">,</span>
<a name="line1957"></a>                GESHI_NUMBER_OCT_PREFIX <span style="color: #339933;">=&gt;</span>
<a name="line1958"></a>                    <span style="color: #0000ff;">'(?&lt;![0-9a-z_\.])(?&lt;![\d\.]e[+\-])0[0-7]+?(?![0-9a-z\.])'</span><span style="color: #339933;">,</span>
<a name="line1959"></a>                GESHI_NUMBER_OCT_SUFFIX <span style="color: #339933;">=&gt;</span>
<a name="line1960"></a>                    <span style="color: #0000ff;">'(?&lt;![0-9a-z_\.])(?&lt;![\d\.]e[+\-])[0-7]+?o(?![0-9a-z\.])'</span><span style="color: #339933;">,</span>
<a name="line1961"></a>                GESHI_NUMBER_HEX_PREFIX <span style="color: #339933;">=&gt;</span>
<a name="line1962"></a>                    <span style="color: #0000ff;">'(?&lt;![0-9a-z_\.])(?&lt;![\d\.]e[+\-])0x[0-9a-f]+?(?![0-9a-z\.])'</span><span style="color: #339933;">,</span>
<a name="line1963"></a>                GESHI_NUMBER_HEX_SUFFIX <span style="color: #339933;">=&gt;</span>
<a name="line1964"></a>                    <span style="color: #0000ff;">'(?&lt;![0-9a-z_\.])(?&lt;![\d\.]e[+\-])\d[0-9a-f]*?h(?![0-9a-z\.])'</span><span style="color: #339933;">,</span>
<a name="line1965"></a>                GESHI_NUMBER_FLT_NONSCI <span style="color: #339933;">=&gt;</span>
<a name="line1966"></a>                    <span style="color: #0000ff;">'(?&lt;![0-9a-z_\.])(?&lt;![\d\.]e[+\-])\d+?\.\d+?(?![0-9a-z\.])'</span><span style="color: #339933;">,</span>
<a name="line1967"></a>                GESHI_NUMBER_FLT_NONSCI_F <span style="color: #339933;">=&gt;</span>
<a name="line1968"></a>                    <span style="color: #0000ff;">'(?&lt;![0-9a-z_\.])(?&lt;![\d\.]e[+\-])(?:\d+?(?:\.\d*?)?|\.\d+?)f(?![0-9a-z\.])'</span><span style="color: #339933;">,</span>
<a name="line1969"></a>                GESHI_NUMBER_FLT_SCI_SHORT <span style="color: #339933;">=&gt;</span>
<a name="line1970"></a>                    <span style="color: #0000ff;">'(?&lt;![0-9a-z_\.])(?&lt;![\d\.]e[+\-])\.\d+?(?:e[+\-]?\d+?)?(?![0-9a-z\.])'</span><span style="color: #339933;">,</span>
<a name="line1971"></a>                GESHI_NUMBER_FLT_SCI_ZERO <span style="color: #339933;">=&gt;</span>
<a name="line1972"></a>                    <span style="color: #0000ff;">'(?&lt;![0-9a-z_\.])(?&lt;![\d\.]e[+\-])(?:\d+?(?:\.\d*?)?|\.\d+?)(?:e[+\-]?\d+?)?(?![0-9a-z\.])'</span>
<a name="line1973"></a>                <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line1974"></a>&nbsp;
<a name="line1975"></a>            <span style="color: #666666; font-style: italic;">//At this step we have an associative array with flag groups for a</span>
<a name="line1976"></a>            <span style="color: #666666; font-style: italic;">//specific style or an string denoting a regexp given its index.</span>
<a name="line1977"></a>            <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'NUMBERS_RXCACHE'</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line1978"></a>            <span style="color: #b1b100;">foreach</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'NUMBERS_CACHE'</span><span style="color: #009900;">&#93;</span> <span style="color: #b1b100;">as</span> <span style="color: #000088;">$key</span> <span style="color: #339933;">=&gt;</span> <span style="color: #000088;">$rxdata</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1979"></a>                <span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><a href="http://www.php.net/is_string"><span style="color: #990000;">is_string</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$rxdata</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1980"></a>                    <span style="color: #000088;">$regexp</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$rxdata</span><span style="color: #339933;">;</span>
<a name="line1981"></a>                <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line1982"></a>                    <span style="color: #666666; font-style: italic;">//This is a bitfield of number flags to highlight:</span>
<a name="line1983"></a>                    <span style="color: #666666; font-style: italic;">//Build an array, implode them together and make this the actual RX</span>
<a name="line1984"></a>                    <span style="color: #000088;">$rxuse</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line1985"></a>                    <span style="color: #b1b100;">for</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$i</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">1</span><span style="color: #339933;">;</span> <span style="color: #000088;">$i</span> <span style="color: #339933;">&lt;=</span> <span style="color: #000088;">$rxdata</span><span style="color: #339933;">;</span> <span style="color: #000088;">$i</span><span style="color: #339933;">&lt;&lt;=</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1986"></a>                        <span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$rxdata</span> <span style="color: #339933;">&amp;</span> <span style="color: #000088;">$i</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line1987"></a>                            <span style="color: #000088;">$rxuse</span><span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$numbers_format</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$i</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
<a name="line1988"></a>                        <span style="color: #009900;">&#125;</span>
<a name="line1989"></a>                    <span style="color: #009900;">&#125;</span>
<a name="line1990"></a>                    <span style="color: #000088;">$regexp</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/implode"><span style="color: #990000;">implode</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;|&quot;</span><span style="color: #339933;">,</span> <span style="color: #000088;">$rxuse</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line1991"></a>                <span style="color: #009900;">&#125;</span>
<a name="line1992"></a>&nbsp;
<a name="line1993"></a>                <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'NUMBERS_RXCACHE'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$key</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span>
<a name="line1994"></a>                    <span style="color: #0000ff;">&quot;/(?&lt;!&lt;\|\/NUM!)(?&lt;!\d\/&gt;)(<span style="color: #006699; font-weight: bold;">$regexp</span>)(?!\|&gt;)/i&quot;</span><span style="color: #339933;">;</span>
<a name="line1995"></a>            <span style="color: #009900;">&#125;</span>
<a name="line1996"></a>        <span style="color: #009900;">&#125;</span>
<a name="line1997"></a>&nbsp;
<a name="line1998"></a>        <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">parse_cache_built</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">true</span><span style="color: #339933;">;</span>
<a name="line1999"></a>    <span style="color: #009900;">&#125;</span>
<a name="line2000"></a>&nbsp;
<a name="line2001"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line2002"></a>     * Returns the code in $this-&gt;source, highlighted and surrounded by the
<a name="line2003"></a>     * nessecary HTML.
<a name="line2004"></a>     *
<a name="line2005"></a>     * This should only be called ONCE, cos it's SLOW! If you want to highlight
<a name="line2006"></a>     * the same source multiple times, you're better off doing a whole lot of
<a name="line2007"></a>     * str_replaces to replace the &amp;lt;span&amp;gt;s
<a name="line2008"></a>     *
<a name="line2009"></a>     * @since 1.0.0
<a name="line2010"></a>     */</span>
<a name="line2011"></a>    <span style="color: #000000; font-weight: bold;">function</span> parse_code <span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2012"></a>        <span style="color: #666666; font-style: italic;">// Start the timer</span>
<a name="line2013"></a>        <span style="color: #000088;">$start_time</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/microtime"><span style="color: #990000;">microtime</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line2014"></a>&nbsp;
<a name="line2015"></a>        <span style="color: #666666; font-style: italic;">// Firstly, if there is an error, we won't highlight</span>
<a name="line2016"></a>        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">error</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2017"></a>            <span style="color: #666666; font-style: italic;">//Escape the source for output</span>
<a name="line2018"></a>            <span style="color: #000088;">$result</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">hsc</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">source</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line2019"></a>&nbsp;
<a name="line2020"></a>            <span style="color: #666666; font-style: italic;">//This fix is related to SF#1923020, but has to be applied regardless of</span>
<a name="line2021"></a>            <span style="color: #666666; font-style: italic;">//actually highlighting symbols.</span>
<a name="line2022"></a>            <span style="color: #000088;">$result</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/str_replace"><span style="color: #990000;">str_replace</span></a><span style="color: #009900;">&#40;</span><a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'&lt;SEMI&gt;'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'&lt;PIPE&gt;'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">';'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'|'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <span style="color: #000088;">$result</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line2023"></a>&nbsp;
<a name="line2024"></a>            <span style="color: #666666; font-style: italic;">// Timing is irrelevant</span>
<a name="line2025"></a>            <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">set_time</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$start_time</span><span style="color: #339933;">,</span> <span style="color: #000088;">$start_time</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line2026"></a>            <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">finalise</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$result</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line2027"></a>            <span style="color: #b1b100;">return</span> <span style="color: #000088;">$result</span><span style="color: #339933;">;</span>
<a name="line2028"></a>        <span style="color: #009900;">&#125;</span>
<a name="line2029"></a>&nbsp;
<a name="line2030"></a>        <span style="color: #666666; font-style: italic;">// make sure the parse cache is up2date</span>
<a name="line2031"></a>        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">parse_cache_built</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2032"></a>            <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">build_parse_cache</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line2033"></a>        <span style="color: #009900;">&#125;</span>
<a name="line2034"></a>&nbsp;
<a name="line2035"></a>        <span style="color: #666666; font-style: italic;">// Replace all newlines to a common form.</span>
<a name="line2036"></a>        <span style="color: #000088;">$code</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/str_replace"><span style="color: #990000;">str_replace</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">source</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line2037"></a>        <span style="color: #000088;">$code</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/str_replace"><span style="color: #990000;">str_replace</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\r</span>&quot;</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> <span style="color: #000088;">$code</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line2038"></a>&nbsp;
<a name="line2039"></a>        <span style="color: #666666; font-style: italic;">// Add spaces for regular expression matching and line numbers</span>
<a name="line2040"></a><span style="color: #666666; font-style: italic;">//        $code = &quot;\n&quot; . $code . &quot;\n&quot;;</span>
<a name="line2041"></a>&nbsp;
<a name="line2042"></a>        <span style="color: #666666; font-style: italic;">// Initialise various stuff</span>
<a name="line2043"></a>        <span style="color: #000088;">$length</span>           <span style="color: #339933;">=</span> <a href="http://www.php.net/strlen"><span style="color: #990000;">strlen</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$code</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line2044"></a>        <span style="color: #000088;">$COMMENT_MATCHED</span>  <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #339933;">;</span>
<a name="line2045"></a>        <span style="color: #000088;">$stuff_to_parse</span>   <span style="color: #339933;">=</span> <span style="color: #0000ff;">''</span><span style="color: #339933;">;</span>
<a name="line2046"></a>        <span style="color: #000088;">$endresult</span>        <span style="color: #339933;">=</span> <span style="color: #0000ff;">''</span><span style="color: #339933;">;</span>
<a name="line2047"></a>&nbsp;
<a name="line2048"></a>        <span style="color: #666666; font-style: italic;">// &quot;Important&quot; selections are handled like multiline comments</span>
<a name="line2049"></a>        <span style="color: #666666; font-style: italic;">// @todo GET RID OF THIS SHIZ</span>
<a name="line2050"></a>        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">enable_important_blocks</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2051"></a>            <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'COMMENT_MULTI'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span>GESHI_START_IMPORTANT<span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> GESHI_END_IMPORTANT<span style="color: #339933;">;</span>
<a name="line2052"></a>        <span style="color: #009900;">&#125;</span>
<a name="line2053"></a>&nbsp;
<a name="line2054"></a>        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">strict_mode</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2055"></a>            <span style="color: #666666; font-style: italic;">// Break the source into bits. Each bit will be a portion of the code</span>
<a name="line2056"></a>            <span style="color: #666666; font-style: italic;">// within script delimiters - for example, HTML between &lt; and &gt;</span>
<a name="line2057"></a>            <span style="color: #000088;">$k</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span>
<a name="line2058"></a>            <span style="color: #000088;">$parts</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line2059"></a>            <span style="color: #000088;">$matches</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line2060"></a>            <span style="color: #000088;">$next_match_pointer</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">null</span><span style="color: #339933;">;</span>
<a name="line2061"></a>            <span style="color: #666666; font-style: italic;">// we use a copy to unset delimiters on demand (when they are not found)</span>
<a name="line2062"></a>            <span style="color: #000088;">$delim_copy</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'SCRIPT_DELIMITERS'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
<a name="line2063"></a>            <span style="color: #000088;">$i</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span>
<a name="line2064"></a>            <span style="color: #b1b100;">while</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$i</span> <span style="color: #339933;">&lt;</span> <span style="color: #000088;">$length</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2065"></a>                <span style="color: #000088;">$next_match_pos</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$length</span> <span style="color: #339933;">+</span> <span style="color: #cc66cc;">1</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">// never true</span>
<a name="line2066"></a>                <span style="color: #b1b100;">foreach</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$delim_copy</span> <span style="color: #b1b100;">as</span> <span style="color: #000088;">$dk</span> <span style="color: #339933;">=&gt;</span> <span style="color: #000088;">$delimiters</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2067"></a>                    <span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><a href="http://www.php.net/is_array"><span style="color: #990000;">is_array</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$delimiters</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2068"></a>                        <span style="color: #b1b100;">foreach</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$delimiters</span> <span style="color: #b1b100;">as</span> <span style="color: #000088;">$open</span> <span style="color: #339933;">=&gt;</span> <span style="color: #000088;">$close</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2069"></a>                            <span style="color: #666666; font-style: italic;">// make sure the cache is setup properly</span>
<a name="line2070"></a>                            <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><a href="http://www.php.net/isset"><span style="color: #990000;">isset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$matches</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$dk</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$open</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2071"></a>                                <span style="color: #000088;">$matches</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$dk</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$open</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span>
<a name="line2072"></a>                                    <span style="color: #0000ff;">'next_match'</span> <span style="color: #339933;">=&gt;</span> <span style="color: #339933;">-</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span>
<a name="line2073"></a>                                    <span style="color: #0000ff;">'dk'</span> <span style="color: #339933;">=&gt;</span> <span style="color: #000088;">$dk</span><span style="color: #339933;">,</span>
<a name="line2074"></a>&nbsp;
<a name="line2075"></a>                                    <span style="color: #0000ff;">'open'</span> <span style="color: #339933;">=&gt;</span> <span style="color: #000088;">$open</span><span style="color: #339933;">,</span> <span style="color: #666666; font-style: italic;">// needed for grouping of adjacent code blocks (see below)</span>
<a name="line2076"></a>                                    <span style="color: #0000ff;">'open_strlen'</span> <span style="color: #339933;">=&gt;</span> <a href="http://www.php.net/strlen"><span style="color: #990000;">strlen</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$open</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span>
<a name="line2077"></a>&nbsp;
<a name="line2078"></a>                                    <span style="color: #0000ff;">'close'</span> <span style="color: #339933;">=&gt;</span> <span style="color: #000088;">$close</span><span style="color: #339933;">,</span>
<a name="line2079"></a>                                    <span style="color: #0000ff;">'close_strlen'</span> <span style="color: #339933;">=&gt;</span> <a href="http://www.php.net/strlen"><span style="color: #990000;">strlen</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$close</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span>
<a name="line2080"></a>                                <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line2081"></a>                            <span style="color: #009900;">&#125;</span>
<a name="line2082"></a>                            <span style="color: #666666; font-style: italic;">// Get the next little bit for this opening string</span>
<a name="line2083"></a>                            <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$matches</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$dk</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$open</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'next_match'</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">&lt;</span> <span style="color: #000088;">$i</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2084"></a>                                <span style="color: #666666; font-style: italic;">// only find the next pos if it was not already cached</span>
<a name="line2085"></a>                                <span style="color: #000088;">$open_pos</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/strpos"><span style="color: #990000;">strpos</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$code</span><span style="color: #339933;">,</span> <span style="color: #000088;">$open</span><span style="color: #339933;">,</span> <span style="color: #000088;">$i</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line2086"></a>                                <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$open_pos</span> <span style="color: #339933;">===</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2087"></a>                                    <span style="color: #666666; font-style: italic;">// no match for this delimiter ever</span>
<a name="line2088"></a>                                    <a href="http://www.php.net/unset"><span style="color: #990000;">unset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$delim_copy</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$dk</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$open</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line2089"></a>                                    <span style="color: #b1b100;">continue</span><span style="color: #339933;">;</span>
<a name="line2090"></a>                                <span style="color: #009900;">&#125;</span>
<a name="line2091"></a>                                <span style="color: #000088;">$matches</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$dk</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$open</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'next_match'</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$open_pos</span><span style="color: #339933;">;</span>
<a name="line2092"></a>                            <span style="color: #009900;">&#125;</span>
<a name="line2093"></a>                            <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$matches</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$dk</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$open</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'next_match'</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">&lt;</span> <span style="color: #000088;">$next_match_pos</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2094"></a>                                <span style="color: #666666; font-style: italic;">//So we got a new match, update the close_pos</span>
<a name="line2095"></a>                                <span style="color: #000088;">$matches</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$dk</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$open</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'close_pos'</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span>
<a name="line2096"></a>                                    <a href="http://www.php.net/strpos"><span style="color: #990000;">strpos</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$code</span><span style="color: #339933;">,</span> <span style="color: #000088;">$close</span><span style="color: #339933;">,</span> <span style="color: #000088;">$matches</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$dk</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$open</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'next_match'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">+</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line2097"></a>&nbsp;
<a name="line2098"></a>                                <span style="color: #000088;">$next_match_pointer</span> <span style="color: #339933;">=&amp;</span> <span style="color: #000088;">$matches</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$dk</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$open</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
<a name="line2099"></a>                                <span style="color: #000088;">$next_match_pos</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$matches</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$dk</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$open</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'next_match'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
<a name="line2100"></a>                            <span style="color: #009900;">&#125;</span>
<a name="line2101"></a>                        <span style="color: #009900;">&#125;</span>
<a name="line2102"></a>                    <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line2103"></a>                        <span style="color: #666666; font-style: italic;">//So we should match an RegExp as Strict Block ...</span>
<a name="line2104"></a>                        <span style="color: #009933; font-style: italic;">/**
<a name="line2105"></a>                         * The value in $delimiters is expected to be an RegExp
<a name="line2106"></a>                         * containing exactly 2 matching groups:
<a name="line2107"></a>                         *  - Group 1 is the opener
<a name="line2108"></a>                         *  - Group 2 is the closer
<a name="line2109"></a>                         */</span>
<a name="line2110"></a>                        <span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span>GESHI_PHP_PRE_433 <span style="color: #339933;">&amp;&amp;</span> <span style="color: #666666; font-style: italic;">//Needs proper rewrite to work with PHP &gt;=4.3.0; 4.3.3 is guaranteed to work.</span>
<a name="line2111"></a>                            <a href="http://www.php.net/preg_match"><span style="color: #990000;">preg_match</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$delimiters</span><span style="color: #339933;">,</span> <span style="color: #000088;">$code</span><span style="color: #339933;">,</span> <span style="color: #000088;">$matches_rx</span><span style="color: #339933;">,</span> PREG_OFFSET_CAPTURE<span style="color: #339933;">,</span> <span style="color: #000088;">$i</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2112"></a>                            <span style="color: #666666; font-style: italic;">//We got a match ...</span>
<a name="line2113"></a>                            <span style="color: #000088;">$matches</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$dk</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span>
<a name="line2114"></a>                                <span style="color: #0000ff;">'next_match'</span> <span style="color: #339933;">=&gt;</span> <span style="color: #000088;">$matches_rx</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span>
<a name="line2115"></a>                                <span style="color: #0000ff;">'dk'</span> <span style="color: #339933;">=&gt;</span> <span style="color: #000088;">$dk</span><span style="color: #339933;">,</span>
<a name="line2116"></a>&nbsp;
<a name="line2117"></a>                                <span style="color: #0000ff;">'close_strlen'</span> <span style="color: #339933;">=&gt;</span> <a href="http://www.php.net/strlen"><span style="color: #990000;">strlen</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$matches_rx</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">2</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span>
<a name="line2118"></a>                                <span style="color: #0000ff;">'close_pos'</span> <span style="color: #339933;">=&gt;</span> <span style="color: #000088;">$matches_rx</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">2</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span>
<a name="line2119"></a>                                <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line2120"></a>                        <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line2121"></a>                            <span style="color: #666666; font-style: italic;">// no match for this delimiter ever</span>
<a name="line2122"></a>                            <a href="http://www.php.net/unset"><span style="color: #990000;">unset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$delim_copy</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$dk</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line2123"></a>                            <span style="color: #b1b100;">continue</span><span style="color: #339933;">;</span>
<a name="line2124"></a>                        <span style="color: #009900;">&#125;</span>
<a name="line2125"></a>&nbsp;
<a name="line2126"></a>                        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$matches</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$dk</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'next_match'</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">&lt;=</span> <span style="color: #000088;">$next_match_pos</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2127"></a>                            <span style="color: #000088;">$next_match_pointer</span> <span style="color: #339933;">=&amp;</span> <span style="color: #000088;">$matches</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$dk</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
<a name="line2128"></a>                            <span style="color: #000088;">$next_match_pos</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$matches</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$dk</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'next_match'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
<a name="line2129"></a>                        <span style="color: #009900;">&#125;</span>
<a name="line2130"></a>                    <span style="color: #009900;">&#125;</span>
<a name="line2131"></a>                <span style="color: #009900;">&#125;</span>
<a name="line2132"></a>                <span style="color: #666666; font-style: italic;">// non-highlightable text</span>
<a name="line2133"></a>                <span style="color: #000088;">$parts</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$k</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span>
<a name="line2134"></a>                    <span style="color: #cc66cc;">1</span> <span style="color: #339933;">=&gt;</span> <a href="http://www.php.net/substr"><span style="color: #990000;">substr</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$code</span><span style="color: #339933;">,</span> <span style="color: #000088;">$i</span><span style="color: #339933;">,</span> <span style="color: #000088;">$next_match_pos</span> <span style="color: #339933;">-</span> <span style="color: #000088;">$i</span><span style="color: #009900;">&#41;</span>
<a name="line2135"></a>                <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line2136"></a>                <span style="color: #339933;">++</span><span style="color: #000088;">$k</span><span style="color: #339933;">;</span>
<a name="line2137"></a>&nbsp;
<a name="line2138"></a>                <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$next_match_pos</span> <span style="color: #339933;">&gt;</span> <span style="color: #000088;">$length</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2139"></a>                    <span style="color: #666666; font-style: italic;">// out of bounds means no next match was found</span>
<a name="line2140"></a>                    <span style="color: #b1b100;">break</span><span style="color: #339933;">;</span>
<a name="line2141"></a>                <span style="color: #009900;">&#125;</span>
<a name="line2142"></a>&nbsp;
<a name="line2143"></a>                <span style="color: #666666; font-style: italic;">// highlightable code</span>
<a name="line2144"></a>                <span style="color: #000088;">$parts</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$k</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$next_match_pointer</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'dk'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
<a name="line2145"></a>&nbsp;
<a name="line2146"></a>                <span style="color: #666666; font-style: italic;">//Only combine for non-rx script blocks</span>
<a name="line2147"></a>                <span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><a href="http://www.php.net/is_array"><span style="color: #990000;">is_array</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$delim_copy</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$next_match_pointer</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'dk'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2148"></a>                    <span style="color: #666666; font-style: italic;">// group adjacent script blocks, e.g. &lt;foobar&gt;&lt;asdf&gt; should be one block, not three!</span>
<a name="line2149"></a>                    <span style="color: #000088;">$i</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$next_match_pos</span> <span style="color: #339933;">+</span> <span style="color: #000088;">$next_match_pointer</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'open_strlen'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
<a name="line2150"></a>                    <span style="color: #b1b100;">while</span> <span style="color: #009900;">&#40;</span><span style="color: #009900; font-weight: bold;">true</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2151"></a>                        <span style="color: #000088;">$close_pos</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/strpos"><span style="color: #990000;">strpos</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$code</span><span style="color: #339933;">,</span> <span style="color: #000088;">$next_match_pointer</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'close'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> <span style="color: #000088;">$i</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line2152"></a>                        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$close_pos</span> <span style="color: #339933;">==</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2153"></a>                            <span style="color: #b1b100;">break</span><span style="color: #339933;">;</span>
<a name="line2154"></a>                        <span style="color: #009900;">&#125;</span>
<a name="line2155"></a>                        <span style="color: #000088;">$i</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$close_pos</span> <span style="color: #339933;">+</span> <span style="color: #000088;">$next_match_pointer</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'close_strlen'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
<a name="line2156"></a>                        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$i</span> <span style="color: #339933;">==</span> <span style="color: #000088;">$length</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2157"></a>                            <span style="color: #b1b100;">break</span><span style="color: #339933;">;</span>
<a name="line2158"></a>                        <span style="color: #009900;">&#125;</span>
<a name="line2159"></a>                        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$code</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$i</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">==</span> <span style="color: #000088;">$next_match_pointer</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'open'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">&amp;&amp;</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$next_match_pointer</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'open_strlen'</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">==</span> <span style="color: #cc66cc;">1</span> <span style="color: #339933;">||</span>
<a name="line2160"></a>                            <a href="http://www.php.net/substr"><span style="color: #990000;">substr</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$code</span><span style="color: #339933;">,</span> <span style="color: #000088;">$i</span><span style="color: #339933;">,</span> <span style="color: #000088;">$next_match_pointer</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'open_strlen'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">==</span> <span style="color: #000088;">$next_match_pointer</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'open'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2161"></a>                            <span style="color: #666666; font-style: italic;">// merge adjacent but make sure we don't merge things like &lt;tag&gt;&lt;!-- comment --&gt;</span>
<a name="line2162"></a>                            <span style="color: #b1b100;">foreach</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$matches</span> <span style="color: #b1b100;">as</span> <span style="color: #000088;">$submatches</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2163"></a>                                <span style="color: #b1b100;">foreach</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$submatches</span> <span style="color: #b1b100;">as</span> <span style="color: #000088;">$match</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2164"></a>                                    <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$match</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'next_match'</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">==</span> <span style="color: #000088;">$i</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2165"></a>                                        <span style="color: #666666; font-style: italic;">// a different block already matches here!</span>
<a name="line2166"></a>                                        <span style="color: #b1b100;">break</span> <span style="color: #cc66cc;">3</span><span style="color: #339933;">;</span>
<a name="line2167"></a>                                    <span style="color: #009900;">&#125;</span>
<a name="line2168"></a>                                <span style="color: #009900;">&#125;</span>
<a name="line2169"></a>                            <span style="color: #009900;">&#125;</span>
<a name="line2170"></a>                        <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line2171"></a>                            <span style="color: #b1b100;">break</span><span style="color: #339933;">;</span>
<a name="line2172"></a>                        <span style="color: #009900;">&#125;</span>
<a name="line2173"></a>                    <span style="color: #009900;">&#125;</span>
<a name="line2174"></a>                <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line2175"></a>                    <span style="color: #000088;">$close_pos</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$next_match_pointer</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'close_pos'</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">+</span> <span style="color: #000088;">$next_match_pointer</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'close_strlen'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
<a name="line2176"></a>                    <span style="color: #000088;">$i</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$close_pos</span><span style="color: #339933;">;</span>
<a name="line2177"></a>                <span style="color: #009900;">&#125;</span>
<a name="line2178"></a>&nbsp;
<a name="line2179"></a>                <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$close_pos</span> <span style="color: #339933;">===</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2180"></a>                    <span style="color: #666666; font-style: italic;">// no closing delimiter found!</span>
<a name="line2181"></a>                    <span style="color: #000088;">$parts</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$k</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/substr"><span style="color: #990000;">substr</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$code</span><span style="color: #339933;">,</span> <span style="color: #000088;">$next_match_pos</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line2182"></a>                    <span style="color: #339933;">++</span><span style="color: #000088;">$k</span><span style="color: #339933;">;</span>
<a name="line2183"></a>                    <span style="color: #b1b100;">break</span><span style="color: #339933;">;</span>
<a name="line2184"></a>                <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line2185"></a>                    <span style="color: #000088;">$parts</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$k</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/substr"><span style="color: #990000;">substr</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$code</span><span style="color: #339933;">,</span> <span style="color: #000088;">$next_match_pos</span><span style="color: #339933;">,</span> <span style="color: #000088;">$i</span> <span style="color: #339933;">-</span> <span style="color: #000088;">$next_match_pos</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line2186"></a>                    <span style="color: #339933;">++</span><span style="color: #000088;">$k</span><span style="color: #339933;">;</span>
<a name="line2187"></a>                <span style="color: #009900;">&#125;</span>
<a name="line2188"></a>            <span style="color: #009900;">&#125;</span>
<a name="line2189"></a>            <a href="http://www.php.net/unset"><span style="color: #990000;">unset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$delim_copy</span><span style="color: #339933;">,</span> <span style="color: #000088;">$next_match_pointer</span><span style="color: #339933;">,</span> <span style="color: #000088;">$next_match_pos</span><span style="color: #339933;">,</span> <span style="color: #000088;">$matches</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line2190"></a>            <span style="color: #000088;">$num_parts</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$k</span><span style="color: #339933;">;</span>
<a name="line2191"></a>&nbsp;
<a name="line2192"></a>            <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$num_parts</span> <span style="color: #339933;">==</span> <span style="color: #cc66cc;">1</span> <span style="color: #339933;">&amp;&amp;</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">strict_mode</span> <span style="color: #339933;">==</span> GESHI_MAYBE<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2193"></a>                <span style="color: #666666; font-style: italic;">// when we have only one part, we don't have anything to highlight at all.</span>
<a name="line2194"></a>                <span style="color: #666666; font-style: italic;">// if we have a &quot;maybe&quot; strict language, this should be handled as highlightable code</span>
<a name="line2195"></a>                <span style="color: #000088;">$parts</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span>
<a name="line2196"></a>                    <span style="color: #cc66cc;">0</span> <span style="color: #339933;">=&gt;</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span>
<a name="line2197"></a>                        <span style="color: #cc66cc;">0</span> <span style="color: #339933;">=&gt;</span> <span style="color: #0000ff;">''</span><span style="color: #339933;">,</span>
<a name="line2198"></a>                        <span style="color: #cc66cc;">1</span> <span style="color: #339933;">=&gt;</span> <span style="color: #0000ff;">''</span>
<a name="line2199"></a>                    <span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span>
<a name="line2200"></a>                    <span style="color: #cc66cc;">1</span> <span style="color: #339933;">=&gt;</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span>
<a name="line2201"></a>                        <span style="color: #cc66cc;">0</span> <span style="color: #339933;">=&gt;</span> <span style="color: #009900; font-weight: bold;">null</span><span style="color: #339933;">,</span>
<a name="line2202"></a>                        <span style="color: #cc66cc;">1</span> <span style="color: #339933;">=&gt;</span> <span style="color: #000088;">$parts</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span>
<a name="line2203"></a>                    <span style="color: #009900;">&#41;</span>
<a name="line2204"></a>                <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line2205"></a>                <span style="color: #000088;">$num_parts</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">2</span><span style="color: #339933;">;</span>
<a name="line2206"></a>            <span style="color: #009900;">&#125;</span>
<a name="line2207"></a>&nbsp;
<a name="line2208"></a>        <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line2209"></a>            <span style="color: #666666; font-style: italic;">// Not strict mode - simply dump the source into</span>
<a name="line2210"></a>            <span style="color: #666666; font-style: italic;">// the array at index 1 (the first highlightable block)</span>
<a name="line2211"></a>            <span style="color: #000088;">$parts</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span>
<a name="line2212"></a>                <span style="color: #cc66cc;">0</span> <span style="color: #339933;">=&gt;</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span>
<a name="line2213"></a>                    <span style="color: #cc66cc;">0</span> <span style="color: #339933;">=&gt;</span> <span style="color: #0000ff;">''</span><span style="color: #339933;">,</span>
<a name="line2214"></a>                    <span style="color: #cc66cc;">1</span> <span style="color: #339933;">=&gt;</span> <span style="color: #0000ff;">''</span>
<a name="line2215"></a>                <span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span>
<a name="line2216"></a>                <span style="color: #cc66cc;">1</span> <span style="color: #339933;">=&gt;</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span>
<a name="line2217"></a>                    <span style="color: #cc66cc;">0</span> <span style="color: #339933;">=&gt;</span> <span style="color: #009900; font-weight: bold;">null</span><span style="color: #339933;">,</span>
<a name="line2218"></a>                    <span style="color: #cc66cc;">1</span> <span style="color: #339933;">=&gt;</span> <span style="color: #000088;">$code</span>
<a name="line2219"></a>                <span style="color: #009900;">&#41;</span>
<a name="line2220"></a>            <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line2221"></a>            <span style="color: #000088;">$num_parts</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">2</span><span style="color: #339933;">;</span>
<a name="line2222"></a>        <span style="color: #009900;">&#125;</span>
<a name="line2223"></a>&nbsp;
<a name="line2224"></a>        <span style="color: #666666; font-style: italic;">//Unset variables we won't need any longer</span>
<a name="line2225"></a>        <a href="http://www.php.net/unset"><span style="color: #990000;">unset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$code</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line2226"></a>&nbsp;
<a name="line2227"></a>        <span style="color: #666666; font-style: italic;">//Preload some repeatedly used values regarding hardquotes ...</span>
<a name="line2228"></a>        <span style="color: #000088;">$hq</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/isset"><span style="color: #990000;">isset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'HARDQUOTE'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span> ? <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'HARDQUOTE'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">:</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #339933;">;</span>
<a name="line2229"></a>        <span style="color: #000088;">$hq_strlen</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/strlen"><span style="color: #990000;">strlen</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$hq</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line2230"></a>&nbsp;
<a name="line2231"></a>        <span style="color: #666666; font-style: italic;">//Preload if line numbers are to be generated afterwards</span>
<a name="line2232"></a>        <span style="color: #666666; font-style: italic;">//Added a check if line breaks should be forced even without line numbers, fixes SF#1727398</span>
<a name="line2233"></a>        <span style="color: #000088;">$check_linenumbers</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">line_numbers</span> <span style="color: #339933;">!=</span> GESHI_NO_LINE_NUMBERS <span style="color: #339933;">||</span>
<a name="line2234"></a>            <span style="color: #339933;">!</span><a href="http://www.php.net/empty"><span style="color: #990000;">empty</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">highlight_extra_lines</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">||</span> <span style="color: #339933;">!</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">allow_multiline_span</span><span style="color: #339933;">;</span>
<a name="line2235"></a>&nbsp;
<a name="line2236"></a>        <span style="color: #666666; font-style: italic;">//preload the escape char for faster checking ...</span>
<a name="line2237"></a>        <span style="color: #000088;">$escaped_escape_char</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">hsc</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'ESCAPE_CHAR'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line2238"></a>&nbsp;
<a name="line2239"></a>        <span style="color: #666666; font-style: italic;">// this is used for single-line comments</span>
<a name="line2240"></a>        <span style="color: #000088;">$sc_disallowed_before</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;&quot;</span><span style="color: #339933;">;</span>
<a name="line2241"></a>        <span style="color: #000088;">$sc_disallowed_after</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;&quot;</span><span style="color: #339933;">;</span>
<a name="line2242"></a>&nbsp;
<a name="line2243"></a>        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><a href="http://www.php.net/isset"><span style="color: #990000;">isset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'PARSER_CONTROL'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2244"></a>            <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><a href="http://www.php.net/isset"><span style="color: #990000;">isset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'PARSER_CONTROL'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'COMMENTS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2245"></a>                <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><a href="http://www.php.net/isset"><span style="color: #990000;">isset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'PARSER_CONTROL'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'COMMENTS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'DISALLOWED_BEFORE'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2246"></a>                    <span style="color: #000088;">$sc_disallowed_before</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'PARSER_CONTROL'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'COMMENTS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'DISALLOWED_BEFORE'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
<a name="line2247"></a>                <span style="color: #009900;">&#125;</span>
<a name="line2248"></a>                <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><a href="http://www.php.net/isset"><span style="color: #990000;">isset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'PARSER_CONTROL'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'COMMENTS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'DISALLOWED_AFTER'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2249"></a>                    <span style="color: #000088;">$sc_disallowed_after</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'PARSER_CONTROL'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'COMMENTS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'DISALLOWED_AFTER'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
<a name="line2250"></a>                <span style="color: #009900;">&#125;</span>
<a name="line2251"></a>            <span style="color: #009900;">&#125;</span>
<a name="line2252"></a>        <span style="color: #009900;">&#125;</span>
<a name="line2253"></a>&nbsp;
<a name="line2254"></a>        <span style="color: #666666; font-style: italic;">//Fix for SF#1932083: Multichar Quotemarks unsupported</span>
<a name="line2255"></a>        <span style="color: #000088;">$is_string_starter</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line2256"></a>        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">lexic_permissions</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'STRINGS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2257"></a>            <span style="color: #b1b100;">foreach</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'QUOTEMARKS'</span><span style="color: #009900;">&#93;</span> <span style="color: #b1b100;">as</span> <span style="color: #000088;">$quotemark</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2258"></a>                <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><a href="http://www.php.net/isset"><span style="color: #990000;">isset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$is_string_starter</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$quotemark</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2259"></a>                    <span style="color: #000088;">$is_string_starter</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$quotemark</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #009900;">&#40;</span>string<span style="color: #009900;">&#41;</span><span style="color: #000088;">$quotemark</span><span style="color: #339933;">;</span>
<a name="line2260"></a>                <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><a href="http://www.php.net/is_string"><span style="color: #990000;">is_string</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$is_string_starter</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$quotemark</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2261"></a>                    <span style="color: #000088;">$is_string_starter</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$quotemark</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span>
<a name="line2262"></a>                        <span style="color: #000088;">$is_string_starter</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$quotemark</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span>
<a name="line2263"></a>                        <span style="color: #000088;">$quotemark</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line2264"></a>                <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line2265"></a>                    <span style="color: #000088;">$is_string_starter</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$quotemark</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$quotemark</span><span style="color: #339933;">;</span>
<a name="line2266"></a>                <span style="color: #009900;">&#125;</span>
<a name="line2267"></a>            <span style="color: #009900;">&#125;</span>
<a name="line2268"></a>        <span style="color: #009900;">&#125;</span>
<a name="line2269"></a>&nbsp;
<a name="line2270"></a>        <span style="color: #666666; font-style: italic;">// Now we go through each part. We know that even-indexed parts are</span>
<a name="line2271"></a>        <span style="color: #666666; font-style: italic;">// code that shouldn't be highlighted, and odd-indexed parts should</span>
<a name="line2272"></a>        <span style="color: #666666; font-style: italic;">// be highlighted</span>
<a name="line2273"></a>        <span style="color: #b1b100;">for</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$key</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span> <span style="color: #000088;">$key</span> <span style="color: #339933;">&lt;</span> <span style="color: #000088;">$num_parts</span><span style="color: #339933;">;</span> <span style="color: #339933;">++</span><span style="color: #000088;">$key</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2274"></a>            <span style="color: #000088;">$STRICTATTRS</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">''</span><span style="color: #339933;">;</span>
<a name="line2275"></a>&nbsp;
<a name="line2276"></a>            <span style="color: #666666; font-style: italic;">// If this block should be highlighted...</span>
<a name="line2277"></a>            <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$key</span> <span style="color: #339933;">&amp;</span> <span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2278"></a>                <span style="color: #666666; font-style: italic;">// Else not a block to highlight</span>
<a name="line2279"></a>                <span style="color: #000088;">$endresult</span> <span style="color: #339933;">.=</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">hsc</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$parts</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$key</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line2280"></a>                <a href="http://www.php.net/unset"><span style="color: #990000;">unset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$parts</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$key</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line2281"></a>                <span style="color: #b1b100;">continue</span><span style="color: #339933;">;</span>
<a name="line2282"></a>            <span style="color: #009900;">&#125;</span>
<a name="line2283"></a>&nbsp;
<a name="line2284"></a>            <span style="color: #000088;">$result</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">''</span><span style="color: #339933;">;</span>
<a name="line2285"></a>            <span style="color: #000088;">$part</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$parts</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$key</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
<a name="line2286"></a>&nbsp;
<a name="line2287"></a>            <span style="color: #000088;">$highlight_part</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">true</span><span style="color: #339933;">;</span>
<a name="line2288"></a>            <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">strict_mode</span> <span style="color: #339933;">&amp;&amp;</span> <span style="color: #339933;">!</span><a href="http://www.php.net/is_null"><span style="color: #990000;">is_null</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$parts</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$key</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2289"></a>                <span style="color: #666666; font-style: italic;">// get the class key for this block of code</span>
<a name="line2290"></a>                <span style="color: #000088;">$script_key</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$parts</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$key</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
<a name="line2291"></a>                <span style="color: #000088;">$highlight_part</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'HIGHLIGHT_STRICT_BLOCK'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$script_key</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
<a name="line2292"></a>                <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'STYLES'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'SCRIPT'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$script_key</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">!=</span> <span style="color: #0000ff;">''</span> <span style="color: #339933;">&amp;&amp;</span>
<a name="line2293"></a>                    <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">lexic_permissions</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'SCRIPT'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2294"></a>                    <span style="color: #666666; font-style: italic;">// Add a span element around the source to</span>
<a name="line2295"></a>                    <span style="color: #666666; font-style: italic;">// highlight the overall source block</span>
<a name="line2296"></a>                    <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">use_classes</span> <span style="color: #339933;">&amp;&amp;</span>
<a name="line2297"></a>                        <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'STYLES'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'SCRIPT'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$script_key</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">!=</span> <span style="color: #0000ff;">''</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2298"></a>                        <span style="color: #000088;">$attributes</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">' style=&quot;'</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'STYLES'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'SCRIPT'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$script_key</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">'&quot;'</span><span style="color: #339933;">;</span>
<a name="line2299"></a>                    <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line2300"></a>                        <span style="color: #000088;">$attributes</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">' class=&quot;sc'</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$script_key</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">'&quot;'</span><span style="color: #339933;">;</span>
<a name="line2301"></a>                    <span style="color: #009900;">&#125;</span>
<a name="line2302"></a>                    <span style="color: #000088;">$result</span> <span style="color: #339933;">.=</span> <span style="color: #0000ff;">&quot;&lt;span<span style="color: #006699; font-weight: bold;">$attributes</span>&gt;&quot;</span><span style="color: #339933;">;</span>
<a name="line2303"></a>                    <span style="color: #000088;">$STRICTATTRS</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$attributes</span><span style="color: #339933;">;</span>
<a name="line2304"></a>                <span style="color: #009900;">&#125;</span>
<a name="line2305"></a>            <span style="color: #009900;">&#125;</span>
<a name="line2306"></a>&nbsp;
<a name="line2307"></a>            <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$highlight_part</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2308"></a>                <span style="color: #666666; font-style: italic;">// Now, highlight the code in this block. This code</span>
<a name="line2309"></a>                <span style="color: #666666; font-style: italic;">// is really the engine of GeSHi (along with the method</span>
<a name="line2310"></a>                <span style="color: #666666; font-style: italic;">// parse_non_string_part).</span>
<a name="line2311"></a>&nbsp;
<a name="line2312"></a>                <span style="color: #666666; font-style: italic;">// cache comment regexps incrementally</span>
<a name="line2313"></a>                <span style="color: #000088;">$next_comment_regexp_key</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">''</span><span style="color: #339933;">;</span>
<a name="line2314"></a>                <span style="color: #000088;">$next_comment_regexp_pos</span> <span style="color: #339933;">=</span> <span style="color: #339933;">-</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">;</span>
<a name="line2315"></a>                <span style="color: #000088;">$next_comment_multi_pos</span> <span style="color: #339933;">=</span> <span style="color: #339933;">-</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">;</span>
<a name="line2316"></a>                <span style="color: #000088;">$next_comment_single_pos</span> <span style="color: #339933;">=</span> <span style="color: #339933;">-</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">;</span>
<a name="line2317"></a>                <span style="color: #000088;">$comment_regexp_cache_per_key</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line2318"></a>                <span style="color: #000088;">$comment_multi_cache_per_key</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line2319"></a>                <span style="color: #000088;">$comment_single_cache_per_key</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line2320"></a>                <span style="color: #000088;">$next_open_comment_multi</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">''</span><span style="color: #339933;">;</span>
<a name="line2321"></a>                <span style="color: #000088;">$next_comment_single_key</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">''</span><span style="color: #339933;">;</span>
<a name="line2322"></a>                <span style="color: #000088;">$escape_regexp_cache_per_key</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line2323"></a>                <span style="color: #000088;">$next_escape_regexp_key</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">''</span><span style="color: #339933;">;</span>
<a name="line2324"></a>                <span style="color: #000088;">$next_escape_regexp_pos</span> <span style="color: #339933;">=</span> <span style="color: #339933;">-</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">;</span>
<a name="line2325"></a>&nbsp;
<a name="line2326"></a>                <span style="color: #000088;">$length</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/strlen"><span style="color: #990000;">strlen</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$part</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line2327"></a>                <span style="color: #b1b100;">for</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$i</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span> <span style="color: #000088;">$i</span> <span style="color: #339933;">&lt;</span> <span style="color: #000088;">$length</span><span style="color: #339933;">;</span> <span style="color: #339933;">++</span><span style="color: #000088;">$i</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2328"></a>                    <span style="color: #666666; font-style: italic;">// Get the next char</span>
<a name="line2329"></a>                    <span style="color: #000088;">$char</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$part</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$i</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
<a name="line2330"></a>                    <span style="color: #000088;">$char_len</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">1</span><span style="color: #339933;">;</span>
<a name="line2331"></a>&nbsp;
<a name="line2332"></a>                    <span style="color: #666666; font-style: italic;">// update regexp comment cache if needed</span>
<a name="line2333"></a>                    <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><a href="http://www.php.net/isset"><span style="color: #990000;">isset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'COMMENT_REGEXP'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">&amp;&amp;</span> <span style="color: #000088;">$next_comment_regexp_pos</span> <span style="color: #339933;">&lt;</span> <span style="color: #000088;">$i</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2334"></a>                        <span style="color: #000088;">$next_comment_regexp_pos</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$length</span><span style="color: #339933;">;</span>
<a name="line2335"></a>                        <span style="color: #b1b100;">foreach</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'COMMENT_REGEXP'</span><span style="color: #009900;">&#93;</span> <span style="color: #b1b100;">as</span> <span style="color: #000088;">$comment_key</span> <span style="color: #339933;">=&gt;</span> <span style="color: #000088;">$regexp</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2336"></a>                            <span style="color: #000088;">$match_i</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #339933;">;</span>
<a name="line2337"></a>                            <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><a href="http://www.php.net/isset"><span style="color: #990000;">isset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$comment_regexp_cache_per_key</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$comment_key</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">&amp;&amp;</span>
<a name="line2338"></a>                                <span style="color: #009900;">&#40;</span><span style="color: #000088;">$comment_regexp_cache_per_key</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$comment_key</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'pos'</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">&gt;=</span> <span style="color: #000088;">$i</span> <span style="color: #339933;">||</span>
<a name="line2339"></a>                                 <span style="color: #000088;">$comment_regexp_cache_per_key</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$comment_key</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'pos'</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">===</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2340"></a>                                <span style="color: #666666; font-style: italic;">// we have already matched something</span>
<a name="line2341"></a>                                <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$comment_regexp_cache_per_key</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$comment_key</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'pos'</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">===</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2342"></a>                                    <span style="color: #666666; font-style: italic;">// this comment is never matched</span>
<a name="line2343"></a>                                    <span style="color: #b1b100;">continue</span><span style="color: #339933;">;</span>
<a name="line2344"></a>                                <span style="color: #009900;">&#125;</span>
<a name="line2345"></a>                                <span style="color: #000088;">$match_i</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$comment_regexp_cache_per_key</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$comment_key</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'pos'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
<a name="line2346"></a>                            <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span>
<a name="line2347"></a>                                <span style="color: #666666; font-style: italic;">//This is to allow use of the offset parameter in preg_match and stay as compatible with older PHP versions as possible</span>
<a name="line2348"></a>                                <span style="color: #009900;">&#40;</span>GESHI_PHP_PRE_433 <span style="color: #339933;">&amp;&amp;</span> <a href="http://www.php.net/preg_match"><span style="color: #990000;">preg_match</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$regexp</span><span style="color: #339933;">,</span> <a href="http://www.php.net/substr"><span style="color: #990000;">substr</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$part</span><span style="color: #339933;">,</span> <span style="color: #000088;">$i</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <span style="color: #000088;">$match</span><span style="color: #339933;">,</span> PREG_OFFSET_CAPTURE<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">||</span>
<a name="line2349"></a>                                <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span>GESHI_PHP_PRE_433 <span style="color: #339933;">&amp;&amp;</span> <a href="http://www.php.net/preg_match"><span style="color: #990000;">preg_match</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$regexp</span><span style="color: #339933;">,</span> <span style="color: #000088;">$part</span><span style="color: #339933;">,</span> <span style="color: #000088;">$match</span><span style="color: #339933;">,</span> PREG_OFFSET_CAPTURE<span style="color: #339933;">,</span> <span style="color: #000088;">$i</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
<a name="line2350"></a>                                <span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2351"></a>                                <span style="color: #000088;">$match_i</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$match</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
<a name="line2352"></a>                                <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span>GESHI_PHP_PRE_433<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2353"></a>                                    <span style="color: #000088;">$match_i</span> <span style="color: #339933;">+=</span> <span style="color: #000088;">$i</span><span style="color: #339933;">;</span>
<a name="line2354"></a>                                <span style="color: #009900;">&#125;</span>
<a name="line2355"></a>&nbsp;
<a name="line2356"></a>                                <span style="color: #000088;">$comment_regexp_cache_per_key</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$comment_key</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span>
<a name="line2357"></a>                                    <span style="color: #0000ff;">'key'</span> <span style="color: #339933;">=&gt;</span> <span style="color: #000088;">$comment_key</span><span style="color: #339933;">,</span>
<a name="line2358"></a>                                    <span style="color: #0000ff;">'length'</span> <span style="color: #339933;">=&gt;</span> <a href="http://www.php.net/strlen"><span style="color: #990000;">strlen</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$match</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span>
<a name="line2359"></a>                                    <span style="color: #0000ff;">'pos'</span> <span style="color: #339933;">=&gt;</span> <span style="color: #000088;">$match_i</span>
<a name="line2360"></a>                                <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line2361"></a>                            <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line2362"></a>                                <span style="color: #000088;">$comment_regexp_cache_per_key</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$comment_key</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'pos'</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #339933;">;</span>
<a name="line2363"></a>                                <span style="color: #b1b100;">continue</span><span style="color: #339933;">;</span>
<a name="line2364"></a>                            <span style="color: #009900;">&#125;</span>
<a name="line2365"></a>&nbsp;
<a name="line2366"></a>                            <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$match_i</span> <span style="color: #339933;">!==</span> <span style="color: #009900; font-weight: bold;">false</span> <span style="color: #339933;">&amp;&amp;</span> <span style="color: #000088;">$match_i</span> <span style="color: #339933;">&lt;</span> <span style="color: #000088;">$next_comment_regexp_pos</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2367"></a>                                <span style="color: #000088;">$next_comment_regexp_pos</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$match_i</span><span style="color: #339933;">;</span>
<a name="line2368"></a>                                <span style="color: #000088;">$next_comment_regexp_key</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$comment_key</span><span style="color: #339933;">;</span>
<a name="line2369"></a>                                <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$match_i</span> <span style="color: #339933;">===</span> <span style="color: #000088;">$i</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2370"></a>                                    <span style="color: #b1b100;">break</span><span style="color: #339933;">;</span>
<a name="line2371"></a>                                <span style="color: #009900;">&#125;</span>
<a name="line2372"></a>                            <span style="color: #009900;">&#125;</span>
<a name="line2373"></a>                        <span style="color: #009900;">&#125;</span>
<a name="line2374"></a>                    <span style="color: #009900;">&#125;</span>
<a name="line2375"></a>&nbsp;
<a name="line2376"></a>                    <span style="color: #000088;">$string_started</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #339933;">;</span>
<a name="line2377"></a>&nbsp;
<a name="line2378"></a>                    <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><a href="http://www.php.net/isset"><span style="color: #990000;">isset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$is_string_starter</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$char</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2379"></a>                        <span style="color: #666666; font-style: italic;">// Possibly the start of a new string ...</span>
<a name="line2380"></a>&nbsp;
<a name="line2381"></a>                        <span style="color: #666666; font-style: italic;">//Check which starter it was ...</span>
<a name="line2382"></a>                        <span style="color: #666666; font-style: italic;">//Fix for SF#1932083: Multichar Quotemarks unsupported</span>
<a name="line2383"></a>                        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><a href="http://www.php.net/is_array"><span style="color: #990000;">is_array</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$is_string_starter</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$char</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2384"></a>                            <span style="color: #000088;">$char_new</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">''</span><span style="color: #339933;">;</span>
<a name="line2385"></a>                            <span style="color: #b1b100;">foreach</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$is_string_starter</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$char</span><span style="color: #009900;">&#93;</span> <span style="color: #b1b100;">as</span> <span style="color: #000088;">$testchar</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2386"></a>                                <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$testchar</span> <span style="color: #339933;">===</span> <a href="http://www.php.net/substr"><span style="color: #990000;">substr</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$part</span><span style="color: #339933;">,</span> <span style="color: #000088;">$i</span><span style="color: #339933;">,</span> <a href="http://www.php.net/strlen"><span style="color: #990000;">strlen</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$testchar</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">&amp;&amp;</span>
<a name="line2387"></a>                                    <a href="http://www.php.net/strlen"><span style="color: #990000;">strlen</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$testchar</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">&gt;</span> <a href="http://www.php.net/strlen"><span style="color: #990000;">strlen</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$char_new</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2388"></a>                                    <span style="color: #000088;">$char_new</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$testchar</span><span style="color: #339933;">;</span>
<a name="line2389"></a>                                    <span style="color: #000088;">$string_started</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">true</span><span style="color: #339933;">;</span>
<a name="line2390"></a>                                <span style="color: #009900;">&#125;</span>
<a name="line2391"></a>                            <span style="color: #009900;">&#125;</span>
<a name="line2392"></a>                            <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$string_started</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2393"></a>                                <span style="color: #000088;">$char</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$char_new</span><span style="color: #339933;">;</span>
<a name="line2394"></a>                            <span style="color: #009900;">&#125;</span>
<a name="line2395"></a>                        <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line2396"></a>                            <span style="color: #000088;">$testchar</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$is_string_starter</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$char</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
<a name="line2397"></a>                            <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$testchar</span> <span style="color: #339933;">===</span> <a href="http://www.php.net/substr"><span style="color: #990000;">substr</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$part</span><span style="color: #339933;">,</span> <span style="color: #000088;">$i</span><span style="color: #339933;">,</span> <a href="http://www.php.net/strlen"><span style="color: #990000;">strlen</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$testchar</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2398"></a>                                <span style="color: #000088;">$char</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$testchar</span><span style="color: #339933;">;</span>
<a name="line2399"></a>                                <span style="color: #000088;">$string_started</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">true</span><span style="color: #339933;">;</span>
<a name="line2400"></a>                            <span style="color: #009900;">&#125;</span>
<a name="line2401"></a>                        <span style="color: #009900;">&#125;</span>
<a name="line2402"></a>                        <span style="color: #000088;">$char_len</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/strlen"><span style="color: #990000;">strlen</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$char</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line2403"></a>                    <span style="color: #009900;">&#125;</span>
<a name="line2404"></a>&nbsp;
<a name="line2405"></a>                    <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$string_started</span> <span style="color: #339933;">&amp;&amp;</span> <span style="color: #000088;">$i</span> <span style="color: #339933;">!=</span> <span style="color: #000088;">$next_comment_regexp_pos</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2406"></a>                        <span style="color: #666666; font-style: italic;">// Hand out the correct style information for this string</span>
<a name="line2407"></a>                        <span style="color: #000088;">$string_key</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/array_search"><span style="color: #990000;">array_search</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$char</span><span style="color: #339933;">,</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'QUOTEMARKS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line2408"></a>                        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><a href="http://www.php.net/isset"><span style="color: #990000;">isset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'STYLES'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'STRINGS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$string_key</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">||</span>
<a name="line2409"></a>                            <span style="color: #339933;">!</span><a href="http://www.php.net/isset"><span style="color: #990000;">isset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'STYLES'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'ESCAPE_CHAR'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$string_key</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2410"></a>                            <span style="color: #000088;">$string_key</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span>
<a name="line2411"></a>                        <span style="color: #009900;">&#125;</span>
<a name="line2412"></a>&nbsp;
<a name="line2413"></a>                        <span style="color: #666666; font-style: italic;">// parse the stuff before this</span>
<a name="line2414"></a>                        <span style="color: #000088;">$result</span> <span style="color: #339933;">.=</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">parse_non_string_part</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$stuff_to_parse</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line2415"></a>                        <span style="color: #000088;">$stuff_to_parse</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">''</span><span style="color: #339933;">;</span>
<a name="line2416"></a>&nbsp;
<a name="line2417"></a>                        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">use_classes</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2418"></a>                            <span style="color: #000088;">$string_attributes</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">' style=&quot;'</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'STYLES'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'STRINGS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$string_key</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">'&quot;'</span><span style="color: #339933;">;</span>
<a name="line2419"></a>                        <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line2420"></a>                            <span style="color: #000088;">$string_attributes</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">' class=&quot;st'</span><span style="color: #339933;">.</span><span style="color: #000088;">$string_key</span><span style="color: #339933;">.</span><span style="color: #0000ff;">'&quot;'</span><span style="color: #339933;">;</span>
<a name="line2421"></a>                        <span style="color: #009900;">&#125;</span>
<a name="line2422"></a>&nbsp;
<a name="line2423"></a>                        <span style="color: #666666; font-style: italic;">// now handle the string</span>
<a name="line2424"></a>                        <span style="color: #000088;">$string</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;&lt;span<span style="color: #006699; font-weight: bold;">$string_attributes</span>&gt;&quot;</span> <span style="color: #339933;">.</span> GeSHi<span style="color: #339933;">::</span><span style="color: #004000;">hsc</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$char</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line2425"></a>                        <span style="color: #000088;">$start</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$i</span> <span style="color: #339933;">+</span> <span style="color: #000088;">$char_len</span><span style="color: #339933;">;</span>
<a name="line2426"></a>                        <span style="color: #000088;">$string_open</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">true</span><span style="color: #339933;">;</span>
<a name="line2427"></a>&nbsp;
<a name="line2428"></a>                        <span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><a href="http://www.php.net/empty"><span style="color: #990000;">empty</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'ESCAPE_REGEXP'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2429"></a>                            <span style="color: #000088;">$next_escape_regexp_pos</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$length</span><span style="color: #339933;">;</span>
<a name="line2430"></a>                        <span style="color: #009900;">&#125;</span>
<a name="line2431"></a>&nbsp;
<a name="line2432"></a>                        <span style="color: #b1b100;">do</span> <span style="color: #009900;">&#123;</span>
<a name="line2433"></a>                            <span style="color: #666666; font-style: italic;">//Get the regular ending pos ...</span>
<a name="line2434"></a>                            <span style="color: #000088;">$close_pos</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/strpos"><span style="color: #990000;">strpos</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$part</span><span style="color: #339933;">,</span> <span style="color: #000088;">$char</span><span style="color: #339933;">,</span> <span style="color: #000088;">$start</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line2435"></a>                            <span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #009900; font-weight: bold;">false</span> <span style="color: #339933;">===</span> <span style="color: #000088;">$close_pos</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2436"></a>                                <span style="color: #000088;">$close_pos</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$length</span><span style="color: #339933;">;</span>
<a name="line2437"></a>                            <span style="color: #009900;">&#125;</span>
<a name="line2438"></a>&nbsp;
<a name="line2439"></a>                            <span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">lexic_permissions</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'ESCAPE_CHAR'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2440"></a>                                <span style="color: #666666; font-style: italic;">// update escape regexp cache if needed</span>
<a name="line2441"></a>                                <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><a href="http://www.php.net/isset"><span style="color: #990000;">isset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'ESCAPE_REGEXP'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">&amp;&amp;</span> <span style="color: #000088;">$next_escape_regexp_pos</span> <span style="color: #339933;">&lt;</span> <span style="color: #000088;">$start</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2442"></a>                                    <span style="color: #000088;">$next_escape_regexp_pos</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$length</span><span style="color: #339933;">;</span>
<a name="line2443"></a>                                    <span style="color: #b1b100;">foreach</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'ESCAPE_REGEXP'</span><span style="color: #009900;">&#93;</span> <span style="color: #b1b100;">as</span> <span style="color: #000088;">$escape_key</span> <span style="color: #339933;">=&gt;</span> <span style="color: #000088;">$regexp</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2444"></a>                                        <span style="color: #000088;">$match_i</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #339933;">;</span>
<a name="line2445"></a>                                        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><a href="http://www.php.net/isset"><span style="color: #990000;">isset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$escape_regexp_cache_per_key</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$escape_key</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">&amp;&amp;</span>
<a name="line2446"></a>                                            <span style="color: #009900;">&#40;</span><span style="color: #000088;">$escape_regexp_cache_per_key</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$escape_key</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'pos'</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">&gt;=</span> <span style="color: #000088;">$start</span> <span style="color: #339933;">||</span>
<a name="line2447"></a>                                             <span style="color: #000088;">$escape_regexp_cache_per_key</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$escape_key</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'pos'</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">===</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2448"></a>                                            <span style="color: #666666; font-style: italic;">// we have already matched something</span>
<a name="line2449"></a>                                            <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$escape_regexp_cache_per_key</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$escape_key</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'pos'</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">===</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2450"></a>                                                <span style="color: #666666; font-style: italic;">// this comment is never matched</span>
<a name="line2451"></a>                                                <span style="color: #b1b100;">continue</span><span style="color: #339933;">;</span>
<a name="line2452"></a>                                            <span style="color: #009900;">&#125;</span>
<a name="line2453"></a>                                            <span style="color: #000088;">$match_i</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$escape_regexp_cache_per_key</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$escape_key</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'pos'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
<a name="line2454"></a>                                        <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span>
<a name="line2455"></a>                                            <span style="color: #666666; font-style: italic;">//This is to allow use of the offset parameter in preg_match and stay as compatible with older PHP versions as possible</span>
<a name="line2456"></a>                                            <span style="color: #009900;">&#40;</span>GESHI_PHP_PRE_433 <span style="color: #339933;">&amp;&amp;</span> <a href="http://www.php.net/preg_match"><span style="color: #990000;">preg_match</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$regexp</span><span style="color: #339933;">,</span> <a href="http://www.php.net/substr"><span style="color: #990000;">substr</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$part</span><span style="color: #339933;">,</span> <span style="color: #000088;">$start</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <span style="color: #000088;">$match</span><span style="color: #339933;">,</span> PREG_OFFSET_CAPTURE<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">||</span>
<a name="line2457"></a>                                            <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span>GESHI_PHP_PRE_433 <span style="color: #339933;">&amp;&amp;</span> <a href="http://www.php.net/preg_match"><span style="color: #990000;">preg_match</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$regexp</span><span style="color: #339933;">,</span> <span style="color: #000088;">$part</span><span style="color: #339933;">,</span> <span style="color: #000088;">$match</span><span style="color: #339933;">,</span> PREG_OFFSET_CAPTURE<span style="color: #339933;">,</span> <span style="color: #000088;">$start</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
<a name="line2458"></a>                                            <span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2459"></a>                                            <span style="color: #000088;">$match_i</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$match</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
<a name="line2460"></a>                                            <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span>GESHI_PHP_PRE_433<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2461"></a>                                                <span style="color: #000088;">$match_i</span> <span style="color: #339933;">+=</span> <span style="color: #000088;">$start</span><span style="color: #339933;">;</span>
<a name="line2462"></a>                                            <span style="color: #009900;">&#125;</span>
<a name="line2463"></a>&nbsp;
<a name="line2464"></a>                                            <span style="color: #000088;">$escape_regexp_cache_per_key</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$escape_key</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span>
<a name="line2465"></a>                                                <span style="color: #0000ff;">'key'</span> <span style="color: #339933;">=&gt;</span> <span style="color: #000088;">$escape_key</span><span style="color: #339933;">,</span>
<a name="line2466"></a>                                                <span style="color: #0000ff;">'length'</span> <span style="color: #339933;">=&gt;</span> <a href="http://www.php.net/strlen"><span style="color: #990000;">strlen</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$match</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span>
<a name="line2467"></a>                                                <span style="color: #0000ff;">'pos'</span> <span style="color: #339933;">=&gt;</span> <span style="color: #000088;">$match_i</span>
<a name="line2468"></a>                                            <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line2469"></a>                                        <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line2470"></a>                                            <span style="color: #000088;">$escape_regexp_cache_per_key</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$escape_key</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'pos'</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #339933;">;</span>
<a name="line2471"></a>                                            <span style="color: #b1b100;">continue</span><span style="color: #339933;">;</span>
<a name="line2472"></a>                                        <span style="color: #009900;">&#125;</span>
<a name="line2473"></a>&nbsp;
<a name="line2474"></a>                                        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$match_i</span> <span style="color: #339933;">!==</span> <span style="color: #009900; font-weight: bold;">false</span> <span style="color: #339933;">&amp;&amp;</span> <span style="color: #000088;">$match_i</span> <span style="color: #339933;">&lt;</span> <span style="color: #000088;">$next_escape_regexp_pos</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2475"></a>                                            <span style="color: #000088;">$next_escape_regexp_pos</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$match_i</span><span style="color: #339933;">;</span>
<a name="line2476"></a>                                            <span style="color: #000088;">$next_escape_regexp_key</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$escape_key</span><span style="color: #339933;">;</span>
<a name="line2477"></a>                                            <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$match_i</span> <span style="color: #339933;">===</span> <span style="color: #000088;">$start</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2478"></a>                                                <span style="color: #b1b100;">break</span><span style="color: #339933;">;</span>
<a name="line2479"></a>                                            <span style="color: #009900;">&#125;</span>
<a name="line2480"></a>                                        <span style="color: #009900;">&#125;</span>
<a name="line2481"></a>                                    <span style="color: #009900;">&#125;</span>
<a name="line2482"></a>                                <span style="color: #009900;">&#125;</span>
<a name="line2483"></a>&nbsp;
<a name="line2484"></a>                                <span style="color: #666666; font-style: italic;">//Find the next simple escape position</span>
<a name="line2485"></a>                                <span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">''</span> <span style="color: #339933;">!=</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'ESCAPE_CHAR'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2486"></a>                                    <span style="color: #000088;">$simple_escape</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/strpos"><span style="color: #990000;">strpos</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$part</span><span style="color: #339933;">,</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'ESCAPE_CHAR'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> <span style="color: #000088;">$start</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line2487"></a>                                    <span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #009900; font-weight: bold;">false</span> <span style="color: #339933;">===</span> <span style="color: #000088;">$simple_escape</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2488"></a>                                        <span style="color: #000088;">$simple_escape</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$length</span><span style="color: #339933;">;</span>
<a name="line2489"></a>                                    <span style="color: #009900;">&#125;</span>
<a name="line2490"></a>                                <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line2491"></a>                                    <span style="color: #000088;">$simple_escape</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$length</span><span style="color: #339933;">;</span>
<a name="line2492"></a>                                <span style="color: #009900;">&#125;</span>
<a name="line2493"></a>                            <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line2494"></a>                                <span style="color: #000088;">$next_escape_regexp_pos</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$length</span><span style="color: #339933;">;</span>
<a name="line2495"></a>                                <span style="color: #000088;">$simple_escape</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$length</span><span style="color: #339933;">;</span>
<a name="line2496"></a>                            <span style="color: #009900;">&#125;</span>
<a name="line2497"></a>&nbsp;
<a name="line2498"></a>                            <span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$simple_escape</span> <span style="color: #339933;">&lt;</span> <span style="color: #000088;">$next_escape_regexp_pos</span> <span style="color: #339933;">&amp;&amp;</span>
<a name="line2499"></a>                                <span style="color: #000088;">$simple_escape</span> <span style="color: #339933;">&lt;</span> <span style="color: #000088;">$length</span> <span style="color: #339933;">&amp;&amp;</span>
<a name="line2500"></a>                                <span style="color: #000088;">$simple_escape</span> <span style="color: #339933;">&lt;</span> <span style="color: #000088;">$close_pos</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2501"></a>                                <span style="color: #666666; font-style: italic;">//The nexxt escape sequence is a simple one ...</span>
<a name="line2502"></a>                                <span style="color: #000088;">$es_pos</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$simple_escape</span><span style="color: #339933;">;</span>
<a name="line2503"></a>&nbsp;
<a name="line2504"></a>                                <span style="color: #666666; font-style: italic;">//Add the stuff not in the string yet ...</span>
<a name="line2505"></a>                                <span style="color: #000088;">$string</span> <span style="color: #339933;">.=</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">hsc</span><span style="color: #009900;">&#40;</span><a href="http://www.php.net/substr"><span style="color: #990000;">substr</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$part</span><span style="color: #339933;">,</span> <span style="color: #000088;">$start</span><span style="color: #339933;">,</span> <span style="color: #000088;">$es_pos</span> <span style="color: #339933;">-</span> <span style="color: #000088;">$start</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line2506"></a>&nbsp;
<a name="line2507"></a>                                <span style="color: #666666; font-style: italic;">//Get the style for this escaped char ...</span>
<a name="line2508"></a>                                <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">use_classes</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2509"></a>                                    <span style="color: #000088;">$escape_char_attributes</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">' style=&quot;'</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'STYLES'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'ESCAPE_CHAR'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">'&quot;'</span><span style="color: #339933;">;</span>
<a name="line2510"></a>                                <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line2511"></a>                                    <span style="color: #000088;">$escape_char_attributes</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">' class=&quot;es0&quot;'</span><span style="color: #339933;">;</span>
<a name="line2512"></a>                                <span style="color: #009900;">&#125;</span>
<a name="line2513"></a>&nbsp;
<a name="line2514"></a>                                <span style="color: #666666; font-style: italic;">//Add the style for the escape char ...</span>
<a name="line2515"></a>                                <span style="color: #000088;">$string</span> <span style="color: #339933;">.=</span> <span style="color: #0000ff;">&quot;&lt;span<span style="color: #006699; font-weight: bold;">$escape_char_attributes</span>&gt;&quot;</span> <span style="color: #339933;">.</span>
<a name="line2516"></a>                                    GeSHi<span style="color: #339933;">::</span><span style="color: #004000;">hsc</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'ESCAPE_CHAR'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line2517"></a>&nbsp;
<a name="line2518"></a>                                <span style="color: #666666; font-style: italic;">//Get the byte AFTER the ESCAPE_CHAR we just found</span>
<a name="line2519"></a>                                <span style="color: #000088;">$es_char</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$part</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$es_pos</span> <span style="color: #339933;">+</span> <span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
<a name="line2520"></a>                                <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$es_char</span> <span style="color: #339933;">==</span> <span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2521"></a>                                    <span style="color: #666666; font-style: italic;">// don't put a newline around newlines</span>
<a name="line2522"></a>                                    <span style="color: #000088;">$string</span> <span style="color: #339933;">.=</span> <span style="color: #0000ff;">&quot;&lt;/span&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span>
<a name="line2523"></a>                                    <span style="color: #000088;">$start</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$es_pos</span> <span style="color: #339933;">+</span> <span style="color: #cc66cc;">2</span><span style="color: #339933;">;</span>
<a name="line2524"></a>                                <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><a href="http://www.php.net/ord"><span style="color: #990000;">ord</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$es_char</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">&gt;=</span> <span style="color: #cc66cc;">128</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2525"></a>                                    <span style="color: #666666; font-style: italic;">//This is an non-ASCII char (UTF8 or single byte)</span>
<a name="line2526"></a>                                    <span style="color: #666666; font-style: italic;">//This code tries to work around SF#2037598 ...</span>
<a name="line2527"></a>                                    <span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><a href="http://www.php.net/function_exists"><span style="color: #990000;">function_exists</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'mb_substr'</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2528"></a>                                        <span style="color: #000088;">$es_char_m</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/mb_substr"><span style="color: #990000;">mb_substr</span></a><span style="color: #009900;">&#40;</span><a href="http://www.php.net/substr"><span style="color: #990000;">substr</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$part</span><span style="color: #339933;">,</span> <span style="color: #000088;">$es_pos</span><span style="color: #339933;">+</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">16</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">encoding</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line2529"></a>                                        <span style="color: #000088;">$string</span> <span style="color: #339933;">.=</span> <span style="color: #000088;">$es_char_m</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">'&lt;/span&gt;'</span><span style="color: #339933;">;</span>
<a name="line2530"></a>                                    <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span>GESHI_PHP_PRE_433 <span style="color: #339933;">&amp;&amp;</span> <span style="color: #0000ff;">'utf-8'</span> <span style="color: #339933;">==</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">encoding</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2531"></a>                                        <span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><a href="http://www.php.net/preg_match"><span style="color: #990000;">preg_match</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;/[<span style="color: #660099; font-weight: bold;">\xC2</span>-<span style="color: #660099; font-weight: bold;">\xDF</span>][<span style="color: #660099; font-weight: bold;">\x80</span>-<span style="color: #660099; font-weight: bold;">\xBF</span>]&quot;</span><span style="color: #339933;">.</span>
<a name="line2532"></a>                                            <span style="color: #0000ff;">&quot;|<span style="color: #660099; font-weight: bold;">\xE0</span>[<span style="color: #660099; font-weight: bold;">\xA0</span>-<span style="color: #660099; font-weight: bold;">\xBF</span>][<span style="color: #660099; font-weight: bold;">\x80</span>-<span style="color: #660099; font-weight: bold;">\xBF</span>]&quot;</span><span style="color: #339933;">.</span>
<a name="line2533"></a>                                            <span style="color: #0000ff;">&quot;|[<span style="color: #660099; font-weight: bold;">\xE1</span>-<span style="color: #660099; font-weight: bold;">\xEC</span><span style="color: #660099; font-weight: bold;">\xEE</span><span style="color: #660099; font-weight: bold;">\xEF</span>][<span style="color: #660099; font-weight: bold;">\x80</span>-<span style="color: #660099; font-weight: bold;">\xBF</span>]{2}&quot;</span><span style="color: #339933;">.</span>
<a name="line2534"></a>                                            <span style="color: #0000ff;">&quot;|<span style="color: #660099; font-weight: bold;">\xED</span>[<span style="color: #660099; font-weight: bold;">\x80</span>-<span style="color: #660099; font-weight: bold;">\x9F</span>][<span style="color: #660099; font-weight: bold;">\x80</span>-<span style="color: #660099; font-weight: bold;">\xBF</span>]&quot;</span><span style="color: #339933;">.</span>
<a name="line2535"></a>                                            <span style="color: #0000ff;">&quot;|<span style="color: #660099; font-weight: bold;">\xF0</span>[<span style="color: #660099; font-weight: bold;">\x90</span>-<span style="color: #660099; font-weight: bold;">\xBF</span>][<span style="color: #660099; font-weight: bold;">\x80</span>-<span style="color: #660099; font-weight: bold;">\xBF</span>]{2}&quot;</span><span style="color: #339933;">.</span>
<a name="line2536"></a>                                            <span style="color: #0000ff;">&quot;|[<span style="color: #660099; font-weight: bold;">\xF1</span>-<span style="color: #660099; font-weight: bold;">\xF3</span>][<span style="color: #660099; font-weight: bold;">\x80</span>-<span style="color: #660099; font-weight: bold;">\xBF</span>]{3}&quot;</span><span style="color: #339933;">.</span>
<a name="line2537"></a>                                            <span style="color: #0000ff;">&quot;|<span style="color: #660099; font-weight: bold;">\xF4</span>[<span style="color: #660099; font-weight: bold;">\x80</span>-<span style="color: #660099; font-weight: bold;">\x8F</span>][<span style="color: #660099; font-weight: bold;">\x80</span>-<span style="color: #660099; font-weight: bold;">\xBF</span>]{2}/s&quot;</span><span style="color: #339933;">,</span>
<a name="line2538"></a>                                            <span style="color: #000088;">$part</span><span style="color: #339933;">,</span> <span style="color: #000088;">$es_char_m</span><span style="color: #339933;">,</span> <span style="color: #009900; font-weight: bold;">null</span><span style="color: #339933;">,</span> <span style="color: #000088;">$es_pos</span> <span style="color: #339933;">+</span> <span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2539"></a>                                            <span style="color: #000088;">$es_char_m</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$es_char_m</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
<a name="line2540"></a>                                        <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line2541"></a>                                            <span style="color: #000088;">$es_char_m</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$es_char</span><span style="color: #339933;">;</span>
<a name="line2542"></a>                                        <span style="color: #009900;">&#125;</span>
<a name="line2543"></a>                                        <span style="color: #000088;">$string</span> <span style="color: #339933;">.=</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">hsc</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$es_char_m</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">'&lt;/span&gt;'</span><span style="color: #339933;">;</span>
<a name="line2544"></a>                                    <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line2545"></a>                                        <span style="color: #000088;">$es_char_m</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">hsc</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$es_char</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line2546"></a>                                    <span style="color: #009900;">&#125;</span>
<a name="line2547"></a>                                    <span style="color: #000088;">$start</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$es_pos</span> <span style="color: #339933;">+</span> <a href="http://www.php.net/strlen"><span style="color: #990000;">strlen</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$es_char_m</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">+</span> <span style="color: #cc66cc;">1</span><span style="color: #339933;">;</span>
<a name="line2548"></a>                                <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line2549"></a>                                    <span style="color: #000088;">$string</span> <span style="color: #339933;">.=</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">hsc</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$es_char</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">'&lt;/span&gt;'</span><span style="color: #339933;">;</span>
<a name="line2550"></a>                                    <span style="color: #000088;">$start</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$es_pos</span> <span style="color: #339933;">+</span> <span style="color: #cc66cc;">2</span><span style="color: #339933;">;</span>
<a name="line2551"></a>                                <span style="color: #009900;">&#125;</span>
<a name="line2552"></a>                            <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$next_escape_regexp_pos</span> <span style="color: #339933;">&lt;</span> <span style="color: #000088;">$length</span> <span style="color: #339933;">&amp;&amp;</span>
<a name="line2553"></a>                                <span style="color: #000088;">$next_escape_regexp_pos</span> <span style="color: #339933;">&lt;</span> <span style="color: #000088;">$close_pos</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2554"></a>                                <span style="color: #000088;">$es_pos</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$next_escape_regexp_pos</span><span style="color: #339933;">;</span>
<a name="line2555"></a>                                <span style="color: #666666; font-style: italic;">//Add the stuff not in the string yet ...</span>
<a name="line2556"></a>                                <span style="color: #000088;">$string</span> <span style="color: #339933;">.=</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">hsc</span><span style="color: #009900;">&#40;</span><a href="http://www.php.net/substr"><span style="color: #990000;">substr</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$part</span><span style="color: #339933;">,</span> <span style="color: #000088;">$start</span><span style="color: #339933;">,</span> <span style="color: #000088;">$es_pos</span> <span style="color: #339933;">-</span> <span style="color: #000088;">$start</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line2557"></a>&nbsp;
<a name="line2558"></a>                                <span style="color: #666666; font-style: italic;">//Get the key and length of this match ...</span>
<a name="line2559"></a>                                <span style="color: #000088;">$escape</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$escape_regexp_cache_per_key</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$next_escape_regexp_key</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
<a name="line2560"></a>                                <span style="color: #000088;">$escape_str</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/substr"><span style="color: #990000;">substr</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$part</span><span style="color: #339933;">,</span> <span style="color: #000088;">$es_pos</span><span style="color: #339933;">,</span> <span style="color: #000088;">$escape</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'length'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line2561"></a>                                <span style="color: #000088;">$escape_key</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$escape</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'key'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
<a name="line2562"></a>&nbsp;
<a name="line2563"></a>                                <span style="color: #666666; font-style: italic;">//Get the style for this escaped char ...</span>
<a name="line2564"></a>                                <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">use_classes</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2565"></a>                                    <span style="color: #000088;">$escape_char_attributes</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">' style=&quot;'</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'STYLES'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'ESCAPE_CHAR'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$escape_key</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">'&quot;'</span><span style="color: #339933;">;</span>
<a name="line2566"></a>                                <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line2567"></a>                                    <span style="color: #000088;">$escape_char_attributes</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">' class=&quot;es'</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$escape_key</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">'&quot;'</span><span style="color: #339933;">;</span>
<a name="line2568"></a>                                <span style="color: #009900;">&#125;</span>
<a name="line2569"></a>&nbsp;
<a name="line2570"></a>                                <span style="color: #666666; font-style: italic;">//Add the style for the escape char ...</span>
<a name="line2571"></a>                                <span style="color: #000088;">$string</span> <span style="color: #339933;">.=</span> <span style="color: #0000ff;">&quot;&lt;span<span style="color: #006699; font-weight: bold;">$escape_char_attributes</span>&gt;&quot;</span> <span style="color: #339933;">.</span>
<a name="line2572"></a>                                    <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">hsc</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$escape_str</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">'&lt;/span&gt;'</span><span style="color: #339933;">;</span>
<a name="line2573"></a>&nbsp;
<a name="line2574"></a>                                <span style="color: #000088;">$start</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$es_pos</span> <span style="color: #339933;">+</span> <span style="color: #000088;">$escape</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'length'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
<a name="line2575"></a>                            <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line2576"></a>                                <span style="color: #666666; font-style: italic;">//Copy the remainder of the string ...</span>
<a name="line2577"></a>                                <span style="color: #000088;">$string</span> <span style="color: #339933;">.=</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">hsc</span><span style="color: #009900;">&#40;</span><a href="http://www.php.net/substr"><span style="color: #990000;">substr</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$part</span><span style="color: #339933;">,</span> <span style="color: #000088;">$start</span><span style="color: #339933;">,</span> <span style="color: #000088;">$close_pos</span> <span style="color: #339933;">-</span> <span style="color: #000088;">$start</span> <span style="color: #339933;">+</span> <span style="color: #000088;">$char_len</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">'&lt;/span&gt;'</span><span style="color: #339933;">;</span>
<a name="line2578"></a>                                <span style="color: #000088;">$start</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$close_pos</span> <span style="color: #339933;">+</span> <span style="color: #000088;">$char_len</span><span style="color: #339933;">;</span>
<a name="line2579"></a>                                <span style="color: #000088;">$string_open</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #339933;">;</span>
<a name="line2580"></a>                            <span style="color: #009900;">&#125;</span>
<a name="line2581"></a>                        <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">while</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$string_open</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line2582"></a>&nbsp;
<a name="line2583"></a>                        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$check_linenumbers</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2584"></a>                            <span style="color: #666666; font-style: italic;">// Are line numbers used? If, we should end the string before</span>
<a name="line2585"></a>                            <span style="color: #666666; font-style: italic;">// the newline and begin it again (so when &lt;li&gt;s are put in the source</span>
<a name="line2586"></a>                            <span style="color: #666666; font-style: italic;">// remains XHTML compliant)</span>
<a name="line2587"></a>                            <span style="color: #666666; font-style: italic;">// note to self: This opens up possibility of config files specifying</span>
<a name="line2588"></a>                            <span style="color: #666666; font-style: italic;">// that languages can/cannot have multiline strings???</span>
<a name="line2589"></a>                            <span style="color: #000088;">$string</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/str_replace"><span style="color: #990000;">str_replace</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">&quot;&lt;/span&gt;<span style="color: #000099; font-weight: bold;">\n</span>&lt;span<span style="color: #006699; font-weight: bold;">$string_attributes</span>&gt;&quot;</span><span style="color: #339933;">,</span> <span style="color: #000088;">$string</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line2590"></a>                        <span style="color: #009900;">&#125;</span>
<a name="line2591"></a>&nbsp;
<a name="line2592"></a>                        <span style="color: #000088;">$result</span> <span style="color: #339933;">.=</span> <span style="color: #000088;">$string</span><span style="color: #339933;">;</span>
<a name="line2593"></a>                        <span style="color: #000088;">$string</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">''</span><span style="color: #339933;">;</span>
<a name="line2594"></a>                        <span style="color: #000088;">$i</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$start</span> <span style="color: #339933;">-</span> <span style="color: #cc66cc;">1</span><span style="color: #339933;">;</span>
<a name="line2595"></a>                        <span style="color: #b1b100;">continue</span><span style="color: #339933;">;</span>
<a name="line2596"></a>                    <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">lexic_permissions</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'STRINGS'</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">&amp;&amp;</span> <span style="color: #000088;">$hq</span> <span style="color: #339933;">&amp;&amp;</span> <span style="color: #000088;">$hq</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">==</span> <span style="color: #000088;">$char</span> <span style="color: #339933;">&amp;&amp;</span>
<a name="line2597"></a>                        <a href="http://www.php.net/substr"><span style="color: #990000;">substr</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$part</span><span style="color: #339933;">,</span> <span style="color: #000088;">$i</span><span style="color: #339933;">,</span> <span style="color: #000088;">$hq_strlen</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">==</span> <span style="color: #000088;">$hq</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2598"></a>                        <span style="color: #666666; font-style: italic;">// The start of a hard quoted string</span>
<a name="line2599"></a>                        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">use_classes</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2600"></a>                            <span style="color: #000088;">$string_attributes</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">' style=&quot;'</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'STYLES'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'STRINGS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'HARD'</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">'&quot;'</span><span style="color: #339933;">;</span>
<a name="line2601"></a>                            <span style="color: #000088;">$escape_char_attributes</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">' style=&quot;'</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'STYLES'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'ESCAPE_CHAR'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'HARD'</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">'&quot;'</span><span style="color: #339933;">;</span>
<a name="line2602"></a>                        <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line2603"></a>                            <span style="color: #000088;">$string_attributes</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">' class=&quot;st_h&quot;'</span><span style="color: #339933;">;</span>
<a name="line2604"></a>                            <span style="color: #000088;">$escape_char_attributes</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">' class=&quot;es_h&quot;'</span><span style="color: #339933;">;</span>
<a name="line2605"></a>                        <span style="color: #009900;">&#125;</span>
<a name="line2606"></a>                        <span style="color: #666666; font-style: italic;">// parse the stuff before this</span>
<a name="line2607"></a>                        <span style="color: #000088;">$result</span> <span style="color: #339933;">.=</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">parse_non_string_part</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$stuff_to_parse</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line2608"></a>                        <span style="color: #000088;">$stuff_to_parse</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">''</span><span style="color: #339933;">;</span>
<a name="line2609"></a>&nbsp;
<a name="line2610"></a>                        <span style="color: #666666; font-style: italic;">// now handle the string</span>
<a name="line2611"></a>                        <span style="color: #000088;">$string</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">''</span><span style="color: #339933;">;</span>
<a name="line2612"></a>&nbsp;
<a name="line2613"></a>                        <span style="color: #666666; font-style: italic;">// look for closing quote</span>
<a name="line2614"></a>                        <span style="color: #000088;">$start</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$i</span> <span style="color: #339933;">+</span> <span style="color: #000088;">$hq_strlen</span><span style="color: #339933;">;</span>
<a name="line2615"></a>                        <span style="color: #b1b100;">while</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$close_pos</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/strpos"><span style="color: #990000;">strpos</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$part</span><span style="color: #339933;">,</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'HARDQUOTE'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> <span style="color: #000088;">$start</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2616"></a>                            <span style="color: #000088;">$start</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$close_pos</span> <span style="color: #339933;">+</span> <span style="color: #cc66cc;">1</span><span style="color: #339933;">;</span>
<a name="line2617"></a>                            <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">lexic_permissions</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'ESCAPE_CHAR'</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">&amp;&amp;</span> <span style="color: #000088;">$part</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$close_pos</span> <span style="color: #339933;">-</span> <span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">==</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'HARDCHAR'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2618"></a>                                <span style="color: #666666; font-style: italic;">// make sure this quote is not escaped</span>
<a name="line2619"></a>                                <span style="color: #b1b100;">foreach</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'HARDESCAPE'</span><span style="color: #009900;">&#93;</span> <span style="color: #b1b100;">as</span> <span style="color: #000088;">$hardescape</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2620"></a>                                    <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><a href="http://www.php.net/substr"><span style="color: #990000;">substr</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$part</span><span style="color: #339933;">,</span> <span style="color: #000088;">$close_pos</span> <span style="color: #339933;">-</span> <span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span> <a href="http://www.php.net/strlen"><span style="color: #990000;">strlen</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$hardescape</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">==</span> <span style="color: #000088;">$hardescape</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2621"></a>                                        <span style="color: #666666; font-style: italic;">// check wether this quote is escaped or if it is something like '\\'</span>
<a name="line2622"></a>                                        <span style="color: #000088;">$escape_char_pos</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$close_pos</span> <span style="color: #339933;">-</span> <span style="color: #cc66cc;">1</span><span style="color: #339933;">;</span>
<a name="line2623"></a>                                        <span style="color: #b1b100;">while</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$escape_char_pos</span> <span style="color: #339933;">&gt;</span> <span style="color: #cc66cc;">0</span>
<a name="line2624"></a>                                                <span style="color: #339933;">&amp;&amp;</span> <span style="color: #000088;">$part</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$escape_char_pos</span> <span style="color: #339933;">-</span> <span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">==</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'HARDCHAR'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2625"></a>                                            <span style="color: #339933;">--</span><span style="color: #000088;">$escape_char_pos</span><span style="color: #339933;">;</span>
<a name="line2626"></a>                                        <span style="color: #009900;">&#125;</span>
<a name="line2627"></a>                                        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$close_pos</span> <span style="color: #339933;">-</span> <span style="color: #000088;">$escape_char_pos</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">&amp;</span> <span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2628"></a>                                            <span style="color: #666666; font-style: italic;">// uneven number of escape chars =&gt; this quote is escaped</span>
<a name="line2629"></a>                                            <span style="color: #b1b100;">continue</span> <span style="color: #cc66cc;">2</span><span style="color: #339933;">;</span>
<a name="line2630"></a>                                        <span style="color: #009900;">&#125;</span>
<a name="line2631"></a>                                    <span style="color: #009900;">&#125;</span>
<a name="line2632"></a>                                <span style="color: #009900;">&#125;</span>
<a name="line2633"></a>                            <span style="color: #009900;">&#125;</span>
<a name="line2634"></a>&nbsp;
<a name="line2635"></a>                            <span style="color: #666666; font-style: italic;">// found closing quote</span>
<a name="line2636"></a>                            <span style="color: #b1b100;">break</span><span style="color: #339933;">;</span>
<a name="line2637"></a>                        <span style="color: #009900;">&#125;</span>
<a name="line2638"></a>&nbsp;
<a name="line2639"></a>                        <span style="color: #666666; font-style: italic;">//Found the closing delimiter?</span>
<a name="line2640"></a>                        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><span style="color: #000088;">$close_pos</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2641"></a>                            <span style="color: #666666; font-style: italic;">// span till the end of this $part when no closing delimiter is found</span>
<a name="line2642"></a>                            <span style="color: #000088;">$close_pos</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$length</span><span style="color: #339933;">;</span>
<a name="line2643"></a>                        <span style="color: #009900;">&#125;</span>
<a name="line2644"></a>&nbsp;
<a name="line2645"></a>                        <span style="color: #666666; font-style: italic;">//Get the actual string</span>
<a name="line2646"></a>                        <span style="color: #000088;">$string</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/substr"><span style="color: #990000;">substr</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$part</span><span style="color: #339933;">,</span> <span style="color: #000088;">$i</span><span style="color: #339933;">,</span> <span style="color: #000088;">$close_pos</span> <span style="color: #339933;">-</span> <span style="color: #000088;">$i</span> <span style="color: #339933;">+</span> <span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line2647"></a>                        <span style="color: #000088;">$i</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$close_pos</span><span style="color: #339933;">;</span>
<a name="line2648"></a>&nbsp;
<a name="line2649"></a>                        <span style="color: #666666; font-style: italic;">// handle escape chars and encode html chars</span>
<a name="line2650"></a>                        <span style="color: #666666; font-style: italic;">// (special because when we have escape chars within our string they may not be escaped)</span>
<a name="line2651"></a>                        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">lexic_permissions</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'ESCAPE_CHAR'</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">&amp;&amp;</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'ESCAPE_CHAR'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2652"></a>                            <span style="color: #000088;">$start</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span>
<a name="line2653"></a>                            <span style="color: #000088;">$new_string</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">''</span><span style="color: #339933;">;</span>
<a name="line2654"></a>                            <span style="color: #b1b100;">while</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$es_pos</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/strpos"><span style="color: #990000;">strpos</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$string</span><span style="color: #339933;">,</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'ESCAPE_CHAR'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> <span style="color: #000088;">$start</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2655"></a>                                <span style="color: #666666; font-style: italic;">// hmtl escape stuff before</span>
<a name="line2656"></a>                                <span style="color: #000088;">$new_string</span> <span style="color: #339933;">.=</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">hsc</span><span style="color: #009900;">&#40;</span><a href="http://www.php.net/substr"><span style="color: #990000;">substr</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$string</span><span style="color: #339933;">,</span> <span style="color: #000088;">$start</span><span style="color: #339933;">,</span> <span style="color: #000088;">$es_pos</span> <span style="color: #339933;">-</span> <span style="color: #000088;">$start</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line2657"></a>                                <span style="color: #666666; font-style: italic;">// check if this is a hard escape</span>
<a name="line2658"></a>                                <span style="color: #b1b100;">foreach</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'HARDESCAPE'</span><span style="color: #009900;">&#93;</span> <span style="color: #b1b100;">as</span> <span style="color: #000088;">$hardescape</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2659"></a>                                    <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><a href="http://www.php.net/substr"><span style="color: #990000;">substr</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$string</span><span style="color: #339933;">,</span> <span style="color: #000088;">$es_pos</span><span style="color: #339933;">,</span> <a href="http://www.php.net/strlen"><span style="color: #990000;">strlen</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$hardescape</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">==</span> <span style="color: #000088;">$hardescape</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2660"></a>                                        <span style="color: #666666; font-style: italic;">// indeed, this is a hardescape</span>
<a name="line2661"></a>                                        <span style="color: #000088;">$new_string</span> <span style="color: #339933;">.=</span> <span style="color: #0000ff;">&quot;&lt;span<span style="color: #006699; font-weight: bold;">$escape_char_attributes</span>&gt;&quot;</span> <span style="color: #339933;">.</span>
<a name="line2662"></a>                                            <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">hsc</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$hardescape</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">'&lt;/span&gt;'</span><span style="color: #339933;">;</span>
<a name="line2663"></a>                                        <span style="color: #000088;">$start</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$es_pos</span> <span style="color: #339933;">+</span> <a href="http://www.php.net/strlen"><span style="color: #990000;">strlen</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$hardescape</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line2664"></a>                                        <span style="color: #b1b100;">continue</span> <span style="color: #cc66cc;">2</span><span style="color: #339933;">;</span>
<a name="line2665"></a>                                    <span style="color: #009900;">&#125;</span>
<a name="line2666"></a>                                <span style="color: #009900;">&#125;</span>
<a name="line2667"></a>                                <span style="color: #666666; font-style: italic;">// not a hard escape, but a normal escape</span>
<a name="line2668"></a>                                <span style="color: #666666; font-style: italic;">// they come in pairs of two</span>
<a name="line2669"></a>                                <span style="color: #000088;">$c</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span>
<a name="line2670"></a>                                <span style="color: #b1b100;">while</span> <span style="color: #009900;">&#40;</span><a href="http://www.php.net/isset"><span style="color: #990000;">isset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$string</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$es_pos</span> <span style="color: #339933;">+</span> <span style="color: #000088;">$c</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">&amp;&amp;</span> <a href="http://www.php.net/isset"><span style="color: #990000;">isset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$string</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$es_pos</span> <span style="color: #339933;">+</span> <span style="color: #000088;">$c</span> <span style="color: #339933;">+</span> <span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span>
<a name="line2671"></a>                                    <span style="color: #339933;">&amp;&amp;</span> <span style="color: #000088;">$string</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$es_pos</span> <span style="color: #339933;">+</span> <span style="color: #000088;">$c</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">==</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'ESCAPE_CHAR'</span><span style="color: #009900;">&#93;</span>
<a name="line2672"></a>                                    <span style="color: #339933;">&amp;&amp;</span> <span style="color: #000088;">$string</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$es_pos</span> <span style="color: #339933;">+</span> <span style="color: #000088;">$c</span> <span style="color: #339933;">+</span> <span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">==</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'ESCAPE_CHAR'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2673"></a>                                    <span style="color: #000088;">$c</span> <span style="color: #339933;">+=</span> <span style="color: #cc66cc;">2</span><span style="color: #339933;">;</span>
<a name="line2674"></a>                                <span style="color: #009900;">&#125;</span>
<a name="line2675"></a>                                <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$c</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2676"></a>                                    <span style="color: #000088;">$new_string</span> <span style="color: #339933;">.=</span> <span style="color: #0000ff;">&quot;&lt;span<span style="color: #006699; font-weight: bold;">$escape_char_attributes</span>&gt;&quot;</span> <span style="color: #339933;">.</span>
<a name="line2677"></a>                                        <a href="http://www.php.net/str_repeat"><span style="color: #990000;">str_repeat</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$escaped_escape_char</span><span style="color: #339933;">,</span> <span style="color: #000088;">$c</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">.</span>
<a name="line2678"></a>                                        <span style="color: #0000ff;">'&lt;/span&gt;'</span><span style="color: #339933;">;</span>
<a name="line2679"></a>                                    <span style="color: #000088;">$start</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$es_pos</span> <span style="color: #339933;">+</span> <span style="color: #000088;">$c</span><span style="color: #339933;">;</span>
<a name="line2680"></a>                                <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line2681"></a>                                    <span style="color: #666666; font-style: italic;">// this is just a single lonely escape char...</span>
<a name="line2682"></a>                                    <span style="color: #000088;">$new_string</span> <span style="color: #339933;">.=</span> <span style="color: #000088;">$escaped_escape_char</span><span style="color: #339933;">;</span>
<a name="line2683"></a>                                    <span style="color: #000088;">$start</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$es_pos</span> <span style="color: #339933;">+</span> <span style="color: #cc66cc;">1</span><span style="color: #339933;">;</span>
<a name="line2684"></a>                                <span style="color: #009900;">&#125;</span>
<a name="line2685"></a>                            <span style="color: #009900;">&#125;</span>
<a name="line2686"></a>                            <span style="color: #000088;">$string</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$new_string</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">hsc</span><span style="color: #009900;">&#40;</span><a href="http://www.php.net/substr"><span style="color: #990000;">substr</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$string</span><span style="color: #339933;">,</span> <span style="color: #000088;">$start</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line2687"></a>                        <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line2688"></a>                            <span style="color: #000088;">$string</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">hsc</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$string</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line2689"></a>                        <span style="color: #009900;">&#125;</span>
<a name="line2690"></a>&nbsp;
<a name="line2691"></a>                        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$check_linenumbers</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2692"></a>                            <span style="color: #666666; font-style: italic;">// Are line numbers used? If, we should end the string before</span>
<a name="line2693"></a>                            <span style="color: #666666; font-style: italic;">// the newline and begin it again (so when &lt;li&gt;s are put in the source</span>
<a name="line2694"></a>                            <span style="color: #666666; font-style: italic;">// remains XHTML compliant)</span>
<a name="line2695"></a>                            <span style="color: #666666; font-style: italic;">// note to self: This opens up possibility of config files specifying</span>
<a name="line2696"></a>                            <span style="color: #666666; font-style: italic;">// that languages can/cannot have multiline strings???</span>
<a name="line2697"></a>                            <span style="color: #000088;">$string</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/str_replace"><span style="color: #990000;">str_replace</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">&quot;&lt;/span&gt;<span style="color: #000099; font-weight: bold;">\n</span>&lt;span<span style="color: #006699; font-weight: bold;">$string_attributes</span>&gt;&quot;</span><span style="color: #339933;">,</span> <span style="color: #000088;">$string</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line2698"></a>                        <span style="color: #009900;">&#125;</span>
<a name="line2699"></a>&nbsp;
<a name="line2700"></a>                        <span style="color: #000088;">$result</span> <span style="color: #339933;">.=</span> <span style="color: #0000ff;">&quot;&lt;span<span style="color: #006699; font-weight: bold;">$string_attributes</span>&gt;&quot;</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$string</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">'&lt;/span&gt;'</span><span style="color: #339933;">;</span>
<a name="line2701"></a>                        <span style="color: #000088;">$string</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">''</span><span style="color: #339933;">;</span>
<a name="line2702"></a>                        <span style="color: #b1b100;">continue</span><span style="color: #339933;">;</span>
<a name="line2703"></a>                    <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line2704"></a>                        <span style="color: #666666; font-style: italic;">//Have a look for regexp comments</span>
<a name="line2705"></a>                        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$i</span> <span style="color: #339933;">==</span> <span style="color: #000088;">$next_comment_regexp_pos</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2706"></a>                            <span style="color: #000088;">$COMMENT_MATCHED</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">true</span><span style="color: #339933;">;</span>
<a name="line2707"></a>                            <span style="color: #000088;">$comment</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$comment_regexp_cache_per_key</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$next_comment_regexp_key</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
<a name="line2708"></a>                            <span style="color: #000088;">$test_str</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">hsc</span><span style="color: #009900;">&#40;</span><a href="http://www.php.net/substr"><span style="color: #990000;">substr</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$part</span><span style="color: #339933;">,</span> <span style="color: #000088;">$i</span><span style="color: #339933;">,</span> <span style="color: #000088;">$comment</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'length'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line2709"></a>&nbsp;
<a name="line2710"></a>                            <span style="color: #666666; font-style: italic;">//@todo If remove important do remove here</span>
<a name="line2711"></a>                            <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">lexic_permissions</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'COMMENTS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'MULTI'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2712"></a>                                <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">use_classes</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2713"></a>                                    <span style="color: #000088;">$attributes</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">' style=&quot;'</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'STYLES'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'COMMENTS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$comment</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'key'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">'&quot;'</span><span style="color: #339933;">;</span>
<a name="line2714"></a>                                <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line2715"></a>                                    <span style="color: #000088;">$attributes</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">' class=&quot;co'</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$comment</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'key'</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">'&quot;'</span><span style="color: #339933;">;</span>
<a name="line2716"></a>                                <span style="color: #009900;">&#125;</span>
<a name="line2717"></a>&nbsp;
<a name="line2718"></a>                                <span style="color: #000088;">$test_str</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;&lt;span<span style="color: #006699; font-weight: bold;">$attributes</span>&gt;&quot;</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$test_str</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">&quot;&lt;/span&gt;&quot;</span><span style="color: #339933;">;</span>
<a name="line2719"></a>&nbsp;
<a name="line2720"></a>                                <span style="color: #666666; font-style: italic;">// Short-cut through all the multiline code</span>
<a name="line2721"></a>                                <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$check_linenumbers</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2722"></a>                                    <span style="color: #666666; font-style: italic;">// strreplace to put close span and open span around multiline newlines</span>
<a name="line2723"></a>                                    <span style="color: #000088;">$test_str</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/str_replace"><span style="color: #990000;">str_replace</span></a><span style="color: #009900;">&#40;</span>
<a name="line2724"></a>                                        <span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">&quot;&lt;/span&gt;<span style="color: #000099; font-weight: bold;">\n</span>&lt;span<span style="color: #006699; font-weight: bold;">$attributes</span>&gt;&quot;</span><span style="color: #339933;">,</span>
<a name="line2725"></a>                                        <a href="http://www.php.net/str_replace"><span style="color: #990000;">str_replace</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\n</span> &quot;</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\n</span>&amp;nbsp;&quot;</span><span style="color: #339933;">,</span> <span style="color: #000088;">$test_str</span><span style="color: #009900;">&#41;</span>
<a name="line2726"></a>                                    <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line2727"></a>                                <span style="color: #009900;">&#125;</span>
<a name="line2728"></a>                            <span style="color: #009900;">&#125;</span>
<a name="line2729"></a>&nbsp;
<a name="line2730"></a>                            <span style="color: #000088;">$i</span> <span style="color: #339933;">+=</span> <span style="color: #000088;">$comment</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'length'</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">-</span> <span style="color: #cc66cc;">1</span><span style="color: #339933;">;</span>
<a name="line2731"></a>&nbsp;
<a name="line2732"></a>                            <span style="color: #666666; font-style: italic;">// parse the rest</span>
<a name="line2733"></a>                            <span style="color: #000088;">$result</span> <span style="color: #339933;">.=</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">parse_non_string_part</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$stuff_to_parse</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line2734"></a>                            <span style="color: #000088;">$stuff_to_parse</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">''</span><span style="color: #339933;">;</span>
<a name="line2735"></a>                        <span style="color: #009900;">&#125;</span>
<a name="line2736"></a>&nbsp;
<a name="line2737"></a>                        <span style="color: #666666; font-style: italic;">// If we haven't matched a regexp comment, try multi-line comments</span>
<a name="line2738"></a>                        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><span style="color: #000088;">$COMMENT_MATCHED</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2739"></a>                            <span style="color: #666666; font-style: italic;">// Is this a multiline comment?</span>
<a name="line2740"></a>                            <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><a href="http://www.php.net/empty"><span style="color: #990000;">empty</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'COMMENT_MULTI'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">&amp;&amp;</span> <span style="color: #000088;">$next_comment_multi_pos</span> <span style="color: #339933;">&lt;</span> <span style="color: #000088;">$i</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2741"></a>                                <span style="color: #000088;">$next_comment_multi_pos</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$length</span><span style="color: #339933;">;</span>
<a name="line2742"></a>                                <span style="color: #b1b100;">foreach</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'COMMENT_MULTI'</span><span style="color: #009900;">&#93;</span> <span style="color: #b1b100;">as</span> <span style="color: #000088;">$open</span> <span style="color: #339933;">=&gt;</span> <span style="color: #000088;">$close</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2743"></a>                                    <span style="color: #000088;">$match_i</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #339933;">;</span>
<a name="line2744"></a>                                    <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><a href="http://www.php.net/isset"><span style="color: #990000;">isset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$comment_multi_cache_per_key</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$open</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">&amp;&amp;</span>
<a name="line2745"></a>                                        <span style="color: #009900;">&#40;</span><span style="color: #000088;">$comment_multi_cache_per_key</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$open</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">&gt;=</span> <span style="color: #000088;">$i</span> <span style="color: #339933;">||</span>
<a name="line2746"></a>                                         <span style="color: #000088;">$comment_multi_cache_per_key</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$open</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">===</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2747"></a>                                        <span style="color: #666666; font-style: italic;">// we have already matched something</span>
<a name="line2748"></a>                                        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$comment_multi_cache_per_key</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$open</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">===</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2749"></a>                                            <span style="color: #666666; font-style: italic;">// this comment is never matched</span>
<a name="line2750"></a>                                            <span style="color: #b1b100;">continue</span><span style="color: #339933;">;</span>
<a name="line2751"></a>                                        <span style="color: #009900;">&#125;</span>
<a name="line2752"></a>                                        <span style="color: #000088;">$match_i</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$comment_multi_cache_per_key</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$open</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
<a name="line2753"></a>                                    <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$match_i</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/stripos"><span style="color: #990000;">stripos</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$part</span><span style="color: #339933;">,</span> <span style="color: #000088;">$open</span><span style="color: #339933;">,</span> <span style="color: #000088;">$i</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">!==</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2754"></a>                                        <span style="color: #000088;">$comment_multi_cache_per_key</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$open</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$match_i</span><span style="color: #339933;">;</span>
<a name="line2755"></a>                                    <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line2756"></a>                                        <span style="color: #000088;">$comment_multi_cache_per_key</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$open</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #339933;">;</span>
<a name="line2757"></a>                                        <span style="color: #b1b100;">continue</span><span style="color: #339933;">;</span>
<a name="line2758"></a>                                    <span style="color: #009900;">&#125;</span>
<a name="line2759"></a>                                    <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$match_i</span> <span style="color: #339933;">!==</span> <span style="color: #009900; font-weight: bold;">false</span> <span style="color: #339933;">&amp;&amp;</span> <span style="color: #000088;">$match_i</span> <span style="color: #339933;">&lt;</span> <span style="color: #000088;">$next_comment_multi_pos</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2760"></a>                                        <span style="color: #000088;">$next_comment_multi_pos</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$match_i</span><span style="color: #339933;">;</span>
<a name="line2761"></a>                                        <span style="color: #000088;">$next_open_comment_multi</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$open</span><span style="color: #339933;">;</span>
<a name="line2762"></a>                                        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$match_i</span> <span style="color: #339933;">===</span> <span style="color: #000088;">$i</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2763"></a>                                            <span style="color: #b1b100;">break</span><span style="color: #339933;">;</span>
<a name="line2764"></a>                                        <span style="color: #009900;">&#125;</span>
<a name="line2765"></a>                                    <span style="color: #009900;">&#125;</span>
<a name="line2766"></a>                                <span style="color: #009900;">&#125;</span>
<a name="line2767"></a>                            <span style="color: #009900;">&#125;</span>
<a name="line2768"></a>                            <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$i</span> <span style="color: #339933;">==</span> <span style="color: #000088;">$next_comment_multi_pos</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2769"></a>                                <span style="color: #000088;">$open</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$next_open_comment_multi</span><span style="color: #339933;">;</span>
<a name="line2770"></a>                                <span style="color: #000088;">$close</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'COMMENT_MULTI'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$open</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
<a name="line2771"></a>                                <span style="color: #000088;">$open_strlen</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/strlen"><span style="color: #990000;">strlen</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$open</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line2772"></a>                                <span style="color: #000088;">$close_strlen</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/strlen"><span style="color: #990000;">strlen</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$close</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line2773"></a>                                <span style="color: #000088;">$COMMENT_MATCHED</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">true</span><span style="color: #339933;">;</span>
<a name="line2774"></a>                                <span style="color: #000088;">$test_str_match</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$open</span><span style="color: #339933;">;</span>
<a name="line2775"></a>                                <span style="color: #666666; font-style: italic;">//@todo If remove important do remove here</span>
<a name="line2776"></a>                                <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">lexic_permissions</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'COMMENTS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'MULTI'</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">||</span>
<a name="line2777"></a>                                    <span style="color: #000088;">$open</span> <span style="color: #339933;">==</span> GESHI_START_IMPORTANT<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2778"></a>                                    <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$open</span> <span style="color: #339933;">!=</span> GESHI_START_IMPORTANT<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2779"></a>                                        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">use_classes</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2780"></a>                                            <span style="color: #000088;">$attributes</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">' style=&quot;'</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'STYLES'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'COMMENTS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'MULTI'</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">'&quot;'</span><span style="color: #339933;">;</span>
<a name="line2781"></a>                                        <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line2782"></a>                                            <span style="color: #000088;">$attributes</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">' class=&quot;coMULTI&quot;'</span><span style="color: #339933;">;</span>
<a name="line2783"></a>                                        <span style="color: #009900;">&#125;</span>
<a name="line2784"></a>                                        <span style="color: #000088;">$test_str</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;&lt;span<span style="color: #006699; font-weight: bold;">$attributes</span>&gt;&quot;</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">hsc</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$open</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line2785"></a>                                    <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line2786"></a>                                        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">use_classes</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2787"></a>                                            <span style="color: #000088;">$attributes</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">' style=&quot;'</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">important_styles</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">'&quot;'</span><span style="color: #339933;">;</span>
<a name="line2788"></a>                                        <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line2789"></a>                                            <span style="color: #000088;">$attributes</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">' class=&quot;imp&quot;'</span><span style="color: #339933;">;</span>
<a name="line2790"></a>                                        <span style="color: #009900;">&#125;</span>
<a name="line2791"></a>&nbsp;
<a name="line2792"></a>                                        <span style="color: #666666; font-style: italic;">// We don't include the start of the comment if it's an</span>
<a name="line2793"></a>                                        <span style="color: #666666; font-style: italic;">// &quot;important&quot; part</span>
<a name="line2794"></a>                                        <span style="color: #000088;">$test_str</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;&lt;span<span style="color: #006699; font-weight: bold;">$attributes</span>&gt;&quot;</span><span style="color: #339933;">;</span>
<a name="line2795"></a>                                    <span style="color: #009900;">&#125;</span>
<a name="line2796"></a>                                <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line2797"></a>                                    <span style="color: #000088;">$test_str</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">hsc</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$open</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line2798"></a>                                <span style="color: #009900;">&#125;</span>
<a name="line2799"></a>&nbsp;
<a name="line2800"></a>                                <span style="color: #000088;">$close_pos</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/strpos"><span style="color: #990000;">strpos</span></a><span style="color: #009900;">&#40;</span> <span style="color: #000088;">$part</span><span style="color: #339933;">,</span> <span style="color: #000088;">$close</span><span style="color: #339933;">,</span> <span style="color: #000088;">$i</span> <span style="color: #339933;">+</span> <span style="color: #000088;">$open_strlen</span> <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line2801"></a>&nbsp;
<a name="line2802"></a>                                <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$close_pos</span> <span style="color: #339933;">===</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2803"></a>                                    <span style="color: #000088;">$close_pos</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$length</span><span style="color: #339933;">;</span>
<a name="line2804"></a>                                <span style="color: #009900;">&#125;</span>
<a name="line2805"></a>&nbsp;
<a name="line2806"></a>                                <span style="color: #666666; font-style: italic;">// Short-cut through all the multiline code</span>
<a name="line2807"></a>                                <span style="color: #000088;">$rest_of_comment</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">hsc</span><span style="color: #009900;">&#40;</span><a href="http://www.php.net/substr"><span style="color: #990000;">substr</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$part</span><span style="color: #339933;">,</span> <span style="color: #000088;">$i</span> <span style="color: #339933;">+</span> <span style="color: #000088;">$open_strlen</span><span style="color: #339933;">,</span> <span style="color: #000088;">$close_pos</span> <span style="color: #339933;">-</span> <span style="color: #000088;">$i</span> <span style="color: #339933;">-</span> <span style="color: #000088;">$open_strlen</span> <span style="color: #339933;">+</span> <span style="color: #000088;">$close_strlen</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line2808"></a>                                <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">lexic_permissions</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'COMMENTS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'MULTI'</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">||</span>
<a name="line2809"></a>                                    <span style="color: #000088;">$test_str_match</span> <span style="color: #339933;">==</span> GESHI_START_IMPORTANT<span style="color: #009900;">&#41;</span> <span style="color: #339933;">&amp;&amp;</span>
<a name="line2810"></a>                                    <span style="color: #000088;">$check_linenumbers</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2811"></a>&nbsp;
<a name="line2812"></a>                                    <span style="color: #666666; font-style: italic;">// strreplace to put close span and open span around multiline newlines</span>
<a name="line2813"></a>                                    <span style="color: #000088;">$test_str</span> <span style="color: #339933;">.=</span> <a href="http://www.php.net/str_replace"><span style="color: #990000;">str_replace</span></a><span style="color: #009900;">&#40;</span>
<a name="line2814"></a>                                        <span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">&quot;&lt;/span&gt;<span style="color: #000099; font-weight: bold;">\n</span>&lt;span<span style="color: #006699; font-weight: bold;">$attributes</span>&gt;&quot;</span><span style="color: #339933;">,</span>
<a name="line2815"></a>                                        <a href="http://www.php.net/str_replace"><span style="color: #990000;">str_replace</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\n</span> &quot;</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\n</span>&amp;nbsp;&quot;</span><span style="color: #339933;">,</span> <span style="color: #000088;">$rest_of_comment</span><span style="color: #009900;">&#41;</span>
<a name="line2816"></a>                                    <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line2817"></a>                                <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line2818"></a>                                    <span style="color: #000088;">$test_str</span> <span style="color: #339933;">.=</span> <span style="color: #000088;">$rest_of_comment</span><span style="color: #339933;">;</span>
<a name="line2819"></a>                                <span style="color: #009900;">&#125;</span>
<a name="line2820"></a>&nbsp;
<a name="line2821"></a>                                <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">lexic_permissions</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'COMMENTS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'MULTI'</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">||</span>
<a name="line2822"></a>                                    <span style="color: #000088;">$test_str_match</span> <span style="color: #339933;">==</span> GESHI_START_IMPORTANT<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2823"></a>                                    <span style="color: #000088;">$test_str</span> <span style="color: #339933;">.=</span> <span style="color: #0000ff;">'&lt;/span&gt;'</span><span style="color: #339933;">;</span>
<a name="line2824"></a>                                <span style="color: #009900;">&#125;</span>
<a name="line2825"></a>&nbsp;
<a name="line2826"></a>                                <span style="color: #000088;">$i</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$close_pos</span> <span style="color: #339933;">+</span> <span style="color: #000088;">$close_strlen</span> <span style="color: #339933;">-</span> <span style="color: #cc66cc;">1</span><span style="color: #339933;">;</span>
<a name="line2827"></a>&nbsp;
<a name="line2828"></a>                                <span style="color: #666666; font-style: italic;">// parse the rest</span>
<a name="line2829"></a>                                <span style="color: #000088;">$result</span> <span style="color: #339933;">.=</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">parse_non_string_part</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$stuff_to_parse</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line2830"></a>                                <span style="color: #000088;">$stuff_to_parse</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">''</span><span style="color: #339933;">;</span>
<a name="line2831"></a>                            <span style="color: #009900;">&#125;</span>
<a name="line2832"></a>                        <span style="color: #009900;">&#125;</span>
<a name="line2833"></a>&nbsp;
<a name="line2834"></a>                        <span style="color: #666666; font-style: italic;">// If we haven't matched a multiline comment, try single-line comments</span>
<a name="line2835"></a>                        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><span style="color: #000088;">$COMMENT_MATCHED</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2836"></a>                            <span style="color: #666666; font-style: italic;">// cache potential single line comment occurances</span>
<a name="line2837"></a>                            <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><a href="http://www.php.net/empty"><span style="color: #990000;">empty</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'COMMENT_SINGLE'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">&amp;&amp;</span> <span style="color: #000088;">$next_comment_single_pos</span> <span style="color: #339933;">&lt;</span> <span style="color: #000088;">$i</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2838"></a>                                <span style="color: #000088;">$next_comment_single_pos</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$length</span><span style="color: #339933;">;</span>
<a name="line2839"></a>                                <span style="color: #b1b100;">foreach</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'COMMENT_SINGLE'</span><span style="color: #009900;">&#93;</span> <span style="color: #b1b100;">as</span> <span style="color: #000088;">$comment_key</span> <span style="color: #339933;">=&gt;</span> <span style="color: #000088;">$comment_mark</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2840"></a>                                    <span style="color: #000088;">$match_i</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #339933;">;</span>
<a name="line2841"></a>                                    <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><a href="http://www.php.net/isset"><span style="color: #990000;">isset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$comment_single_cache_per_key</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$comment_key</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">&amp;&amp;</span>
<a name="line2842"></a>                                        <span style="color: #009900;">&#40;</span><span style="color: #000088;">$comment_single_cache_per_key</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$comment_key</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">&gt;=</span> <span style="color: #000088;">$i</span> <span style="color: #339933;">||</span>
<a name="line2843"></a>                                         <span style="color: #000088;">$comment_single_cache_per_key</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$comment_key</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">===</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2844"></a>                                        <span style="color: #666666; font-style: italic;">// we have already matched something</span>
<a name="line2845"></a>                                        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$comment_single_cache_per_key</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$comment_key</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">===</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2846"></a>                                            <span style="color: #666666; font-style: italic;">// this comment is never matched</span>
<a name="line2847"></a>                                            <span style="color: #b1b100;">continue</span><span style="color: #339933;">;</span>
<a name="line2848"></a>                                        <span style="color: #009900;">&#125;</span>
<a name="line2849"></a>                                        <span style="color: #000088;">$match_i</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$comment_single_cache_per_key</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$comment_key</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
<a name="line2850"></a>                                    <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span>
<a name="line2851"></a>                                        <span style="color: #666666; font-style: italic;">// case sensitive comments</span>
<a name="line2852"></a>                                        <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'CASE_SENSITIVE'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span>GESHI_COMMENTS<span style="color: #009900;">&#93;</span> <span style="color: #339933;">&amp;&amp;</span>
<a name="line2853"></a>                                        <span style="color: #009900;">&#40;</span><span style="color: #000088;">$match_i</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/stripos"><span style="color: #990000;">stripos</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$part</span><span style="color: #339933;">,</span> <span style="color: #000088;">$comment_mark</span><span style="color: #339933;">,</span> <span style="color: #000088;">$i</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">!==</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">||</span>
<a name="line2854"></a>                                        <span style="color: #666666; font-style: italic;">// non case sensitive</span>
<a name="line2855"></a>                                        <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'CASE_SENSITIVE'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span>GESHI_COMMENTS<span style="color: #009900;">&#93;</span> <span style="color: #339933;">&amp;&amp;</span>
<a name="line2856"></a>                                          <span style="color: #009900;">&#40;</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$match_i</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/strpos"><span style="color: #990000;">strpos</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$part</span><span style="color: #339933;">,</span> <span style="color: #000088;">$comment_mark</span><span style="color: #339933;">,</span> <span style="color: #000088;">$i</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">!==</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2857"></a>                                        <span style="color: #000088;">$comment_single_cache_per_key</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$comment_key</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$match_i</span><span style="color: #339933;">;</span>
<a name="line2858"></a>                                    <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line2859"></a>                                        <span style="color: #000088;">$comment_single_cache_per_key</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$comment_key</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #339933;">;</span>
<a name="line2860"></a>                                        <span style="color: #b1b100;">continue</span><span style="color: #339933;">;</span>
<a name="line2861"></a>                                    <span style="color: #009900;">&#125;</span>
<a name="line2862"></a>                                    <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$match_i</span> <span style="color: #339933;">!==</span> <span style="color: #009900; font-weight: bold;">false</span> <span style="color: #339933;">&amp;&amp;</span> <span style="color: #000088;">$match_i</span> <span style="color: #339933;">&lt;</span> <span style="color: #000088;">$next_comment_single_pos</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2863"></a>                                        <span style="color: #000088;">$next_comment_single_pos</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$match_i</span><span style="color: #339933;">;</span>
<a name="line2864"></a>                                        <span style="color: #000088;">$next_comment_single_key</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$comment_key</span><span style="color: #339933;">;</span>
<a name="line2865"></a>                                        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$match_i</span> <span style="color: #339933;">===</span> <span style="color: #000088;">$i</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2866"></a>                                            <span style="color: #b1b100;">break</span><span style="color: #339933;">;</span>
<a name="line2867"></a>                                        <span style="color: #009900;">&#125;</span>
<a name="line2868"></a>                                    <span style="color: #009900;">&#125;</span>
<a name="line2869"></a>                                <span style="color: #009900;">&#125;</span>
<a name="line2870"></a>                            <span style="color: #009900;">&#125;</span>
<a name="line2871"></a>                            <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$next_comment_single_pos</span> <span style="color: #339933;">==</span> <span style="color: #000088;">$i</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2872"></a>                                <span style="color: #000088;">$comment_key</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$next_comment_single_key</span><span style="color: #339933;">;</span>
<a name="line2873"></a>                                <span style="color: #000088;">$comment_mark</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'COMMENT_SINGLE'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$comment_key</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
<a name="line2874"></a>                                <span style="color: #000088;">$com_len</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/strlen"><span style="color: #990000;">strlen</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$comment_mark</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line2875"></a>&nbsp;
<a name="line2876"></a>                                <span style="color: #666666; font-style: italic;">// This check will find special variables like $# in bash</span>
<a name="line2877"></a>                                <span style="color: #666666; font-style: italic;">// or compiler directives of Delphi beginning {$</span>
<a name="line2878"></a>                                <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #009900;">&#40;</span><a href="http://www.php.net/empty"><span style="color: #990000;">empty</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$sc_disallowed_before</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">||</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$i</span> <span style="color: #339933;">==</span> <span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">||</span>
<a name="line2879"></a>                                    <span style="color: #009900;">&#40;</span><span style="color: #009900; font-weight: bold;">false</span> <span style="color: #339933;">===</span> <a href="http://www.php.net/strpos"><span style="color: #990000;">strpos</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$sc_disallowed_before</span><span style="color: #339933;">,</span> <span style="color: #000088;">$part</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$i</span><span style="color: #339933;">-</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">&amp;&amp;</span>
<a name="line2880"></a>                                    <span style="color: #009900;">&#40;</span><a href="http://www.php.net/empty"><span style="color: #990000;">empty</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$sc_disallowed_after</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">||</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$length</span> <span style="color: #339933;">&lt;=</span> <span style="color: #000088;">$i</span> <span style="color: #339933;">+</span> <span style="color: #000088;">$com_len</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">||</span>
<a name="line2881"></a>                                    <span style="color: #009900;">&#40;</span><span style="color: #009900; font-weight: bold;">false</span> <span style="color: #339933;">===</span> <a href="http://www.php.net/strpos"><span style="color: #990000;">strpos</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$sc_disallowed_after</span><span style="color: #339933;">,</span> <span style="color: #000088;">$part</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$i</span> <span style="color: #339933;">+</span> <span style="color: #000088;">$com_len</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
<a name="line2882"></a>                                <span style="color: #009900;">&#123;</span>
<a name="line2883"></a>                                    <span style="color: #666666; font-style: italic;">// this is a valid comment</span>
<a name="line2884"></a>                                    <span style="color: #000088;">$COMMENT_MATCHED</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">true</span><span style="color: #339933;">;</span>
<a name="line2885"></a>                                    <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">lexic_permissions</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'COMMENTS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$comment_key</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2886"></a>                                        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">use_classes</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2887"></a>                                            <span style="color: #000088;">$attributes</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">' style=&quot;'</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'STYLES'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'COMMENTS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$comment_key</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">'&quot;'</span><span style="color: #339933;">;</span>
<a name="line2888"></a>                                        <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line2889"></a>                                            <span style="color: #000088;">$attributes</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">' class=&quot;co'</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$comment_key</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">'&quot;'</span><span style="color: #339933;">;</span>
<a name="line2890"></a>                                        <span style="color: #009900;">&#125;</span>
<a name="line2891"></a>                                        <span style="color: #000088;">$test_str</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;&lt;span<span style="color: #006699; font-weight: bold;">$attributes</span>&gt;&quot;</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">hsc</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">change_case</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$comment_mark</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line2892"></a>                                    <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line2893"></a>                                        <span style="color: #000088;">$test_str</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">hsc</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$comment_mark</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line2894"></a>                                    <span style="color: #009900;">&#125;</span>
<a name="line2895"></a>&nbsp;
<a name="line2896"></a>                                    <span style="color: #666666; font-style: italic;">//Check if this comment is the last in the source</span>
<a name="line2897"></a>                                    <span style="color: #000088;">$close_pos</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/strpos"><span style="color: #990000;">strpos</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$part</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> <span style="color: #000088;">$i</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line2898"></a>                                    <span style="color: #000088;">$oops</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #339933;">;</span>
<a name="line2899"></a>                                    <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$close_pos</span> <span style="color: #339933;">===</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2900"></a>                                        <span style="color: #000088;">$close_pos</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$length</span><span style="color: #339933;">;</span>
<a name="line2901"></a>                                        <span style="color: #000088;">$oops</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">true</span><span style="color: #339933;">;</span>
<a name="line2902"></a>                                    <span style="color: #009900;">&#125;</span>
<a name="line2903"></a>                                    <span style="color: #000088;">$test_str</span> <span style="color: #339933;">.=</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">hsc</span><span style="color: #009900;">&#40;</span><a href="http://www.php.net/substr"><span style="color: #990000;">substr</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$part</span><span style="color: #339933;">,</span> <span style="color: #000088;">$i</span> <span style="color: #339933;">+</span> <span style="color: #000088;">$com_len</span><span style="color: #339933;">,</span> <span style="color: #000088;">$close_pos</span> <span style="color: #339933;">-</span> <span style="color: #000088;">$i</span> <span style="color: #339933;">-</span> <span style="color: #000088;">$com_len</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line2904"></a>                                    <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">lexic_permissions</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'COMMENTS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$comment_key</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2905"></a>                                        <span style="color: #000088;">$test_str</span> <span style="color: #339933;">.=</span> <span style="color: #0000ff;">&quot;&lt;/span&gt;&quot;</span><span style="color: #339933;">;</span>
<a name="line2906"></a>                                    <span style="color: #009900;">&#125;</span>
<a name="line2907"></a>&nbsp;
<a name="line2908"></a>                                    <span style="color: #666666; font-style: italic;">// Take into account that the comment might be the last in the source</span>
<a name="line2909"></a>                                    <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><span style="color: #000088;">$oops</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2910"></a>                                      <span style="color: #000088;">$test_str</span> <span style="color: #339933;">.=</span> <span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span>
<a name="line2911"></a>                                    <span style="color: #009900;">&#125;</span>
<a name="line2912"></a>&nbsp;
<a name="line2913"></a>                                    <span style="color: #000088;">$i</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$close_pos</span><span style="color: #339933;">;</span>
<a name="line2914"></a>&nbsp;
<a name="line2915"></a>                                    <span style="color: #666666; font-style: italic;">// parse the rest</span>
<a name="line2916"></a>                                    <span style="color: #000088;">$result</span> <span style="color: #339933;">.=</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">parse_non_string_part</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$stuff_to_parse</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line2917"></a>                                    <span style="color: #000088;">$stuff_to_parse</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">''</span><span style="color: #339933;">;</span>
<a name="line2918"></a>                                <span style="color: #009900;">&#125;</span>
<a name="line2919"></a>                            <span style="color: #009900;">&#125;</span>
<a name="line2920"></a>                        <span style="color: #009900;">&#125;</span>
<a name="line2921"></a>                    <span style="color: #009900;">&#125;</span>
<a name="line2922"></a>&nbsp;
<a name="line2923"></a>                    <span style="color: #666666; font-style: italic;">// Where are we adding this char?</span>
<a name="line2924"></a>                    <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><span style="color: #000088;">$COMMENT_MATCHED</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2925"></a>                        <span style="color: #000088;">$stuff_to_parse</span> <span style="color: #339933;">.=</span> <span style="color: #000088;">$char</span><span style="color: #339933;">;</span>
<a name="line2926"></a>                    <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line2927"></a>                        <span style="color: #000088;">$result</span> <span style="color: #339933;">.=</span> <span style="color: #000088;">$test_str</span><span style="color: #339933;">;</span>
<a name="line2928"></a>                        <a href="http://www.php.net/unset"><span style="color: #990000;">unset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$test_str</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line2929"></a>                        <span style="color: #000088;">$COMMENT_MATCHED</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #339933;">;</span>
<a name="line2930"></a>                    <span style="color: #009900;">&#125;</span>
<a name="line2931"></a>                <span style="color: #009900;">&#125;</span>
<a name="line2932"></a>                <span style="color: #666666; font-style: italic;">// Parse the last bit</span>
<a name="line2933"></a>                <span style="color: #000088;">$result</span> <span style="color: #339933;">.=</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">parse_non_string_part</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$stuff_to_parse</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line2934"></a>                <span style="color: #000088;">$stuff_to_parse</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">''</span><span style="color: #339933;">;</span>
<a name="line2935"></a>            <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line2936"></a>                <span style="color: #000088;">$result</span> <span style="color: #339933;">.=</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">hsc</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$part</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line2937"></a>            <span style="color: #009900;">&#125;</span>
<a name="line2938"></a>            <span style="color: #666666; font-style: italic;">// Close the &lt;span&gt; that surrounds the block</span>
<a name="line2939"></a>            <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$STRICTATTRS</span> <span style="color: #339933;">!=</span> <span style="color: #0000ff;">''</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2940"></a>                <span style="color: #000088;">$result</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/str_replace"><span style="color: #990000;">str_replace</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">&quot;&lt;/span&gt;<span style="color: #000099; font-weight: bold;">\n</span>&lt;span<span style="color: #006699; font-weight: bold;">$STRICTATTRS</span>&gt;&quot;</span><span style="color: #339933;">,</span> <span style="color: #000088;">$result</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line2941"></a>                <span style="color: #000088;">$result</span> <span style="color: #339933;">.=</span> <span style="color: #0000ff;">'&lt;/span&gt;'</span><span style="color: #339933;">;</span>
<a name="line2942"></a>            <span style="color: #009900;">&#125;</span>
<a name="line2943"></a>&nbsp;
<a name="line2944"></a>            <span style="color: #000088;">$endresult</span> <span style="color: #339933;">.=</span> <span style="color: #000088;">$result</span><span style="color: #339933;">;</span>
<a name="line2945"></a>            <a href="http://www.php.net/unset"><span style="color: #990000;">unset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$part</span><span style="color: #339933;">,</span> <span style="color: #000088;">$parts</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$key</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> <span style="color: #000088;">$result</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line2946"></a>        <span style="color: #009900;">&#125;</span>
<a name="line2947"></a>&nbsp;
<a name="line2948"></a>        <span style="color: #666666; font-style: italic;">//This fix is related to SF#1923020, but has to be applied regardless of</span>
<a name="line2949"></a>        <span style="color: #666666; font-style: italic;">//actually highlighting symbols.</span>
<a name="line2950"></a>        <span style="color: #009933; font-style: italic;">/** NOTE: memorypeak #3 */</span>
<a name="line2951"></a>        <span style="color: #000088;">$endresult</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/str_replace"><span style="color: #990000;">str_replace</span></a><span style="color: #009900;">&#40;</span><a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'&lt;SEMI&gt;'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'&lt;PIPE&gt;'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">';'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'|'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <span style="color: #000088;">$endresult</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line2952"></a>&nbsp;
<a name="line2953"></a><span style="color: #666666; font-style: italic;">//        // Parse the last stuff (redundant?)</span>
<a name="line2954"></a><span style="color: #666666; font-style: italic;">//        $result .= $this-&gt;parse_non_string_part($stuff_to_parse);</span>
<a name="line2955"></a>&nbsp;
<a name="line2956"></a>        <span style="color: #666666; font-style: italic;">// Lop off the very first and last spaces</span>
<a name="line2957"></a><span style="color: #666666; font-style: italic;">//        $result = substr($result, 1, -1);</span>
<a name="line2958"></a>&nbsp;
<a name="line2959"></a>        <span style="color: #666666; font-style: italic;">// We're finished: stop timing</span>
<a name="line2960"></a>        <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">set_time</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$start_time</span><span style="color: #339933;">,</span> <a href="http://www.php.net/microtime"><span style="color: #990000;">microtime</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line2961"></a>&nbsp;
<a name="line2962"></a>        <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">finalise</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$endresult</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line2963"></a>        <span style="color: #b1b100;">return</span> <span style="color: #000088;">$endresult</span><span style="color: #339933;">;</span>
<a name="line2964"></a>    <span style="color: #009900;">&#125;</span>
<a name="line2965"></a>&nbsp;
<a name="line2966"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line2967"></a>     * Swaps out spaces and tabs for HTML indentation. Not needed if
<a name="line2968"></a>     * the code is in a pre block...
<a name="line2969"></a>     *
<a name="line2970"></a>     * @param  string The source to indent (reference!)
<a name="line2971"></a>     * @since  1.0.0
<a name="line2972"></a>     * @access private
<a name="line2973"></a>     */</span>
<a name="line2974"></a>    <span style="color: #000000; font-weight: bold;">function</span> indent<span style="color: #009900;">&#40;</span><span style="color: #339933;">&amp;</span><span style="color: #000088;">$result</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2975"></a>        <span style="color: #666666; font-style: italic;">/// Replace tabs with the correct number of spaces</span>
<a name="line2976"></a>        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #009900; font-weight: bold;">false</span> <span style="color: #339933;">!==</span> <a href="http://www.php.net/strpos"><span style="color: #990000;">strpos</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$result</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\t</span>&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2977"></a>            <span style="color: #000088;">$lines</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/explode"><span style="color: #990000;">explode</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> <span style="color: #000088;">$result</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line2978"></a>            <span style="color: #000088;">$result</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">null</span><span style="color: #339933;">;</span><span style="color: #666666; font-style: italic;">//Save memory while we process the lines individually</span>
<a name="line2979"></a>            <span style="color: #000088;">$tab_width</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">get_real_tab_width</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line2980"></a>            <span style="color: #000088;">$tab_string</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">'&amp;nbsp;'</span> <span style="color: #339933;">.</span> <a href="http://www.php.net/str_repeat"><span style="color: #990000;">str_repeat</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">' '</span><span style="color: #339933;">,</span> <span style="color: #000088;">$tab_width</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line2981"></a>&nbsp;
<a name="line2982"></a>            <span style="color: #b1b100;">for</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$key</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span> <span style="color: #000088;">$n</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/count"><span style="color: #990000;">count</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$lines</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #000088;">$key</span> <span style="color: #339933;">&lt;</span> <span style="color: #000088;">$n</span><span style="color: #339933;">;</span> <span style="color: #000088;">$key</span><span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2983"></a>                <span style="color: #000088;">$line</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$lines</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$key</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
<a name="line2984"></a>                <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #009900; font-weight: bold;">false</span> <span style="color: #339933;">===</span> <a href="http://www.php.net/strpos"><span style="color: #990000;">strpos</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$line</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\t</span>&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2985"></a>                    <span style="color: #b1b100;">continue</span><span style="color: #339933;">;</span>
<a name="line2986"></a>                <span style="color: #009900;">&#125;</span>
<a name="line2987"></a>&nbsp;
<a name="line2988"></a>                <span style="color: #000088;">$pos</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span>
<a name="line2989"></a>                <span style="color: #000088;">$length</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/strlen"><span style="color: #990000;">strlen</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$line</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line2990"></a>                <span style="color: #000088;">$lines</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$key</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">''</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">// reduce memory</span>
<a name="line2991"></a>&nbsp;
<a name="line2992"></a>                <span style="color: #000088;">$IN_TAG</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #339933;">;</span>
<a name="line2993"></a>                <span style="color: #b1b100;">for</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$i</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span> <span style="color: #000088;">$i</span> <span style="color: #339933;">&lt;</span> <span style="color: #000088;">$length</span><span style="color: #339933;">;</span> <span style="color: #339933;">++</span><span style="color: #000088;">$i</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line2994"></a>                    <span style="color: #000088;">$char</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$line</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$i</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
<a name="line2995"></a>                    <span style="color: #666666; font-style: italic;">// Simple engine to work out whether we're in a tag.</span>
<a name="line2996"></a>                    <span style="color: #666666; font-style: italic;">// If we are we modify $pos. This is so we ignore HTML</span>
<a name="line2997"></a>                    <span style="color: #666666; font-style: italic;">// in the line and only workout the tab replacement</span>
<a name="line2998"></a>                    <span style="color: #666666; font-style: italic;">// via the actual content of the string</span>
<a name="line2999"></a>                    <span style="color: #666666; font-style: italic;">// This test could be improved to include strings in the</span>
<a name="line3000"></a>                    <span style="color: #666666; font-style: italic;">// html so that &lt; or &gt; would be allowed in user's styles</span>
<a name="line3001"></a>                    <span style="color: #666666; font-style: italic;">// (e.g. quotes: '&lt;' '&gt;'; or similar)</span>
<a name="line3002"></a>                    <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$IN_TAG</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3003"></a>                        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'&gt;'</span> <span style="color: #339933;">==</span> <span style="color: #000088;">$char</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3004"></a>                            <span style="color: #000088;">$IN_TAG</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #339933;">;</span>
<a name="line3005"></a>                        <span style="color: #009900;">&#125;</span>
<a name="line3006"></a>                        <span style="color: #000088;">$lines</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$key</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">.=</span> <span style="color: #000088;">$char</span><span style="color: #339933;">;</span>
<a name="line3007"></a>                    <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'&lt;'</span> <span style="color: #339933;">==</span> <span style="color: #000088;">$char</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3008"></a>                        <span style="color: #000088;">$IN_TAG</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">true</span><span style="color: #339933;">;</span>
<a name="line3009"></a>                        <span style="color: #000088;">$lines</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$key</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">.=</span> <span style="color: #0000ff;">'&lt;'</span><span style="color: #339933;">;</span>
<a name="line3010"></a>                    <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'&amp;'</span> <span style="color: #339933;">==</span> <span style="color: #000088;">$char</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3011"></a>                        <span style="color: #000088;">$substr</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/substr"><span style="color: #990000;">substr</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$line</span><span style="color: #339933;">,</span> <span style="color: #000088;">$i</span> <span style="color: #339933;">+</span> <span style="color: #cc66cc;">3</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">5</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line3012"></a>                        <span style="color: #000088;">$posi</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/strpos"><span style="color: #990000;">strpos</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$substr</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">';'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line3013"></a>                        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #009900; font-weight: bold;">false</span> <span style="color: #339933;">===</span> <span style="color: #000088;">$posi</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3014"></a>                            <span style="color: #339933;">++</span><span style="color: #000088;">$pos</span><span style="color: #339933;">;</span>
<a name="line3015"></a>                        <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line3016"></a>                            <span style="color: #000088;">$pos</span> <span style="color: #339933;">-=</span> <span style="color: #000088;">$posi</span><span style="color: #339933;">+</span><span style="color: #cc66cc;">2</span><span style="color: #339933;">;</span>
<a name="line3017"></a>                        <span style="color: #009900;">&#125;</span>
<a name="line3018"></a>                        <span style="color: #000088;">$lines</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$key</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">.=</span> <span style="color: #000088;">$char</span><span style="color: #339933;">;</span>
<a name="line3019"></a>                    <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\t</span>&quot;</span> <span style="color: #339933;">==</span> <span style="color: #000088;">$char</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3020"></a>                        <span style="color: #000088;">$str</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">''</span><span style="color: #339933;">;</span>
<a name="line3021"></a>                        <span style="color: #666666; font-style: italic;">// OPTIMISE - move $strs out. Make an array:</span>
<a name="line3022"></a>                        <span style="color: #666666; font-style: italic;">// $tabs = array(</span>
<a name="line3023"></a>                        <span style="color: #666666; font-style: italic;">//  1 =&gt; '&amp;nbsp;',</span>
<a name="line3024"></a>                        <span style="color: #666666; font-style: italic;">//  2 =&gt; '&amp;nbsp; ',</span>
<a name="line3025"></a>                        <span style="color: #666666; font-style: italic;">//  3 =&gt; '&amp;nbsp; &amp;nbsp;' etc etc</span>
<a name="line3026"></a>                        <span style="color: #666666; font-style: italic;">// to use instead of building a string every time</span>
<a name="line3027"></a>                        <span style="color: #000088;">$tab_end_width</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$tab_width</span> <span style="color: #339933;">-</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$pos</span> <span style="color: #339933;">%</span> <span style="color: #000088;">$tab_width</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">//Moved out of the look as it doesn't change within the loop</span>
<a name="line3028"></a>                        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$pos</span> <span style="color: #339933;">&amp;</span> <span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">||</span> <span style="color: #cc66cc;">1</span> <span style="color: #339933;">==</span> <span style="color: #000088;">$tab_end_width</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3029"></a>                            <span style="color: #000088;">$str</span> <span style="color: #339933;">.=</span> <a href="http://www.php.net/substr"><span style="color: #990000;">substr</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$tab_string</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">6</span><span style="color: #339933;">,</span> <span style="color: #000088;">$tab_end_width</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line3030"></a>                        <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line3031"></a>                            <span style="color: #000088;">$str</span> <span style="color: #339933;">.=</span> <a href="http://www.php.net/substr"><span style="color: #990000;">substr</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$tab_string</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span> <span style="color: #000088;">$tab_end_width</span><span style="color: #339933;">+</span><span style="color: #cc66cc;">5</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line3032"></a>                        <span style="color: #009900;">&#125;</span>
<a name="line3033"></a>                        <span style="color: #000088;">$lines</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$key</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">.=</span> <span style="color: #000088;">$str</span><span style="color: #339933;">;</span>
<a name="line3034"></a>                        <span style="color: #000088;">$pos</span> <span style="color: #339933;">+=</span> <span style="color: #000088;">$tab_end_width</span><span style="color: #339933;">;</span>
<a name="line3035"></a>&nbsp;
<a name="line3036"></a>                        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #009900; font-weight: bold;">false</span> <span style="color: #339933;">===</span> <a href="http://www.php.net/strpos"><span style="color: #990000;">strpos</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$line</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\t</span>&quot;</span><span style="color: #339933;">,</span> <span style="color: #000088;">$i</span> <span style="color: #339933;">+</span> <span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3037"></a>                            <span style="color: #000088;">$lines</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$key</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">.=</span> <a href="http://www.php.net/substr"><span style="color: #990000;">substr</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$line</span><span style="color: #339933;">,</span> <span style="color: #000088;">$i</span> <span style="color: #339933;">+</span> <span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line3038"></a>                            <span style="color: #b1b100;">break</span><span style="color: #339933;">;</span>
<a name="line3039"></a>                        <span style="color: #009900;">&#125;</span>
<a name="line3040"></a>                    <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">0</span> <span style="color: #339933;">==</span> <span style="color: #000088;">$pos</span> <span style="color: #339933;">&amp;&amp;</span> <span style="color: #0000ff;">' '</span> <span style="color: #339933;">==</span> <span style="color: #000088;">$char</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3041"></a>                        <span style="color: #000088;">$lines</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$key</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">.=</span> <span style="color: #0000ff;">'&amp;nbsp;'</span><span style="color: #339933;">;</span>
<a name="line3042"></a>                        <span style="color: #339933;">++</span><span style="color: #000088;">$pos</span><span style="color: #339933;">;</span>
<a name="line3043"></a>                    <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line3044"></a>                        <span style="color: #000088;">$lines</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$key</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">.=</span> <span style="color: #000088;">$char</span><span style="color: #339933;">;</span>
<a name="line3045"></a>                        <span style="color: #339933;">++</span><span style="color: #000088;">$pos</span><span style="color: #339933;">;</span>
<a name="line3046"></a>                    <span style="color: #009900;">&#125;</span>
<a name="line3047"></a>                <span style="color: #009900;">&#125;</span>
<a name="line3048"></a>            <span style="color: #009900;">&#125;</span>
<a name="line3049"></a>            <span style="color: #000088;">$result</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/implode"><span style="color: #990000;">implode</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> <span style="color: #000088;">$lines</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line3050"></a>            <a href="http://www.php.net/unset"><span style="color: #990000;">unset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$lines</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><span style="color: #666666; font-style: italic;">//We don't need the lines separated beyond this --- free them!</span>
<a name="line3051"></a>        <span style="color: #009900;">&#125;</span>
<a name="line3052"></a>        <span style="color: #666666; font-style: italic;">// Other whitespace</span>
<a name="line3053"></a>        <span style="color: #666666; font-style: italic;">// BenBE: Fix to reduce the number of replacements to be done</span>
<a name="line3054"></a>        <span style="color: #000088;">$result</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/preg_replace"><span style="color: #990000;">preg_replace</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'/^ /m'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'&amp;nbsp;'</span><span style="color: #339933;">,</span> <span style="color: #000088;">$result</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line3055"></a>        <span style="color: #000088;">$result</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/str_replace"><span style="color: #990000;">str_replace</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'  '</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">' &amp;nbsp;'</span><span style="color: #339933;">,</span> <span style="color: #000088;">$result</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line3056"></a>&nbsp;
<a name="line3057"></a>        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">line_numbers</span> <span style="color: #339933;">==</span> GESHI_NO_LINE_NUMBERS<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3058"></a>            <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">line_ending</span> <span style="color: #339933;">===</span> <span style="color: #009900; font-weight: bold;">null</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3059"></a>                <span style="color: #000088;">$result</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/nl2br"><span style="color: #990000;">nl2br</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$result</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line3060"></a>            <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line3061"></a>                <span style="color: #000088;">$result</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/str_replace"><span style="color: #990000;">str_replace</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">line_ending</span><span style="color: #339933;">,</span> <span style="color: #000088;">$result</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line3062"></a>            <span style="color: #009900;">&#125;</span>
<a name="line3063"></a>        <span style="color: #009900;">&#125;</span>
<a name="line3064"></a>    <span style="color: #009900;">&#125;</span>
<a name="line3065"></a>&nbsp;
<a name="line3066"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line3067"></a>     * Changes the case of a keyword for those languages where a change is asked for
<a name="line3068"></a>     *
<a name="line3069"></a>     * @param  string The keyword to change the case of
<a name="line3070"></a>     * @return string The keyword with its case changed
<a name="line3071"></a>     * @since  1.0.0
<a name="line3072"></a>     * @access private
<a name="line3073"></a>     */</span>
<a name="line3074"></a>    <span style="color: #000000; font-weight: bold;">function</span> change_case<span style="color: #009900;">&#40;</span><span style="color: #000088;">$instr</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3075"></a>        <span style="color: #b1b100;">switch</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'CASE_KEYWORDS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3076"></a>            <span style="color: #b1b100;">case</span> GESHI_CAPS_UPPER<span style="color: #339933;">:</span>
<a name="line3077"></a>                <span style="color: #b1b100;">return</span> <a href="http://www.php.net/strtoupper"><span style="color: #990000;">strtoupper</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$instr</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line3078"></a>            <span style="color: #b1b100;">case</span> GESHI_CAPS_LOWER<span style="color: #339933;">:</span>
<a name="line3079"></a>                <span style="color: #b1b100;">return</span> <a href="http://www.php.net/strtolower"><span style="color: #990000;">strtolower</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$instr</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line3080"></a>            <span style="color: #b1b100;">default</span><span style="color: #339933;">:</span>
<a name="line3081"></a>                <span style="color: #b1b100;">return</span> <span style="color: #000088;">$instr</span><span style="color: #339933;">;</span>
<a name="line3082"></a>        <span style="color: #009900;">&#125;</span>
<a name="line3083"></a>    <span style="color: #009900;">&#125;</span>
<a name="line3084"></a>&nbsp;
<a name="line3085"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line3086"></a>     * Handles replacements of keywords to include markup and links if requested
<a name="line3087"></a>     *
<a name="line3088"></a>     * @param  string The keyword to add the Markup to
<a name="line3089"></a>     * @return The HTML for the match found
<a name="line3090"></a>     * @since  1.0.8
<a name="line3091"></a>     * @access private
<a name="line3092"></a>     *
<a name="line3093"></a>     * @todo   Get rid of ender in keyword links
<a name="line3094"></a>     */</span>
<a name="line3095"></a>    <span style="color: #000000; font-weight: bold;">function</span> handle_keyword_replace<span style="color: #009900;">&#40;</span><span style="color: #000088;">$match</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3096"></a>        <span style="color: #000088;">$k</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span>_kw_replace_group<span style="color: #339933;">;</span>
<a name="line3097"></a>        <span style="color: #000088;">$keyword</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$match</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
<a name="line3098"></a>&nbsp;
<a name="line3099"></a>        <span style="color: #000088;">$before</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">''</span><span style="color: #339933;">;</span>
<a name="line3100"></a>        <span style="color: #000088;">$after</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">''</span><span style="color: #339933;">;</span>
<a name="line3101"></a>&nbsp;
<a name="line3102"></a>        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">keyword_links</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3103"></a>            <span style="color: #666666; font-style: italic;">// Keyword links have been ebabled</span>
<a name="line3104"></a>&nbsp;
<a name="line3105"></a>            <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><a href="http://www.php.net/isset"><span style="color: #990000;">isset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'URLS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$k</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">&amp;&amp;</span>
<a name="line3106"></a>                <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'URLS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$k</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">!=</span> <span style="color: #0000ff;">''</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3107"></a>                <span style="color: #666666; font-style: italic;">// There is a base group for this keyword</span>
<a name="line3108"></a>&nbsp;
<a name="line3109"></a>                <span style="color: #666666; font-style: italic;">// Old system: strtolower</span>
<a name="line3110"></a>                <span style="color: #666666; font-style: italic;">//$keyword = ( $this-&gt;language_data['CASE_SENSITIVE'][$group] ) ? $keyword : strtolower($keyword);</span>
<a name="line3111"></a>                <span style="color: #666666; font-style: italic;">// New system: get keyword from language file to get correct case</span>
<a name="line3112"></a>                <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'CASE_SENSITIVE'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$k</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">&amp;&amp;</span>
<a name="line3113"></a>                    <a href="http://www.php.net/strpos"><span style="color: #990000;">strpos</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'URLS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$k</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'{FNAME}'</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">!==</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3114"></a>                    <span style="color: #b1b100;">foreach</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'KEYWORDS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$k</span><span style="color: #009900;">&#93;</span> <span style="color: #b1b100;">as</span> <span style="color: #000088;">$word</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3115"></a>                        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><a href="http://www.php.net/strcasecmp"><span style="color: #990000;">strcasecmp</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$word</span><span style="color: #339933;">,</span> <span style="color: #000088;">$keyword</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">==</span> <span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3116"></a>                            <span style="color: #b1b100;">break</span><span style="color: #339933;">;</span>
<a name="line3117"></a>                        <span style="color: #009900;">&#125;</span>
<a name="line3118"></a>                    <span style="color: #009900;">&#125;</span>
<a name="line3119"></a>                <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line3120"></a>                    <span style="color: #000088;">$word</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$keyword</span><span style="color: #339933;">;</span>
<a name="line3121"></a>                <span style="color: #009900;">&#125;</span>
<a name="line3122"></a>&nbsp;
<a name="line3123"></a>                <span style="color: #000088;">$before</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">'&lt;|UR1|&quot;'</span> <span style="color: #339933;">.</span>
<a name="line3124"></a>                    <a href="http://www.php.net/str_replace"><span style="color: #990000;">str_replace</span></a><span style="color: #009900;">&#40;</span>
<a name="line3125"></a>                        <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span>
<a name="line3126"></a>                            <span style="color: #0000ff;">'{FNAME}'</span><span style="color: #339933;">,</span>
<a name="line3127"></a>                            <span style="color: #0000ff;">'{FNAMEL}'</span><span style="color: #339933;">,</span>
<a name="line3128"></a>                            <span style="color: #0000ff;">'{FNAMEU}'</span><span style="color: #339933;">,</span>
<a name="line3129"></a>                            <span style="color: #0000ff;">'.'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span>
<a name="line3130"></a>                        <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span>
<a name="line3131"></a>                            <a href="http://www.php.net/str_replace"><span style="color: #990000;">str_replace</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'+'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'%20'</span><span style="color: #339933;">,</span> <a href="http://www.php.net/urlencode"><span style="color: #990000;">urlencode</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">hsc</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$word</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span>
<a name="line3132"></a>                            <a href="http://www.php.net/str_replace"><span style="color: #990000;">str_replace</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'+'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'%20'</span><span style="color: #339933;">,</span> <a href="http://www.php.net/urlencode"><span style="color: #990000;">urlencode</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">hsc</span><span style="color: #009900;">&#40;</span><a href="http://www.php.net/strtolower"><span style="color: #990000;">strtolower</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$word</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span>
<a name="line3133"></a>                            <a href="http://www.php.net/str_replace"><span style="color: #990000;">str_replace</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'+'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'%20'</span><span style="color: #339933;">,</span> <a href="http://www.php.net/urlencode"><span style="color: #990000;">urlencode</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">hsc</span><span style="color: #009900;">&#40;</span><a href="http://www.php.net/strtoupper"><span style="color: #990000;">strtoupper</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$word</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span>
<a name="line3134"></a>                            <span style="color: #0000ff;">'&lt;DOT&gt;'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span>
<a name="line3135"></a>                        <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'URLS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$k</span><span style="color: #009900;">&#93;</span>
<a name="line3136"></a>                    <span style="color: #009900;">&#41;</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">'&quot;&gt;'</span><span style="color: #339933;">;</span>
<a name="line3137"></a>                <span style="color: #000088;">$after</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">'&lt;/a&gt;'</span><span style="color: #339933;">;</span>
<a name="line3138"></a>            <span style="color: #009900;">&#125;</span>
<a name="line3139"></a>        <span style="color: #009900;">&#125;</span>
<a name="line3140"></a>&nbsp;
<a name="line3141"></a>        <span style="color: #b1b100;">return</span> <span style="color: #000088;">$before</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">'&lt;|/'</span><span style="color: #339933;">.</span> <span style="color: #000088;">$k</span> <span style="color: #339933;">.</span><span style="color: #0000ff;">'/&gt;'</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">change_case</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$keyword</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">'|&gt;'</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$after</span><span style="color: #339933;">;</span>
<a name="line3142"></a>    <span style="color: #009900;">&#125;</span>
<a name="line3143"></a>&nbsp;
<a name="line3144"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line3145"></a>     * handles regular expressions highlighting-definitions with callback functions
<a name="line3146"></a>     *
<a name="line3147"></a>     * @note this is a callback, don't use it directly
<a name="line3148"></a>     *
<a name="line3149"></a>     * @param array the matches array
<a name="line3150"></a>     * @return The highlighted string
<a name="line3151"></a>     * @since 1.0.8
<a name="line3152"></a>     * @access private
<a name="line3153"></a>     */</span>
<a name="line3154"></a>    <span style="color: #000000; font-weight: bold;">function</span> handle_regexps_callback<span style="color: #009900;">&#40;</span><span style="color: #000088;">$matches</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3155"></a>        <span style="color: #666666; font-style: italic;">// before: &quot;' style=\&quot;' . call_user_func(\&quot;$func\&quot;, '\\1') . '\&quot;\\1|&gt;'&quot;,</span>
<a name="line3156"></a>        <span style="color: #b1b100;">return</span>  <span style="color: #0000ff;">' style=&quot;'</span> <span style="color: #339933;">.</span> <a href="http://www.php.net/call_user_func"><span style="color: #990000;">call_user_func</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'STYLES'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'REGEXPS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span>_rx_key<span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> <span style="color: #000088;">$matches</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">'&quot;'</span><span style="color: #339933;">.</span> <span style="color: #000088;">$matches</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">'|&gt;'</span><span style="color: #339933;">;</span>
<a name="line3157"></a>    <span style="color: #009900;">&#125;</span>
<a name="line3158"></a>&nbsp;
<a name="line3159"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line3160"></a>     * handles newlines in REGEXPS matches. Set the _hmr_* vars before calling this
<a name="line3161"></a>     *
<a name="line3162"></a>     * @note this is a callback, don't use it directly
<a name="line3163"></a>     *
<a name="line3164"></a>     * @param array the matches array
<a name="line3165"></a>     * @return string
<a name="line3166"></a>     * @since 1.0.8
<a name="line3167"></a>     * @access private
<a name="line3168"></a>     */</span>
<a name="line3169"></a>    <span style="color: #000000; font-weight: bold;">function</span> handle_multiline_regexps<span style="color: #009900;">&#40;</span><span style="color: #000088;">$matches</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3170"></a>        <span style="color: #000088;">$before</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span>_hmr_before<span style="color: #339933;">;</span>
<a name="line3171"></a>        <span style="color: #000088;">$after</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span>_hmr_after<span style="color: #339933;">;</span>
<a name="line3172"></a>        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span>_hmr_replace<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3173"></a>            <span style="color: #000088;">$replace</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span>_hmr_replace<span style="color: #339933;">;</span>
<a name="line3174"></a>            <span style="color: #000088;">$search</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line3175"></a>&nbsp;
<a name="line3176"></a>            <span style="color: #b1b100;">foreach</span> <span style="color: #009900;">&#40;</span><a href="http://www.php.net/array_keys"><span style="color: #990000;">array_keys</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$matches</span><span style="color: #009900;">&#41;</span> <span style="color: #b1b100;">as</span> <span style="color: #000088;">$k</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3177"></a>                <span style="color: #000088;">$search</span><span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">'\\'</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$k</span><span style="color: #339933;">;</span>
<a name="line3178"></a>            <span style="color: #009900;">&#125;</span>
<a name="line3179"></a>&nbsp;
<a name="line3180"></a>            <span style="color: #000088;">$before</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/str_replace"><span style="color: #990000;">str_replace</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$search</span><span style="color: #339933;">,</span> <span style="color: #000088;">$matches</span><span style="color: #339933;">,</span> <span style="color: #000088;">$before</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line3181"></a>            <span style="color: #000088;">$after</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/str_replace"><span style="color: #990000;">str_replace</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$search</span><span style="color: #339933;">,</span> <span style="color: #000088;">$matches</span><span style="color: #339933;">,</span> <span style="color: #000088;">$after</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line3182"></a>            <span style="color: #000088;">$replace</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/str_replace"><span style="color: #990000;">str_replace</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$search</span><span style="color: #339933;">,</span> <span style="color: #000088;">$matches</span><span style="color: #339933;">,</span> <span style="color: #000088;">$replace</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line3183"></a>        <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line3184"></a>            <span style="color: #000088;">$replace</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$matches</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
<a name="line3185"></a>        <span style="color: #009900;">&#125;</span>
<a name="line3186"></a>        <span style="color: #b1b100;">return</span> <span style="color: #000088;">$before</span>
<a name="line3187"></a>                    <span style="color: #339933;">.</span> <span style="color: #0000ff;">'&lt;|!REG3XP'</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span>_hmr_key <span style="color: #339933;">.</span><span style="color: #0000ff;">'!&gt;'</span>
<a name="line3188"></a>                        <span style="color: #339933;">.</span> <a href="http://www.php.net/str_replace"><span style="color: #990000;">str_replace</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">&quot;|&gt;<span style="color: #000099; font-weight: bold;">\n</span>&lt;|!REG3XP&quot;</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span>_hmr_key <span style="color: #339933;">.</span> <span style="color: #0000ff;">'!&gt;'</span><span style="color: #339933;">,</span> <span style="color: #000088;">$replace</span><span style="color: #009900;">&#41;</span>
<a name="line3189"></a>                    <span style="color: #339933;">.</span> <span style="color: #0000ff;">'|&gt;'</span>
<a name="line3190"></a>              <span style="color: #339933;">.</span> <span style="color: #000088;">$after</span><span style="color: #339933;">;</span>
<a name="line3191"></a>    <span style="color: #009900;">&#125;</span>
<a name="line3192"></a>&nbsp;
<a name="line3193"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line3194"></a>     * Takes a string that has no strings or comments in it, and highlights
<a name="line3195"></a>     * stuff like keywords, numbers and methods.
<a name="line3196"></a>     *
<a name="line3197"></a>     * @param string The string to parse for keyword, numbers etc.
<a name="line3198"></a>     * @since 1.0.0
<a name="line3199"></a>     * @access private
<a name="line3200"></a>     * @todo BUGGY! Why? Why not build string and return?
<a name="line3201"></a>     */</span>
<a name="line3202"></a>    <span style="color: #000000; font-weight: bold;">function</span> parse_non_string_part<span style="color: #009900;">&#40;</span><span style="color: #000088;">$stuff_to_parse</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3203"></a>        <span style="color: #000088;">$stuff_to_parse</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">' '</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">hsc</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$stuff_to_parse</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line3204"></a>&nbsp;
<a name="line3205"></a>        <span style="color: #666666; font-style: italic;">// Regular expressions</span>
<a name="line3206"></a>        <span style="color: #b1b100;">foreach</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'REGEXPS'</span><span style="color: #009900;">&#93;</span> <span style="color: #b1b100;">as</span> <span style="color: #000088;">$key</span> <span style="color: #339933;">=&gt;</span> <span style="color: #000088;">$regexp</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3207"></a>            <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">lexic_permissions</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'REGEXPS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$key</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3208"></a>                <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><a href="http://www.php.net/is_array"><span style="color: #990000;">is_array</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$regexp</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3209"></a>                    <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">line_numbers</span> <span style="color: #339933;">!=</span> GESHI_NO_LINE_NUMBERS<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3210"></a>                        <span style="color: #666666; font-style: italic;">// produce valid HTML when we match multiple lines</span>
<a name="line3211"></a>                        <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span>_hmr_replace <span style="color: #339933;">=</span> <span style="color: #000088;">$regexp</span><span style="color: #009900;">&#91;</span>GESHI_REPLACE<span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
<a name="line3212"></a>                        <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span>_hmr_before <span style="color: #339933;">=</span> <span style="color: #000088;">$regexp</span><span style="color: #009900;">&#91;</span>GESHI_BEFORE<span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
<a name="line3213"></a>                        <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span>_hmr_key <span style="color: #339933;">=</span> <span style="color: #000088;">$key</span><span style="color: #339933;">;</span>
<a name="line3214"></a>                        <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span>_hmr_after <span style="color: #339933;">=</span> <span style="color: #000088;">$regexp</span><span style="color: #009900;">&#91;</span>GESHI_AFTER<span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
<a name="line3215"></a>                        <span style="color: #000088;">$stuff_to_parse</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/preg_replace_callback"><span style="color: #990000;">preg_replace_callback</span></a><span style="color: #009900;">&#40;</span>
<a name="line3216"></a>                            <span style="color: #0000ff;">&quot;/&quot;</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$regexp</span><span style="color: #009900;">&#91;</span>GESHI_SEARCH<span style="color: #009900;">&#93;</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">&quot;/<span style="color: #006699; font-weight: bold;">{$regexp[GESHI_MODIFIERS]}</span>&quot;</span><span style="color: #339933;">,</span>
<a name="line3217"></a>                            <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'handle_multiline_regexps'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span>
<a name="line3218"></a>                            <span style="color: #000088;">$stuff_to_parse</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line3219"></a>                        <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span>_hmr_replace <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #339933;">;</span>
<a name="line3220"></a>                        <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span>_hmr_before <span style="color: #339933;">=</span> <span style="color: #0000ff;">''</span><span style="color: #339933;">;</span>
<a name="line3221"></a>                        <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span>_hmr_after <span style="color: #339933;">=</span> <span style="color: #0000ff;">''</span><span style="color: #339933;">;</span>
<a name="line3222"></a>                    <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line3223"></a>                        <span style="color: #000088;">$stuff_to_parse</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/preg_replace"><span style="color: #990000;">preg_replace</span></a><span style="color: #009900;">&#40;</span>
<a name="line3224"></a>                            <span style="color: #0000ff;">'/'</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$regexp</span><span style="color: #009900;">&#91;</span>GESHI_SEARCH<span style="color: #009900;">&#93;</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">'/'</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$regexp</span><span style="color: #009900;">&#91;</span>GESHI_MODIFIERS<span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span>
<a name="line3225"></a>                            <span style="color: #000088;">$regexp</span><span style="color: #009900;">&#91;</span>GESHI_BEFORE<span style="color: #009900;">&#93;</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">'&lt;|!REG3XP'</span><span style="color: #339933;">.</span> <span style="color: #000088;">$key</span> <span style="color: #339933;">.</span><span style="color: #0000ff;">'!&gt;'</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$regexp</span><span style="color: #009900;">&#91;</span>GESHI_REPLACE<span style="color: #009900;">&#93;</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">'|&gt;'</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$regexp</span><span style="color: #009900;">&#91;</span>GESHI_AFTER<span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span>
<a name="line3226"></a>                            <span style="color: #000088;">$stuff_to_parse</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line3227"></a>                    <span style="color: #009900;">&#125;</span>
<a name="line3228"></a>                <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line3229"></a>                    <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">line_numbers</span> <span style="color: #339933;">!=</span> GESHI_NO_LINE_NUMBERS<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3230"></a>                        <span style="color: #666666; font-style: italic;">// produce valid HTML when we match multiple lines</span>
<a name="line3231"></a>                        <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span>_hmr_key <span style="color: #339933;">=</span> <span style="color: #000088;">$key</span><span style="color: #339933;">;</span>
<a name="line3232"></a>                        <span style="color: #000088;">$stuff_to_parse</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/preg_replace_callback"><span style="color: #990000;">preg_replace_callback</span></a><span style="color: #009900;">&#40;</span> <span style="color: #0000ff;">&quot;/(&quot;</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$regexp</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">&quot;)/&quot;</span><span style="color: #339933;">,</span>
<a name="line3233"></a>                                              <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'handle_multiline_regexps'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <span style="color: #000088;">$stuff_to_parse</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line3234"></a>                        <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span>_hmr_key <span style="color: #339933;">=</span> <span style="color: #0000ff;">''</span><span style="color: #339933;">;</span>
<a name="line3235"></a>                    <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line3236"></a>                        <span style="color: #000088;">$stuff_to_parse</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/preg_replace"><span style="color: #990000;">preg_replace</span></a><span style="color: #009900;">&#40;</span> <span style="color: #0000ff;">&quot;/(&quot;</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$regexp</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">&quot;)/&quot;</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">&quot;&lt;|!REG3XP<span style="color: #006699; font-weight: bold;">$key</span>!&gt;<span style="color: #000099; font-weight: bold;">\\</span>1|&gt;&quot;</span><span style="color: #339933;">,</span> <span style="color: #000088;">$stuff_to_parse</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line3237"></a>                    <span style="color: #009900;">&#125;</span>
<a name="line3238"></a>                <span style="color: #009900;">&#125;</span>
<a name="line3239"></a>            <span style="color: #009900;">&#125;</span>
<a name="line3240"></a>        <span style="color: #009900;">&#125;</span>
<a name="line3241"></a>&nbsp;
<a name="line3242"></a>        <span style="color: #666666; font-style: italic;">// Highlight numbers. As of 1.0.8 we support diffent types of numbers</span>
<a name="line3243"></a>        <span style="color: #000088;">$numbers_found</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #339933;">;</span>
<a name="line3244"></a>        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">lexic_permissions</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'NUMBERS'</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">&amp;&amp;</span> <a href="http://www.php.net/preg_match"><span style="color: #990000;">preg_match</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'#\d#'</span><span style="color: #339933;">,</span> <span style="color: #000088;">$stuff_to_parse</span> <span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3245"></a>            <span style="color: #000088;">$numbers_found</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">true</span><span style="color: #339933;">;</span>
<a name="line3246"></a>&nbsp;
<a name="line3247"></a>            <span style="color: #666666; font-style: italic;">//For each of the formats ...</span>
<a name="line3248"></a>            <span style="color: #b1b100;">foreach</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'NUMBERS_RXCACHE'</span><span style="color: #009900;">&#93;</span> <span style="color: #b1b100;">as</span> <span style="color: #000088;">$id</span> <span style="color: #339933;">=&gt;</span> <span style="color: #000088;">$regexp</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3249"></a>                <span style="color: #666666; font-style: italic;">//Check if it should be highlighted ...</span>
<a name="line3250"></a>                <span style="color: #000088;">$stuff_to_parse</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/preg_replace"><span style="color: #990000;">preg_replace</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$regexp</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">&quot;&lt;|/NUM!<span style="color: #006699; font-weight: bold;">$id</span>/&gt;<span style="color: #000099; font-weight: bold;">\\</span>1|&gt;&quot;</span><span style="color: #339933;">,</span> <span style="color: #000088;">$stuff_to_parse</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line3251"></a>            <span style="color: #009900;">&#125;</span>
<a name="line3252"></a>        <span style="color: #009900;">&#125;</span>
<a name="line3253"></a>&nbsp;
<a name="line3254"></a>        <span style="color: #666666; font-style: italic;">// Highlight keywords</span>
<a name="line3255"></a>        <span style="color: #000088;">$disallowed_before</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;(?&lt;![a-zA-Z0-9<span style="color: #000099; font-weight: bold;">\$</span>_\|\#;&gt;|^&amp;&quot;</span><span style="color: #339933;">;</span>
<a name="line3256"></a>        <span style="color: #000088;">$disallowed_after</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;(?![a-zA-Z0-9_\|%<span style="color: #000099; font-weight: bold;">\\</span>-&amp;;&quot;</span><span style="color: #339933;">;</span>
<a name="line3257"></a>        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">lexic_permissions</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'STRINGS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3258"></a>            <span style="color: #000088;">$quotemarks</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/preg_quote"><span style="color: #990000;">preg_quote</span></a><span style="color: #009900;">&#40;</span><a href="http://www.php.net/implode"><span style="color: #990000;">implode</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'QUOTEMARKS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'/'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line3259"></a>            <span style="color: #000088;">$disallowed_before</span> <span style="color: #339933;">.=</span> <span style="color: #000088;">$quotemarks</span><span style="color: #339933;">;</span>
<a name="line3260"></a>            <span style="color: #000088;">$disallowed_after</span> <span style="color: #339933;">.=</span> <span style="color: #000088;">$quotemarks</span><span style="color: #339933;">;</span>
<a name="line3261"></a>        <span style="color: #009900;">&#125;</span>
<a name="line3262"></a>        <span style="color: #000088;">$disallowed_before</span> <span style="color: #339933;">.=</span> <span style="color: #0000ff;">&quot;])&quot;</span><span style="color: #339933;">;</span>
<a name="line3263"></a>        <span style="color: #000088;">$disallowed_after</span> <span style="color: #339933;">.=</span> <span style="color: #0000ff;">&quot;])&quot;</span><span style="color: #339933;">;</span>
<a name="line3264"></a>&nbsp;
<a name="line3265"></a>        <span style="color: #000088;">$parser_control_pergroup</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #339933;">;</span>
<a name="line3266"></a>        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><a href="http://www.php.net/isset"><span style="color: #990000;">isset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'PARSER_CONTROL'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3267"></a>            <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><a href="http://www.php.net/isset"><span style="color: #990000;">isset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'PARSER_CONTROL'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'KEYWORDS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3268"></a>                <span style="color: #000088;">$x</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">// check wether per-keyword-group parser_control is enabled</span>
<a name="line3269"></a>                <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><a href="http://www.php.net/isset"><span style="color: #990000;">isset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'PARSER_CONTROL'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'KEYWORDS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'DISALLOWED_BEFORE'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3270"></a>                    <span style="color: #000088;">$disallowed_before</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'PARSER_CONTROL'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'KEYWORDS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'DISALLOWED_BEFORE'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
<a name="line3271"></a>                    <span style="color: #339933;">++</span><span style="color: #000088;">$x</span><span style="color: #339933;">;</span>
<a name="line3272"></a>                <span style="color: #009900;">&#125;</span>
<a name="line3273"></a>                <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><a href="http://www.php.net/isset"><span style="color: #990000;">isset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'PARSER_CONTROL'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'KEYWORDS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'DISALLOWED_AFTER'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3274"></a>                    <span style="color: #000088;">$disallowed_after</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'PARSER_CONTROL'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'KEYWORDS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'DISALLOWED_AFTER'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
<a name="line3275"></a>                    <span style="color: #339933;">++</span><span style="color: #000088;">$x</span><span style="color: #339933;">;</span>
<a name="line3276"></a>                <span style="color: #009900;">&#125;</span>
<a name="line3277"></a>                <span style="color: #000088;">$parser_control_pergroup</span> <span style="color: #339933;">=</span> <span style="color: #009900;">&#40;</span><a href="http://www.php.net/count"><span style="color: #990000;">count</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'PARSER_CONTROL'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'KEYWORDS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">-</span> <span style="color: #000088;">$x</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">&gt;</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span>
<a name="line3278"></a>            <span style="color: #009900;">&#125;</span>
<a name="line3279"></a>        <span style="color: #009900;">&#125;</span>
<a name="line3280"></a>&nbsp;
<a name="line3281"></a>        <span style="color: #666666; font-style: italic;">// if this is changed, don't forget to change it below</span>
<a name="line3282"></a><span style="color: #666666; font-style: italic;">//        if (!empty($disallowed_before)) {</span>
<a name="line3283"></a><span style="color: #666666; font-style: italic;">//            $disallowed_before = &quot;(?&lt;![$disallowed_before])&quot;;</span>
<a name="line3284"></a><span style="color: #666666; font-style: italic;">//        }</span>
<a name="line3285"></a><span style="color: #666666; font-style: italic;">//        if (!empty($disallowed_after)) {</span>
<a name="line3286"></a><span style="color: #666666; font-style: italic;">//            $disallowed_after = &quot;(?![$disallowed_after])&quot;;</span>
<a name="line3287"></a><span style="color: #666666; font-style: italic;">//        }</span>
<a name="line3288"></a>&nbsp;
<a name="line3289"></a>        <span style="color: #b1b100;">foreach</span> <span style="color: #009900;">&#40;</span><a href="http://www.php.net/array_keys"><span style="color: #990000;">array_keys</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'KEYWORDS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span> <span style="color: #b1b100;">as</span> <span style="color: #000088;">$k</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3290"></a>            <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><a href="http://www.php.net/isset"><span style="color: #990000;">isset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">lexic_permissions</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'KEYWORDS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$k</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">||</span>
<a name="line3291"></a>                <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">lexic_permissions</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'KEYWORDS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$k</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3292"></a>&nbsp;
<a name="line3293"></a>                <span style="color: #000088;">$case_sensitive</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'CASE_SENSITIVE'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$k</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
<a name="line3294"></a>                <span style="color: #000088;">$modifiers</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$case_sensitive</span> ? <span style="color: #0000ff;">''</span> <span style="color: #339933;">:</span> <span style="color: #0000ff;">'i'</span><span style="color: #339933;">;</span>
<a name="line3295"></a>&nbsp;
<a name="line3296"></a>                <span style="color: #666666; font-style: italic;">// NEW in 1.0.8 - per-keyword-group parser control</span>
<a name="line3297"></a>                <span style="color: #000088;">$disallowed_before_local</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$disallowed_before</span><span style="color: #339933;">;</span>
<a name="line3298"></a>                <span style="color: #000088;">$disallowed_after_local</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$disallowed_after</span><span style="color: #339933;">;</span>
<a name="line3299"></a>                <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$parser_control_pergroup</span> <span style="color: #339933;">&amp;&amp;</span> <a href="http://www.php.net/isset"><span style="color: #990000;">isset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'PARSER_CONTROL'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'KEYWORDS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$k</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3300"></a>                    <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><a href="http://www.php.net/isset"><span style="color: #990000;">isset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'PARSER_CONTROL'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'KEYWORDS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$k</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'DISALLOWED_BEFORE'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3301"></a>                        <span style="color: #000088;">$disallowed_before_local</span> <span style="color: #339933;">=</span>
<a name="line3302"></a>                            <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'PARSER_CONTROL'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'KEYWORDS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$k</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'DISALLOWED_BEFORE'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
<a name="line3303"></a>                    <span style="color: #009900;">&#125;</span>
<a name="line3304"></a>&nbsp;
<a name="line3305"></a>                    <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><a href="http://www.php.net/isset"><span style="color: #990000;">isset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'PARSER_CONTROL'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'KEYWORDS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$k</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'DISALLOWED_AFTER'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3306"></a>                        <span style="color: #000088;">$disallowed_after_local</span> <span style="color: #339933;">=</span>
<a name="line3307"></a>                            <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'PARSER_CONTROL'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'KEYWORDS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$k</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'DISALLOWED_AFTER'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
<a name="line3308"></a>                    <span style="color: #009900;">&#125;</span>
<a name="line3309"></a>                <span style="color: #009900;">&#125;</span>
<a name="line3310"></a>&nbsp;
<a name="line3311"></a>                <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span>_kw_replace_group <span style="color: #339933;">=</span> <span style="color: #000088;">$k</span><span style="color: #339933;">;</span>
<a name="line3312"></a>&nbsp;
<a name="line3313"></a>                <span style="color: #666666; font-style: italic;">//NEW in 1.0.8, the cached regexp list</span>
<a name="line3314"></a>                <span style="color: #666666; font-style: italic;">// since we don't want PHP / PCRE to crash due to too large patterns we split them into smaller chunks</span>
<a name="line3315"></a>                <span style="color: #b1b100;">for</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$set</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span> <span style="color: #000088;">$set_length</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/count"><span style="color: #990000;">count</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'CACHED_KEYWORD_LISTS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$k</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #000088;">$set</span> <span style="color: #339933;">&lt;</span>  <span style="color: #000088;">$set_length</span><span style="color: #339933;">;</span> <span style="color: #339933;">++</span><span style="color: #000088;">$set</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3316"></a>                    <span style="color: #000088;">$keywordset</span> <span style="color: #339933;">=&amp;</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'CACHED_KEYWORD_LISTS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$k</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$set</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
<a name="line3317"></a>                    <span style="color: #666666; font-style: italic;">// Might make a more unique string for putting the number in soon</span>
<a name="line3318"></a>                    <span style="color: #666666; font-style: italic;">// Basically, we don't put the styles in yet because then the styles themselves will</span>
<a name="line3319"></a>                    <span style="color: #666666; font-style: italic;">// get highlighted if the language has a CSS keyword in it (like CSS, for example ;))</span>
<a name="line3320"></a>                    <span style="color: #000088;">$stuff_to_parse</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/preg_replace_callback"><span style="color: #990000;">preg_replace_callback</span></a><span style="color: #009900;">&#40;</span>
<a name="line3321"></a>                        <span style="color: #0000ff;">&quot;/<span style="color: #006699; font-weight: bold;">$disallowed_before_local</span>(<span style="color: #006699; font-weight: bold;">{$keywordset}</span>)(?!\&lt;DOT\&gt;(?:htm|php))<span style="color: #006699; font-weight: bold;">$disallowed_after_local</span>/<span style="color: #006699; font-weight: bold;">$modifiers</span>&quot;</span><span style="color: #339933;">,</span>
<a name="line3322"></a>                        <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'handle_keyword_replace'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span>
<a name="line3323"></a>                        <span style="color: #000088;">$stuff_to_parse</span>
<a name="line3324"></a>                        <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line3325"></a>                <span style="color: #009900;">&#125;</span>
<a name="line3326"></a>            <span style="color: #009900;">&#125;</span>
<a name="line3327"></a>        <span style="color: #009900;">&#125;</span>
<a name="line3328"></a>&nbsp;
<a name="line3329"></a>        <span style="color: #666666; font-style: italic;">//</span>
<a name="line3330"></a>        <span style="color: #666666; font-style: italic;">// Now that's all done, replace /[number]/ with the correct styles</span>
<a name="line3331"></a>        <span style="color: #666666; font-style: italic;">//</span>
<a name="line3332"></a>        <span style="color: #b1b100;">foreach</span> <span style="color: #009900;">&#40;</span><a href="http://www.php.net/array_keys"><span style="color: #990000;">array_keys</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'KEYWORDS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span> <span style="color: #b1b100;">as</span> <span style="color: #000088;">$k</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3333"></a>            <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">use_classes</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3334"></a>                <span style="color: #000088;">$attributes</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">' style=&quot;'</span> <span style="color: #339933;">.</span>
<a name="line3335"></a>                    <span style="color: #009900;">&#40;</span><a href="http://www.php.net/isset"><span style="color: #990000;">isset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'STYLES'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'KEYWORDS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$k</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span> ?
<a name="line3336"></a>                    <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'STYLES'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'KEYWORDS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$k</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">:</span> <span style="color: #0000ff;">&quot;&quot;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">'&quot;'</span><span style="color: #339933;">;</span>
<a name="line3337"></a>            <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line3338"></a>                <span style="color: #000088;">$attributes</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">' class=&quot;kw'</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$k</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">'&quot;'</span><span style="color: #339933;">;</span>
<a name="line3339"></a>            <span style="color: #009900;">&#125;</span>
<a name="line3340"></a>            <span style="color: #000088;">$stuff_to_parse</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/str_replace"><span style="color: #990000;">str_replace</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;&lt;|/<span style="color: #006699; font-weight: bold;">$k</span>/&gt;&quot;</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">&quot;&lt;|<span style="color: #006699; font-weight: bold;">$attributes</span>&gt;&quot;</span><span style="color: #339933;">,</span> <span style="color: #000088;">$stuff_to_parse</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line3341"></a>        <span style="color: #009900;">&#125;</span>
<a name="line3342"></a>&nbsp;
<a name="line3343"></a>        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$numbers_found</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3344"></a>            <span style="color: #666666; font-style: italic;">// Put number styles in</span>
<a name="line3345"></a>            <span style="color: #b1b100;">foreach</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'NUMBERS_RXCACHE'</span><span style="color: #009900;">&#93;</span> <span style="color: #b1b100;">as</span> <span style="color: #000088;">$id</span> <span style="color: #339933;">=&gt;</span> <span style="color: #000088;">$regexp</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3346"></a><span style="color: #666666; font-style: italic;">//Commented out for now, as this needs some review ...</span>
<a name="line3347"></a><span style="color: #666666; font-style: italic;">//                if ($numbers_permissions &amp; $id) {</span>
<a name="line3348"></a>                    <span style="color: #666666; font-style: italic;">//Get the appropriate style ...</span>
<a name="line3349"></a>                        <span style="color: #666666; font-style: italic;">//Checking for unset styles is done by the style cache builder ...</span>
<a name="line3350"></a>                    <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">use_classes</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3351"></a>                        <span style="color: #000088;">$attributes</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">' style=&quot;'</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'STYLES'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'NUMBERS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$id</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">'&quot;'</span><span style="color: #339933;">;</span>
<a name="line3352"></a>                    <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line3353"></a>                        <span style="color: #000088;">$attributes</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">' class=&quot;nu'</span><span style="color: #339933;">.</span><span style="color: #000088;">$id</span><span style="color: #339933;">.</span><span style="color: #0000ff;">'&quot;'</span><span style="color: #339933;">;</span>
<a name="line3354"></a>                    <span style="color: #009900;">&#125;</span>
<a name="line3355"></a>&nbsp;
<a name="line3356"></a>                    <span style="color: #666666; font-style: italic;">//Set in the correct styles ...</span>
<a name="line3357"></a>                    <span style="color: #000088;">$stuff_to_parse</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/str_replace"><span style="color: #990000;">str_replace</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;/NUM!<span style="color: #006699; font-weight: bold;">$id</span>/&quot;</span><span style="color: #339933;">,</span> <span style="color: #000088;">$attributes</span><span style="color: #339933;">,</span> <span style="color: #000088;">$stuff_to_parse</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line3358"></a><span style="color: #666666; font-style: italic;">//                }</span>
<a name="line3359"></a>            <span style="color: #009900;">&#125;</span>
<a name="line3360"></a>        <span style="color: #009900;">&#125;</span>
<a name="line3361"></a>&nbsp;
<a name="line3362"></a>        <span style="color: #666666; font-style: italic;">// Highlight methods and fields in objects</span>
<a name="line3363"></a>        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">lexic_permissions</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'METHODS'</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">&amp;&amp;</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'OOLANG'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3364"></a>            <span style="color: #000088;">$oolang_spaces</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;[\s]*&quot;</span><span style="color: #339933;">;</span>
<a name="line3365"></a>            <span style="color: #000088;">$oolang_before</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;&quot;</span><span style="color: #339933;">;</span>
<a name="line3366"></a>            <span style="color: #000088;">$oolang_after</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;[a-zA-Z][a-zA-Z0-9_]*&quot;</span><span style="color: #339933;">;</span>
<a name="line3367"></a>            <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><a href="http://www.php.net/isset"><span style="color: #990000;">isset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'PARSER_CONTROL'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3368"></a>                <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><a href="http://www.php.net/isset"><span style="color: #990000;">isset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'PARSER_CONTROL'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'OOLANG'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3369"></a>                    <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><a href="http://www.php.net/isset"><span style="color: #990000;">isset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'PARSER_CONTROL'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'OOLANG'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'MATCH_BEFORE'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3370"></a>                        <span style="color: #000088;">$oolang_before</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'PARSER_CONTROL'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'OOLANG'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'MATCH_BEFORE'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
<a name="line3371"></a>                    <span style="color: #009900;">&#125;</span>
<a name="line3372"></a>                    <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><a href="http://www.php.net/isset"><span style="color: #990000;">isset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'PARSER_CONTROL'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'OOLANG'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'MATCH_AFTER'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3373"></a>                        <span style="color: #000088;">$oolang_after</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'PARSER_CONTROL'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'OOLANG'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'MATCH_AFTER'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
<a name="line3374"></a>                    <span style="color: #009900;">&#125;</span>
<a name="line3375"></a>                    <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><a href="http://www.php.net/isset"><span style="color: #990000;">isset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'PARSER_CONTROL'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'OOLANG'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'MATCH_SPACES'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3376"></a>                        <span style="color: #000088;">$oolang_spaces</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'PARSER_CONTROL'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'OOLANG'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'MATCH_SPACES'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
<a name="line3377"></a>                    <span style="color: #009900;">&#125;</span>
<a name="line3378"></a>                <span style="color: #009900;">&#125;</span>
<a name="line3379"></a>            <span style="color: #009900;">&#125;</span>
<a name="line3380"></a>&nbsp;
<a name="line3381"></a>            <span style="color: #b1b100;">foreach</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'OBJECT_SPLITTERS'</span><span style="color: #009900;">&#93;</span> <span style="color: #b1b100;">as</span> <span style="color: #000088;">$key</span> <span style="color: #339933;">=&gt;</span> <span style="color: #000088;">$splitter</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3382"></a>                <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #009900; font-weight: bold;">false</span> <span style="color: #339933;">!==</span> <a href="http://www.php.net/strpos"><span style="color: #990000;">strpos</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$stuff_to_parse</span><span style="color: #339933;">,</span> <span style="color: #000088;">$splitter</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3383"></a>                    <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">use_classes</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3384"></a>                        <span style="color: #000088;">$attributes</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">' style=&quot;'</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'STYLES'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'METHODS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$key</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">'&quot;'</span><span style="color: #339933;">;</span>
<a name="line3385"></a>                    <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line3386"></a>                        <span style="color: #000088;">$attributes</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">' class=&quot;me'</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$key</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">'&quot;'</span><span style="color: #339933;">;</span>
<a name="line3387"></a>                    <span style="color: #009900;">&#125;</span>
<a name="line3388"></a>                    <span style="color: #000088;">$stuff_to_parse</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/preg_replace"><span style="color: #990000;">preg_replace</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;/(<span style="color: #006699; font-weight: bold;">$oolang_before</span>)(&quot;</span> <span style="color: #339933;">.</span> <a href="http://www.php.net/preg_quote"><span style="color: #990000;">preg_quote</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'OBJECT_SPLITTERS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$key</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'/'</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">&quot;)(<span style="color: #006699; font-weight: bold;">$oolang_spaces</span>)(<span style="color: #006699; font-weight: bold;">$oolang_after</span>)/&quot;</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\\</span>1<span style="color: #000099; font-weight: bold;">\\</span>2<span style="color: #000099; font-weight: bold;">\\</span>3&lt;|<span style="color: #006699; font-weight: bold;">$attributes</span>&gt;<span style="color: #000099; font-weight: bold;">\\</span>4|&gt;&quot;</span><span style="color: #339933;">,</span> <span style="color: #000088;">$stuff_to_parse</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line3389"></a>                <span style="color: #009900;">&#125;</span>
<a name="line3390"></a>            <span style="color: #009900;">&#125;</span>
<a name="line3391"></a>        <span style="color: #009900;">&#125;</span>
<a name="line3392"></a>&nbsp;
<a name="line3393"></a>        <span style="color: #666666; font-style: italic;">//</span>
<a name="line3394"></a>        <span style="color: #666666; font-style: italic;">// Highlight brackets. Yes, I've tried adding a semi-colon to this list.</span>
<a name="line3395"></a>        <span style="color: #666666; font-style: italic;">// You try it, and see what happens ;)</span>
<a name="line3396"></a>        <span style="color: #666666; font-style: italic;">// TODO: Fix lexic permissions not converting entities if shouldn't</span>
<a name="line3397"></a>        <span style="color: #666666; font-style: italic;">// be highlighting regardless</span>
<a name="line3398"></a>        <span style="color: #666666; font-style: italic;">//</span>
<a name="line3399"></a>        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">lexic_permissions</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'BRACKETS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3400"></a>            <span style="color: #000088;">$stuff_to_parse</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/str_replace"><span style="color: #990000;">str_replace</span></a><span style="color: #009900;">&#40;</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'CACHE_BRACKET_MATCH'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span>
<a name="line3401"></a>                              <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'CACHE_BRACKET_REPLACE'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> <span style="color: #000088;">$stuff_to_parse</span> <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line3402"></a>        <span style="color: #009900;">&#125;</span>
<a name="line3403"></a>&nbsp;
<a name="line3404"></a>&nbsp;
<a name="line3405"></a>        <span style="color: #666666; font-style: italic;">//FIX for symbol highlighting ...</span>
<a name="line3406"></a>        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">lexic_permissions</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'SYMBOLS'</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">&amp;&amp;</span> <span style="color: #339933;">!</span><a href="http://www.php.net/empty"><span style="color: #990000;">empty</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'SYMBOLS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3407"></a>            <span style="color: #666666; font-style: italic;">//Get all matches and throw away those witin a block that is already highlighted... (i.e. matched by a regexp)</span>
<a name="line3408"></a>            <span style="color: #000088;">$n_symbols</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/preg_match_all"><span style="color: #990000;">preg_match_all</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;/&lt;\|(?:&lt;DOT&gt;|[^&gt;])+&gt;(?:(?!\|&gt;).*?)\|&gt;|&lt;\/a&gt;|(?:&quot;</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'SYMBOL_SEARCH'</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">&quot;)+/&quot;</span><span style="color: #339933;">,</span> <span style="color: #000088;">$stuff_to_parse</span><span style="color: #339933;">,</span> <span style="color: #000088;">$pot_symbols</span><span style="color: #339933;">,</span> PREG_OFFSET_CAPTURE <span style="color: #339933;">|</span> PREG_SET_ORDER<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line3409"></a>            <span style="color: #000088;">$global_offset</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span>
<a name="line3410"></a>            <span style="color: #b1b100;">for</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$s_id</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span> <span style="color: #000088;">$s_id</span> <span style="color: #339933;">&lt;</span> <span style="color: #000088;">$n_symbols</span><span style="color: #339933;">;</span> <span style="color: #339933;">++</span><span style="color: #000088;">$s_id</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3411"></a>                <span style="color: #000088;">$symbol_match</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$pot_symbols</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$s_id</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
<a name="line3412"></a>                <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><a href="http://www.php.net/strpos"><span style="color: #990000;">strpos</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$symbol_match</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'&lt;'</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">!==</span> <span style="color: #009900; font-weight: bold;">false</span> <span style="color: #339933;">||</span> <a href="http://www.php.net/strpos"><span style="color: #990000;">strpos</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$symbol_match</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'&gt;'</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">!==</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3413"></a>                    <span style="color: #666666; font-style: italic;">// already highlighted blocks _must_ include either &lt; or &gt;</span>
<a name="line3414"></a>                    <span style="color: #666666; font-style: italic;">// so if this conditional applies, we have to skip this match</span>
<a name="line3415"></a>                    <span style="color: #666666; font-style: italic;">// BenBE: UNLESS the block contains &lt;SEMI&gt; or &lt;PIPE&gt;</span>
<a name="line3416"></a>                    <span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><a href="http://www.php.net/strpos"><span style="color: #990000;">strpos</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$symbol_match</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'&lt;SEMI&gt;'</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">===</span> <span style="color: #009900; font-weight: bold;">false</span> <span style="color: #339933;">&amp;&amp;</span>
<a name="line3417"></a>                        <a href="http://www.php.net/strpos"><span style="color: #990000;">strpos</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$symbol_match</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'&lt;PIPE&gt;'</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">===</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3418"></a>                        <span style="color: #b1b100;">continue</span><span style="color: #339933;">;</span>
<a name="line3419"></a>                    <span style="color: #009900;">&#125;</span>
<a name="line3420"></a>                <span style="color: #009900;">&#125;</span>
<a name="line3421"></a>&nbsp;
<a name="line3422"></a>                <span style="color: #666666; font-style: italic;">// if we reach this point, we have a valid match which needs to be highlighted</span>
<a name="line3423"></a>&nbsp;
<a name="line3424"></a>                <span style="color: #000088;">$symbol_length</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/strlen"><span style="color: #990000;">strlen</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$symbol_match</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line3425"></a>                <span style="color: #000088;">$symbol_offset</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$pot_symbols</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$s_id</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
<a name="line3426"></a>                <a href="http://www.php.net/unset"><span style="color: #990000;">unset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$pot_symbols</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$s_id</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line3427"></a>                <span style="color: #000088;">$symbol_end</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$symbol_length</span> <span style="color: #339933;">+</span> <span style="color: #000088;">$symbol_offset</span><span style="color: #339933;">;</span>
<a name="line3428"></a>                <span style="color: #000088;">$symbol_hl</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;&quot;</span><span style="color: #339933;">;</span>
<a name="line3429"></a>&nbsp;
<a name="line3430"></a>                <span style="color: #666666; font-style: italic;">// if we have multiple styles, we have to handle them properly</span>
<a name="line3431"></a>                <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'MULTIPLE_SYMBOL_GROUPS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3432"></a>                    <span style="color: #000088;">$old_sym</span> <span style="color: #339933;">=</span> <span style="color: #339933;">-</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">;</span>
<a name="line3433"></a>                    <span style="color: #666666; font-style: italic;">// Split the current stuff to replace into its atomic symbols ...</span>
<a name="line3434"></a>                    <a href="http://www.php.net/preg_match_all"><span style="color: #990000;">preg_match_all</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;/&quot;</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'SYMBOL_SEARCH'</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">&quot;/&quot;</span><span style="color: #339933;">,</span> <span style="color: #000088;">$symbol_match</span><span style="color: #339933;">,</span> <span style="color: #000088;">$sym_match_syms</span><span style="color: #339933;">,</span> PREG_PATTERN_ORDER<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line3435"></a>                    <span style="color: #b1b100;">foreach</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$sym_match_syms</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#93;</span> <span style="color: #b1b100;">as</span> <span style="color: #000088;">$sym_ms</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3436"></a>                        <span style="color: #666666; font-style: italic;">//Check if consequtive symbols belong to the same group to save output ...</span>
<a name="line3437"></a>                        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><a href="http://www.php.net/isset"><span style="color: #990000;">isset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'SYMBOL_DATA'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$sym_ms</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span>
<a name="line3438"></a>                            <span style="color: #339933;">&amp;&amp;</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'SYMBOL_DATA'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$sym_ms</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">!=</span> <span style="color: #000088;">$old_sym</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3439"></a>                            <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">-</span><span style="color: #cc66cc;">1</span> <span style="color: #339933;">!=</span> <span style="color: #000088;">$old_sym</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3440"></a>                                <span style="color: #000088;">$symbol_hl</span> <span style="color: #339933;">.=</span> <span style="color: #0000ff;">&quot;|&gt;&quot;</span><span style="color: #339933;">;</span>
<a name="line3441"></a>                            <span style="color: #009900;">&#125;</span>
<a name="line3442"></a>                            <span style="color: #000088;">$old_sym</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'SYMBOL_DATA'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$sym_ms</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
<a name="line3443"></a>                            <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">use_classes</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3444"></a>                                <span style="color: #000088;">$symbol_hl</span> <span style="color: #339933;">.=</span> <span style="color: #0000ff;">'&lt;| style=&quot;'</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'STYLES'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'SYMBOLS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$old_sym</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">'&quot;&gt;'</span><span style="color: #339933;">;</span>
<a name="line3445"></a>                            <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line3446"></a>                                <span style="color: #000088;">$symbol_hl</span> <span style="color: #339933;">.=</span> <span style="color: #0000ff;">'&lt;| class=&quot;sy'</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$old_sym</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">'&quot;&gt;'</span><span style="color: #339933;">;</span>
<a name="line3447"></a>                            <span style="color: #009900;">&#125;</span>
<a name="line3448"></a>                        <span style="color: #009900;">&#125;</span>
<a name="line3449"></a>                        <span style="color: #000088;">$symbol_hl</span> <span style="color: #339933;">.=</span> <span style="color: #000088;">$sym_ms</span><span style="color: #339933;">;</span>
<a name="line3450"></a>                    <span style="color: #009900;">&#125;</span>
<a name="line3451"></a>                    <a href="http://www.php.net/unset"><span style="color: #990000;">unset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$sym_match_syms</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line3452"></a>&nbsp;
<a name="line3453"></a>                    <span style="color: #666666; font-style: italic;">//Close remaining tags and insert the replacement at the right position ...</span>
<a name="line3454"></a>                    <span style="color: #666666; font-style: italic;">//Take caution if symbol_hl is empty to avoid doubled closing spans.</span>
<a name="line3455"></a>                    <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">-</span><span style="color: #cc66cc;">1</span> <span style="color: #339933;">!=</span> <span style="color: #000088;">$old_sym</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3456"></a>                        <span style="color: #000088;">$symbol_hl</span> <span style="color: #339933;">.=</span> <span style="color: #0000ff;">&quot;|&gt;&quot;</span><span style="color: #339933;">;</span>
<a name="line3457"></a>                    <span style="color: #009900;">&#125;</span>
<a name="line3458"></a>                <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line3459"></a>                    <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">use_classes</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3460"></a>                        <span style="color: #000088;">$symbol_hl</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">'&lt;| style=&quot;'</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'STYLES'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'SYMBOLS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">'&quot;&gt;'</span><span style="color: #339933;">;</span>
<a name="line3461"></a>                    <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line3462"></a>                        <span style="color: #000088;">$symbol_hl</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">'&lt;| class=&quot;sy0&quot;&gt;'</span><span style="color: #339933;">;</span>
<a name="line3463"></a>                    <span style="color: #009900;">&#125;</span>
<a name="line3464"></a>                    <span style="color: #000088;">$symbol_hl</span> <span style="color: #339933;">.=</span> <span style="color: #000088;">$symbol_match</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">'|&gt;'</span><span style="color: #339933;">;</span>
<a name="line3465"></a>                <span style="color: #009900;">&#125;</span>
<a name="line3466"></a>&nbsp;
<a name="line3467"></a>                <span style="color: #000088;">$stuff_to_parse</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/substr_replace"><span style="color: #990000;">substr_replace</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$stuff_to_parse</span><span style="color: #339933;">,</span> <span style="color: #000088;">$symbol_hl</span><span style="color: #339933;">,</span> <span style="color: #000088;">$symbol_offset</span> <span style="color: #339933;">+</span> <span style="color: #000088;">$global_offset</span><span style="color: #339933;">,</span> <span style="color: #000088;">$symbol_length</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line3468"></a>&nbsp;
<a name="line3469"></a>                <span style="color: #666666; font-style: italic;">// since we replace old text with something of different size,</span>
<a name="line3470"></a>                <span style="color: #666666; font-style: italic;">// we'll have to keep track of the differences</span>
<a name="line3471"></a>                <span style="color: #000088;">$global_offset</span> <span style="color: #339933;">+=</span> <a href="http://www.php.net/strlen"><span style="color: #990000;">strlen</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$symbol_hl</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">-</span> <span style="color: #000088;">$symbol_length</span><span style="color: #339933;">;</span>
<a name="line3472"></a>            <span style="color: #009900;">&#125;</span>
<a name="line3473"></a>        <span style="color: #009900;">&#125;</span>
<a name="line3474"></a>        <span style="color: #666666; font-style: italic;">//FIX for symbol highlighting ...</span>
<a name="line3475"></a>&nbsp;
<a name="line3476"></a>        <span style="color: #666666; font-style: italic;">// Add class/style for regexps</span>
<a name="line3477"></a>        <span style="color: #b1b100;">foreach</span> <span style="color: #009900;">&#40;</span><a href="http://www.php.net/array_keys"><span style="color: #990000;">array_keys</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'REGEXPS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span> <span style="color: #b1b100;">as</span> <span style="color: #000088;">$key</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3478"></a>            <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">lexic_permissions</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'REGEXPS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$key</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3479"></a>                <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><a href="http://www.php.net/is_callable"><span style="color: #990000;">is_callable</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'STYLES'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'REGEXPS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$key</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3480"></a>                    <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span>_rx_key <span style="color: #339933;">=</span> <span style="color: #000088;">$key</span><span style="color: #339933;">;</span>
<a name="line3481"></a>                    <span style="color: #000088;">$stuff_to_parse</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/preg_replace_callback"><span style="color: #990000;">preg_replace_callback</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;/!REG3XP<span style="color: #006699; font-weight: bold;">$key</span>!(.*)\|&gt;/U&quot;</span><span style="color: #339933;">,</span>
<a name="line3482"></a>                        <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'handle_regexps_callback'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span>
<a name="line3483"></a>                        <span style="color: #000088;">$stuff_to_parse</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line3484"></a>                <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line3485"></a>                    <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">use_classes</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3486"></a>                        <span style="color: #000088;">$attributes</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">' style=&quot;'</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'STYLES'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'REGEXPS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$key</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">'&quot;'</span><span style="color: #339933;">;</span>
<a name="line3487"></a>                    <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line3488"></a>                        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><a href="http://www.php.net/is_array"><span style="color: #990000;">is_array</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'REGEXPS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$key</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">&amp;&amp;</span>
<a name="line3489"></a>                            <a href="http://www.php.net/array_key_exists"><span style="color: #990000;">array_key_exists</span></a><span style="color: #009900;">&#40;</span>GESHI_CLASS<span style="color: #339933;">,</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'REGEXPS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$key</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3490"></a>                            <span style="color: #000088;">$attributes</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">' class=&quot;'</span> <span style="color: #339933;">.</span>
<a name="line3491"></a>                                <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'REGEXPS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$key</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span>GESHI_CLASS<span style="color: #009900;">&#93;</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">'&quot;'</span><span style="color: #339933;">;</span>
<a name="line3492"></a>                        <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line3493"></a>                           <span style="color: #000088;">$attributes</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">' class=&quot;re'</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$key</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">'&quot;'</span><span style="color: #339933;">;</span>
<a name="line3494"></a>                        <span style="color: #009900;">&#125;</span>
<a name="line3495"></a>                    <span style="color: #009900;">&#125;</span>
<a name="line3496"></a>                    <span style="color: #000088;">$stuff_to_parse</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/str_replace"><span style="color: #990000;">str_replace</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;!REG3XP<span style="color: #006699; font-weight: bold;">$key</span>!&quot;</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">&quot;<span style="color: #006699; font-weight: bold;">$attributes</span>&quot;</span><span style="color: #339933;">,</span> <span style="color: #000088;">$stuff_to_parse</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line3497"></a>                <span style="color: #009900;">&#125;</span>
<a name="line3498"></a>            <span style="color: #009900;">&#125;</span>
<a name="line3499"></a>        <span style="color: #009900;">&#125;</span>
<a name="line3500"></a>&nbsp;
<a name="line3501"></a>        <span style="color: #666666; font-style: italic;">// Replace &lt;DOT&gt; with . for urls</span>
<a name="line3502"></a>        <span style="color: #000088;">$stuff_to_parse</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/str_replace"><span style="color: #990000;">str_replace</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'&lt;DOT&gt;'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'.'</span><span style="color: #339933;">,</span> <span style="color: #000088;">$stuff_to_parse</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line3503"></a>        <span style="color: #666666; font-style: italic;">// Replace &lt;|UR1| with &lt;a href= for urls also</span>
<a name="line3504"></a>        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><a href="http://www.php.net/isset"><span style="color: #990000;">isset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">link_styles</span><span style="color: #009900;">&#91;</span>GESHI_LINK<span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3505"></a>            <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">use_classes</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3506"></a>                <span style="color: #000088;">$stuff_to_parse</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/str_replace"><span style="color: #990000;">str_replace</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'&lt;|UR1|'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'&lt;a'</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">link_target</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">' href='</span><span style="color: #339933;">,</span> <span style="color: #000088;">$stuff_to_parse</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line3507"></a>            <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line3508"></a>                <span style="color: #000088;">$stuff_to_parse</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/str_replace"><span style="color: #990000;">str_replace</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'&lt;|UR1|'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'&lt;a'</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">link_target</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">' style=&quot;'</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">link_styles</span><span style="color: #009900;">&#91;</span>GESHI_LINK<span style="color: #009900;">&#93;</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">'&quot; href='</span><span style="color: #339933;">,</span> <span style="color: #000088;">$stuff_to_parse</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line3509"></a>            <span style="color: #009900;">&#125;</span>
<a name="line3510"></a>        <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line3511"></a>            <span style="color: #000088;">$stuff_to_parse</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/str_replace"><span style="color: #990000;">str_replace</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'&lt;|UR1|'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'&lt;a'</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">link_target</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">' href='</span><span style="color: #339933;">,</span> <span style="color: #000088;">$stuff_to_parse</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line3512"></a>        <span style="color: #009900;">&#125;</span>
<a name="line3513"></a>&nbsp;
<a name="line3514"></a>        <span style="color: #666666; font-style: italic;">//</span>
<a name="line3515"></a>        <span style="color: #666666; font-style: italic;">// NOW we add the span thingy ;)</span>
<a name="line3516"></a>        <span style="color: #666666; font-style: italic;">//</span>
<a name="line3517"></a>&nbsp;
<a name="line3518"></a>        <span style="color: #000088;">$stuff_to_parse</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/str_replace"><span style="color: #990000;">str_replace</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'&lt;|'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'&lt;span'</span><span style="color: #339933;">,</span> <span style="color: #000088;">$stuff_to_parse</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line3519"></a>        <span style="color: #000088;">$stuff_to_parse</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/str_replace"><span style="color: #990000;">str_replace</span></a> <span style="color: #009900;">&#40;</span> <span style="color: #0000ff;">'|&gt;'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'&lt;/span&gt;'</span><span style="color: #339933;">,</span> <span style="color: #000088;">$stuff_to_parse</span> <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line3520"></a>        <span style="color: #b1b100;">return</span> <a href="http://www.php.net/substr"><span style="color: #990000;">substr</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$stuff_to_parse</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line3521"></a>    <span style="color: #009900;">&#125;</span>
<a name="line3522"></a>&nbsp;
<a name="line3523"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line3524"></a>     * Sets the time taken to parse the code
<a name="line3525"></a>     *
<a name="line3526"></a>     * @param microtime The time when parsing started
<a name="line3527"></a>     * @param microtime The time when parsing ended
<a name="line3528"></a>     * @since 1.0.2
<a name="line3529"></a>     * @access private
<a name="line3530"></a>     */</span>
<a name="line3531"></a>    <span style="color: #000000; font-weight: bold;">function</span> set_time<span style="color: #009900;">&#40;</span><span style="color: #000088;">$start_time</span><span style="color: #339933;">,</span> <span style="color: #000088;">$end_time</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3532"></a>        <span style="color: #000088;">$start</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/explode"><span style="color: #990000;">explode</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">' '</span><span style="color: #339933;">,</span> <span style="color: #000088;">$start_time</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line3533"></a>        <span style="color: #000088;">$end</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/explode"><span style="color: #990000;">explode</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">' '</span><span style="color: #339933;">,</span> <span style="color: #000088;">$end_time</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line3534"></a>        <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">time</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$end</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">+</span> <span style="color: #000088;">$end</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">-</span> <span style="color: #000088;">$start</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">-</span> <span style="color: #000088;">$start</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
<a name="line3535"></a>    <span style="color: #009900;">&#125;</span>
<a name="line3536"></a>&nbsp;
<a name="line3537"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line3538"></a>     * Gets the time taken to parse the code
<a name="line3539"></a>     *
<a name="line3540"></a>     * @return double The time taken to parse the code
<a name="line3541"></a>     * @since  1.0.2
<a name="line3542"></a>     */</span>
<a name="line3543"></a>    <span style="color: #000000; font-weight: bold;">function</span> get_time<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3544"></a>        <span style="color: #b1b100;">return</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">time</span><span style="color: #339933;">;</span>
<a name="line3545"></a>    <span style="color: #009900;">&#125;</span>
<a name="line3546"></a>&nbsp;
<a name="line3547"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line3548"></a>     * Merges arrays recursively, overwriting values of the first array with values of later arrays
<a name="line3549"></a>     *
<a name="line3550"></a>     * @since 1.0.8
<a name="line3551"></a>     * @access private
<a name="line3552"></a>     */</span>
<a name="line3553"></a>    <span style="color: #000000; font-weight: bold;">function</span> merge_arrays<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3554"></a>        <span style="color: #000088;">$arrays</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/func_get_args"><span style="color: #990000;">func_get_args</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line3555"></a>        <span style="color: #000088;">$narrays</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/count"><span style="color: #990000;">count</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$arrays</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line3556"></a>&nbsp;
<a name="line3557"></a>        <span style="color: #666666; font-style: italic;">// check arguments</span>
<a name="line3558"></a>        <span style="color: #666666; font-style: italic;">// comment out if more performance is necessary (in this case the foreach loop will trigger a warning if the argument is not an array)</span>
<a name="line3559"></a>        <span style="color: #b1b100;">for</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$i</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span> <span style="color: #000088;">$i</span> <span style="color: #339933;">&lt;</span> <span style="color: #000088;">$narrays</span><span style="color: #339933;">;</span> <span style="color: #000088;">$i</span> <span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3560"></a>            <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><a href="http://www.php.net/is_array"><span style="color: #990000;">is_array</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$arrays</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$i</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3561"></a>                <span style="color: #666666; font-style: italic;">// also array_merge_recursive returns nothing in this case</span>
<a name="line3562"></a>                <a href="http://www.php.net/trigger_error"><span style="color: #990000;">trigger_error</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'Argument #'</span> <span style="color: #339933;">.</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$i</span><span style="color: #339933;">+</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">' is not an array - trying to merge array with scalar! Returning false!'</span><span style="color: #339933;">,</span> <span style="color: #009900; font-weight: bold;">E_USER_WARNING</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line3563"></a>                <span style="color: #b1b100;">return</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #339933;">;</span>
<a name="line3564"></a>            <span style="color: #009900;">&#125;</span>
<a name="line3565"></a>        <span style="color: #009900;">&#125;</span>
<a name="line3566"></a>&nbsp;
<a name="line3567"></a>        <span style="color: #666666; font-style: italic;">// the first array is in the output set in every case</span>
<a name="line3568"></a>        <span style="color: #000088;">$ret</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$arrays</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
<a name="line3569"></a>&nbsp;
<a name="line3570"></a>        <span style="color: #666666; font-style: italic;">// merege $ret with the remaining arrays</span>
<a name="line3571"></a>        <span style="color: #b1b100;">for</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$i</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">1</span><span style="color: #339933;">;</span> <span style="color: #000088;">$i</span> <span style="color: #339933;">&lt;</span> <span style="color: #000088;">$narrays</span><span style="color: #339933;">;</span> <span style="color: #000088;">$i</span> <span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3572"></a>            <span style="color: #b1b100;">foreach</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$arrays</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$i</span><span style="color: #009900;">&#93;</span> <span style="color: #b1b100;">as</span> <span style="color: #000088;">$key</span> <span style="color: #339933;">=&gt;</span> <span style="color: #000088;">$value</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3573"></a>                <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><a href="http://www.php.net/is_array"><span style="color: #990000;">is_array</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$value</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">&amp;&amp;</span> <a href="http://www.php.net/isset"><span style="color: #990000;">isset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$ret</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$key</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3574"></a>                    <span style="color: #666666; font-style: italic;">// if $ret[$key] is not an array you try to merge an scalar value with an array - the result is not defined (incompatible arrays)</span>
<a name="line3575"></a>                    <span style="color: #666666; font-style: italic;">// in this case the call will trigger an E_USER_WARNING and the $ret[$key] will be false.</span>
<a name="line3576"></a>                    <span style="color: #000088;">$ret</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$key</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">merge_arrays</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$ret</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$key</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> <span style="color: #000088;">$value</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line3577"></a>                <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line3578"></a>                    <span style="color: #000088;">$ret</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$key</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$value</span><span style="color: #339933;">;</span>
<a name="line3579"></a>                <span style="color: #009900;">&#125;</span>
<a name="line3580"></a>            <span style="color: #009900;">&#125;</span>
<a name="line3581"></a>        <span style="color: #009900;">&#125;</span>
<a name="line3582"></a>&nbsp;
<a name="line3583"></a>        <span style="color: #b1b100;">return</span> <span style="color: #000088;">$ret</span><span style="color: #339933;">;</span>
<a name="line3584"></a>    <span style="color: #009900;">&#125;</span>
<a name="line3585"></a>&nbsp;
<a name="line3586"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line3587"></a>     * Gets language information and stores it for later use
<a name="line3588"></a>     *
<a name="line3589"></a>     * @param string The filename of the language file you want to load
<a name="line3590"></a>     * @since 1.0.0
<a name="line3591"></a>     * @access private
<a name="line3592"></a>     * @todo Needs to load keys for lexic permissions for keywords, regexps etc
<a name="line3593"></a>     */</span>
<a name="line3594"></a>    <span style="color: #000000; font-weight: bold;">function</span> load_language<span style="color: #009900;">&#40;</span><span style="color: #000088;">$file_name</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3595"></a>        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$file_name</span> <span style="color: #339933;">==</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">loaded_language</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3596"></a>            <span style="color: #666666; font-style: italic;">// this file is already loaded!</span>
<a name="line3597"></a>            <span style="color: #b1b100;">return</span><span style="color: #339933;">;</span>
<a name="line3598"></a>        <span style="color: #009900;">&#125;</span>
<a name="line3599"></a>&nbsp;
<a name="line3600"></a>        <span style="color: #666666; font-style: italic;">//Prepare some stuff before actually loading the language file</span>
<a name="line3601"></a>        <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">loaded_language</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$file_name</span><span style="color: #339933;">;</span>
<a name="line3602"></a>        <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">parse_cache_built</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #339933;">;</span>
<a name="line3603"></a>        <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">enable_highlighting</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line3604"></a>        <span style="color: #000088;">$language_data</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line3605"></a>&nbsp;
<a name="line3606"></a>        <span style="color: #666666; font-style: italic;">//Load the language file</span>
<a name="line3607"></a>        <span style="color: #b1b100;">require</span> <span style="color: #000088;">$file_name</span><span style="color: #339933;">;</span>
<a name="line3608"></a>&nbsp;
<a name="line3609"></a>        <span style="color: #666666; font-style: italic;">// Perhaps some checking might be added here later to check that</span>
<a name="line3610"></a>        <span style="color: #666666; font-style: italic;">// $language data is a valid thing but maybe not</span>
<a name="line3611"></a>        <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$language_data</span><span style="color: #339933;">;</span>
<a name="line3612"></a>&nbsp;
<a name="line3613"></a>        <span style="color: #666666; font-style: italic;">// Set strict mode if should be set</span>
<a name="line3614"></a>        <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">strict_mode</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'STRICT_MODE_APPLIES'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
<a name="line3615"></a>&nbsp;
<a name="line3616"></a>        <span style="color: #666666; font-style: italic;">// Set permissions for all lexics to true</span>
<a name="line3617"></a>        <span style="color: #666666; font-style: italic;">// so they'll be highlighted by default</span>
<a name="line3618"></a>        <span style="color: #b1b100;">foreach</span> <span style="color: #009900;">&#40;</span><a href="http://www.php.net/array_keys"><span style="color: #990000;">array_keys</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'KEYWORDS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span> <span style="color: #b1b100;">as</span> <span style="color: #000088;">$key</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3619"></a>            <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><a href="http://www.php.net/empty"><span style="color: #990000;">empty</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'KEYWORDS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$key</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3620"></a>                <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">lexic_permissions</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'KEYWORDS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$key</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">true</span><span style="color: #339933;">;</span>
<a name="line3621"></a>            <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line3622"></a>                <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">lexic_permissions</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'KEYWORDS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$key</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #339933;">;</span>
<a name="line3623"></a>            <span style="color: #009900;">&#125;</span>
<a name="line3624"></a>        <span style="color: #009900;">&#125;</span>
<a name="line3625"></a>&nbsp;
<a name="line3626"></a>        <span style="color: #b1b100;">foreach</span> <span style="color: #009900;">&#40;</span><a href="http://www.php.net/array_keys"><span style="color: #990000;">array_keys</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'COMMENT_SINGLE'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span> <span style="color: #b1b100;">as</span> <span style="color: #000088;">$key</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3627"></a>            <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">lexic_permissions</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'COMMENTS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$key</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">true</span><span style="color: #339933;">;</span>
<a name="line3628"></a>        <span style="color: #009900;">&#125;</span>
<a name="line3629"></a>        <span style="color: #b1b100;">foreach</span> <span style="color: #009900;">&#40;</span><a href="http://www.php.net/array_keys"><span style="color: #990000;">array_keys</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'REGEXPS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span> <span style="color: #b1b100;">as</span> <span style="color: #000088;">$key</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3630"></a>            <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">lexic_permissions</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'REGEXPS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$key</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">true</span><span style="color: #339933;">;</span>
<a name="line3631"></a>        <span style="color: #009900;">&#125;</span>
<a name="line3632"></a>&nbsp;
<a name="line3633"></a>        <span style="color: #666666; font-style: italic;">// for BenBE and future code reviews:</span>
<a name="line3634"></a>        <span style="color: #666666; font-style: italic;">// we can use empty here since we only check for existance and emptiness of an array</span>
<a name="line3635"></a>        <span style="color: #666666; font-style: italic;">// if it is not an array at all but rather false or null this will work as intended as well</span>
<a name="line3636"></a>        <span style="color: #666666; font-style: italic;">// even if $this-&gt;language_data['PARSER_CONTROL'] is undefined this won't trigger a notice</span>
<a name="line3637"></a>        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><a href="http://www.php.net/empty"><span style="color: #990000;">empty</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'PARSER_CONTROL'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'ENABLE_FLAGS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3638"></a>            <span style="color: #b1b100;">foreach</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'PARSER_CONTROL'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'ENABLE_FLAGS'</span><span style="color: #009900;">&#93;</span> <span style="color: #b1b100;">as</span> <span style="color: #000088;">$flag</span> <span style="color: #339933;">=&gt;</span> <span style="color: #000088;">$value</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3639"></a>                <span style="color: #666666; font-style: italic;">// it's either true or false and maybe is true as well</span>
<a name="line3640"></a>                <span style="color: #000088;">$perm</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$value</span> <span style="color: #339933;">!==</span> GESHI_NEVER<span style="color: #339933;">;</span>
<a name="line3641"></a>                <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$flag</span> <span style="color: #339933;">==</span> <span style="color: #0000ff;">'ALL'</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3642"></a>                    <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">enable_highlighting</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$perm</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line3643"></a>                    <span style="color: #b1b100;">continue</span><span style="color: #339933;">;</span>
<a name="line3644"></a>                <span style="color: #009900;">&#125;</span>
<a name="line3645"></a>                <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><a href="http://www.php.net/isset"><span style="color: #990000;">isset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">lexic_permissions</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$flag</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3646"></a>                    <span style="color: #666666; font-style: italic;">// unknown lexic permission</span>
<a name="line3647"></a>                    <span style="color: #b1b100;">continue</span><span style="color: #339933;">;</span>
<a name="line3648"></a>                <span style="color: #009900;">&#125;</span>
<a name="line3649"></a>                <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><a href="http://www.php.net/is_array"><span style="color: #990000;">is_array</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">lexic_permissions</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$flag</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3650"></a>                    <span style="color: #b1b100;">foreach</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">lexic_permissions</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$flag</span><span style="color: #009900;">&#93;</span> <span style="color: #b1b100;">as</span> <span style="color: #000088;">$key</span> <span style="color: #339933;">=&gt;</span> <span style="color: #000088;">$val</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3651"></a>                        <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">lexic_permissions</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$flag</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$key</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$perm</span><span style="color: #339933;">;</span>
<a name="line3652"></a>                    <span style="color: #009900;">&#125;</span>
<a name="line3653"></a>                <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line3654"></a>                    <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">lexic_permissions</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$flag</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$perm</span><span style="color: #339933;">;</span>
<a name="line3655"></a>                <span style="color: #009900;">&#125;</span>
<a name="line3656"></a>            <span style="color: #009900;">&#125;</span>
<a name="line3657"></a>            <a href="http://www.php.net/unset"><span style="color: #990000;">unset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'PARSER_CONTROL'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'ENABLE_FLAGS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line3658"></a>        <span style="color: #009900;">&#125;</span>
<a name="line3659"></a>&nbsp;
<a name="line3660"></a>        <span style="color: #666666; font-style: italic;">//Fix: Problem where hardescapes weren't handled if no ESCAPE_CHAR was given</span>
<a name="line3661"></a>        <span style="color: #666666; font-style: italic;">//You need to set one for HARDESCAPES only in this case.</span>
<a name="line3662"></a>        <span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><a href="http://www.php.net/isset"><span style="color: #990000;">isset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'HARDCHAR'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3663"></a>            <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'HARDCHAR'</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'ESCAPE_CHAR'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
<a name="line3664"></a>        <span style="color: #009900;">&#125;</span>
<a name="line3665"></a>&nbsp;
<a name="line3666"></a>        <span style="color: #666666; font-style: italic;">//NEW in 1.0.8: Allow styles to be loaded from a separate file to override defaults</span>
<a name="line3667"></a>        <span style="color: #000088;">$style_filename</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/substr"><span style="color: #990000;">substr</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$file_name</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span> <span style="color: #339933;">-</span><span style="color: #cc66cc;">4</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">'.style.php'</span><span style="color: #339933;">;</span>
<a name="line3668"></a>        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><a href="http://www.php.net/is_readable"><span style="color: #990000;">is_readable</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$style_filename</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3669"></a>            <span style="color: #666666; font-style: italic;">//Clear any style_data that could have been set before ...</span>
<a name="line3670"></a>            <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><a href="http://www.php.net/isset"><span style="color: #990000;">isset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$style_data</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3671"></a>                <a href="http://www.php.net/unset"><span style="color: #990000;">unset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$style_data</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line3672"></a>            <span style="color: #009900;">&#125;</span>
<a name="line3673"></a>&nbsp;
<a name="line3674"></a>            <span style="color: #666666; font-style: italic;">//Read the Style Information from the style file</span>
<a name="line3675"></a>            <span style="color: #b1b100;">include</span> <span style="color: #000088;">$style_filename</span><span style="color: #339933;">;</span>
<a name="line3676"></a>&nbsp;
<a name="line3677"></a>            <span style="color: #666666; font-style: italic;">//Apply the new styles to our current language styles</span>
<a name="line3678"></a>            <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><a href="http://www.php.net/isset"><span style="color: #990000;">isset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$style_data</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">&amp;&amp;</span> <a href="http://www.php.net/is_array"><span style="color: #990000;">is_array</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$style_data</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3679"></a>                <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'STYLES'</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span>
<a name="line3680"></a>                    <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">merge_arrays</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'STYLES'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> <span style="color: #000088;">$style_data</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line3681"></a>            <span style="color: #009900;">&#125;</span>
<a name="line3682"></a>        <span style="color: #009900;">&#125;</span>
<a name="line3683"></a>    <span style="color: #009900;">&#125;</span>
<a name="line3684"></a>&nbsp;
<a name="line3685"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line3686"></a>     * Takes the parsed code and various options, and creates the HTML
<a name="line3687"></a>     * surrounding it to make it look nice.
<a name="line3688"></a>     *
<a name="line3689"></a>     * @param  string The code already parsed (reference!)
<a name="line3690"></a>     * @since  1.0.0
<a name="line3691"></a>     * @access private
<a name="line3692"></a>     */</span>
<a name="line3693"></a>    <span style="color: #000000; font-weight: bold;">function</span> finalise<span style="color: #009900;">&#40;</span><span style="color: #339933;">&amp;</span><span style="color: #000088;">$parsed_code</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3694"></a>        <span style="color: #666666; font-style: italic;">// Remove end parts of important declarations</span>
<a name="line3695"></a>        <span style="color: #666666; font-style: italic;">// This is BUGGY!! My fault for bad code: fix coming in 1.2</span>
<a name="line3696"></a>        <span style="color: #666666; font-style: italic;">// @todo Remove this crap</span>
<a name="line3697"></a>        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">enable_important_blocks</span> <span style="color: #339933;">&amp;&amp;</span>
<a name="line3698"></a>            <span style="color: #009900;">&#40;</span><a href="http://www.php.net/strpos"><span style="color: #990000;">strpos</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$parsed_code</span><span style="color: #339933;">,</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">hsc</span><span style="color: #009900;">&#40;</span>GESHI_START_IMPORTANT<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">===</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3699"></a>            <span style="color: #000088;">$parsed_code</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/str_replace"><span style="color: #990000;">str_replace</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">hsc</span><span style="color: #009900;">&#40;</span>GESHI_END_IMPORTANT<span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">''</span><span style="color: #339933;">,</span> <span style="color: #000088;">$parsed_code</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line3700"></a>        <span style="color: #009900;">&#125;</span>
<a name="line3701"></a>&nbsp;
<a name="line3702"></a>        <span style="color: #666666; font-style: italic;">// Add HTML whitespace stuff if we're using the &lt;div&gt; header</span>
<a name="line3703"></a>        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">header_type</span> <span style="color: #339933;">!=</span> GESHI_HEADER_PRE <span style="color: #339933;">&amp;&amp;</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">header_type</span> <span style="color: #339933;">!=</span> GESHI_HEADER_PRE_VALID<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3704"></a>            <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">indent</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$parsed_code</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line3705"></a>        <span style="color: #009900;">&#125;</span>
<a name="line3706"></a>&nbsp;
<a name="line3707"></a>        <span style="color: #666666; font-style: italic;">// purge some unnecessary stuff</span>
<a name="line3708"></a>        <span style="color: #009933; font-style: italic;">/** NOTE: memorypeak #1 */</span>
<a name="line3709"></a>        <span style="color: #000088;">$parsed_code</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/preg_replace"><span style="color: #990000;">preg_replace</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'#&lt;span[^&gt;]+&gt;(\s*)&lt;/span&gt;#'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'\\1'</span><span style="color: #339933;">,</span> <span style="color: #000088;">$parsed_code</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line3710"></a>&nbsp;
<a name="line3711"></a>        <span style="color: #666666; font-style: italic;">// If we are using IDs for line numbers, there needs to be an overall</span>
<a name="line3712"></a>        <span style="color: #666666; font-style: italic;">// ID set to prevent collisions.</span>
<a name="line3713"></a>        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">add_ids</span> <span style="color: #339933;">&amp;&amp;</span> <span style="color: #339933;">!</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">overall_id</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3714"></a>            <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">overall_id</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">'geshi-'</span> <span style="color: #339933;">.</span> <a href="http://www.php.net/substr"><span style="color: #990000;">substr</span></a><span style="color: #009900;">&#40;</span><a href="http://www.php.net/md5"><span style="color: #990000;">md5</span></a><span style="color: #009900;">&#40;</span><a href="http://www.php.net/microtime"><span style="color: #990000;">microtime</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">4</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line3715"></a>        <span style="color: #009900;">&#125;</span>
<a name="line3716"></a>&nbsp;
<a name="line3717"></a>        <span style="color: #666666; font-style: italic;">// Get code into lines</span>
<a name="line3718"></a>        <span style="color: #009933; font-style: italic;">/** NOTE: memorypeak #2 */</span>
<a name="line3719"></a>        <span style="color: #000088;">$code</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/explode"><span style="color: #990000;">explode</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> <span style="color: #000088;">$parsed_code</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line3720"></a>        <span style="color: #000088;">$parsed_code</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">header</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line3721"></a>&nbsp;
<a name="line3722"></a>        <span style="color: #666666; font-style: italic;">// If we're using line numbers, we insert &lt;li&gt;s and appropriate</span>
<a name="line3723"></a>        <span style="color: #666666; font-style: italic;">// markup to style them (otherwise we don't need to do anything)</span>
<a name="line3724"></a>        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">line_numbers</span> <span style="color: #339933;">!=</span> GESHI_NO_LINE_NUMBERS <span style="color: #339933;">&amp;&amp;</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">header_type</span> <span style="color: #339933;">!=</span> GESHI_HEADER_PRE_TABLE<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3725"></a>            <span style="color: #666666; font-style: italic;">// If we're using the &lt;pre&gt; header, we shouldn't add newlines because</span>
<a name="line3726"></a>            <span style="color: #666666; font-style: italic;">// the &lt;pre&gt; will line-break them (and the &lt;li&gt;s already do this for us)</span>
<a name="line3727"></a>            <span style="color: #000088;">$ls</span> <span style="color: #339933;">=</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">header_type</span> <span style="color: #339933;">!=</span> GESHI_HEADER_PRE <span style="color: #339933;">&amp;&amp;</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">header_type</span> <span style="color: #339933;">!=</span> GESHI_HEADER_PRE_VALID<span style="color: #009900;">&#41;</span> ? <span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">:</span> <span style="color: #0000ff;">''</span><span style="color: #339933;">;</span>
<a name="line3728"></a>&nbsp;
<a name="line3729"></a>            <span style="color: #666666; font-style: italic;">// Set vars to defaults for following loop</span>
<a name="line3730"></a>            <span style="color: #000088;">$i</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span>
<a name="line3731"></a>&nbsp;
<a name="line3732"></a>            <span style="color: #666666; font-style: italic;">// Foreach line...</span>
<a name="line3733"></a>            <span style="color: #b1b100;">for</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$i</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span> <span style="color: #000088;">$n</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/count"><span style="color: #990000;">count</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$code</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #000088;">$i</span> <span style="color: #339933;">&lt;</span> <span style="color: #000088;">$n</span><span style="color: #339933;">;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3734"></a>                <span style="color: #666666; font-style: italic;">//Reset the attributes for a new line ...</span>
<a name="line3735"></a>                <span style="color: #000088;">$attrs</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line3736"></a>&nbsp;
<a name="line3737"></a>                <span style="color: #666666; font-style: italic;">// Make lines have at least one space in them if they're empty</span>
<a name="line3738"></a>                <span style="color: #666666; font-style: italic;">// BenBE: Checking emptiness using trim instead of relying on blanks</span>
<a name="line3739"></a>                <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #0000ff;">''</span> <span style="color: #339933;">==</span> <a href="http://www.php.net/trim"><span style="color: #990000;">trim</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$code</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$i</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3740"></a>                    <span style="color: #000088;">$code</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$i</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">'&amp;nbsp;'</span><span style="color: #339933;">;</span>
<a name="line3741"></a>                <span style="color: #009900;">&#125;</span>
<a name="line3742"></a>&nbsp;
<a name="line3743"></a>                <span style="color: #666666; font-style: italic;">// If this is a &quot;special line&quot;...</span>
<a name="line3744"></a>                <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">line_numbers</span> <span style="color: #339933;">==</span> GESHI_FANCY_LINE_NUMBERS <span style="color: #339933;">&amp;&amp;</span>
<a name="line3745"></a>                    <span style="color: #000088;">$i</span> <span style="color: #339933;">%</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">line_nth_row</span> <span style="color: #339933;">==</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">line_nth_row</span> <span style="color: #339933;">-</span> <span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3746"></a>                    <span style="color: #666666; font-style: italic;">// Set the attributes to style the line</span>
<a name="line3747"></a>                    <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">use_classes</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3748"></a>                        <span style="color: #666666; font-style: italic;">//$attr = ' class=&quot;li2&quot;';</span>
<a name="line3749"></a>                        <span style="color: #000088;">$attrs</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'class'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">'li2'</span><span style="color: #339933;">;</span>
<a name="line3750"></a>                        <span style="color: #000088;">$def_attr</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">' class=&quot;de2&quot;'</span><span style="color: #339933;">;</span>
<a name="line3751"></a>                    <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line3752"></a>                        <span style="color: #666666; font-style: italic;">//$attr = ' style=&quot;' . $this-&gt;line_style2 . '&quot;';</span>
<a name="line3753"></a>                        <span style="color: #000088;">$attrs</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'style'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">line_style2</span><span style="color: #339933;">;</span>
<a name="line3754"></a>                        <span style="color: #666666; font-style: italic;">// This style &quot;covers up&quot; the special styles set for special lines</span>
<a name="line3755"></a>                        <span style="color: #666666; font-style: italic;">// so that styles applied to special lines don't apply to the actual</span>
<a name="line3756"></a>                        <span style="color: #666666; font-style: italic;">// code on that line</span>
<a name="line3757"></a>                        <span style="color: #000088;">$def_attr</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">' style=&quot;'</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">code_style</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">'&quot;'</span><span style="color: #339933;">;</span>
<a name="line3758"></a>                    <span style="color: #009900;">&#125;</span>
<a name="line3759"></a>                <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line3760"></a>                    <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">use_classes</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3761"></a>                        <span style="color: #666666; font-style: italic;">//$attr = ' class=&quot;li1&quot;';</span>
<a name="line3762"></a>                        <span style="color: #000088;">$attrs</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'class'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">'li1'</span><span style="color: #339933;">;</span>
<a name="line3763"></a>                        <span style="color: #000088;">$def_attr</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">' class=&quot;de1&quot;'</span><span style="color: #339933;">;</span>
<a name="line3764"></a>                    <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line3765"></a>                        <span style="color: #666666; font-style: italic;">//$attr = ' style=&quot;' . $this-&gt;line_style1 . '&quot;';</span>
<a name="line3766"></a>                        <span style="color: #000088;">$attrs</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'style'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">line_style1</span><span style="color: #339933;">;</span>
<a name="line3767"></a>                        <span style="color: #000088;">$def_attr</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">' style=&quot;'</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">code_style</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">'&quot;'</span><span style="color: #339933;">;</span>
<a name="line3768"></a>                    <span style="color: #009900;">&#125;</span>
<a name="line3769"></a>                <span style="color: #009900;">&#125;</span>
<a name="line3770"></a>&nbsp;
<a name="line3771"></a>                <span style="color: #666666; font-style: italic;">//Check which type of tag to insert for this line</span>
<a name="line3772"></a>                <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">header_type</span> <span style="color: #339933;">==</span> GESHI_HEADER_PRE_VALID<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3773"></a>                    <span style="color: #000088;">$start</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;&lt;pre<span style="color: #006699; font-weight: bold;">$def_attr</span>&gt;&quot;</span><span style="color: #339933;">;</span>
<a name="line3774"></a>                    <span style="color: #000088;">$end</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">'&lt;/pre&gt;'</span><span style="color: #339933;">;</span>
<a name="line3775"></a>                <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line3776"></a>                    <span style="color: #666666; font-style: italic;">// Span or div?</span>
<a name="line3777"></a>                    <span style="color: #000088;">$start</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;&lt;div<span style="color: #006699; font-weight: bold;">$def_attr</span>&gt;&quot;</span><span style="color: #339933;">;</span>
<a name="line3778"></a>                    <span style="color: #000088;">$end</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">'&lt;/div&gt;'</span><span style="color: #339933;">;</span>
<a name="line3779"></a>                <span style="color: #009900;">&#125;</span>
<a name="line3780"></a>&nbsp;
<a name="line3781"></a>                <span style="color: #339933;">++</span><span style="color: #000088;">$i</span><span style="color: #339933;">;</span>
<a name="line3782"></a>&nbsp;
<a name="line3783"></a>                <span style="color: #666666; font-style: italic;">// Are we supposed to use ids? If so, add them</span>
<a name="line3784"></a>                <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">add_ids</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3785"></a>                    <span style="color: #000088;">$attrs</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'id'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;<span style="color: #006699; font-weight: bold;">$this-&gt;overall_id</span>-<span style="color: #006699; font-weight: bold;">$i</span>&quot;</span><span style="color: #339933;">;</span>
<a name="line3786"></a>                <span style="color: #009900;">&#125;</span>
<a name="line3787"></a>&nbsp;
<a name="line3788"></a>                <span style="color: #666666; font-style: italic;">//Is this some line with extra styles???</span>
<a name="line3789"></a>                <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><a href="http://www.php.net/in_array"><span style="color: #990000;">in_array</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$i</span><span style="color: #339933;">,</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">highlight_extra_lines</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3790"></a>                    <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">use_classes</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3791"></a>                        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><a href="http://www.php.net/isset"><span style="color: #990000;">isset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">highlight_extra_lines_styles</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$i</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3792"></a>                            <span style="color: #000088;">$attrs</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'class'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;lx<span style="color: #006699; font-weight: bold;">$i</span>&quot;</span><span style="color: #339933;">;</span>
<a name="line3793"></a>                        <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line3794"></a>                            <span style="color: #000088;">$attrs</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'class'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;ln-xtra&quot;</span><span style="color: #339933;">;</span>
<a name="line3795"></a>                        <span style="color: #009900;">&#125;</span>
<a name="line3796"></a>                    <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line3797"></a>                        <a href="http://www.php.net/array_push"><span style="color: #990000;">array_push</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$attrs</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'style'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">get_line_style</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$i</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line3798"></a>                    <span style="color: #009900;">&#125;</span>
<a name="line3799"></a>                <span style="color: #009900;">&#125;</span>
<a name="line3800"></a>&nbsp;
<a name="line3801"></a>                <span style="color: #666666; font-style: italic;">// Add in the line surrounded by appropriate list HTML</span>
<a name="line3802"></a>                <span style="color: #000088;">$attr_string</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">''</span><span style="color: #339933;">;</span>
<a name="line3803"></a>                <span style="color: #b1b100;">foreach</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$attrs</span> <span style="color: #b1b100;">as</span> <span style="color: #000088;">$key</span> <span style="color: #339933;">=&gt;</span> <span style="color: #000088;">$attr</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3804"></a>                    <span style="color: #000088;">$attr_string</span> <span style="color: #339933;">.=</span> <span style="color: #0000ff;">' '</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$key</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">'=&quot;'</span> <span style="color: #339933;">.</span> <a href="http://www.php.net/implode"><span style="color: #990000;">implode</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">' '</span><span style="color: #339933;">,</span> <span style="color: #000088;">$attr</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">'&quot;'</span><span style="color: #339933;">;</span>
<a name="line3805"></a>                <span style="color: #009900;">&#125;</span>
<a name="line3806"></a>&nbsp;
<a name="line3807"></a>                <span style="color: #000088;">$parsed_code</span> <span style="color: #339933;">.=</span> <span style="color: #0000ff;">&quot;&lt;li<span style="color: #006699; font-weight: bold;">$attr_string</span>&gt;<span style="color: #006699; font-weight: bold;">$start</span>{<span style="color: #006699; font-weight: bold;">$code</span>[<span style="color: #006699; font-weight: bold;">$i</span>-1]}<span style="color: #006699; font-weight: bold;">$end</span>&lt;/li&gt;<span style="color: #006699; font-weight: bold;">$ls</span>&quot;</span><span style="color: #339933;">;</span>
<a name="line3808"></a>                <a href="http://www.php.net/unset"><span style="color: #990000;">unset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$code</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$i</span> <span style="color: #339933;">-</span> <span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line3809"></a>            <span style="color: #009900;">&#125;</span>
<a name="line3810"></a>        <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line3811"></a>            <span style="color: #000088;">$n</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/count"><span style="color: #990000;">count</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$code</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line3812"></a>            <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">use_classes</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3813"></a>                <span style="color: #000088;">$attributes</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">' class=&quot;de1&quot;'</span><span style="color: #339933;">;</span>
<a name="line3814"></a>            <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line3815"></a>                <span style="color: #000088;">$attributes</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">' style=&quot;'</span><span style="color: #339933;">.</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">code_style</span> <span style="color: #339933;">.</span><span style="color: #0000ff;">'&quot;'</span><span style="color: #339933;">;</span>
<a name="line3816"></a>            <span style="color: #009900;">&#125;</span>
<a name="line3817"></a>            <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">header_type</span> <span style="color: #339933;">==</span> GESHI_HEADER_PRE_VALID<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3818"></a>                <span style="color: #000088;">$parsed_code</span> <span style="color: #339933;">.=</span> <span style="color: #0000ff;">'&lt;pre'</span><span style="color: #339933;">.</span> <span style="color: #000088;">$attributes</span> <span style="color: #339933;">.</span><span style="color: #0000ff;">'&gt;'</span><span style="color: #339933;">;</span>
<a name="line3819"></a>            <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">elseif</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">header_type</span> <span style="color: #339933;">==</span> GESHI_HEADER_PRE_TABLE<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3820"></a>                <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">line_numbers</span> <span style="color: #339933;">!=</span> GESHI_NO_LINE_NUMBERS<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3821"></a>                    <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">use_classes</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3822"></a>                        <span style="color: #000088;">$attrs</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">' class=&quot;ln&quot;'</span><span style="color: #339933;">;</span>
<a name="line3823"></a>                    <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line3824"></a>                        <span style="color: #000088;">$attrs</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">' style=&quot;'</span><span style="color: #339933;">.</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">table_linenumber_style</span> <span style="color: #339933;">.</span><span style="color: #0000ff;">'&quot;'</span><span style="color: #339933;">;</span>
<a name="line3825"></a>                    <span style="color: #009900;">&#125;</span>
<a name="line3826"></a>                    <span style="color: #000088;">$parsed_code</span> <span style="color: #339933;">.=</span> <span style="color: #0000ff;">'&lt;td'</span><span style="color: #339933;">.</span><span style="color: #000088;">$attrs</span><span style="color: #339933;">.</span><span style="color: #0000ff;">'&gt;&lt;pre'</span><span style="color: #339933;">.</span><span style="color: #000088;">$attributes</span><span style="color: #339933;">.</span><span style="color: #0000ff;">'&gt;'</span><span style="color: #339933;">;</span>
<a name="line3827"></a>                    <span style="color: #666666; font-style: italic;">// get linenumbers</span>
<a name="line3828"></a>                    <span style="color: #666666; font-style: italic;">// we don't merge it with the for below, since it should be better for</span>
<a name="line3829"></a>                    <span style="color: #666666; font-style: italic;">// memory consumption this way</span>
<a name="line3830"></a>                    <span style="color: #666666; font-style: italic;">// @todo: but... actually it would still be somewhat nice to merge the two loops</span>
<a name="line3831"></a>                    <span style="color: #666666; font-style: italic;">//        the mem peaks are at different positions</span>
<a name="line3832"></a>                    <span style="color: #b1b100;">for</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$i</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span> <span style="color: #000088;">$i</span> <span style="color: #339933;">&lt;</span> <span style="color: #000088;">$n</span><span style="color: #339933;">;</span> <span style="color: #339933;">++</span><span style="color: #000088;">$i</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3833"></a>                        <span style="color: #000088;">$close</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span>
<a name="line3834"></a>                        <span style="color: #666666; font-style: italic;">// fancy lines</span>
<a name="line3835"></a>                        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">line_numbers</span> <span style="color: #339933;">==</span> GESHI_FANCY_LINE_NUMBERS <span style="color: #339933;">&amp;&amp;</span>
<a name="line3836"></a>                            <span style="color: #000088;">$i</span> <span style="color: #339933;">%</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">line_nth_row</span> <span style="color: #339933;">==</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">line_nth_row</span> <span style="color: #339933;">-</span> <span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3837"></a>                            <span style="color: #666666; font-style: italic;">// Set the attributes to style the line</span>
<a name="line3838"></a>                            <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">use_classes</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3839"></a>                                <span style="color: #000088;">$parsed_code</span> <span style="color: #339933;">.=</span> <span style="color: #0000ff;">'&lt;span class=&quot;xtra li2&quot;&gt;&lt;span class=&quot;de2&quot;&gt;'</span><span style="color: #339933;">;</span>
<a name="line3840"></a>                            <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line3841"></a>                                <span style="color: #666666; font-style: italic;">// This style &quot;covers up&quot; the special styles set for special lines</span>
<a name="line3842"></a>                                <span style="color: #666666; font-style: italic;">// so that styles applied to special lines don't apply to the actual</span>
<a name="line3843"></a>                                <span style="color: #666666; font-style: italic;">// code on that line</span>
<a name="line3844"></a>                                <span style="color: #000088;">$parsed_code</span> <span style="color: #339933;">.=</span> <span style="color: #0000ff;">'&lt;span style=&quot;display:block;'</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">line_style2</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">'&quot;&gt;'</span>
<a name="line3845"></a>                                                  <span style="color: #339933;">.</span><span style="color: #0000ff;">'&lt;span style=&quot;'</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">code_style</span> <span style="color: #339933;">.</span><span style="color: #0000ff;">'&quot;&gt;'</span><span style="color: #339933;">;</span>
<a name="line3846"></a>                            <span style="color: #009900;">&#125;</span>
<a name="line3847"></a>                            <span style="color: #000088;">$close</span> <span style="color: #339933;">+=</span> <span style="color: #cc66cc;">2</span><span style="color: #339933;">;</span>
<a name="line3848"></a>                        <span style="color: #009900;">&#125;</span>
<a name="line3849"></a>                        <span style="color: #666666; font-style: italic;">//Is this some line with extra styles???</span>
<a name="line3850"></a>                        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><a href="http://www.php.net/in_array"><span style="color: #990000;">in_array</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$i</span> <span style="color: #339933;">+</span> <span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">highlight_extra_lines</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3851"></a>                            <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">use_classes</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3852"></a>                                <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><a href="http://www.php.net/isset"><span style="color: #990000;">isset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">highlight_extra_lines_styles</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$i</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3853"></a>                                    <span style="color: #000088;">$parsed_code</span> <span style="color: #339933;">.=</span> <span style="color: #0000ff;">&quot;&lt;span class=<span style="color: #000099; font-weight: bold;">\&quot;</span>xtra lx<span style="color: #006699; font-weight: bold;">$i</span><span style="color: #000099; font-weight: bold;">\&quot;</span>&gt;&quot;</span><span style="color: #339933;">;</span>
<a name="line3854"></a>                                <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line3855"></a>                                    <span style="color: #000088;">$parsed_code</span> <span style="color: #339933;">.=</span> <span style="color: #0000ff;">&quot;&lt;span class=<span style="color: #000099; font-weight: bold;">\&quot;</span>xtra ln-xtra<span style="color: #000099; font-weight: bold;">\&quot;</span>&gt;&quot;</span><span style="color: #339933;">;</span>
<a name="line3856"></a>                                <span style="color: #009900;">&#125;</span>
<a name="line3857"></a>                            <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line3858"></a>                                <span style="color: #000088;">$parsed_code</span> <span style="color: #339933;">.=</span> <span style="color: #0000ff;">&quot;&lt;span style=<span style="color: #000099; font-weight: bold;">\&quot;</span>display:block;&quot;</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">get_line_style</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$i</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\&quot;</span>&gt;&quot;</span><span style="color: #339933;">;</span>
<a name="line3859"></a>                            <span style="color: #009900;">&#125;</span>
<a name="line3860"></a>                            <span style="color: #339933;">++</span><span style="color: #000088;">$close</span><span style="color: #339933;">;</span>
<a name="line3861"></a>                        <span style="color: #009900;">&#125;</span>
<a name="line3862"></a>                        <span style="color: #000088;">$parsed_code</span> <span style="color: #339933;">.=</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">line_numbers_start</span> <span style="color: #339933;">+</span> <span style="color: #000088;">$i</span><span style="color: #339933;">;</span>
<a name="line3863"></a>                        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$close</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3864"></a>                            <span style="color: #000088;">$parsed_code</span> <span style="color: #339933;">.=</span> <a href="http://www.php.net/str_repeat"><span style="color: #990000;">str_repeat</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'&lt;/span&gt;'</span><span style="color: #339933;">,</span> <span style="color: #000088;">$close</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line3865"></a>                        <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$i</span> <span style="color: #339933;">!=</span> <span style="color: #000088;">$n</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3866"></a>                            <span style="color: #000088;">$parsed_code</span> <span style="color: #339933;">.=</span> <span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span>
<a name="line3867"></a>                        <span style="color: #009900;">&#125;</span>
<a name="line3868"></a>                    <span style="color: #009900;">&#125;</span>
<a name="line3869"></a>                    <span style="color: #000088;">$parsed_code</span> <span style="color: #339933;">.=</span> <span style="color: #0000ff;">'&lt;/pre&gt;&lt;/td&gt;&lt;td'</span><span style="color: #339933;">.</span><span style="color: #000088;">$attributes</span><span style="color: #339933;">.</span><span style="color: #0000ff;">'&gt;'</span><span style="color: #339933;">;</span>
<a name="line3870"></a>                <span style="color: #009900;">&#125;</span>
<a name="line3871"></a>                <span style="color: #000088;">$parsed_code</span> <span style="color: #339933;">.=</span> <span style="color: #0000ff;">'&lt;pre'</span><span style="color: #339933;">.</span> <span style="color: #000088;">$attributes</span> <span style="color: #339933;">.</span><span style="color: #0000ff;">'&gt;'</span><span style="color: #339933;">;</span>
<a name="line3872"></a>            <span style="color: #009900;">&#125;</span>
<a name="line3873"></a>            <span style="color: #666666; font-style: italic;">// No line numbers, but still need to handle highlighting lines extra.</span>
<a name="line3874"></a>            <span style="color: #666666; font-style: italic;">// Have to use divs so the full width of the code is highlighted</span>
<a name="line3875"></a>            <span style="color: #000088;">$close</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span>
<a name="line3876"></a>            <span style="color: #b1b100;">for</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$i</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span> <span style="color: #000088;">$i</span> <span style="color: #339933;">&lt;</span> <span style="color: #000088;">$n</span><span style="color: #339933;">;</span> <span style="color: #339933;">++</span><span style="color: #000088;">$i</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3877"></a>                <span style="color: #666666; font-style: italic;">// Make lines have at least one space in them if they're empty</span>
<a name="line3878"></a>                <span style="color: #666666; font-style: italic;">// BenBE: Checking emptiness using trim instead of relying on blanks</span>
<a name="line3879"></a>                <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #0000ff;">''</span> <span style="color: #339933;">==</span> <a href="http://www.php.net/trim"><span style="color: #990000;">trim</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$code</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$i</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3880"></a>                    <span style="color: #000088;">$code</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$i</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">'&amp;nbsp;'</span><span style="color: #339933;">;</span>
<a name="line3881"></a>                <span style="color: #009900;">&#125;</span>
<a name="line3882"></a>                <span style="color: #666666; font-style: italic;">// fancy lines</span>
<a name="line3883"></a>                <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">line_numbers</span> <span style="color: #339933;">==</span> GESHI_FANCY_LINE_NUMBERS <span style="color: #339933;">&amp;&amp;</span>
<a name="line3884"></a>                    <span style="color: #000088;">$i</span> <span style="color: #339933;">%</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">line_nth_row</span> <span style="color: #339933;">==</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">line_nth_row</span> <span style="color: #339933;">-</span> <span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3885"></a>                    <span style="color: #666666; font-style: italic;">// Set the attributes to style the line</span>
<a name="line3886"></a>                    <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">use_classes</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3887"></a>                        <span style="color: #000088;">$parsed_code</span> <span style="color: #339933;">.=</span> <span style="color: #0000ff;">'&lt;span class=&quot;xtra li2&quot;&gt;&lt;span class=&quot;de2&quot;&gt;'</span><span style="color: #339933;">;</span>
<a name="line3888"></a>                    <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line3889"></a>                        <span style="color: #666666; font-style: italic;">// This style &quot;covers up&quot; the special styles set for special lines</span>
<a name="line3890"></a>                        <span style="color: #666666; font-style: italic;">// so that styles applied to special lines don't apply to the actual</span>
<a name="line3891"></a>                        <span style="color: #666666; font-style: italic;">// code on that line</span>
<a name="line3892"></a>                        <span style="color: #000088;">$parsed_code</span> <span style="color: #339933;">.=</span> <span style="color: #0000ff;">'&lt;span style=&quot;display:block;'</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">line_style2</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">'&quot;&gt;'</span>
<a name="line3893"></a>                                          <span style="color: #339933;">.</span><span style="color: #0000ff;">'&lt;span style=&quot;'</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">code_style</span> <span style="color: #339933;">.</span><span style="color: #0000ff;">'&quot;&gt;'</span><span style="color: #339933;">;</span>
<a name="line3894"></a>                    <span style="color: #009900;">&#125;</span>
<a name="line3895"></a>                    <span style="color: #000088;">$close</span> <span style="color: #339933;">+=</span> <span style="color: #cc66cc;">2</span><span style="color: #339933;">;</span>
<a name="line3896"></a>                <span style="color: #009900;">&#125;</span>
<a name="line3897"></a>                <span style="color: #666666; font-style: italic;">//Is this some line with extra styles???</span>
<a name="line3898"></a>                <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><a href="http://www.php.net/in_array"><span style="color: #990000;">in_array</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$i</span> <span style="color: #339933;">+</span> <span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">highlight_extra_lines</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3899"></a>                    <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">use_classes</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3900"></a>                        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><a href="http://www.php.net/isset"><span style="color: #990000;">isset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">highlight_extra_lines_styles</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$i</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3901"></a>                            <span style="color: #000088;">$parsed_code</span> <span style="color: #339933;">.=</span> <span style="color: #0000ff;">&quot;&lt;span class=<span style="color: #000099; font-weight: bold;">\&quot;</span>xtra lx<span style="color: #006699; font-weight: bold;">$i</span><span style="color: #000099; font-weight: bold;">\&quot;</span>&gt;&quot;</span><span style="color: #339933;">;</span>
<a name="line3902"></a>                        <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line3903"></a>                            <span style="color: #000088;">$parsed_code</span> <span style="color: #339933;">.=</span> <span style="color: #0000ff;">&quot;&lt;span class=<span style="color: #000099; font-weight: bold;">\&quot;</span>xtra ln-xtra<span style="color: #000099; font-weight: bold;">\&quot;</span>&gt;&quot;</span><span style="color: #339933;">;</span>
<a name="line3904"></a>                        <span style="color: #009900;">&#125;</span>
<a name="line3905"></a>                    <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line3906"></a>                        <span style="color: #000088;">$parsed_code</span> <span style="color: #339933;">.=</span> <span style="color: #0000ff;">&quot;&lt;span style=<span style="color: #000099; font-weight: bold;">\&quot;</span>display:block;&quot;</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">get_line_style</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$i</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\&quot;</span>&gt;&quot;</span><span style="color: #339933;">;</span>
<a name="line3907"></a>                    <span style="color: #009900;">&#125;</span>
<a name="line3908"></a>                    <span style="color: #339933;">++</span><span style="color: #000088;">$close</span><span style="color: #339933;">;</span>
<a name="line3909"></a>                <span style="color: #009900;">&#125;</span>
<a name="line3910"></a>&nbsp;
<a name="line3911"></a>                <span style="color: #000088;">$parsed_code</span> <span style="color: #339933;">.=</span> <span style="color: #000088;">$code</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$i</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
<a name="line3912"></a>&nbsp;
<a name="line3913"></a>                <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$close</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3914"></a>                  <span style="color: #000088;">$parsed_code</span> <span style="color: #339933;">.=</span> <a href="http://www.php.net/str_repeat"><span style="color: #990000;">str_repeat</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'&lt;/span&gt;'</span><span style="color: #339933;">,</span> <span style="color: #000088;">$close</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line3915"></a>                  <span style="color: #000088;">$close</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span>
<a name="line3916"></a>                <span style="color: #009900;">&#125;</span>
<a name="line3917"></a>                <span style="color: #b1b100;">elseif</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$i</span> <span style="color: #339933;">+</span> <span style="color: #cc66cc;">1</span> <span style="color: #339933;">&lt;</span> <span style="color: #000088;">$n</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3918"></a>                    <span style="color: #000088;">$parsed_code</span> <span style="color: #339933;">.=</span> <span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span>
<a name="line3919"></a>                <span style="color: #009900;">&#125;</span>
<a name="line3920"></a>                <a href="http://www.php.net/unset"><span style="color: #990000;">unset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$code</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$i</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line3921"></a>            <span style="color: #009900;">&#125;</span>
<a name="line3922"></a>&nbsp;
<a name="line3923"></a>            <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">header_type</span> <span style="color: #339933;">==</span> GESHI_HEADER_PRE_VALID <span style="color: #339933;">||</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">header_type</span> <span style="color: #339933;">==</span> GESHI_HEADER_PRE_TABLE<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3924"></a>                <span style="color: #000088;">$parsed_code</span> <span style="color: #339933;">.=</span> <span style="color: #0000ff;">'&lt;/pre&gt;'</span><span style="color: #339933;">;</span>
<a name="line3925"></a>            <span style="color: #009900;">&#125;</span>
<a name="line3926"></a>            <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">header_type</span> <span style="color: #339933;">==</span> GESHI_HEADER_PRE_TABLE <span style="color: #339933;">&amp;&amp;</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">line_numbers</span> <span style="color: #339933;">!=</span> GESHI_NO_LINE_NUMBERS<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3927"></a>                <span style="color: #000088;">$parsed_code</span> <span style="color: #339933;">.=</span> <span style="color: #0000ff;">'&lt;/td&gt;'</span><span style="color: #339933;">;</span>
<a name="line3928"></a>            <span style="color: #009900;">&#125;</span>
<a name="line3929"></a>        <span style="color: #009900;">&#125;</span>
<a name="line3930"></a>&nbsp;
<a name="line3931"></a>        <span style="color: #000088;">$parsed_code</span> <span style="color: #339933;">.=</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">footer</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line3932"></a>    <span style="color: #009900;">&#125;</span>
<a name="line3933"></a>&nbsp;
<a name="line3934"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line3935"></a>     * Creates the header for the code block (with correct attributes)
<a name="line3936"></a>     *
<a name="line3937"></a>     * @return string The header for the code block
<a name="line3938"></a>     * @since  1.0.0
<a name="line3939"></a>     * @access private
<a name="line3940"></a>     */</span>
<a name="line3941"></a>    <span style="color: #000000; font-weight: bold;">function</span> <a href="http://www.php.net/header"><span style="color: #990000;">header</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3942"></a>        <span style="color: #666666; font-style: italic;">// Get attributes needed</span>
<a name="line3943"></a>        <span style="color: #009933; font-style: italic;">/**
<a name="line3944"></a>         * @todo   Document behaviour change - class is outputted regardless of whether
<a name="line3945"></a>         *         we're using classes or not. Same with style
<a name="line3946"></a>         */</span>
<a name="line3947"></a>        <span style="color: #000088;">$attributes</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">' class=&quot;'</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language</span><span style="color: #339933;">;</span>
<a name="line3948"></a>        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">overall_class</span> <span style="color: #339933;">!=</span> <span style="color: #0000ff;">''</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3949"></a>            <span style="color: #000088;">$attributes</span> <span style="color: #339933;">.=</span> <span style="color: #0000ff;">&quot; &quot;</span><span style="color: #339933;">.</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">overall_class</span><span style="color: #339933;">;</span>
<a name="line3950"></a>        <span style="color: #009900;">&#125;</span>
<a name="line3951"></a>        <span style="color: #000088;">$attributes</span> <span style="color: #339933;">.=</span> <span style="color: #0000ff;">'&quot;'</span><span style="color: #339933;">;</span>
<a name="line3952"></a>&nbsp;
<a name="line3953"></a>        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">overall_id</span> <span style="color: #339933;">!=</span> <span style="color: #0000ff;">''</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3954"></a>            <span style="color: #000088;">$attributes</span> <span style="color: #339933;">.=</span> <span style="color: #0000ff;">&quot; id=<span style="color: #000099; font-weight: bold;">\&quot;</span><span style="color: #006699; font-weight: bold;">{$this-&gt;overall_id}</span><span style="color: #000099; font-weight: bold;">\&quot;</span>&quot;</span><span style="color: #339933;">;</span>
<a name="line3955"></a>        <span style="color: #009900;">&#125;</span>
<a name="line3956"></a>        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">overall_style</span> <span style="color: #339933;">!=</span> <span style="color: #0000ff;">''</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3957"></a>            <span style="color: #000088;">$attributes</span> <span style="color: #339933;">.=</span> <span style="color: #0000ff;">' style=&quot;'</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">overall_style</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">'&quot;'</span><span style="color: #339933;">;</span>
<a name="line3958"></a>        <span style="color: #009900;">&#125;</span>
<a name="line3959"></a>&nbsp;
<a name="line3960"></a>        <span style="color: #000088;">$ol_attributes</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">''</span><span style="color: #339933;">;</span>
<a name="line3961"></a>&nbsp;
<a name="line3962"></a>        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">line_numbers_start</span> <span style="color: #339933;">!=</span> <span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3963"></a>            <span style="color: #000088;">$ol_attributes</span> <span style="color: #339933;">.=</span> <span style="color: #0000ff;">' start=&quot;'</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">line_numbers_start</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">'&quot;'</span><span style="color: #339933;">;</span>
<a name="line3964"></a>        <span style="color: #009900;">&#125;</span>
<a name="line3965"></a>&nbsp;
<a name="line3966"></a>        <span style="color: #666666; font-style: italic;">// Get the header HTML</span>
<a name="line3967"></a>        <span style="color: #000088;">$header</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">header_content</span><span style="color: #339933;">;</span>
<a name="line3968"></a>        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$header</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3969"></a>            <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">header_type</span> <span style="color: #339933;">==</span> GESHI_HEADER_PRE <span style="color: #339933;">||</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">header_type</span> <span style="color: #339933;">==</span> GESHI_HEADER_PRE_VALID<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3970"></a>                <span style="color: #000088;">$header</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/str_replace"><span style="color: #990000;">str_replace</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">''</span><span style="color: #339933;">,</span> <span style="color: #000088;">$header</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line3971"></a>            <span style="color: #009900;">&#125;</span>
<a name="line3972"></a>            <span style="color: #000088;">$header</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">replace_keywords</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$header</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line3973"></a>&nbsp;
<a name="line3974"></a>            <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">use_classes</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3975"></a>                <span style="color: #000088;">$attr</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">' class=&quot;head&quot;'</span><span style="color: #339933;">;</span>
<a name="line3976"></a>            <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line3977"></a>                <span style="color: #000088;">$attr</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot; style=<span style="color: #000099; font-weight: bold;">\&quot;</span><span style="color: #006699; font-weight: bold;">{$this-&gt;header_content_style}</span><span style="color: #000099; font-weight: bold;">\&quot;</span>&quot;</span><span style="color: #339933;">;</span>
<a name="line3978"></a>            <span style="color: #009900;">&#125;</span>
<a name="line3979"></a>            <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">header_type</span> <span style="color: #339933;">==</span> GESHI_HEADER_PRE_TABLE <span style="color: #339933;">&amp;&amp;</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">line_numbers</span> <span style="color: #339933;">!=</span> GESHI_NO_LINE_NUMBERS<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3980"></a>                <span style="color: #000088;">$header</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;&lt;thead&gt;&lt;tr&gt;&lt;td colspan=<span style="color: #000099; font-weight: bold;">\&quot;</span>2<span style="color: #000099; font-weight: bold;">\&quot;</span> <span style="color: #006699; font-weight: bold;">$attr</span>&gt;<span style="color: #006699; font-weight: bold;">$header</span>&lt;/td&gt;&lt;/tr&gt;&lt;/thead&gt;&quot;</span><span style="color: #339933;">;</span>
<a name="line3981"></a>            <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line3982"></a>                <span style="color: #000088;">$header</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;&lt;div<span style="color: #006699; font-weight: bold;">$attr</span>&gt;<span style="color: #006699; font-weight: bold;">$header</span>&lt;/div&gt;&quot;</span><span style="color: #339933;">;</span>
<a name="line3983"></a>            <span style="color: #009900;">&#125;</span>
<a name="line3984"></a>        <span style="color: #009900;">&#125;</span>
<a name="line3985"></a>&nbsp;
<a name="line3986"></a>        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span>GESHI_HEADER_NONE <span style="color: #339933;">==</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">header_type</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3987"></a>            <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">line_numbers</span> <span style="color: #339933;">!=</span> GESHI_NO_LINE_NUMBERS<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3988"></a>                <span style="color: #b1b100;">return</span> <span style="color: #0000ff;">&quot;<span style="color: #006699; font-weight: bold;">$header</span>&lt;ol<span style="color: #006699; font-weight: bold;">$attributes</span><span style="color: #006699; font-weight: bold;">$ol_attributes</span>&gt;&quot;</span><span style="color: #339933;">;</span>
<a name="line3989"></a>            <span style="color: #009900;">&#125;</span>
<a name="line3990"></a>            <span style="color: #b1b100;">return</span> <span style="color: #000088;">$header</span> <span style="color: #339933;">.</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">force_code_block</span> ? <span style="color: #0000ff;">'&lt;div&gt;'</span> <span style="color: #339933;">:</span> <span style="color: #0000ff;">''</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line3991"></a>        <span style="color: #009900;">&#125;</span>
<a name="line3992"></a>&nbsp;
<a name="line3993"></a>        <span style="color: #666666; font-style: italic;">// Work out what to return and do it</span>
<a name="line3994"></a>        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">line_numbers</span> <span style="color: #339933;">!=</span> GESHI_NO_LINE_NUMBERS<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3995"></a>            <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">header_type</span> <span style="color: #339933;">==</span> GESHI_HEADER_PRE<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3996"></a>                <span style="color: #b1b100;">return</span> <span style="color: #0000ff;">&quot;&lt;pre<span style="color: #006699; font-weight: bold;">$attributes</span>&gt;<span style="color: #006699; font-weight: bold;">$header</span>&lt;ol<span style="color: #006699; font-weight: bold;">$ol_attributes</span>&gt;&quot;</span><span style="color: #339933;">;</span>
<a name="line3997"></a>            <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">header_type</span> <span style="color: #339933;">==</span> GESHI_HEADER_DIV <span style="color: #339933;">||</span>
<a name="line3998"></a>                <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">header_type</span> <span style="color: #339933;">==</span> GESHI_HEADER_PRE_VALID<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line3999"></a>                <span style="color: #b1b100;">return</span> <span style="color: #0000ff;">&quot;&lt;div<span style="color: #006699; font-weight: bold;">$attributes</span>&gt;<span style="color: #006699; font-weight: bold;">$header</span>&lt;ol<span style="color: #006699; font-weight: bold;">$ol_attributes</span>&gt;&quot;</span><span style="color: #339933;">;</span>
<a name="line4000"></a>            <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">header_type</span> <span style="color: #339933;">==</span> GESHI_HEADER_PRE_TABLE<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line4001"></a>                <span style="color: #b1b100;">return</span> <span style="color: #0000ff;">&quot;&lt;table<span style="color: #006699; font-weight: bold;">$attributes</span>&gt;<span style="color: #006699; font-weight: bold;">$header</span>&lt;tbody&gt;&lt;tr class=<span style="color: #000099; font-weight: bold;">\&quot;</span>li1<span style="color: #000099; font-weight: bold;">\&quot;</span>&gt;&quot;</span><span style="color: #339933;">;</span>
<a name="line4002"></a>            <span style="color: #009900;">&#125;</span>
<a name="line4003"></a>        <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line4004"></a>            <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">header_type</span> <span style="color: #339933;">==</span> GESHI_HEADER_PRE<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line4005"></a>                <span style="color: #b1b100;">return</span> <span style="color: #0000ff;">&quot;&lt;pre<span style="color: #006699; font-weight: bold;">$attributes</span>&gt;<span style="color: #006699; font-weight: bold;">$header</span>&quot;</span>  <span style="color: #339933;">.</span>
<a name="line4006"></a>                    <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">force_code_block</span> ? <span style="color: #0000ff;">'&lt;div&gt;'</span> <span style="color: #339933;">:</span> <span style="color: #0000ff;">''</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line4007"></a>            <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line4008"></a>                <span style="color: #b1b100;">return</span> <span style="color: #0000ff;">&quot;&lt;div<span style="color: #006699; font-weight: bold;">$attributes</span>&gt;<span style="color: #006699; font-weight: bold;">$header</span>&quot;</span> <span style="color: #339933;">.</span>
<a name="line4009"></a>                    <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">force_code_block</span> ? <span style="color: #0000ff;">'&lt;div&gt;'</span> <span style="color: #339933;">:</span> <span style="color: #0000ff;">''</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line4010"></a>            <span style="color: #009900;">&#125;</span>
<a name="line4011"></a>        <span style="color: #009900;">&#125;</span>
<a name="line4012"></a>    <span style="color: #009900;">&#125;</span>
<a name="line4013"></a>&nbsp;
<a name="line4014"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line4015"></a>     * Returns the footer for the code block.
<a name="line4016"></a>     *
<a name="line4017"></a>     * @return string The footer for the code block
<a name="line4018"></a>     * @since  1.0.0
<a name="line4019"></a>     * @access private
<a name="line4020"></a>     */</span>
<a name="line4021"></a>    <span style="color: #000000; font-weight: bold;">function</span> footer<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line4022"></a>        <span style="color: #000088;">$footer</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">footer_content</span><span style="color: #339933;">;</span>
<a name="line4023"></a>        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$footer</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line4024"></a>            <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">header_type</span> <span style="color: #339933;">==</span> GESHI_HEADER_PRE<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line4025"></a>                <span style="color: #000088;">$footer</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/str_replace"><span style="color: #990000;">str_replace</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">''</span><span style="color: #339933;">,</span> <span style="color: #000088;">$footer</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;;</span>
<a name="line4026"></a>            <span style="color: #009900;">&#125;</span>
<a name="line4027"></a>            <span style="color: #000088;">$footer</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">replace_keywords</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$footer</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line4028"></a>&nbsp;
<a name="line4029"></a>            <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">use_classes</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line4030"></a>                <span style="color: #000088;">$attr</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">' class=&quot;foot&quot;'</span><span style="color: #339933;">;</span>
<a name="line4031"></a>            <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line4032"></a>                <span style="color: #000088;">$attr</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot; style=<span style="color: #000099; font-weight: bold;">\&quot;</span><span style="color: #006699; font-weight: bold;">{$this-&gt;footer_content_style}</span><span style="color: #000099; font-weight: bold;">\&quot;</span>&quot;</span><span style="color: #339933;">;</span>
<a name="line4033"></a>            <span style="color: #009900;">&#125;</span>
<a name="line4034"></a>            <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">header_type</span> <span style="color: #339933;">==</span> GESHI_HEADER_PRE_TABLE <span style="color: #339933;">&amp;&amp;</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">line_numbers</span> <span style="color: #339933;">!=</span> GESHI_NO_LINE_NUMBERS<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line4035"></a>                <span style="color: #000088;">$footer</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;&lt;tfoot&gt;&lt;tr&gt;&lt;td colspan=<span style="color: #000099; font-weight: bold;">\&quot;</span>2<span style="color: #000099; font-weight: bold;">\&quot;</span>&gt;<span style="color: #006699; font-weight: bold;">$footer</span>&lt;/td&gt;&lt;/tr&gt;&lt;/tfoot&gt;&quot;</span><span style="color: #339933;">;</span>
<a name="line4036"></a>            <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line4037"></a>                <span style="color: #000088;">$footer</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;&lt;div<span style="color: #006699; font-weight: bold;">$attr</span>&gt;<span style="color: #006699; font-weight: bold;">$footer</span>&lt;/div&gt;&quot;</span><span style="color: #339933;">;</span>
<a name="line4038"></a>            <span style="color: #009900;">&#125;</span>
<a name="line4039"></a>        <span style="color: #009900;">&#125;</span>
<a name="line4040"></a>&nbsp;
<a name="line4041"></a>        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span>GESHI_HEADER_NONE <span style="color: #339933;">==</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">header_type</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line4042"></a>            <span style="color: #b1b100;">return</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">line_numbers</span> <span style="color: #339933;">!=</span> GESHI_NO_LINE_NUMBERS<span style="color: #009900;">&#41;</span> ? <span style="color: #0000ff;">'&lt;/ol&gt;'</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$footer</span> <span style="color: #339933;">:</span> <span style="color: #000088;">$footer</span><span style="color: #339933;">;</span>
<a name="line4043"></a>        <span style="color: #009900;">&#125;</span>
<a name="line4044"></a>&nbsp;
<a name="line4045"></a>        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">header_type</span> <span style="color: #339933;">==</span> GESHI_HEADER_DIV <span style="color: #339933;">||</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">header_type</span> <span style="color: #339933;">==</span> GESHI_HEADER_PRE_VALID<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line4046"></a>            <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">line_numbers</span> <span style="color: #339933;">!=</span> GESHI_NO_LINE_NUMBERS<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line4047"></a>                <span style="color: #b1b100;">return</span> <span style="color: #0000ff;">&quot;&lt;/ol&gt;<span style="color: #006699; font-weight: bold;">$footer</span>&lt;/div&gt;&quot;</span><span style="color: #339933;">;</span>
<a name="line4048"></a>            <span style="color: #009900;">&#125;</span>
<a name="line4049"></a>            <span style="color: #b1b100;">return</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">force_code_block</span> ? <span style="color: #0000ff;">'&lt;/div&gt;'</span> <span style="color: #339933;">:</span> <span style="color: #0000ff;">''</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">.</span>
<a name="line4050"></a>                <span style="color: #0000ff;">&quot;<span style="color: #006699; font-weight: bold;">$footer</span>&lt;/div&gt;&quot;</span><span style="color: #339933;">;</span>
<a name="line4051"></a>        <span style="color: #009900;">&#125;</span>
<a name="line4052"></a>        <span style="color: #b1b100;">elseif</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">header_type</span> <span style="color: #339933;">==</span> GESHI_HEADER_PRE_TABLE<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line4053"></a>            <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">line_numbers</span> <span style="color: #339933;">!=</span> GESHI_NO_LINE_NUMBERS<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line4054"></a>                <span style="color: #b1b100;">return</span> <span style="color: #0000ff;">&quot;&lt;/tr&gt;&lt;/tbody&gt;<span style="color: #006699; font-weight: bold;">$footer</span>&lt;/table&gt;&quot;</span><span style="color: #339933;">;</span>
<a name="line4055"></a>            <span style="color: #009900;">&#125;</span>
<a name="line4056"></a>            <span style="color: #b1b100;">return</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">force_code_block</span> ? <span style="color: #0000ff;">'&lt;/div&gt;'</span> <span style="color: #339933;">:</span> <span style="color: #0000ff;">''</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">.</span>
<a name="line4057"></a>                <span style="color: #0000ff;">&quot;<span style="color: #006699; font-weight: bold;">$footer</span>&lt;/div&gt;&quot;</span><span style="color: #339933;">;</span>
<a name="line4058"></a>        <span style="color: #009900;">&#125;</span>
<a name="line4059"></a>        <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line4060"></a>            <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">line_numbers</span> <span style="color: #339933;">!=</span> GESHI_NO_LINE_NUMBERS<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line4061"></a>                <span style="color: #b1b100;">return</span> <span style="color: #0000ff;">&quot;&lt;/ol&gt;<span style="color: #006699; font-weight: bold;">$footer</span>&lt;/pre&gt;&quot;</span><span style="color: #339933;">;</span>
<a name="line4062"></a>            <span style="color: #009900;">&#125;</span>
<a name="line4063"></a>            <span style="color: #b1b100;">return</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">force_code_block</span> ? <span style="color: #0000ff;">'&lt;/div&gt;'</span> <span style="color: #339933;">:</span> <span style="color: #0000ff;">''</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">.</span>
<a name="line4064"></a>                <span style="color: #0000ff;">&quot;<span style="color: #006699; font-weight: bold;">$footer</span>&lt;/pre&gt;&quot;</span><span style="color: #339933;">;</span>
<a name="line4065"></a>        <span style="color: #009900;">&#125;</span>
<a name="line4066"></a>    <span style="color: #009900;">&#125;</span>
<a name="line4067"></a>&nbsp;
<a name="line4068"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line4069"></a>     * Replaces certain keywords in the header and footer with
<a name="line4070"></a>     * certain configuration values
<a name="line4071"></a>     *
<a name="line4072"></a>     * @param  string The header or footer content to do replacement on
<a name="line4073"></a>     * @return string The header or footer with replaced keywords
<a name="line4074"></a>     * @since  1.0.2
<a name="line4075"></a>     * @access private
<a name="line4076"></a>     */</span>
<a name="line4077"></a>    <span style="color: #000000; font-weight: bold;">function</span> replace_keywords<span style="color: #009900;">&#40;</span><span style="color: #000088;">$instr</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line4078"></a>        <span style="color: #000088;">$keywords</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$replacements</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line4079"></a>&nbsp;
<a name="line4080"></a>        <span style="color: #000088;">$keywords</span><span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">'&lt;TIME&gt;'</span><span style="color: #339933;">;</span>
<a name="line4081"></a>        <span style="color: #000088;">$keywords</span><span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">'{TIME}'</span><span style="color: #339933;">;</span>
<a name="line4082"></a>        <span style="color: #000088;">$replacements</span><span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$replacements</span><span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/number_format"><span style="color: #990000;">number_format</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$time</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">get_time</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">3</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line4083"></a>&nbsp;
<a name="line4084"></a>        <span style="color: #000088;">$keywords</span><span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">'&lt;LANGUAGE&gt;'</span><span style="color: #339933;">;</span>
<a name="line4085"></a>        <span style="color: #000088;">$keywords</span><span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">'{LANGUAGE}'</span><span style="color: #339933;">;</span>
<a name="line4086"></a>        <span style="color: #000088;">$replacements</span><span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$replacements</span><span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'LANG_NAME'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
<a name="line4087"></a>&nbsp;
<a name="line4088"></a>        <span style="color: #000088;">$keywords</span><span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">'&lt;VERSION&gt;'</span><span style="color: #339933;">;</span>
<a name="line4089"></a>        <span style="color: #000088;">$keywords</span><span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">'{VERSION}'</span><span style="color: #339933;">;</span>
<a name="line4090"></a>        <span style="color: #000088;">$replacements</span><span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$replacements</span><span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> GESHI_VERSION<span style="color: #339933;">;</span>
<a name="line4091"></a>&nbsp;
<a name="line4092"></a>        <span style="color: #000088;">$keywords</span><span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">'&lt;SPEED&gt;'</span><span style="color: #339933;">;</span>
<a name="line4093"></a>        <span style="color: #000088;">$keywords</span><span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">'{SPEED}'</span><span style="color: #339933;">;</span>
<a name="line4094"></a>        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$time</span> <span style="color: #339933;">&lt;=</span> <span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line4095"></a>            <span style="color: #000088;">$speed</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">'N/A'</span><span style="color: #339933;">;</span>
<a name="line4096"></a>        <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line4097"></a>            <span style="color: #000088;">$speed</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/strlen"><span style="color: #990000;">strlen</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">source</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">/</span> <span style="color: #000088;">$time</span><span style="color: #339933;">;</span>
<a name="line4098"></a>            <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$speed</span> <span style="color: #339933;">&gt;=</span> <span style="color: #cc66cc;">1024</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line4099"></a>                <span style="color: #000088;">$speed</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/sprintf"><span style="color: #990000;">sprintf</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;<span style="color: #009933; font-weight: bold;">%.2f</span> KB/s&quot;</span><span style="color: #339933;">,</span> <span style="color: #000088;">$speed</span> <span style="color: #339933;">/</span> <span style="color:#800080;">1024.0</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line4100"></a>            <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line4101"></a>                <span style="color: #000088;">$speed</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/sprintf"><span style="color: #990000;">sprintf</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;<span style="color: #009933; font-weight: bold;">%.0f</span> B/s&quot;</span><span style="color: #339933;">,</span> <span style="color: #000088;">$speed</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line4102"></a>            <span style="color: #009900;">&#125;</span>
<a name="line4103"></a>        <span style="color: #009900;">&#125;</span>
<a name="line4104"></a>        <span style="color: #000088;">$replacements</span><span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$replacements</span><span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$speed</span><span style="color: #339933;">;</span>
<a name="line4105"></a>&nbsp;
<a name="line4106"></a>        <span style="color: #b1b100;">return</span> <a href="http://www.php.net/str_replace"><span style="color: #990000;">str_replace</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$keywords</span><span style="color: #339933;">,</span> <span style="color: #000088;">$replacements</span><span style="color: #339933;">,</span> <span style="color: #000088;">$instr</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line4107"></a>    <span style="color: #009900;">&#125;</span>
<a name="line4108"></a>&nbsp;
<a name="line4109"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line4110"></a>     * Secure replacement for PHP built-in function htmlspecialchars().
<a name="line4111"></a>     *
<a name="line4112"></a>     * See ticket #427 (http://wush.net/trac/wikka/ticket/427) for the rationale
<a name="line4113"></a>     * for this replacement function.
<a name="line4114"></a>     *
<a name="line4115"></a>     * The INTERFACE for this function is almost the same as that for
<a name="line4116"></a>     * htmlspecialchars(), with the same default for quote style; however, there
<a name="line4117"></a>     * is no 'charset' parameter. The reason for this is as follows:
<a name="line4118"></a>     *
<a name="line4119"></a>     * The PHP docs say:
<a name="line4120"></a>     *      &quot;The third argument charset defines character set used in conversion.&quot;
<a name="line4121"></a>     *
<a name="line4122"></a>     * I suspect PHP's htmlspecialchars() is working at the byte-value level and
<a name="line4123"></a>     * thus _needs_ to know (or asssume) a character set because the special
<a name="line4124"></a>     * characters to be replaced could exist at different code points in
<a name="line4125"></a>     * different character sets. (If indeed htmlspecialchars() works at
<a name="line4126"></a>     * byte-value level that goes some  way towards explaining why the
<a name="line4127"></a>     * vulnerability would exist in this function, too, and not only in
<a name="line4128"></a>     * htmlentities() which certainly is working at byte-value level.)
<a name="line4129"></a>     *
<a name="line4130"></a>     * This replacement function however works at character level and should
<a name="line4131"></a>     * therefore be &quot;immune&quot; to character set differences - so no charset
<a name="line4132"></a>     * parameter is needed or provided. If a third parameter is passed, it will
<a name="line4133"></a>     * be silently ignored.
<a name="line4134"></a>     *
<a name="line4135"></a>     * In the OUTPUT there is a minor difference in that we use '&amp;#39;' instead
<a name="line4136"></a>     * of PHP's '&amp;#039;' for a single quote: this provides compatibility with
<a name="line4137"></a>     *      get_html_translation_table(HTML_SPECIALCHARS, ENT_QUOTES)
<a name="line4138"></a>     * (see comment by mikiwoz at yahoo dot co dot uk on
<a name="line4139"></a>     * http://php.net/htmlspecialchars); it also matches the entity definition
<a name="line4140"></a>     * for XML 1.0
<a name="line4141"></a>     * (http://www.w3.org/TR/xhtml1/dtds.html#a_dtd_Special_characters).
<a name="line4142"></a>     * Like PHP we use a numeric character reference instead of '&amp;apos;' for the
<a name="line4143"></a>     * single quote. For the other special characters we use the named entity
<a name="line4144"></a>     * references, as PHP is doing.
<a name="line4145"></a>     *
<a name="line4146"></a>     * @author      {@link http://wikkawiki.org/JavaWoman Marjolein Katsma}
<a name="line4147"></a>     *
<a name="line4148"></a>     * @license     http://www.gnu.org/copyleft/lgpl.html
<a name="line4149"></a>     *              GNU Lesser General Public License
<a name="line4150"></a>     * @copyright   Copyright 2007, {@link http://wikkawiki.org/CreditsPage
<a name="line4151"></a>     *              Wikka Development Team}
<a name="line4152"></a>     *
<a name="line4153"></a>     * @access      private
<a name="line4154"></a>     * @param       string  $string string to be converted
<a name="line4155"></a>     * @param       integer $quote_style
<a name="line4156"></a>     *                      - ENT_COMPAT:   escapes &amp;, &lt;, &gt; and double quote (default)
<a name="line4157"></a>     *                      - ENT_NOQUOTES: escapes only &amp;, &lt; and &gt;
<a name="line4158"></a>     *                      - ENT_QUOTES:   escapes &amp;, &lt;, &gt;, double and single quotes
<a name="line4159"></a>     * @return      string  converted string
<a name="line4160"></a>     * @since       1.0.7.18
<a name="line4161"></a>     */</span>
<a name="line4162"></a>    <span style="color: #000000; font-weight: bold;">function</span> hsc<span style="color: #009900;">&#40;</span><span style="color: #000088;">$string</span><span style="color: #339933;">,</span> <span style="color: #000088;">$quote_style</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">ENT_COMPAT</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line4163"></a>        <span style="color: #666666; font-style: italic;">// init</span>
<a name="line4164"></a>        static <span style="color: #000088;">$aTransSpecchar</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span>
<a name="line4165"></a>            <span style="color: #0000ff;">'&amp;'</span> <span style="color: #339933;">=&gt;</span> <span style="color: #0000ff;">'&amp;amp;'</span><span style="color: #339933;">,</span>
<a name="line4166"></a>            <span style="color: #0000ff;">'&quot;'</span> <span style="color: #339933;">=&gt;</span> <span style="color: #0000ff;">'&amp;quot;'</span><span style="color: #339933;">,</span>
<a name="line4167"></a>            <span style="color: #0000ff;">'&lt;'</span> <span style="color: #339933;">=&gt;</span> <span style="color: #0000ff;">'&amp;lt;'</span><span style="color: #339933;">,</span>
<a name="line4168"></a>            <span style="color: #0000ff;">'&gt;'</span> <span style="color: #339933;">=&gt;</span> <span style="color: #0000ff;">'&amp;gt;'</span><span style="color: #339933;">,</span>
<a name="line4169"></a>&nbsp;
<a name="line4170"></a>            <span style="color: #666666; font-style: italic;">//This fix is related to SF#1923020, but has to be applied</span>
<a name="line4171"></a>            <span style="color: #666666; font-style: italic;">//regardless of actually highlighting symbols.</span>
<a name="line4172"></a>&nbsp;
<a name="line4173"></a>            <span style="color: #666666; font-style: italic;">//Circumvent a bug with symbol highlighting</span>
<a name="line4174"></a>            <span style="color: #666666; font-style: italic;">//This is required as ; would produce undesirable side-effects if it</span>
<a name="line4175"></a>            <span style="color: #666666; font-style: italic;">//was not to be processed as an entity.</span>
<a name="line4176"></a>            <span style="color: #0000ff;">';'</span> <span style="color: #339933;">=&gt;</span> <span style="color: #0000ff;">'&lt;SEMI&gt;'</span><span style="color: #339933;">,</span> <span style="color: #666666; font-style: italic;">// Force ; to be processed as entity</span>
<a name="line4177"></a>            <span style="color: #0000ff;">'|'</span> <span style="color: #339933;">=&gt;</span> <span style="color: #0000ff;">'&lt;PIPE&gt;'</span> <span style="color: #666666; font-style: italic;">// Force | to be processed as entity</span>
<a name="line4178"></a>            <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>                      <span style="color: #666666; font-style: italic;">// ENT_COMPAT set</span>
<a name="line4179"></a>&nbsp;
<a name="line4180"></a>        <span style="color: #b1b100;">switch</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$quote_style</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line4181"></a>            <span style="color: #b1b100;">case</span> <span style="color: #009900; font-weight: bold;">ENT_NOQUOTES</span><span style="color: #339933;">:</span> <span style="color: #666666; font-style: italic;">// don't convert double quotes</span>
<a name="line4182"></a>                <a href="http://www.php.net/unset"><span style="color: #990000;">unset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$aTransSpecchar</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'&quot;'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line4183"></a>                <span style="color: #b1b100;">break</span><span style="color: #339933;">;</span>
<a name="line4184"></a>            <span style="color: #b1b100;">case</span> <span style="color: #009900; font-weight: bold;">ENT_QUOTES</span><span style="color: #339933;">:</span> <span style="color: #666666; font-style: italic;">// convert single quotes as well</span>
<a name="line4185"></a>                <span style="color: #000088;">$aTransSpecchar</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">&quot;'&quot;</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">'&amp;#39;'</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">// (apos) htmlspecialchars() uses '&amp;#039;'</span>
<a name="line4186"></a>                <span style="color: #b1b100;">break</span><span style="color: #339933;">;</span>
<a name="line4187"></a>        <span style="color: #009900;">&#125;</span>
<a name="line4188"></a>&nbsp;
<a name="line4189"></a>        <span style="color: #666666; font-style: italic;">// return translated string</span>
<a name="line4190"></a>        <span style="color: #b1b100;">return</span> <a href="http://www.php.net/strtr"><span style="color: #990000;">strtr</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$string</span><span style="color: #339933;">,</span> <span style="color: #000088;">$aTransSpecchar</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line4191"></a>    <span style="color: #009900;">&#125;</span>
<a name="line4192"></a>&nbsp;
<a name="line4193"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line4194"></a>     * Returns a stylesheet for the highlighted code. If $economy mode
<a name="line4195"></a>     * is true, we only return the stylesheet declarations that matter for
<a name="line4196"></a>     * this code block instead of the whole thing
<a name="line4197"></a>     *
<a name="line4198"></a>     * @param  boolean Whether to use economy mode or not
<a name="line4199"></a>     * @return string A stylesheet built on the data for the current language
<a name="line4200"></a>     * @since  1.0.0
<a name="line4201"></a>     */</span>
<a name="line4202"></a>    <span style="color: #000000; font-weight: bold;">function</span> get_stylesheet<span style="color: #009900;">&#40;</span><span style="color: #000088;">$economy_mode</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">true</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line4203"></a>        <span style="color: #666666; font-style: italic;">// If there's an error, chances are that the language file</span>
<a name="line4204"></a>        <span style="color: #666666; font-style: italic;">// won't have populated the language data file, so we can't</span>
<a name="line4205"></a>        <span style="color: #666666; font-style: italic;">// risk getting a stylesheet...</span>
<a name="line4206"></a>        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">error</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line4207"></a>            <span style="color: #b1b100;">return</span> <span style="color: #0000ff;">''</span><span style="color: #339933;">;</span>
<a name="line4208"></a>        <span style="color: #009900;">&#125;</span>
<a name="line4209"></a>&nbsp;
<a name="line4210"></a>        <span style="color: #666666; font-style: italic;">//Check if the style rearrangements have been processed ...</span>
<a name="line4211"></a>        <span style="color: #666666; font-style: italic;">//This also does some preprocessing to check which style groups are useable ...</span>
<a name="line4212"></a>        <span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><a href="http://www.php.net/isset"><span style="color: #990000;">isset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'NUMBERS_CACHE'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line4213"></a>            <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">build_style_cache</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line4214"></a>        <span style="color: #009900;">&#125;</span>
<a name="line4215"></a>&nbsp;
<a name="line4216"></a>        <span style="color: #666666; font-style: italic;">// First, work out what the selector should be. If there's an ID,</span>
<a name="line4217"></a>        <span style="color: #666666; font-style: italic;">// that should be used, the same for a class. Otherwise, a selector</span>
<a name="line4218"></a>        <span style="color: #666666; font-style: italic;">// of '' means that these styles will be applied anywhere</span>
<a name="line4219"></a>        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">overall_id</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line4220"></a>            <span style="color: #000088;">$selector</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">'#'</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">overall_id</span><span style="color: #339933;">;</span>
<a name="line4221"></a>        <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line4222"></a>            <span style="color: #000088;">$selector</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">'.'</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language</span><span style="color: #339933;">;</span>
<a name="line4223"></a>            <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">overall_class</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line4224"></a>                <span style="color: #000088;">$selector</span> <span style="color: #339933;">.=</span> <span style="color: #0000ff;">'.'</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">overall_class</span><span style="color: #339933;">;</span>
<a name="line4225"></a>            <span style="color: #009900;">&#125;</span>
<a name="line4226"></a>        <span style="color: #009900;">&#125;</span>
<a name="line4227"></a>        <span style="color: #000088;">$selector</span> <span style="color: #339933;">.=</span> <span style="color: #0000ff;">' '</span><span style="color: #339933;">;</span>
<a name="line4228"></a>&nbsp;
<a name="line4229"></a>        <span style="color: #666666; font-style: italic;">// Header of the stylesheet</span>
<a name="line4230"></a>        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><span style="color: #000088;">$economy_mode</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line4231"></a>            <span style="color: #000088;">$stylesheet</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;/**<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">.</span>
<a name="line4232"></a>                <span style="color: #0000ff;">&quot; * GeSHi Dynamically Generated Stylesheet<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">.</span>
<a name="line4233"></a>                <span style="color: #0000ff;">&quot; * --------------------------------------<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">.</span>
<a name="line4234"></a>                <span style="color: #0000ff;">&quot; * Dynamically generated stylesheet for <span style="color: #006699; font-weight: bold;">{$this-&gt;language}</span><span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">.</span>
<a name="line4235"></a>                <span style="color: #0000ff;">&quot; * CSS class: <span style="color: #006699; font-weight: bold;">{$this-&gt;overall_class}</span>, CSS id: <span style="color: #006699; font-weight: bold;">{$this-&gt;overall_id}</span><span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">.</span>
<a name="line4236"></a>                <span style="color: #0000ff;">&quot; * GeSHi (C) 2004 - 2007 Nigel McNie, 2007 - 2008 Benny Baumann<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">.</span>
<a name="line4237"></a>                <span style="color: #0000ff;">&quot; * (http://qbnz.com/highlighter/ and http://geshi.org/)<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">.</span>
<a name="line4238"></a>                <span style="color: #0000ff;">&quot; * --------------------------------------<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">.</span>
<a name="line4239"></a>                <span style="color: #0000ff;">&quot; */<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span>
<a name="line4240"></a>        <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line4241"></a>            <span style="color: #000088;">$stylesheet</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;/**<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">.</span>
<a name="line4242"></a>                <span style="color: #0000ff;">&quot; * GeSHi (C) 2004 - 2007 Nigel McNie, 2007 - 2008 Benny Baumann<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">.</span>
<a name="line4243"></a>                <span style="color: #0000ff;">&quot; * (http://qbnz.com/highlighter/ and http://geshi.org/)<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">.</span>
<a name="line4244"></a>                <span style="color: #0000ff;">&quot; */<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span>
<a name="line4245"></a>        <span style="color: #009900;">&#125;</span>
<a name="line4246"></a>&nbsp;
<a name="line4247"></a>        <span style="color: #666666; font-style: italic;">// Set the &lt;ol&gt; to have no effect at all if there are line numbers</span>
<a name="line4248"></a>        <span style="color: #666666; font-style: italic;">// (&lt;ol&gt;s have margins that should be destroyed so all layout is</span>
<a name="line4249"></a>        <span style="color: #666666; font-style: italic;">// controlled by the set_overall_style method, which works on the</span>
<a name="line4250"></a>        <span style="color: #666666; font-style: italic;">// &lt;pre&gt; or &lt;div&gt; container). Additionally, set default styles for lines</span>
<a name="line4251"></a>        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><span style="color: #000088;">$economy_mode</span> <span style="color: #339933;">||</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">line_numbers</span> <span style="color: #339933;">!=</span> GESHI_NO_LINE_NUMBERS<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line4252"></a>            <span style="color: #666666; font-style: italic;">//$stylesheet .= &quot;$selector, {$selector}ol, {$selector}ol li {margin: 0;}\n&quot;;</span>
<a name="line4253"></a>            <span style="color: #000088;">$stylesheet</span> <span style="color: #339933;">.=</span> <span style="color: #0000ff;">&quot;<span style="color: #006699; font-weight: bold;">$selector</span>.de1, <span style="color: #006699; font-weight: bold;">$selector</span>.de2 {<span style="color: #006699; font-weight: bold;">{$this-&gt;code_style}</span>}<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span>
<a name="line4254"></a>        <span style="color: #009900;">&#125;</span>
<a name="line4255"></a>&nbsp;
<a name="line4256"></a>        <span style="color: #666666; font-style: italic;">// Add overall styles</span>
<a name="line4257"></a>        <span style="color: #666666; font-style: italic;">// note: neglect economy_mode, empty styles are meaningless</span>
<a name="line4258"></a>        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">overall_style</span> <span style="color: #339933;">!=</span> <span style="color: #0000ff;">''</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line4259"></a>            <span style="color: #000088;">$stylesheet</span> <span style="color: #339933;">.=</span> <span style="color: #0000ff;">&quot;<span style="color: #006699; font-weight: bold;">$selector</span> {<span style="color: #006699; font-weight: bold;">{$this-&gt;overall_style}</span>}<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span>
<a name="line4260"></a>        <span style="color: #009900;">&#125;</span>
<a name="line4261"></a>&nbsp;
<a name="line4262"></a>        <span style="color: #666666; font-style: italic;">// Add styles for links</span>
<a name="line4263"></a>        <span style="color: #666666; font-style: italic;">// note: economy mode does not make _any_ sense here</span>
<a name="line4264"></a>        <span style="color: #666666; font-style: italic;">//       either the style is empty and thus no selector is needed</span>
<a name="line4265"></a>        <span style="color: #666666; font-style: italic;">//       or the appropriate key is given.</span>
<a name="line4266"></a>        <span style="color: #b1b100;">foreach</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">link_styles</span> <span style="color: #b1b100;">as</span> <span style="color: #000088;">$key</span> <span style="color: #339933;">=&gt;</span> <span style="color: #000088;">$style</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line4267"></a>            <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$style</span> <span style="color: #339933;">!=</span> <span style="color: #0000ff;">''</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line4268"></a>                <span style="color: #b1b100;">switch</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$key</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line4269"></a>                    <span style="color: #b1b100;">case</span> GESHI_LINK<span style="color: #339933;">:</span>
<a name="line4270"></a>                        <span style="color: #000088;">$stylesheet</span> <span style="color: #339933;">.=</span> <span style="color: #0000ff;">&quot;<span style="color: #006699; font-weight: bold;">{$selector}</span>a:link {<span style="color: #006699; font-weight: bold;">{$style}</span>}<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span>
<a name="line4271"></a>                        <span style="color: #b1b100;">break</span><span style="color: #339933;">;</span>
<a name="line4272"></a>                    <span style="color: #b1b100;">case</span> GESHI_HOVER<span style="color: #339933;">:</span>
<a name="line4273"></a>                        <span style="color: #000088;">$stylesheet</span> <span style="color: #339933;">.=</span> <span style="color: #0000ff;">&quot;<span style="color: #006699; font-weight: bold;">{$selector}</span>a:hover {<span style="color: #006699; font-weight: bold;">{$style}</span>}<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span>
<a name="line4274"></a>                        <span style="color: #b1b100;">break</span><span style="color: #339933;">;</span>
<a name="line4275"></a>                    <span style="color: #b1b100;">case</span> GESHI_ACTIVE<span style="color: #339933;">:</span>
<a name="line4276"></a>                        <span style="color: #000088;">$stylesheet</span> <span style="color: #339933;">.=</span> <span style="color: #0000ff;">&quot;<span style="color: #006699; font-weight: bold;">{$selector}</span>a:active {<span style="color: #006699; font-weight: bold;">{$style}</span>}<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span>
<a name="line4277"></a>                        <span style="color: #b1b100;">break</span><span style="color: #339933;">;</span>
<a name="line4278"></a>                    <span style="color: #b1b100;">case</span> GESHI_VISITED<span style="color: #339933;">:</span>
<a name="line4279"></a>                        <span style="color: #000088;">$stylesheet</span> <span style="color: #339933;">.=</span> <span style="color: #0000ff;">&quot;<span style="color: #006699; font-weight: bold;">{$selector}</span>a:visited {<span style="color: #006699; font-weight: bold;">{$style}</span>}<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span>
<a name="line4280"></a>                        <span style="color: #b1b100;">break</span><span style="color: #339933;">;</span>
<a name="line4281"></a>                <span style="color: #009900;">&#125;</span>
<a name="line4282"></a>            <span style="color: #009900;">&#125;</span>
<a name="line4283"></a>        <span style="color: #009900;">&#125;</span>
<a name="line4284"></a>&nbsp;
<a name="line4285"></a>        <span style="color: #666666; font-style: italic;">// Header and footer</span>
<a name="line4286"></a>        <span style="color: #666666; font-style: italic;">// note: neglect economy_mode, empty styles are meaningless</span>
<a name="line4287"></a>        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">header_content_style</span> <span style="color: #339933;">!=</span> <span style="color: #0000ff;">''</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line4288"></a>            <span style="color: #000088;">$stylesheet</span> <span style="color: #339933;">.=</span> <span style="color: #0000ff;">&quot;<span style="color: #006699; font-weight: bold;">$selector</span>.head {<span style="color: #006699; font-weight: bold;">{$this-&gt;header_content_style}</span>}<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span>
<a name="line4289"></a>        <span style="color: #009900;">&#125;</span>
<a name="line4290"></a>        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">footer_content_style</span> <span style="color: #339933;">!=</span> <span style="color: #0000ff;">''</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line4291"></a>            <span style="color: #000088;">$stylesheet</span> <span style="color: #339933;">.=</span> <span style="color: #0000ff;">&quot;<span style="color: #006699; font-weight: bold;">$selector</span>.foot {<span style="color: #006699; font-weight: bold;">{$this-&gt;footer_content_style}</span>}<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span>
<a name="line4292"></a>        <span style="color: #009900;">&#125;</span>
<a name="line4293"></a>&nbsp;
<a name="line4294"></a>        <span style="color: #666666; font-style: italic;">// Styles for important stuff</span>
<a name="line4295"></a>        <span style="color: #666666; font-style: italic;">// note: neglect economy_mode, empty styles are meaningless</span>
<a name="line4296"></a>        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">important_styles</span> <span style="color: #339933;">!=</span> <span style="color: #0000ff;">''</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line4297"></a>            <span style="color: #000088;">$stylesheet</span> <span style="color: #339933;">.=</span> <span style="color: #0000ff;">&quot;<span style="color: #006699; font-weight: bold;">$selector</span>.imp {<span style="color: #006699; font-weight: bold;">{$this-&gt;important_styles}</span>}<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span>
<a name="line4298"></a>        <span style="color: #009900;">&#125;</span>
<a name="line4299"></a>&nbsp;
<a name="line4300"></a>        <span style="color: #666666; font-style: italic;">// Simple line number styles</span>
<a name="line4301"></a>        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><span style="color: #000088;">$economy_mode</span> <span style="color: #339933;">||</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">line_numbers</span> <span style="color: #339933;">!=</span> GESHI_NO_LINE_NUMBERS<span style="color: #009900;">&#41;</span> <span style="color: #339933;">&amp;&amp;</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">line_style1</span> <span style="color: #339933;">!=</span> <span style="color: #0000ff;">''</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line4302"></a>            <span style="color: #000088;">$stylesheet</span> <span style="color: #339933;">.=</span> <span style="color: #0000ff;">&quot;<span style="color: #006699; font-weight: bold;">{$selector}</span>li, <span style="color: #006699; font-weight: bold;">{$selector}</span>.li1 {<span style="color: #006699; font-weight: bold;">{$this-&gt;line_style1}</span>}<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span>
<a name="line4303"></a>        <span style="color: #009900;">&#125;</span>
<a name="line4304"></a>        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><span style="color: #000088;">$economy_mode</span> <span style="color: #339933;">||</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">line_numbers</span> <span style="color: #339933;">!=</span> GESHI_NO_LINE_NUMBERS<span style="color: #009900;">&#41;</span> <span style="color: #339933;">&amp;&amp;</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">table_linenumber_style</span> <span style="color: #339933;">!=</span> <span style="color: #0000ff;">''</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line4305"></a>            <span style="color: #000088;">$stylesheet</span> <span style="color: #339933;">.=</span> <span style="color: #0000ff;">&quot;<span style="color: #006699; font-weight: bold;">{$selector}</span>.ln {<span style="color: #006699; font-weight: bold;">{$this-&gt;table_linenumber_style}</span>}<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span>
<a name="line4306"></a>        <span style="color: #009900;">&#125;</span>
<a name="line4307"></a>        <span style="color: #666666; font-style: italic;">// If there is a style set for fancy line numbers, echo it out</span>
<a name="line4308"></a>        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><span style="color: #000088;">$economy_mode</span> <span style="color: #339933;">||</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">line_numbers</span> <span style="color: #339933;">==</span> GESHI_FANCY_LINE_NUMBERS<span style="color: #009900;">&#41;</span> <span style="color: #339933;">&amp;&amp;</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">line_style2</span> <span style="color: #339933;">!=</span> <span style="color: #0000ff;">''</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line4309"></a>            <span style="color: #000088;">$stylesheet</span> <span style="color: #339933;">.=</span> <span style="color: #0000ff;">&quot;<span style="color: #006699; font-weight: bold;">{$selector}</span>.li2 {<span style="color: #006699; font-weight: bold;">{$this-&gt;line_style2}</span>}<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span>
<a name="line4310"></a>        <span style="color: #009900;">&#125;</span>
<a name="line4311"></a>&nbsp;
<a name="line4312"></a>        <span style="color: #666666; font-style: italic;">// note: empty styles are meaningless</span>
<a name="line4313"></a>        <span style="color: #b1b100;">foreach</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'STYLES'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'KEYWORDS'</span><span style="color: #009900;">&#93;</span> <span style="color: #b1b100;">as</span> <span style="color: #000088;">$group</span> <span style="color: #339933;">=&gt;</span> <span style="color: #000088;">$styles</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line4314"></a>            <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$styles</span> <span style="color: #339933;">!=</span> <span style="color: #0000ff;">''</span> <span style="color: #339933;">&amp;&amp;</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><span style="color: #000088;">$economy_mode</span> <span style="color: #339933;">||</span>
<a name="line4315"></a>                <span style="color: #009900;">&#40;</span><a href="http://www.php.net/isset"><span style="color: #990000;">isset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">lexic_permissions</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'KEYWORDS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$group</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">&amp;&amp;</span>
<a name="line4316"></a>                <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">lexic_permissions</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'KEYWORDS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$group</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line4317"></a>                <span style="color: #000088;">$stylesheet</span> <span style="color: #339933;">.=</span> <span style="color: #0000ff;">&quot;<span style="color: #006699; font-weight: bold;">$selector</span>.kw<span style="color: #006699; font-weight: bold;">$group</span> {<span style="color: #006699; font-weight: bold;">{$styles}</span>}<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span>
<a name="line4318"></a>            <span style="color: #009900;">&#125;</span>
<a name="line4319"></a>        <span style="color: #009900;">&#125;</span>
<a name="line4320"></a>        <span style="color: #b1b100;">foreach</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'STYLES'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'COMMENTS'</span><span style="color: #009900;">&#93;</span> <span style="color: #b1b100;">as</span> <span style="color: #000088;">$group</span> <span style="color: #339933;">=&gt;</span> <span style="color: #000088;">$styles</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line4321"></a>            <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$styles</span> <span style="color: #339933;">!=</span> <span style="color: #0000ff;">''</span> <span style="color: #339933;">&amp;&amp;</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><span style="color: #000088;">$economy_mode</span> <span style="color: #339933;">||</span>
<a name="line4322"></a>                <span style="color: #009900;">&#40;</span><a href="http://www.php.net/isset"><span style="color: #990000;">isset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">lexic_permissions</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'COMMENTS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$group</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">&amp;&amp;</span>
<a name="line4323"></a>                <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">lexic_permissions</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'COMMENTS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$group</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">||</span>
<a name="line4324"></a>                <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><a href="http://www.php.net/empty"><span style="color: #990000;">empty</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'COMMENT_REGEXP'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">&amp;&amp;</span>
<a name="line4325"></a>                <span style="color: #339933;">!</span><a href="http://www.php.net/empty"><span style="color: #990000;">empty</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'COMMENT_REGEXP'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$group</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line4326"></a>                <span style="color: #000088;">$stylesheet</span> <span style="color: #339933;">.=</span> <span style="color: #0000ff;">&quot;<span style="color: #006699; font-weight: bold;">$selector</span>.co<span style="color: #006699; font-weight: bold;">$group</span> {<span style="color: #006699; font-weight: bold;">{$styles}</span>}<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span>
<a name="line4327"></a>            <span style="color: #009900;">&#125;</span>
<a name="line4328"></a>        <span style="color: #009900;">&#125;</span>
<a name="line4329"></a>        <span style="color: #b1b100;">foreach</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'STYLES'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'ESCAPE_CHAR'</span><span style="color: #009900;">&#93;</span> <span style="color: #b1b100;">as</span> <span style="color: #000088;">$group</span> <span style="color: #339933;">=&gt;</span> <span style="color: #000088;">$styles</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line4330"></a>            <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$styles</span> <span style="color: #339933;">!=</span> <span style="color: #0000ff;">''</span> <span style="color: #339933;">&amp;&amp;</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><span style="color: #000088;">$economy_mode</span> <span style="color: #339933;">||</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">lexic_permissions</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'ESCAPE_CHAR'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line4331"></a>                <span style="color: #666666; font-style: italic;">// NEW: since 1.0.8 we have to handle hardescapes</span>
<a name="line4332"></a>                <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$group</span> <span style="color: #339933;">===</span> <span style="color: #0000ff;">'HARD'</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line4333"></a>                    <span style="color: #000088;">$group</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">'_h'</span><span style="color: #339933;">;</span>
<a name="line4334"></a>                <span style="color: #009900;">&#125;</span>
<a name="line4335"></a>                <span style="color: #000088;">$stylesheet</span> <span style="color: #339933;">.=</span> <span style="color: #0000ff;">&quot;<span style="color: #006699; font-weight: bold;">$selector</span>.es<span style="color: #006699; font-weight: bold;">$group</span> {<span style="color: #006699; font-weight: bold;">{$styles}</span>}<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span>
<a name="line4336"></a>            <span style="color: #009900;">&#125;</span>
<a name="line4337"></a>        <span style="color: #009900;">&#125;</span>
<a name="line4338"></a>        <span style="color: #b1b100;">foreach</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'STYLES'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'BRACKETS'</span><span style="color: #009900;">&#93;</span> <span style="color: #b1b100;">as</span> <span style="color: #000088;">$group</span> <span style="color: #339933;">=&gt;</span> <span style="color: #000088;">$styles</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line4339"></a>            <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$styles</span> <span style="color: #339933;">!=</span> <span style="color: #0000ff;">''</span> <span style="color: #339933;">&amp;&amp;</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><span style="color: #000088;">$economy_mode</span> <span style="color: #339933;">||</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">lexic_permissions</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'BRACKETS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line4340"></a>                <span style="color: #000088;">$stylesheet</span> <span style="color: #339933;">.=</span> <span style="color: #0000ff;">&quot;<span style="color: #006699; font-weight: bold;">$selector</span>.br<span style="color: #006699; font-weight: bold;">$group</span> {<span style="color: #006699; font-weight: bold;">{$styles}</span>}<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span>
<a name="line4341"></a>            <span style="color: #009900;">&#125;</span>
<a name="line4342"></a>        <span style="color: #009900;">&#125;</span>
<a name="line4343"></a>        <span style="color: #b1b100;">foreach</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'STYLES'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'SYMBOLS'</span><span style="color: #009900;">&#93;</span> <span style="color: #b1b100;">as</span> <span style="color: #000088;">$group</span> <span style="color: #339933;">=&gt;</span> <span style="color: #000088;">$styles</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line4344"></a>            <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$styles</span> <span style="color: #339933;">!=</span> <span style="color: #0000ff;">''</span> <span style="color: #339933;">&amp;&amp;</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><span style="color: #000088;">$economy_mode</span> <span style="color: #339933;">||</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">lexic_permissions</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'SYMBOLS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line4345"></a>                <span style="color: #000088;">$stylesheet</span> <span style="color: #339933;">.=</span> <span style="color: #0000ff;">&quot;<span style="color: #006699; font-weight: bold;">$selector</span>.sy<span style="color: #006699; font-weight: bold;">$group</span> {<span style="color: #006699; font-weight: bold;">{$styles}</span>}<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span>
<a name="line4346"></a>            <span style="color: #009900;">&#125;</span>
<a name="line4347"></a>        <span style="color: #009900;">&#125;</span>
<a name="line4348"></a>        <span style="color: #b1b100;">foreach</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'STYLES'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'STRINGS'</span><span style="color: #009900;">&#93;</span> <span style="color: #b1b100;">as</span> <span style="color: #000088;">$group</span> <span style="color: #339933;">=&gt;</span> <span style="color: #000088;">$styles</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line4349"></a>            <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$styles</span> <span style="color: #339933;">!=</span> <span style="color: #0000ff;">''</span> <span style="color: #339933;">&amp;&amp;</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><span style="color: #000088;">$economy_mode</span> <span style="color: #339933;">||</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">lexic_permissions</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'STRINGS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line4350"></a>                <span style="color: #666666; font-style: italic;">// NEW: since 1.0.8 we have to handle hardquotes</span>
<a name="line4351"></a>                <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$group</span> <span style="color: #339933;">===</span> <span style="color: #0000ff;">'HARD'</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line4352"></a>                    <span style="color: #000088;">$group</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">'_h'</span><span style="color: #339933;">;</span>
<a name="line4353"></a>                <span style="color: #009900;">&#125;</span>
<a name="line4354"></a>                <span style="color: #000088;">$stylesheet</span> <span style="color: #339933;">.=</span> <span style="color: #0000ff;">&quot;<span style="color: #006699; font-weight: bold;">$selector</span>.st<span style="color: #006699; font-weight: bold;">$group</span> {<span style="color: #006699; font-weight: bold;">{$styles}</span>}<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span>
<a name="line4355"></a>            <span style="color: #009900;">&#125;</span>
<a name="line4356"></a>        <span style="color: #009900;">&#125;</span>
<a name="line4357"></a>        <span style="color: #b1b100;">foreach</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'STYLES'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'NUMBERS'</span><span style="color: #009900;">&#93;</span> <span style="color: #b1b100;">as</span> <span style="color: #000088;">$group</span> <span style="color: #339933;">=&gt;</span> <span style="color: #000088;">$styles</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line4358"></a>            <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$styles</span> <span style="color: #339933;">!=</span> <span style="color: #0000ff;">''</span> <span style="color: #339933;">&amp;&amp;</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><span style="color: #000088;">$economy_mode</span> <span style="color: #339933;">||</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">lexic_permissions</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'NUMBERS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line4359"></a>                <span style="color: #000088;">$stylesheet</span> <span style="color: #339933;">.=</span> <span style="color: #0000ff;">&quot;<span style="color: #006699; font-weight: bold;">$selector</span>.nu<span style="color: #006699; font-weight: bold;">$group</span> {<span style="color: #006699; font-weight: bold;">{$styles}</span>}<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span>
<a name="line4360"></a>            <span style="color: #009900;">&#125;</span>
<a name="line4361"></a>        <span style="color: #009900;">&#125;</span>
<a name="line4362"></a>        <span style="color: #b1b100;">foreach</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'STYLES'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'METHODS'</span><span style="color: #009900;">&#93;</span> <span style="color: #b1b100;">as</span> <span style="color: #000088;">$group</span> <span style="color: #339933;">=&gt;</span> <span style="color: #000088;">$styles</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line4363"></a>            <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$styles</span> <span style="color: #339933;">!=</span> <span style="color: #0000ff;">''</span> <span style="color: #339933;">&amp;&amp;</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><span style="color: #000088;">$economy_mode</span> <span style="color: #339933;">||</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">lexic_permissions</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'METHODS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line4364"></a>                <span style="color: #000088;">$stylesheet</span> <span style="color: #339933;">.=</span> <span style="color: #0000ff;">&quot;<span style="color: #006699; font-weight: bold;">$selector</span>.me<span style="color: #006699; font-weight: bold;">$group</span> {<span style="color: #006699; font-weight: bold;">{$styles}</span>}<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span>
<a name="line4365"></a>            <span style="color: #009900;">&#125;</span>
<a name="line4366"></a>        <span style="color: #009900;">&#125;</span>
<a name="line4367"></a>        <span style="color: #666666; font-style: italic;">// note: neglect economy_mode, empty styles are meaningless</span>
<a name="line4368"></a>        <span style="color: #b1b100;">foreach</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'STYLES'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'SCRIPT'</span><span style="color: #009900;">&#93;</span> <span style="color: #b1b100;">as</span> <span style="color: #000088;">$group</span> <span style="color: #339933;">=&gt;</span> <span style="color: #000088;">$styles</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line4369"></a>            <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$styles</span> <span style="color: #339933;">!=</span> <span style="color: #0000ff;">''</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line4370"></a>                <span style="color: #000088;">$stylesheet</span> <span style="color: #339933;">.=</span> <span style="color: #0000ff;">&quot;<span style="color: #006699; font-weight: bold;">$selector</span>.sc<span style="color: #006699; font-weight: bold;">$group</span> {<span style="color: #006699; font-weight: bold;">{$styles}</span>}<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span>
<a name="line4371"></a>            <span style="color: #009900;">&#125;</span>
<a name="line4372"></a>        <span style="color: #009900;">&#125;</span>
<a name="line4373"></a>        <span style="color: #b1b100;">foreach</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'STYLES'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'REGEXPS'</span><span style="color: #009900;">&#93;</span> <span style="color: #b1b100;">as</span> <span style="color: #000088;">$group</span> <span style="color: #339933;">=&gt;</span> <span style="color: #000088;">$styles</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line4374"></a>            <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$styles</span> <span style="color: #339933;">!=</span> <span style="color: #0000ff;">''</span> <span style="color: #339933;">&amp;&amp;</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><span style="color: #000088;">$economy_mode</span> <span style="color: #339933;">||</span>
<a name="line4375"></a>                <span style="color: #009900;">&#40;</span><a href="http://www.php.net/isset"><span style="color: #990000;">isset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">lexic_permissions</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'REGEXPS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$group</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">&amp;&amp;</span>
<a name="line4376"></a>                <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">lexic_permissions</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'REGEXPS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$group</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line4377"></a>                <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><a href="http://www.php.net/is_array"><span style="color: #990000;">is_array</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'REGEXPS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$group</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">&amp;&amp;</span>
<a name="line4378"></a>                    <a href="http://www.php.net/array_key_exists"><span style="color: #990000;">array_key_exists</span></a><span style="color: #009900;">&#40;</span>GESHI_CLASS<span style="color: #339933;">,</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'REGEXPS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$group</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line4379"></a>                    <span style="color: #000088;">$stylesheet</span> <span style="color: #339933;">.=</span> <span style="color: #0000ff;">&quot;<span style="color: #006699; font-weight: bold;">$selector</span>.&quot;</span><span style="color: #339933;">;</span>
<a name="line4380"></a>                    <span style="color: #000088;">$stylesheet</span> <span style="color: #339933;">.=</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">language_data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'REGEXPS'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$group</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span>GESHI_CLASS<span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
<a name="line4381"></a>                    <span style="color: #000088;">$stylesheet</span> <span style="color: #339933;">.=</span> <span style="color: #0000ff;">&quot; {<span style="color: #006699; font-weight: bold;">{$styles}</span>}<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span>
<a name="line4382"></a>                <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line4383"></a>                    <span style="color: #000088;">$stylesheet</span> <span style="color: #339933;">.=</span> <span style="color: #0000ff;">&quot;<span style="color: #006699; font-weight: bold;">$selector</span>.re<span style="color: #006699; font-weight: bold;">$group</span> {<span style="color: #006699; font-weight: bold;">{$styles}</span>}<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span>
<a name="line4384"></a>                <span style="color: #009900;">&#125;</span>
<a name="line4385"></a>            <span style="color: #009900;">&#125;</span>
<a name="line4386"></a>        <span style="color: #009900;">&#125;</span>
<a name="line4387"></a>        <span style="color: #666666; font-style: italic;">// Styles for lines being highlighted extra</span>
<a name="line4388"></a>        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><span style="color: #000088;">$economy_mode</span> <span style="color: #339933;">||</span> <span style="color: #009900;">&#40;</span><a href="http://www.php.net/count"><span style="color: #990000;">count</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">highlight_extra_lines</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">!=</span><a href="http://www.php.net/count"><span style="color: #990000;">count</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">highlight_extra_lines_styles</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line4389"></a>            <span style="color: #000088;">$stylesheet</span> <span style="color: #339933;">.=</span> <span style="color: #0000ff;">&quot;<span style="color: #006699; font-weight: bold;">{$selector}</span>.ln-xtra, <span style="color: #006699; font-weight: bold;">{$selector}</span>li.ln-xtra, <span style="color: #006699; font-weight: bold;">{$selector}</span>div.ln-xtra {<span style="color: #006699; font-weight: bold;">{$this-&gt;highlight_extra_lines_style}</span>}<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span>
<a name="line4390"></a>        <span style="color: #009900;">&#125;</span>
<a name="line4391"></a>        <span style="color: #000088;">$stylesheet</span> <span style="color: #339933;">.=</span> <span style="color: #0000ff;">&quot;<span style="color: #006699; font-weight: bold;">{$selector}</span>span.xtra { display:block; }<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span>
<a name="line4392"></a>        <span style="color: #b1b100;">foreach</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">highlight_extra_lines_styles</span> <span style="color: #b1b100;">as</span> <span style="color: #000088;">$lineid</span> <span style="color: #339933;">=&gt;</span> <span style="color: #000088;">$linestyle</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line4393"></a>            <span style="color: #000088;">$stylesheet</span> <span style="color: #339933;">.=</span> <span style="color: #0000ff;">&quot;<span style="color: #006699; font-weight: bold;">{$selector}</span>.lx<span style="color: #006699; font-weight: bold;">$lineid</span>, <span style="color: #006699; font-weight: bold;">{$selector}</span>li.lx<span style="color: #006699; font-weight: bold;">$lineid</span>, <span style="color: #006699; font-weight: bold;">{$selector}</span>div.lx<span style="color: #006699; font-weight: bold;">$lineid</span> {<span style="color: #006699; font-weight: bold;">{$linestyle}</span>}<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span>
<a name="line4394"></a>        <span style="color: #009900;">&#125;</span>
<a name="line4395"></a>&nbsp;
<a name="line4396"></a>        <span style="color: #b1b100;">return</span> <span style="color: #000088;">$stylesheet</span><span style="color: #339933;">;</span>
<a name="line4397"></a>    <span style="color: #009900;">&#125;</span>
<a name="line4398"></a>&nbsp;
<a name="line4399"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line4400"></a>     * Get's the style that is used for the specified line
<a name="line4401"></a>     *
<a name="line4402"></a>     * @param int The line number information is requested for
<a name="line4403"></a>     * @access private
<a name="line4404"></a>     * @since 1.0.7.21
<a name="line4405"></a>     */</span>
<a name="line4406"></a>    <span style="color: #000000; font-weight: bold;">function</span> get_line_style<span style="color: #009900;">&#40;</span><span style="color: #000088;">$line</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line4407"></a>        <span style="color: #666666; font-style: italic;">//$style = null;</span>
<a name="line4408"></a>        <span style="color: #000088;">$style</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">null</span><span style="color: #339933;">;</span>
<a name="line4409"></a>        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><a href="http://www.php.net/isset"><span style="color: #990000;">isset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">highlight_extra_lines_styles</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$line</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line4410"></a>            <span style="color: #000088;">$style</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">highlight_extra_lines_styles</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$line</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
<a name="line4411"></a>        <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span> <span style="color: #666666; font-style: italic;">// if no &quot;extra&quot; style assigned</span>
<a name="line4412"></a>            <span style="color: #000088;">$style</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">highlight_extra_lines_style</span><span style="color: #339933;">;</span>
<a name="line4413"></a>        <span style="color: #009900;">&#125;</span>
<a name="line4414"></a>&nbsp;
<a name="line4415"></a>        <span style="color: #b1b100;">return</span> <span style="color: #000088;">$style</span><span style="color: #339933;">;</span>
<a name="line4416"></a>    <span style="color: #009900;">&#125;</span>
<a name="line4417"></a>&nbsp;
<a name="line4418"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line4419"></a>    * this functions creates an optimized regular expression list
<a name="line4420"></a>    * of an array of strings.
<a name="line4421"></a>    *
<a name="line4422"></a>    * Example:
<a name="line4423"></a>    * &lt;code&gt;$list = array('faa', 'foo', 'foobar');
<a name="line4424"></a>    *          =&gt; string 'f(aa|oo(bar)?)'&lt;/code&gt;
<a name="line4425"></a>    *
<a name="line4426"></a>    * @param $list array of (unquoted) strings
<a name="line4427"></a>    * @param $regexp_delimiter your regular expression delimiter, @see preg_quote()
<a name="line4428"></a>    * @return string for regular expression
<a name="line4429"></a>    * @author Milian Wolff &lt;mail@milianw.de&gt;
<a name="line4430"></a>    * @since 1.0.8
<a name="line4431"></a>    * @access private
<a name="line4432"></a>    */</span>
<a name="line4433"></a>    <span style="color: #000000; font-weight: bold;">function</span> optimize_regexp_list<span style="color: #009900;">&#40;</span><span style="color: #000088;">$list</span><span style="color: #339933;">,</span> <span style="color: #000088;">$regexp_delimiter</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">'/'</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line4434"></a>        <span style="color: #000088;">$regex_chars</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'.'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'\\'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'+'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'*'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'?'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'['</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'^'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">']'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'$'</span><span style="color: #339933;">,</span>
<a name="line4435"></a>            <span style="color: #0000ff;">'('</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">')'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'{'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'}'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'='</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'!'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'&lt;'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'&gt;'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'|'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">':'</span><span style="color: #339933;">,</span> <span style="color: #000088;">$regexp_delimiter</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line4436"></a>        <a href="http://www.php.net/sort"><span style="color: #990000;">sort</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$list</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line4437"></a>        <span style="color: #000088;">$regexp_list</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">''</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line4438"></a>        <span style="color: #000088;">$num_subpatterns</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span>
<a name="line4439"></a>        <span style="color: #000088;">$list_key</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span>
<a name="line4440"></a>&nbsp;
<a name="line4441"></a>        <span style="color: #666666; font-style: italic;">// the tokens which we will use to generate the regexp list</span>
<a name="line4442"></a>        <span style="color: #000088;">$tokens</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line4443"></a>        <span style="color: #000088;">$prev_keys</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line4444"></a>        <span style="color: #666666; font-style: italic;">// go through all entries of the list and generate the token list</span>
<a name="line4445"></a>        <span style="color: #000088;">$cur_len</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span>
<a name="line4446"></a>        <span style="color: #b1b100;">for</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$i</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span> <span style="color: #000088;">$i_max</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/count"><span style="color: #990000;">count</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$list</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #000088;">$i</span> <span style="color: #339933;">&lt;</span> <span style="color: #000088;">$i_max</span><span style="color: #339933;">;</span> <span style="color: #339933;">++</span><span style="color: #000088;">$i</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line4447"></a>            <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$cur_len</span> <span style="color: #339933;">&gt;</span> GESHI_MAX_PCRE_LENGTH<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line4448"></a>                <span style="color: #666666; font-style: italic;">// seems like the length of this pcre is growing exorbitantly</span>
<a name="line4449"></a>                <span style="color: #000088;">$regexp_list</span><span style="color: #009900;">&#91;</span><span style="color: #339933;">++</span><span style="color: #000088;">$list_key</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span>_optimize_regexp_list_tokens_to_string<span style="color: #009900;">&#40;</span><span style="color: #000088;">$tokens</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line4450"></a>                <span style="color: #000088;">$num_subpatterns</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/substr_count"><span style="color: #990000;">substr_count</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$regexp_list</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$list_key</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'(?:'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line4451"></a>                <span style="color: #000088;">$tokens</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line4452"></a>                <span style="color: #000088;">$cur_len</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span>
<a name="line4453"></a>            <span style="color: #009900;">&#125;</span>
<a name="line4454"></a>            <span style="color: #000088;">$level</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span>
<a name="line4455"></a>            <span style="color: #000088;">$entry</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/preg_quote"><span style="color: #990000;">preg_quote</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#40;</span>string<span style="color: #009900;">&#41;</span> <span style="color: #000088;">$list</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$i</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> <span style="color: #000088;">$regexp_delimiter</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line4456"></a>            <span style="color: #000088;">$pointer</span> <span style="color: #339933;">=</span> <span style="color: #339933;">&amp;</span><span style="color: #000088;">$tokens</span><span style="color: #339933;">;</span>
<a name="line4457"></a>            <span style="color: #666666; font-style: italic;">// properly assign the new entry to the correct position in the token array</span>
<a name="line4458"></a>            <span style="color: #666666; font-style: italic;">// possibly generate smaller common denominator keys</span>
<a name="line4459"></a>            <span style="color: #b1b100;">while</span> <span style="color: #009900;">&#40;</span><span style="color: #009900; font-weight: bold;">true</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line4460"></a>                <span style="color: #666666; font-style: italic;">// get the common denominator</span>
<a name="line4461"></a>                <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><a href="http://www.php.net/isset"><span style="color: #990000;">isset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$prev_keys</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$level</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line4462"></a>                    <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$prev_keys</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$level</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">==</span> <span style="color: #000088;">$entry</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line4463"></a>                        <span style="color: #666666; font-style: italic;">// this is a duplicate entry, skip it</span>
<a name="line4464"></a>                        <span style="color: #b1b100;">continue</span> <span style="color: #cc66cc;">2</span><span style="color: #339933;">;</span>
<a name="line4465"></a>                    <span style="color: #009900;">&#125;</span>
<a name="line4466"></a>                    <span style="color: #000088;">$char</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span>
<a name="line4467"></a>                    <span style="color: #b1b100;">while</span> <span style="color: #009900;">&#40;</span><a href="http://www.php.net/isset"><span style="color: #990000;">isset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$entry</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$char</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">&amp;&amp;</span> <a href="http://www.php.net/isset"><span style="color: #990000;">isset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$prev_keys</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$level</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$char</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span>
<a name="line4468"></a>                            <span style="color: #339933;">&amp;&amp;</span> <span style="color: #000088;">$entry</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$char</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">==</span> <span style="color: #000088;">$prev_keys</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$level</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$char</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line4469"></a>                        <span style="color: #339933;">++</span><span style="color: #000088;">$char</span><span style="color: #339933;">;</span>
<a name="line4470"></a>                    <span style="color: #009900;">&#125;</span>
<a name="line4471"></a>                    <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$char</span> <span style="color: #339933;">&gt;</span> <span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line4472"></a>                        <span style="color: #666666; font-style: italic;">// this entry has at least some chars in common with the current key</span>
<a name="line4473"></a>                        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$char</span> <span style="color: #339933;">==</span> <a href="http://www.php.net/strlen"><span style="color: #990000;">strlen</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$prev_keys</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$level</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line4474"></a>                            <span style="color: #666666; font-style: italic;">// current key is totally matched, i.e. this entry has just some bits appended</span>
<a name="line4475"></a>                            <span style="color: #000088;">$pointer</span> <span style="color: #339933;">=</span> <span style="color: #339933;">&amp;</span><span style="color: #000088;">$pointer</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$prev_keys</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$level</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
<a name="line4476"></a>                        <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line4477"></a>                            <span style="color: #666666; font-style: italic;">// only part of the keys match</span>
<a name="line4478"></a>                            <span style="color: #000088;">$new_key_part1</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/substr"><span style="color: #990000;">substr</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$prev_keys</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$level</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span> <span style="color: #000088;">$char</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line4479"></a>                            <span style="color: #000088;">$new_key_part2</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/substr"><span style="color: #990000;">substr</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$prev_keys</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$level</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> <span style="color: #000088;">$char</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line4480"></a>&nbsp;
<a name="line4481"></a>                            <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><a href="http://www.php.net/in_array"><span style="color: #990000;">in_array</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$new_key_part1</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> <span style="color: #000088;">$regex_chars</span><span style="color: #009900;">&#41;</span>
<a name="line4482"></a>                                <span style="color: #339933;">||</span> <a href="http://www.php.net/in_array"><span style="color: #990000;">in_array</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$new_key_part2</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> <span style="color: #000088;">$regex_chars</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line4483"></a>                                <span style="color: #666666; font-style: italic;">// this is bad, a regex char as first character</span>
<a name="line4484"></a>                                <span style="color: #000088;">$pointer</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$entry</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">''</span> <span style="color: #339933;">=&gt;</span> <span style="color: #009900; font-weight: bold;">true</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line4485"></a>                                <a href="http://www.php.net/array_splice"><span style="color: #990000;">array_splice</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$prev_keys</span><span style="color: #339933;">,</span> <span style="color: #000088;">$level</span><span style="color: #339933;">,</span> <a href="http://www.php.net/count"><span style="color: #990000;">count</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$prev_keys</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <span style="color: #000088;">$entry</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line4486"></a>                                <span style="color: #000088;">$cur_len</span> <span style="color: #339933;">+=</span> <a href="http://www.php.net/strlen"><span style="color: #990000;">strlen</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$entry</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line4487"></a>                                <span style="color: #b1b100;">continue</span><span style="color: #339933;">;</span>
<a name="line4488"></a>                            <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line4489"></a>                                <span style="color: #666666; font-style: italic;">// relocate previous tokens</span>
<a name="line4490"></a>                                <span style="color: #000088;">$pointer</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$new_key_part1</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$new_key_part2</span> <span style="color: #339933;">=&gt;</span> <span style="color: #000088;">$pointer</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$prev_keys</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$level</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line4491"></a>                                <a href="http://www.php.net/unset"><span style="color: #990000;">unset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$pointer</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$prev_keys</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$level</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line4492"></a>                                <span style="color: #000088;">$pointer</span> <span style="color: #339933;">=</span> <span style="color: #339933;">&amp;</span><span style="color: #000088;">$pointer</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$new_key_part1</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
<a name="line4493"></a>                                <span style="color: #666666; font-style: italic;">// recreate key index</span>
<a name="line4494"></a>                                <a href="http://www.php.net/array_splice"><span style="color: #990000;">array_splice</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$prev_keys</span><span style="color: #339933;">,</span> <span style="color: #000088;">$level</span><span style="color: #339933;">,</span> <a href="http://www.php.net/count"><span style="color: #990000;">count</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$prev_keys</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$new_key_part1</span><span style="color: #339933;">,</span> <span style="color: #000088;">$new_key_part2</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line4495"></a>                                <span style="color: #000088;">$cur_len</span> <span style="color: #339933;">+=</span> <a href="http://www.php.net/strlen"><span style="color: #990000;">strlen</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$new_key_part2</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line4496"></a>                            <span style="color: #009900;">&#125;</span>
<a name="line4497"></a>                        <span style="color: #009900;">&#125;</span>
<a name="line4498"></a>                        <span style="color: #339933;">++</span><span style="color: #000088;">$level</span><span style="color: #339933;">;</span>
<a name="line4499"></a>                        <span style="color: #000088;">$entry</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/substr"><span style="color: #990000;">substr</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$entry</span><span style="color: #339933;">,</span> <span style="color: #000088;">$char</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line4500"></a>                        <span style="color: #b1b100;">continue</span><span style="color: #339933;">;</span>
<a name="line4501"></a>                    <span style="color: #009900;">&#125;</span>
<a name="line4502"></a>                    <span style="color: #666666; font-style: italic;">// else: fall trough, i.e. no common denominator was found</span>
<a name="line4503"></a>                <span style="color: #009900;">&#125;</span>
<a name="line4504"></a>                <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$level</span> <span style="color: #339933;">==</span> <span style="color: #cc66cc;">0</span> <span style="color: #339933;">&amp;&amp;</span> <span style="color: #339933;">!</span><a href="http://www.php.net/empty"><span style="color: #990000;">empty</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$tokens</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line4505"></a>                    <span style="color: #666666; font-style: italic;">// we can dump current tokens into the string and throw them away afterwards</span>
<a name="line4506"></a>                    <span style="color: #000088;">$new_entry</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span>_optimize_regexp_list_tokens_to_string<span style="color: #009900;">&#40;</span><span style="color: #000088;">$tokens</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line4507"></a>                    <span style="color: #000088;">$new_subpatterns</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/substr_count"><span style="color: #990000;">substr_count</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$new_entry</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'(?:'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line4508"></a>                    <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span>GESHI_MAX_PCRE_SUBPATTERNS <span style="color: #339933;">&amp;&amp;</span> <span style="color: #000088;">$num_subpatterns</span> <span style="color: #339933;">+</span> <span style="color: #000088;">$new_subpatterns</span> <span style="color: #339933;">&gt;</span> GESHI_MAX_PCRE_SUBPATTERNS<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line4509"></a>                        <span style="color: #000088;">$regexp_list</span><span style="color: #009900;">&#91;</span><span style="color: #339933;">++</span><span style="color: #000088;">$list_key</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$new_entry</span><span style="color: #339933;">;</span>
<a name="line4510"></a>                        <span style="color: #000088;">$num_subpatterns</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$new_subpatterns</span><span style="color: #339933;">;</span>
<a name="line4511"></a>                    <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line4512"></a>                        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><a href="http://www.php.net/empty"><span style="color: #990000;">empty</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$regexp_list</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$list_key</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line4513"></a>                            <span style="color: #000088;">$new_entry</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">'|'</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$new_entry</span><span style="color: #339933;">;</span>
<a name="line4514"></a>                        <span style="color: #009900;">&#125;</span>
<a name="line4515"></a>                        <span style="color: #000088;">$regexp_list</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$list_key</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">.=</span> <span style="color: #000088;">$new_entry</span><span style="color: #339933;">;</span>
<a name="line4516"></a>                        <span style="color: #000088;">$num_subpatterns</span> <span style="color: #339933;">+=</span> <span style="color: #000088;">$new_subpatterns</span><span style="color: #339933;">;</span>
<a name="line4517"></a>                    <span style="color: #009900;">&#125;</span>
<a name="line4518"></a>                    <span style="color: #000088;">$tokens</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line4519"></a>                    <span style="color: #000088;">$cur_len</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span>
<a name="line4520"></a>                <span style="color: #009900;">&#125;</span>
<a name="line4521"></a>                <span style="color: #666666; font-style: italic;">// no further common denominator found</span>
<a name="line4522"></a>                <span style="color: #000088;">$pointer</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$entry</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">''</span> <span style="color: #339933;">=&gt;</span> <span style="color: #009900; font-weight: bold;">true</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line4523"></a>                <a href="http://www.php.net/array_splice"><span style="color: #990000;">array_splice</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$prev_keys</span><span style="color: #339933;">,</span> <span style="color: #000088;">$level</span><span style="color: #339933;">,</span> <a href="http://www.php.net/count"><span style="color: #990000;">count</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$prev_keys</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <span style="color: #000088;">$entry</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line4524"></a>&nbsp;
<a name="line4525"></a>                <span style="color: #000088;">$cur_len</span> <span style="color: #339933;">+=</span> <a href="http://www.php.net/strlen"><span style="color: #990000;">strlen</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$entry</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line4526"></a>                <span style="color: #b1b100;">break</span><span style="color: #339933;">;</span>
<a name="line4527"></a>            <span style="color: #009900;">&#125;</span>
<a name="line4528"></a>            <a href="http://www.php.net/unset"><span style="color: #990000;">unset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$list</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$i</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line4529"></a>        <span style="color: #009900;">&#125;</span>
<a name="line4530"></a>        <span style="color: #666666; font-style: italic;">// make sure the last tokens get converted as well</span>
<a name="line4531"></a>        <span style="color: #000088;">$new_entry</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span>_optimize_regexp_list_tokens_to_string<span style="color: #009900;">&#40;</span><span style="color: #000088;">$tokens</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line4532"></a>        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span>GESHI_MAX_PCRE_SUBPATTERNS <span style="color: #339933;">&amp;&amp;</span> <span style="color: #000088;">$num_subpatterns</span> <span style="color: #339933;">+</span> <a href="http://www.php.net/substr_count"><span style="color: #990000;">substr_count</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$new_entry</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'(?:'</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">&gt;</span> GESHI_MAX_PCRE_SUBPATTERNS<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line4533"></a>            <span style="color: #000088;">$regexp_list</span><span style="color: #009900;">&#91;</span><span style="color: #339933;">++</span><span style="color: #000088;">$list_key</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$new_entry</span><span style="color: #339933;">;</span>
<a name="line4534"></a>        <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
<a name="line4535"></a>            <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><a href="http://www.php.net/empty"><span style="color: #990000;">empty</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$regexp_list</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$list_key</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line4536"></a>                <span style="color: #000088;">$new_entry</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">'|'</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$new_entry</span><span style="color: #339933;">;</span>
<a name="line4537"></a>            <span style="color: #009900;">&#125;</span>
<a name="line4538"></a>            <span style="color: #000088;">$regexp_list</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$list_key</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">.=</span> <span style="color: #000088;">$new_entry</span><span style="color: #339933;">;</span>
<a name="line4539"></a>        <span style="color: #009900;">&#125;</span>
<a name="line4540"></a>        <span style="color: #b1b100;">return</span> <span style="color: #000088;">$regexp_list</span><span style="color: #339933;">;</span>
<a name="line4541"></a>    <span style="color: #009900;">&#125;</span>
<a name="line4542"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line4543"></a>    * this function creates the appropriate regexp string of an token array
<a name="line4544"></a>    * you should not call this function directly, @see $this-&gt;optimize_regexp_list().
<a name="line4545"></a>    *
<a name="line4546"></a>    * @param &amp;$tokens array of tokens
<a name="line4547"></a>    * @param $recursed bool to know wether we recursed or not
<a name="line4548"></a>    * @return string
<a name="line4549"></a>    * @author Milian Wolff &lt;mail@milianw.de&gt;
<a name="line4550"></a>    * @since 1.0.8
<a name="line4551"></a>    * @access private
<a name="line4552"></a>    */</span>
<a name="line4553"></a>    <span style="color: #000000; font-weight: bold;">function</span> _optimize_regexp_list_tokens_to_string<span style="color: #009900;">&#40;</span><span style="color: #339933;">&amp;</span><span style="color: #000088;">$tokens</span><span style="color: #339933;">,</span> <span style="color: #000088;">$recursed</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line4554"></a>        <span style="color: #000088;">$list</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">''</span><span style="color: #339933;">;</span>
<a name="line4555"></a>        <span style="color: #b1b100;">foreach</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$tokens</span> <span style="color: #b1b100;">as</span> <span style="color: #000088;">$token</span> <span style="color: #339933;">=&gt;</span> <span style="color: #000088;">$sub_tokens</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line4556"></a>            <span style="color: #000088;">$list</span> <span style="color: #339933;">.=</span> <span style="color: #000088;">$token</span><span style="color: #339933;">;</span>
<a name="line4557"></a>            <span style="color: #000088;">$close_entry</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/isset"><span style="color: #990000;">isset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$sub_tokens</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">''</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line4558"></a>            <a href="http://www.php.net/unset"><span style="color: #990000;">unset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$sub_tokens</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">''</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line4559"></a>            <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><a href="http://www.php.net/empty"><span style="color: #990000;">empty</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$sub_tokens</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line4560"></a>                <span style="color: #000088;">$list</span> <span style="color: #339933;">.=</span> <span style="color: #0000ff;">'(?:'</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span>_optimize_regexp_list_tokens_to_string<span style="color: #009900;">&#40;</span><span style="color: #000088;">$sub_tokens</span><span style="color: #339933;">,</span> <span style="color: #009900; font-weight: bold;">true</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">')'</span><span style="color: #339933;">;</span>
<a name="line4561"></a>                <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$close_entry</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line4562"></a>                    <span style="color: #666666; font-style: italic;">// make sub_tokens optional</span>
<a name="line4563"></a>                    <span style="color: #000088;">$list</span> <span style="color: #339933;">.=</span> <span style="color: #0000ff;">'?'</span><span style="color: #339933;">;</span>
<a name="line4564"></a>                <span style="color: #009900;">&#125;</span>
<a name="line4565"></a>            <span style="color: #009900;">&#125;</span>
<a name="line4566"></a>            <span style="color: #000088;">$list</span> <span style="color: #339933;">.=</span> <span style="color: #0000ff;">'|'</span><span style="color: #339933;">;</span>
<a name="line4567"></a>        <span style="color: #009900;">&#125;</span>
<a name="line4568"></a>        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><span style="color: #000088;">$recursed</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line4569"></a>            <span style="color: #666666; font-style: italic;">// do some optimizations</span>
<a name="line4570"></a>            <span style="color: #666666; font-style: italic;">// common trailing strings</span>
<a name="line4571"></a>            <span style="color: #666666; font-style: italic;">// BUGGY!</span>
<a name="line4572"></a>            <span style="color: #666666; font-style: italic;">//$list = preg_replace_callback('#(?&lt;=^|\:|\|)\w+?(\w+)(?:\|.+\1)+(?=\|)#', create_function(</span>
<a name="line4573"></a>            <span style="color: #666666; font-style: italic;">//    '$matches', 'return &quot;(?:&quot; . preg_replace(&quot;#&quot; . preg_quote($matches[1], &quot;#&quot;) . &quot;(?=\||$)#&quot;, &quot;&quot;, $matches[0]) . &quot;)&quot; . $matches[1];'), $list);</span>
<a name="line4574"></a>            <span style="color: #666666; font-style: italic;">// (?:p)? =&gt; p?</span>
<a name="line4575"></a>            <span style="color: #000088;">$list</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/preg_replace"><span style="color: #990000;">preg_replace</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'#\(\?\:(.)\)\?#'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'\1?'</span><span style="color: #339933;">,</span> <span style="color: #000088;">$list</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line4576"></a>            <span style="color: #666666; font-style: italic;">// (?:a|b|c|d|...)? =&gt; [abcd...]?</span>
<a name="line4577"></a>            <span style="color: #666666; font-style: italic;">// TODO: a|bb|c =&gt; [ac]|bb</span>
<a name="line4578"></a>            static <span style="color: #000088;">$callback_2</span><span style="color: #339933;">;</span>
<a name="line4579"></a>            <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><a href="http://www.php.net/isset"><span style="color: #990000;">isset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$callback_2</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line4580"></a>                <span style="color: #000088;">$callback_2</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/create_function"><span style="color: #990000;">create_function</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'$matches'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'return &quot;[&quot; . str_replace(&quot;|&quot;, &quot;&quot;, $matches[1]) . &quot;]&quot;;'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line4581"></a>            <span style="color: #009900;">&#125;</span>
<a name="line4582"></a>            <span style="color: #000088;">$list</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/preg_replace_callback"><span style="color: #990000;">preg_replace_callback</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'#\(\?\:((?:.\|)+.)\)#'</span><span style="color: #339933;">,</span> <span style="color: #000088;">$callback_2</span><span style="color: #339933;">,</span> <span style="color: #000088;">$list</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line4583"></a>        <span style="color: #009900;">&#125;</span>
<a name="line4584"></a>        <span style="color: #666666; font-style: italic;">// return $list without trailing pipe</span>
<a name="line4585"></a>        <span style="color: #b1b100;">return</span> <a href="http://www.php.net/substr"><span style="color: #990000;">substr</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$list</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span> <span style="color: #339933;">-</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line4586"></a>    <span style="color: #009900;">&#125;</span>
<a name="line4587"></a><span style="color: #009900;">&#125;</span> <span style="color: #666666; font-style: italic;">// End Class GeSHi</span>
<a name="line4588"></a>&nbsp;
<a name="line4589"></a>&nbsp;
<a name="line4590"></a><span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><a href="http://www.php.net/function_exists"><span style="color: #990000;">function_exists</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'geshi_highlight'</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line4591"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line4592"></a>     * Easy way to highlight stuff. Behaves just like highlight_string
<a name="line4593"></a>     *
<a name="line4594"></a>     * @param string The code to highlight
<a name="line4595"></a>     * @param string The language to highlight the code in
<a name="line4596"></a>     * @param string The path to the language files. You can leave this blank if you need
<a name="line4597"></a>     *               as from version 1.0.7 the path should be automatically detected
<a name="line4598"></a>     * @param boolean Whether to return the result or to echo
<a name="line4599"></a>     * @return string The code highlighted (if $return is true)
<a name="line4600"></a>     * @since 1.0.2
<a name="line4601"></a>     */</span>
<a name="line4602"></a>    <span style="color: #000000; font-weight: bold;">function</span> geshi_highlight<span style="color: #009900;">&#40;</span><span style="color: #000088;">$string</span><span style="color: #339933;">,</span> <span style="color: #000088;">$language</span><span style="color: #339933;">,</span> <span style="color: #000088;">$path</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">null</span><span style="color: #339933;">,</span> <span style="color: #000088;">$return</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line4603"></a>        <span style="color: #000088;">$geshi</span> <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> GeSHi<span style="color: #009900;">&#40;</span><span style="color: #000088;">$string</span><span style="color: #339933;">,</span> <span style="color: #000088;">$language</span><span style="color: #339933;">,</span> <span style="color: #000088;">$path</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line4604"></a>        <span style="color: #000088;">$geshi</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">set_header_type</span><span style="color: #009900;">&#40;</span>GESHI_HEADER_NONE<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line4605"></a>&nbsp;
<a name="line4606"></a>        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$return</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line4607"></a>            <span style="color: #b1b100;">return</span> <span style="color: #0000ff;">'&lt;code&gt;'</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$geshi</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">parse_code</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">'&lt;/code&gt;'</span><span style="color: #339933;">;</span>
<a name="line4608"></a>        <span style="color: #009900;">&#125;</span>
<a name="line4609"></a>&nbsp;
<a name="line4610"></a>        <span style="color: #b1b100;">echo</span> <span style="color: #0000ff;">'&lt;code&gt;'</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$geshi</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">parse_code</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">'&lt;/code&gt;'</span><span style="color: #339933;">;</span>
<a name="line4611"></a>&nbsp;
<a name="line4612"></a>        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$geshi</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">error</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a name="line4613"></a>            <span style="color: #b1b100;">return</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #339933;">;</span>
<a name="line4614"></a>        <span style="color: #009900;">&#125;</span>
<a name="line4615"></a>        <span style="color: #b1b100;">return</span> <span style="color: #009900; font-weight: bold;">true</span><span style="color: #339933;">;</span>
<a name="line4616"></a>    <span style="color: #009900;">&#125;</span>
<a name="line4617"></a><span style="color: #009900;">&#125;</span>
<a name="line4618"></a>&nbsp;
<a name="line4619"></a><span style="color: #000000; font-weight: bold;">?&gt;</span></pre>
<div class="header">
<h1>GeSHi</h1>
<ul>
<li><a href="../overview-summary.html">Overview</a></li>
<li>Package</li><li>Class</li><li>Tree</li><li><a href="../overview-files.html">Files</a></li>
<li><a href="../deprecated-list.html">Deprecated</a></li>
<li><a href="../index-all.html">Index</a></li>
</ul>
</div>

<div class="small_links">
<a href="../index.html" target="_top">Frames</a>
<a href="../source/geshi.php.html" target="_top">No frames</a>
</div>
<hr>

<p id="footer">This document was generated by <a href="http://peej.github.com/phpdoctor/">PHPDoctor: The PHP Documentation Creator</a></p>

</body>

</html>